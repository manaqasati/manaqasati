<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--p:#7c3aed;--p2:#6d28d9;--p-light:#ede9fe;--p-mid:#ddd6fe;--text:#1e1b4b;--muted:#6b7280;--border:#e5e7eb;--bg:#f8f7ff}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh}
.side{width:260px;background:#fff;border-left:1px solid var(--border);min-height:100vh;position:fixed;right:0;top:0;display:flex;flex-direction:column;box-shadow:2px 0 20px rgba(0,0,0,0.04);z-index:100}
.side-head{padding:24px 20px;border-bottom:1px solid var(--border)}
.side-logo{font-size:22px;font-weight:900;color:var(--p);margin-bottom:16px}
.side-logo span{color:#f59e0b}
.user-card{background:var(--p-light);border-radius:14px;padding:14px;display:flex;align-items:center;gap:12px}
.user-av{width:42px;height:42px;border-radius:12px;background:var(--p);display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;font-weight:800;flex-shrink:0}
.user-name{font-size:14px;font-weight:800;color:var(--text)}
.user-role{font-size:11px;color:var(--p);font-weight:600;margin-top:2px}
.menu{padding:16px 12px;flex:1}
.menu-sec{font-size:11px;font-weight:700;color:var(--muted);padding:0 8px;margin:16px 0 8px}
.menu-item{display:flex;align-items:center;gap:10px;padding:11px 12px;border-radius:12px;color:var(--muted);cursor:pointer;transition:.2s;font-size:14px;font-weight:600;border:none;background:none;width:100%;text-align:right;font-family:'Tajawal',sans-serif;margin-bottom:2px}
.menu-item:hover{background:var(--bg);color:var(--text)}
.menu-item.on{background:var(--p-light);color:var(--p)}
.menu-item .ic{font-size:18px;width:26px;text-align:center}
.side-foot{padding:16px 20px;border-top:1px solid var(--border)}
.logout-btn{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;color:#ef4444;cursor:pointer;font-size:14px;font-weight:700;border:none;background:none;width:100%;font-family:'Tajawal',sans-serif}
.logout-btn:hover{background:#fee2e2}
.main{margin-right:260px;flex:1;display:flex;flex-direction:column;min-width:0}
.topbar{background:#fff;border-bottom:1px solid var(--border);padding:0 28px;height:64px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar-title{font-size:18px;font-weight:800;color:var(--text)}
.btn-new{background:var(--p);color:#fff;padding:9px 18px;border-radius:10px;font-size:14px;font-weight:800;cursor:pointer;border:none;font-family:'Tajawal',sans-serif;box-shadow:0 2px 12px rgba(124,58,237,0.3)}
.btn-new:hover{background:var(--p2);transform:translateY(-1px)}
.content{padding:28px;flex:1}
.page{display:none}.page.on{display:block}
.mobile-header{display:none;background:#fff;border-bottom:1px solid var(--border);padding:12px 20px;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.mobile-logo{font-size:20px;font-weight:900;color:var(--p)}
.mobile-logo span{color:#f59e0b}
.mobile-av{width:34px;height:34px;border-radius:10px;background:var(--p);display:flex;align-items:center;justify-content:center;font-size:15px;color:#fff;font-weight:800}
.bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--border);z-index:200;padding:8px 0 env(safe-area-inset-bottom,8px)}
.bottom-nav-items{display:flex;justify-content:space-around}
.bn-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 0;cursor:pointer;border:none;background:none;font-family:'Tajawal',sans-serif;color:var(--muted);flex:1}
.bn-item .bn-ic{font-size:22px}
.bn-item .bn-txt{font-size:10px;font-weight:700}
.bn-item.on{color:var(--p)}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
.stat-card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px 22px;display:flex;align-items:center;gap:16px;transition:.2s}
.stat-card:hover{border-color:var(--p-mid);box-shadow:0 4px 20px rgba(124,58,237,0.08)}
.stat-ic-wrap{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}
.si1{background:var(--p-light)}.si2{background:#fef3c7}.si3{background:#dcfce7}
.stat-n{font-size:28px;font-weight:900;color:var(--text)}
.stat-t{font-size:13px;color:var(--muted);margin-top:2px}
.welcome-card{background:linear-gradient(135deg,var(--p),var(--p2));border-radius:20px;padding:28px 32px;margin-bottom:24px;display:flex;align-items:center;justify-content:space-between;overflow:hidden;position:relative}
.welcome-card::before{content:'';position:absolute;top:-40px;left:-40px;width:200px;height:200px;background:rgba(255,255,255,0.06);border-radius:50%}
.welcome-text h2{font-size:20px;font-weight:800;color:#fff;margin-bottom:6px;position:relative}
.welcome-text p{font-size:14px;color:rgba(255,255,255,0.75);position:relative}
.welcome-btn{background:#fff;color:var(--p);padding:10px 22px;border-radius:10px;font-size:14px;font-weight:800;cursor:pointer;border:none;font-family:'Tajawal',sans-serif;white-space:nowrap}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:20px}
.card-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;padding-bottom:14px;border-bottom:1px solid var(--border)}
.card-head h3{font-size:15px;font-weight:800;color:var(--text)}
.req-item{border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px;transition:.2s}
.req-item:hover{border-color:var(--p-mid);background:var(--p-light)}
.req-item:last-child{margin-bottom:0}
.req-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:8px;gap:8px}
.req-title{font-size:15px;font-weight:800;color:var(--text)}
.req-meta{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
.req-tag{font-size:11px;color:var(--muted)}
.req-actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.tag{padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
.t-review{background:#fef3c7;color:#d97706}
.t-open{background:#dcfce7;color:#16a34a}
.t-done{background:var(--p-light);color:var(--p)}
.btn-sm{padding:7px 14px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:none;font-family:'Tajawal',sans-serif;transition:.2s}
.btn-rate{background:#fef3c7;color:#d97706}.btn-rate:hover{background:#fde68a}
.btn-done{background:#dcfce7;color:#16a34a}.btn-done:hover{background:#bbf7d0}
.empty{text-align:center;padding:48px 20px;color:var(--muted)}
.empty-ic{font-size:48px;margin-bottom:12px}
.empty h4{font-size:16px;font-weight:700;margin-bottom:6px;color:var(--text)}
.loading{text-align:center;padding:32px;color:var(--muted);font-size:14px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-full{grid-column:1/-1}
.g{margin-bottom:0}
.g label{display:block;font-size:13px;font-weight:700;color:var(--text);margin-bottom:6px}
.g input,.g textarea,.g select{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:14px;color:var(--text);outline:none;background:#fff;transition:.2s}
.g input:focus,.g textarea:focus,.g select:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(124,58,237,0.08)}
.g textarea{min-height:120px;resize:vertical}
.form-btns{display:flex;gap:10px;margin-top:20px}
.btn-submit{padding:12px 28px;background:var(--p);color:#fff;border:none;border-radius:10px;font-family:'Tajawal',sans-serif;font-size:15px;font-weight:800;cursor:pointer;transition:.2s}
.btn-submit:hover{background:var(--p2);transform:translateY(-1px)}
.btn-submit:disabled{opacity:.6;cursor:not-allowed;transform:none}
.btn-cancel{padding:12px 20px;background:var(--bg);color:var(--muted);border:1px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:15px;font-weight:700;cursor:pointer}
.msg{padding:12px 16px;border-radius:10px;font-size:14px;font-weight:600;margin-bottom:16px;display:none}
.msg.ok{background:#dcfce7;color:#16a34a;display:block}
.msg.err{background:#fee2e2;color:#dc2626;display:block}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:300;align-items:flex-end;justify-content:center;backdrop-filter:blur(6px)}
.overlay.show{display:flex}
.modal{background:#fff;border-radius:24px 24px 0 0;padding:28px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;box-shadow:0 -10px 40px rgba(0,0,0,0.15)}
.modal-handle{width:40px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 20px}
.modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.modal-head h3{font-size:17px;font-weight:800;color:var(--text)}
.modal-close{width:32px;height:32px;border-radius:8px;background:var(--bg);border:none;cursor:pointer;font-size:16px}
.agree-modal{background:#fff;border-radius:24px 24px 0 0;width:100%;max-width:520px;max-height:92vh;overflow:hidden;display:flex;flex-direction:column}
.agree-header{background:linear-gradient(135deg,#1e3a5f,#2d5f8a);padding:20px 24px;text-align:center;flex-shrink:0}
.agree-header h2{color:#fff;font-size:18px;font-weight:900;margin-bottom:4px}
.agree-header p{color:rgba(255,255,255,0.7);font-size:12px}
.agree-body{padding:20px 24px;overflow-y:auto;flex:1}
.quran-box{background:linear-gradient(135deg,#fef9e7,#fef3c7);border:2px solid #f59e0b;border-radius:14px;padding:16px;margin-bottom:16px;text-align:center}
.quran-title{font-size:13px;font-weight:700;color:#92400e;margin-bottom:8px}
.quran-text{font-size:14px;font-weight:700;color:#78350f;line-height:1.8}
.quran-source{font-size:12px;color:#92400e;font-weight:600;margin-top:8px}
.agree-text{background:#f8f7ff;border:1.5px solid var(--p-mid);border-radius:14px;padding:16px;margin-bottom:14px}
.agree-text p{font-size:14px;color:var(--text);line-height:1.9;font-weight:500}
.agree-text strong{color:var(--p);font-weight:800}
.note-box{background:#fef2f2;border:1.5px solid #fca5a5;border-radius:12px;padding:12px 16px;margin-bottom:16px}
.note-box p{font-size:13px;color:#dc2626;font-weight:600;line-height:1.7}
.agree-check{display:flex;align-items:flex-start;gap:12px;margin-bottom:16px;padding:12px;background:var(--p-light);border-radius:12px;cursor:pointer}
.agree-check input{width:20px;height:20px;cursor:pointer;margin-top:2px;accent-color:var(--p);flex-shrink:0}
.agree-check label{font-size:13px;font-weight:700;color:var(--text);cursor:pointer;line-height:1.6}
.agree-footer{padding:16px 24px;display:flex;gap:12px;border-top:1px solid var(--border);flex-shrink:0}
.btn-agree{flex:1;padding:14px;background:var(--p);color:#fff;border:none;border-radius:12px;font-family:'Tajawal',sans-serif;font-size:15px;font-weight:800;cursor:pointer}
.btn-agree:disabled{opacity:.4;cursor:not-allowed}
.btn-back{padding:14px 18px;background:var(--bg);color:var(--muted);border:1.5px solid var(--border);border-radius:12px;font-family:'Tajawal',sans-serif;font-size:15px;font-weight:700;cursor:pointer}
.stars{display:flex;gap:8px;margin-bottom:16px;justify-content:center}
.star{font-size:36px;cursor:pointer;transition:.2s;filter:grayscale(1);opacity:.4}
.star.on{filter:grayscale(0);opacity:1}
.rate-msg{padding:10px 14px;border-radius:9px;font-size:13px;font-weight:600;margin-bottom:14px;display:none}
.rate-msg.ok{background:#dcfce7;color:#16a34a;display:block}
.rate-msg.err{background:#fee2e2;color:#dc2626;display:block}
@media(max-width:768px){
  .side{display:none}
  .main{margin-right:0}
  .topbar{display:none}
  .mobile-header{display:flex}
  .bottom-nav{display:block}
  .content{padding:16px;padding-bottom:90px}
  .stats-grid{grid-template-columns:repeat(2,1fr);gap:12px}
  .stat-card{padding:14px;border-radius:14px}
  .stat-ic-wrap{width:40px;height:40px;font-size:18px}
  .stat-n{font-size:22px}
  .welcome-card{padding:20px;flex-direction:column;gap:14px;text-align:center;border-radius:16px}
  .welcome-text h2{font-size:17px}
  .welcome-btn{width:100%}
  .card{border-radius:14px;padding:16px}
  .form-grid{grid-template-columns:1fr}
  .form-full{grid-column:1}
  .form-btns{flex-direction:column}
  .btn-submit,.btn-cancel{width:100%;text-align:center}
  .req-actions{flex-direction:column}
  .btn-sm{width:100%;text-align:center;padding:10px}
}
</style>
</head>
<body>
<div class="side">
  <div class="side-head">
    <div class="side-logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></div>
    <div class="user-card">
      <div class="user-av" id="userAv">Ø¹</div>
      <div><div class="user-name" id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div><div class="user-role">Ø¹Ù…ÙŠÙ„</div></div>
    </div>
  </div>
  <div class="menu">
    <div class="menu-sec">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
    <button class="menu-item on" onclick="show('home',this,'home')"><span class="ic">ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="menu-item" onclick="show('requests',this,'requests')"><span class="ic">ğŸ“‹</span> Ø·Ù„Ø¨Ø§ØªÙŠ</button>
    <button class="menu-item" onclick="showAgreement()"><span class="ic">â•</span> Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
  </div>
  <div class="side-foot">
    <button class="logout-btn" onclick="logout()"><span>ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>
<div class="mobile-header">
  <div class="mobile-logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></div>
  <div style="display:flex;align-items:center;gap:10px">
    <div class="mobile-av" id="mobileAv">Ø¹</div>
    <button onclick="logout()" style="background:none;border:none;font-size:18px;cursor:pointer">ğŸšª</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <div class="topbar-title" id="pageTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <button class="btn-new" onclick="showAgreement()">â• Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
  </div>
  <div class="content">
    <div class="page on" id="page-home">
      <div class="welcome-card">
        <div class="welcome-text">
          <h2 id="welcomeName">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
          <p>Ø§Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ ÙˆØ§Ø³ØªÙ‚Ø¨Ù„ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶</p>
        </div>
        <button class="welcome-btn" onclick="showAgreement()">â• Ø£Ù†Ø´Ø± Ø·Ù„Ø¨Ø§Ù‹</button>
      </div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-ic-wrap si1">ğŸ“‹</div><div><div class="stat-n" id="s-total">0</div><div class="stat-t">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§ØªÙŠ</div></div></div>
        <div class="stat-card"><div class="stat-ic-wrap si2">â³</div><div><div class="stat-n" id="s-review">0</div><div class="stat-t">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div></div>
        <div class="stat-card"><div class="stat-ic-wrap si3">âœ…</div><div><div class="stat-n" id="s-open">0</div><div class="stat-t">Ù†Ø´Ø·Ø©</div></div></div>
      </div>
      <div class="card">
        <div class="card-head">
          <h3>ğŸ“‹ Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
          <a style="font-size:13px;color:var(--p);font-weight:700;cursor:pointer" onclick="show('requests',null,'requests')">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</a>
        </div>
        <div id="recent-reqs"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
    <div class="page" id="page-requests">
      <div class="card">
        <div class="card-head"><h3>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§ØªÙŠ</h3></div>
        <div id="all-reqs"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
    <div class="page" id="page-new">
      <div class="card">
        <div class="card-head"><h3>â• Ù†Ø´Ø± Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3></div>
        <div class="msg" id="new-msg"></div>
        <div class="form-grid">
          <div class="g form-full"><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨ *</label><input type="text" id="n-title" placeholder="Ù…Ø«Ø§Ù„: ØªØ±ÙƒÙŠØ¨ Ù…ÙƒÙŠÙ Ø³Ø¨Ù„ÙŠØª"></div>
          <div class="g form-full"><label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
            <select id="n-cat">
              <option>ØªÙƒÙŠÙŠÙ ÙˆØªØ¨Ø±ÙŠØ¯</option><option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option><option>Ø³Ø¨Ø§ÙƒØ©</option>
              <option>Ù†Ø¬Ø§Ø±Ø©</option><option>Ø¯Ù‡Ø§Ù†Ø§Øª</option><option>ØªÙ†Ø¸ÙŠÙ</option>
              <option>Ù†Ù‚Ù„ Ø¹ÙØ´</option><option>Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>
          <div class="g form-full"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input type="text" id="n-city" placeholder="Ø§Ù„Ø±ÙŠØ§Ø¶"></div>
          <div class="g form-full"><label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" id="n-budget" placeholder="500" inputmode="numeric"></div>
          <div class="g form-full"><label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ *</label><textarea id="n-desc" placeholder="Ø§Ø´Ø±Ø­ Ø·Ù„Ø¨Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea></div>
        </div>
        <div class="form-btns">
          <button class="btn-submit" id="n-btn" onclick="submitReq()">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨</button>
          <button class="btn-cancel" onclick="show('home',null,'home')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="bottom-nav">
  <div class="bottom-nav-items">
    <button class="bn-item on" id="bn-home" onclick="show('home',null,'home')"><span class="bn-ic">ğŸ </span><span class="bn-txt">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
    <button class="bn-item" id="bn-requests" onclick="show('requests',null,'requests')"><span class="bn-ic">ğŸ“‹</span><span class="bn-txt">Ø·Ù„Ø¨Ø§ØªÙŠ</span></button>
    <button class="bn-item" id="bn-new" onclick="showAgreement()"><span class="bn-ic">â•</span><span class="bn-txt">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span></button>
  </div>
</div>
<div class="overlay" id="agreeOverlay">
  <div class="agree-modal">
    <div class="agree-header">
      <h2>ğŸ“œ Ø§ØªÙØ§Ù‚ÙŠØ© Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ©</h2>
      <p>ÙŠØ±Ø¬Ù‰ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© ÙƒØ§Ù…Ù„Ø©Ù‹ Ù‚Ø¨Ù„ Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ</p>
    </div>
    <div class="agree-body">
      <div class="quran-box">
        <div class="quran-title">ï·½</div>
        <div class="quran-text">"ÙˆÙØ£ÙÙˆÙ’ÙÙÙˆØ§Ù’ Ø¨ÙØ¹ÙÙ‡Ù’Ø¯Ù Ø§Ù„Ù„Ù‡Ù Ø¥ÙØ°ÙØ§ Ø¹ÙØ§Ù‡ÙØ¯ØªÙÙ‘Ù…Ù’ ÙˆÙÙ„Ø§Ù ØªÙÙ†Ù‚ÙØ¶ÙÙˆØ§Ù’ Ø§Ù„Ø£ÙÙŠÙ’Ù…ÙØ§Ù†Ù Ø¨ÙØ¹Ù’Ø¯Ù ØªÙÙˆÙ’ÙƒÙÙŠØ¯ÙÙ‡ÙØ§ ÙˆÙÙ‚ÙØ¯Ù’ Ø¬ÙØ¹ÙÙ„Ù’ØªÙÙ…Ù Ø§Ù„Ù„Ù‡Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’ ÙƒÙÙÙÙŠÙ„Ø§Ù‹"</div>
        <div class="quran-source">ØµØ¯Ù‚ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…</div>
      </div>
      <div class="agree-text">
        <p>Ø£ØªØ¹Ù‡Ø¯ ÙˆØ£ÙÙ‚Ø³Ù… Ø¨Ø§Ù„Ù„Ù‡ Ø£Ù†Ø§ Ø§Ù„Ù…Ø¹Ù„Ù† Ø£Ù† Ø£Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆÙ‡ÙŠ <strong>1% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨ÙŠØ¹</strong> Ø³ÙˆØ§Ø¡ ØªÙ… Ø§Ù„Ø¨ÙŠØ¹ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø¨Ø³Ø¨Ø¨Ù‡.<br><br>ÙƒÙ…Ø§ Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø¯ÙØ¹ Ø§Ù„Ø±Ø³ÙˆÙ… Ø®Ù„Ø§Ù„ <strong>10 Ø£ÙŠØ§Ù…</strong> Ù…Ù† Ø§Ø³ØªÙ„Ø§Ù… ÙƒØ§Ù…Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¨Ø§ÙŠØ¹Ø©.</p>
      </div>
      <div class="note-box">
        <p>âš ï¸ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù† ÙˆÙ„Ø§ ØªØ¨Ø±Ø£ Ø°Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù† Ù…Ù† Ø§Ù„Ø±Ø³ÙˆÙ… Ø¥Ù„Ø§ ÙÙŠ Ø­Ø§Ù„ Ø¯ÙØ¹Ù‡Ø§.</p>
      </div>
      <div class="agree-check">
        <input type="checkbox" id="agreeCheck" onchange="toggleAgreeBtn()">
        <label for="agreeCheck">Ø£Ù‚Ø± Ø¨Ø£Ù†Ù†ÙŠ Ù‚Ø±Ø£Øª Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© ÙˆØ£ØªØ¹Ù‡Ø¯ Ø¨Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© 1% Ø®Ù„Ø§Ù„ 10 Ø£ÙŠØ§Ù… Ù…Ù† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
      </div>
    </div>
    <div class="agree-footer">
      <button class="btn-agree" id="agreeBtn" disabled onclick="acceptAgreement()">âœ… Ø£ÙˆØ§ÙÙ‚ ÙˆØ£Ù†Ø´Ø± Ø·Ù„Ø¨ÙŠ</button>
      <button class="btn-back" onclick="closeAgreement()">Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>
</div>
<div class="overlay" id="rateOverlay">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-head">
      <h3>â­ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø²ÙˆØ¯</h3>
      <button class="modal-close" onclick="closeRate()">âœ•</button>
    </div>
    <div class="rate-msg" id="rate-msg"></div>
    <p style="text-align:center;color:var(--muted);font-size:14px;margin-bottom:16px">ÙƒÙŠÙ ÙƒØ§Ù†Øª ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ø§Ù„Ù…Ø²ÙˆØ¯ØŸ</p>
    <div class="stars">
      <span class="star" onclick="setRating(1)">â­</span>
      <span class="star" onclick="setRating(2)">â­</span>
      <span class="star" onclick="setRating(3)">â­</span>
      <span class="star" onclick="setRating(4)">â­</span>
      <span class="star" onclick="setRating(5)">â­</span>
    </div>
    <div class="g" style="margin-bottom:16px"><label>ØªØ¹Ù„ÙŠÙ‚Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><textarea id="rate-comment" placeholder="Ø´Ø§Ø±Ùƒ ØªØ¬Ø±Ø¨ØªÙƒ..." style="min-height:80px"></textarea></div>
    <div style="display:flex;gap:10px">
      <button class="btn-submit" id="rate-btn" onclick="submitRate()" style="flex:1;padding:14px">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â­</button>
      <button class="btn-cancel" onclick="closeRate()" style="padding:14px 16px">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>
<script>
var API='https://manaqasati-production.up.railway.app';
var user=JSON.parse(localStorage.getItem('user')||'{}');
if(!user.id){location.href='auth.html';}
var name=user.name||'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
document.getElementById('userName').textContent=name;
document.getElementById('welcomeName').textContent='Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ '+name.split(' ')[0]+' ğŸ‘‹';
document.getElementById('userAv').textContent=name.charAt(0);
document.getElementById('mobileAv').textContent=name.charAt(0);
var selectedRating=0,selectedReqId=null,selectedProviderId=null;
function show(page,el,key){
  document.querySelectorAll('.page').forEach(function(p){p.className='page';});
  document.querySelectorAll('.menu-item').forEach(function(m){m.className='menu-item';});
  document.querySelectorAll('.bn-item').forEach(function(m){m.className='bn-item';});
  document.getElementById('page-'+page).className='page on';
  if(el)el.className='menu-item on';
  if(key){var bn=document.getElementById('bn-'+key);if(bn)bn.className='bn-item on';}
  var titles={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',requests:'Ø·Ù„Ø¨Ø§ØªÙŠ',new:'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯'};
  document.getElementById('pageTitle').textContent=titles[page]||'';
  if(page==='requests')loadAllReqs();
  if(page==='home')loadHome();
  window.scrollTo(0,0);
}
function logout(){localStorage.clear();location.href='auth.html';}
function showAgreement(){document.getElementById('agreeCheck').checked=false;document.getElementById('agreeBtn').disabled=true;document.getElementById('agreeOverlay').className='overlay show';}
function closeAgreement(){document.getElementById('agreeOverlay').className='overlay';}
function toggleAgreeBtn(){document.getElementById('agreeBtn').disabled=!document.getElementById('agreeCheck').checked;}
function acceptAgreement(){closeAgreement();show('new',null,'new');}
function statusTag(s){if(s==='open')return '<span class="tag t-open">âœ“ Ù†Ø´Ø·</span>';if(s==='done')return '<span class="tag t-done">âœ… Ù…ÙƒØªÙ…Ù„</span>';return '<span class="tag t-review">â³ Ù…Ø±Ø§Ø¬Ø¹Ø©</span>';}
function reqCard(r,withActions){
  var actions='';
  if(withActions&&r.status==='open'){actions='<div class="req-actions"><button class="btn-sm btn-rate" onclick="openRate('+r.id+','+r.client_id+')">â­ Ù‚ÙŠÙ‘Ù… Ø§Ù„Ù…Ø²ÙˆØ¯</button><button class="btn-sm btn-done" onclick="markDone('+r.id+')">âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</button></div>';}
  return '<div class="req-item"><div class="req-top"><div class="req-title">'+r.title+'</div>'+statusTag(r.status)+'</div><div class="req-meta"><span class="req-tag">ğŸ“ '+(r.city||'â€“')+'</span><span class="req-tag">&nbsp;ğŸ—‚ï¸ '+(r.category||'â€“')+'</span>'+(r.budget_max?'<span class="req-tag">&nbsp;ğŸ’° '+r.budget_max+' Ø±.Ø³</span>':'')+'</div>'+actions+'</div>';
}
function loadHome(){
  fetch(API+'/api/requests').then(function(r){return r.json();}).then(function(all){
    var mine=all.filter(function(r){return r.client_id==user.id;});
    document.getElementById('s-total').textContent=mine.length;
    document.getElementById('s-review').textContent=mine.filter(function(r){return r.status==='review';}).length;
    document.getElementById('s-open').textContent=mine.filter(function(r){return r.status==='open';}).length;
    document.getElementById('recent-reqs').innerHTML=mine.length?mine.slice(0,4).map(function(r){return reqCard(r,false);}).join(''):'<div class="empty"><div class="empty-ic">ğŸ“­</div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</h4><p>Ø§Ù†Ø´Ø± Ø£ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</p></div>';
  }).catch(function(){document.getElementById('recent-reqs').innerHTML='<div class="empty"><div class="empty-ic">âš ï¸</div><h4>ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</h4></div>';});
}
function loadAllReqs(){
  document.getElementById('all-reqs').innerHTML='<div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/requests').then(function(r){return r.json();}).then(function(all){
    var mine=all.filter(function(r){return r.client_id==user.id;});
    document.getElementById('all-reqs').innerHTML=mine.length?mine.map(function(r){return reqCard(r,true);}).join(''):'<div class="empty"><div class="empty-ic">ğŸ“­</div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</h4></div>';
  }).catch(function(){document.getElementById('all-reqs').innerHTML='<div class="empty"><div class="empty-ic">âš ï¸</div><h4>ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</h4></div>';});
}
function markDone(reqId){fetch(API+'/api/requests/'+reqId+'/status',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status:'done'})}).then(function(){loadAllReqs();});}
function openRate(reqId,providerId){selectedReqId=reqId;selectedProviderId=providerId;selectedRating=0;document.querySelectorAll('.star').forEach(function(s){s.className='star';});document.getElementById('rate-comment').value='';document.getElementById('rate-msg').className='rate-msg';document.getElementById('rateOverlay').className='overlay show';}
function closeRate(){document.getElementById('rateOverlay').className='overlay';}
function setRating(n){selectedRating=n;document.querySelectorAll('.star').forEach(function(s,i){s.className=i<n?'star on':'star';});}
function submitRate(){
  if(!selectedRating){document.getElementById('rate-msg').textContent='ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ…';document.getElementById('rate-msg').className='rate-msg err';return;}
  var btn=document.getElementById('rate-btn');btn.disabled=true;btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
  fetch(API+'/api/reviews',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({request_id:selectedReqId,client_id:user.id,provider_id:selectedProviderId,rating:selectedRating,comment:document.getElementById('rate-comment').value})})
  .then(function(r){return r.json().then(function(d){return{ok:r.ok,d:d};});})
  .then(function(r){
    if(r.ok){document.getElementById('rate-msg').textContent='âœ… Ø´ÙƒØ±Ø§Ù‹! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚ÙŠÙŠÙ…Ùƒ';document.getElementById('rate-msg').className='rate-msg ok';setTimeout(function(){closeRate();loadAllReqs();},1500);}
    else{document.getElementById('rate-msg').textContent=r.d.message||'Ø­Ø¯Ø« Ø®Ø·Ø£';document.getElementById('rate-msg').className='rate-msg err';}
    btn.disabled=false;btn.textContent='Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â­';
  }).catch(function(){document.getElementById('rate-msg').textContent='ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„';document.getElementById('rate-msg').className='rate-msg err';btn.disabled=false;btn.textContent='Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â­';});
}
function submitReq(){
  var title=document.getElementById('n-title').value.trim();
  var desc=document.getElementById('n-desc').value.trim();
  if(!title||!desc){showMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„','err');return;}
  var btn=document.getElementById('n-btn');btn.disabled=true;btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
  fetch(API+'/api/requests',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:title,description:desc,category:document.getElementById('n-cat').value,city:document.getElementById('n-city').value.trim()||'Ø§Ù„Ø±ÙŠØ§Ø¶',budget_max:parseInt(document.getElementById('n-budget').value||0),client_id:user.id})})
  .then(function(r){return r.json().then(function(d){return{ok:r.ok,d:d};});})
  .then(function(r){
    if(r.ok){showMsg('âœ… ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!','ok');document.getElementById('n-title').value='';document.getElementById('n-desc').value='';document.getElementById('n-budget').value='';setTimeout(function(){show('home',null,'home');},2000);}
    else{showMsg(r.d.message||'Ø­Ø¯Ø« Ø®Ø·Ø£','err');}
    btn.disabled=false;btn.textContent='ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨';
  }).catch(function(){showMsg('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„','err');btn.disabled=false;btn.textContent='ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨';});
}
function showMsg(t,c){var e=document.getElementById('new-msg');e.textContent=t;e.className='msg '+c;setTimeout(function(){e.className='msg';},5000);}
loadHome();
</script>
</body>
</html>
