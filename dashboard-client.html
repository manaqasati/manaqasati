<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--p:#7c3aed;--p2:#6d28d9;--p-light:#ede9fe;--p-mid:#ddd6fe;--text:#1e1b4b;--muted:#6b7280;--border:#e5e7eb;--bg:#f5f3ff;--white:#fff;--red:#ef4444;--red-l:#fee2e2;--green:#16a34a;--green-l:#dcfce7;--yellow:#d97706;--yellow-l:#fef3c7;--blue:#2563eb;--blue-l:#dbeafe}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.side{width:252px;background:var(--white);border-left:1px solid var(--border);height:100vh;position:fixed;right:0;top:0;display:flex;flex-direction:column;z-index:100;box-shadow:2px 0 20px rgba(124,58,237,0.06)}
.side-head{padding:20px 16px 16px;border-bottom:1px solid var(--border)}
.logo{font-size:22px;font-weight:900;color:var(--p);margin-bottom:12px}.logo span{color:#f59e0b}
.user-pill{background:var(--p-light);border-radius:13px;padding:11px;display:flex;align-items:center;gap:10px}
.av{width:36px;height:36px;border-radius:10px;background:var(--p);color:#fff;font-size:15px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.av-name{font-size:13px;font-weight:800}.av-role{font-size:10px;color:var(--p);font-weight:600;margin-top:1px}
.nav{padding:12px 8px;flex:1;overflow-y:auto}
.nav-sec{font-size:10px;font-weight:800;color:var(--muted);letter-spacing:.8px;padding:0 8px;margin:12px 0 4px;text-transform:uppercase}
.ni{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:11px;color:var(--muted);cursor:pointer;font-size:13px;font-weight:600;border:none;background:none;width:100%;text-align:right;font-family:'Tajawal',sans-serif;margin-bottom:1px;transition:.15s;position:relative}
.ni:hover{background:var(--bg);color:var(--text)}.ni.on{background:var(--p-light);color:var(--p)}
.ni-ic{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s}
.ni.on .ni-ic{background:var(--p)}.ni.on .ni-ic svg{stroke:#fff}.ni-ic svg{stroke:currentColor}
.badge{position:absolute;left:10px;top:50%;transform:translateY(-50%);background:var(--red);color:#fff;font-size:10px;font-weight:800;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.side-foot{padding:10px 16px;border-top:1px solid var(--border)}
.logoutbtn{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:10px;color:var(--red);cursor:pointer;font-size:13px;font-weight:700;border:none;background:none;width:100%;font-family:'Tajawal',sans-serif;transition:.15s}
.logoutbtn:hover{background:var(--red-l)}
.main{margin-right:252px;min-height:100vh;display:flex;flex-direction:column}
.topbar{background:var(--white);border-bottom:1px solid var(--border);height:56px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar-title{font-size:15px;font-weight:800}
.btn-new{background:var(--p);color:#fff;padding:7px 14px;border-radius:9px;font-size:13px;font-weight:800;cursor:pointer;border:none;font-family:'Tajawal',sans-serif;display:flex;align-items:center;gap:5px;transition:.15s}
.btn-new:hover{background:var(--p2)}
.content{padding:20px 24px;flex:1}
.page{display:none}.page.on{display:block}
.mob-head{display:none;background:var(--white);border-bottom:1px solid var(--border);height:52px;padding:0 14px;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.mob-logo{font-size:18px;font-weight:900;color:var(--p)}.mob-logo span{color:#f59e0b}
.mob-right{display:flex;align-items:center;gap:8px}
.mob-notif{position:relative;background:none;border:none;cursor:pointer;padding:6px;color:var(--muted);display:flex}
.mob-notif-badge{position:absolute;top:2px;left:2px;background:var(--red);color:#fff;font-size:9px;font-weight:800;width:15px;height:15px;border-radius:50%;display:none;align-items:center;justify-content:center}
.mob-av{width:28px;height:28px;border-radius:8px;background:var(--p);color:#fff;font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center}
.mob-out{background:none;border:none;cursor:pointer;padding:5px;color:var(--muted);display:flex}
.bnav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--white);border-top:1px solid var(--border);z-index:100;padding:3px 0 calc(env(safe-area-inset-bottom,0px) + 3px)}
.bnav-inner{display:flex}
.bni{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 2px;border:none;background:none;cursor:pointer;font-family:'Tajawal',sans-serif;color:var(--muted);transition:.15s;position:relative}
.bni .bic{width:22px;height:22px;display:flex;align-items:center;justify-content:center}
.bni .bic svg{stroke:currentColor}
.bni .bt{font-size:9px;font-weight:700}
.bni.on{color:var(--p)}
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:18px}
.sc{background:var(--white);border:1px solid var(--border);border-radius:13px;padding:14px;display:flex;align-items:center;gap:10px;transition:.2s}
.sc:hover{border-color:var(--p-mid);box-shadow:0 3px 12px rgba(124,58,237,0.07)}
.sic{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sic.a{background:var(--p-light)}.sic.a svg{stroke:var(--p)}
.sic.y{background:var(--yellow-l)}.sic.y svg{stroke:var(--yellow)}
.sic.g{background:var(--green-l)}.sic.g svg{stroke:var(--green)}
.sic.b{background:var(--blue-l)}.sic.b svg{stroke:var(--blue)}
.sn{font-size:22px;font-weight:900}.st{font-size:10px;color:var(--muted);margin-top:2px}
.hero{background:linear-gradient(135deg,var(--p),var(--p2));border-radius:16px;padding:22px 26px;margin-bottom:18px;display:flex;align-items:center;justify-content:space-between;overflow:hidden;position:relative}
.hero::before{content:'';position:absolute;width:180px;height:180px;border-radius:50%;background:rgba(255,255,255,0.06);top:-50px;left:-30px}
.hero-t h2{font-size:17px;font-weight:800;color:#fff;margin-bottom:3px;position:relative}
.hero-t p{font-size:12px;color:rgba(255,255,255,0.7);position:relative}
.hero-btn{background:#fff;color:var(--p);padding:9px 16px;border-radius:9px;font-size:13px;font-weight:800;cursor:pointer;border:none;font-family:'Tajawal',sans-serif;white-space:nowrap;transition:.15s;flex-shrink:0}
.card{background:var(--white);border:1px solid var(--border);border-radius:13px;padding:16px;margin-bottom:14px}
.ch{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid var(--border);gap:8px;flex-wrap:wrap}
.ch h3{font-size:14px;font-weight:800}
.ch-link{font-size:12px;color:var(--p);font-weight:700;background:none;border:none;cursor:pointer;font-family:'Tajawal',sans-serif}
.ri{border:1px solid var(--border);border-radius:11px;padding:13px;margin-bottom:8px;transition:.2s;cursor:pointer}
.ri:hover{border-color:var(--p-mid);background:var(--p-light)}
.ri-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:5px;gap:6px}
.ri-title{font-size:14px;font-weight:800;flex:1}
.ri-meta{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:6px}
.rm{font-size:11px;color:var(--muted);display:flex;align-items:center;gap:3px}
.ri-actions{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.tag{padding:3px 8px;border-radius:20px;font-size:10px;font-weight:700;display:inline-flex;align-items:center;gap:3px;white-space:nowrap}
.t-open{background:var(--green-l);color:var(--green)}
.t-prog{background:var(--blue-l);color:var(--blue)}
.t-done{background:var(--p-light);color:var(--p)}
.t-rev{background:var(--yellow-l);color:var(--yellow)}
.btn-sm{padding:7px 12px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:none;font-family:'Tajawal',sans-serif;transition:.15s;display:inline-flex;align-items:center;gap:4px}
.bs-p{background:var(--p-light);color:var(--p)}.bs-p:hover{background:var(--p-mid)}
.bs-g{background:var(--green-l);color:var(--green)}.bs-g:hover{background:#bbf7d0}
.bs-r{background:var(--red-l);color:var(--red)}.bs-r:hover{background:#fecaca}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.ff{grid-column:1/-1}
.fg{margin-bottom:0}
.fg label{display:block;font-size:12px;font-weight:700;margin-bottom:4px}
.fg input,.fg textarea,.fg select{width:100%;padding:10px 12px;border:1.5px solid var(--border);border-radius:9px;font-family:'Tajawal',sans-serif;font-size:14px;color:var(--text);outline:none;background:var(--white);transition:.15s}
.fg input:focus,.fg textarea:focus,.fg select:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(124,58,237,0.08)}
.fg textarea{min-height:100px;resize:vertical}
.form-btns{display:flex;gap:8px;margin-top:14px}
.btn-p{padding:11px 20px;background:var(--p);color:#fff;border:none;border-radius:10px;font-family:'Tajawal',sans-serif;font-size:14px;font-weight:800;cursor:pointer;transition:.15s}
.btn-p:hover{background:var(--p2)}.btn-p:disabled{opacity:.5;cursor:not-allowed}
.btn-s{padding:11px 14px;background:var(--bg);color:var(--muted);border:1px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:14px;font-weight:700;cursor:pointer}
.bid-item{border:1px solid var(--border);border-radius:11px;padding:14px;margin-bottom:8px;transition:.2s}
.bid-item.accepted{border-color:var(--green);background:var(--green-l)}
.bid-item.rejected{opacity:.5}
.bid-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;gap:8px}
.bid-name{font-size:14px;font-weight:800}
.bid-price{font-size:18px;font-weight:900;color:var(--p)}
.bid-meta{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.bid-note{font-size:12px;color:#475569;line-height:1.6;margin-bottom:10px;font-style:italic}
.bid-actions{display:flex;gap:6px;flex-wrap:wrap}
.stars-row{color:#f59e0b;font-size:13px;letter-spacing:1px}
.chat-wrap{display:flex;flex-direction:column;height:400px}
.chat-msgs{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px;background:var(--bg);border-radius:10px;margin-bottom:10px}
.msg-bubble{max-width:75%;padding:9px 13px;border-radius:14px;font-size:13px;line-height:1.5}
.msg-me{background:var(--p);color:#fff;align-self:flex-end;border-radius:14px 14px 4px 14px}
.msg-other{background:var(--white);border:1px solid var(--border);align-self:flex-start;border-radius:14px 14px 14px 4px}
.msg-name{font-size:10px;font-weight:700;margin-bottom:2px;opacity:.7}
.msg-time{font-size:10px;opacity:.6;margin-top:3px;text-align:left}
.chat-input{display:flex;gap:8px}
.chat-inp{flex:1;padding:10px 13px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;transition:.15s}
.chat-inp:focus{border-color:var(--p)}
.chat-send{padding:10px 16px;background:var(--p);color:#fff;border:none;border-radius:10px;font-family:'Tajawal',sans-serif;font-size:13px;font-weight:700;cursor:pointer}
.chat-send:hover{background:var(--p2)}
.notif-item{display:flex;gap:10px;padding:12px;border-bottom:1px solid var(--border);cursor:pointer;transition:.15s}
.notif-item:hover{background:var(--bg)}
.notif-item.unread{background:var(--p-light)}
.notif-ic{width:36px;height:36px;border-radius:10px;background:var(--p-light);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px}
.notif-title{font-size:13px;font-weight:800;margin-bottom:2px}
.notif-body{font-size:11px;color:var(--muted);line-height:1.4}
.notif-time{font-size:10px;color:var(--muted);margin-top:3px}
.overlay{display:none;position:fixed;inset:0;background:rgba(10,5,30,0.65);z-index:300;align-items:flex-end;justify-content:center;backdrop-filter:blur(8px)}
.overlay.show{display:flex}
.modal{background:var(--white);border-radius:22px 22px 0 0;width:100%;max-width:520px;max-height:93vh;overflow:hidden;display:flex;flex-direction:column}
.modal-drag{width:34px;height:4px;background:#d1d5db;border-radius:2px;margin:11px auto 0}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:13px 18px 11px;border-bottom:1px solid var(--border)}
.modal-head h3{font-size:15px;font-weight:800}
.modal-x{width:27px;height:27px;border-radius:7px;background:var(--bg);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--muted)}
.modal-body{padding:16px 18px;overflow-y:auto;flex:1}
.modal-foot{padding:11px 18px;border-top:1px solid var(--border);display:flex;gap:8px;background:var(--white)}
.agree-modal{background:var(--white);border-radius:22px 22px 0 0;width:100%;max-width:540px;max-height:94vh;overflow:hidden;display:flex;flex-direction:column}
.agree-hd{background:linear-gradient(135deg,#1e3a5f,#1e4d8c);padding:14px 20px;text-align:center;flex-shrink:0}
.agree-hd h2{color:#fff;font-size:16px;font-weight:900;margin-bottom:2px}
.agree-hd p{color:rgba(255,255,255,0.6);font-size:11px}
.agree-body{padding:16px 18px;overflow-y:auto;flex:1}
.quran-box{background:linear-gradient(135deg,#fef9e7,#fef3c7);border:2px solid #f59e0b;border-radius:13px;padding:14px 16px;margin-bottom:12px;text-align:center}
.quran-title{font-size:12px;font-weight:800;color:#92400e;margin-bottom:6px}
.quran-text{font-size:13px;font-weight:700;color:#78350f;line-height:2}
.quran-src{font-size:11px;color:#92400e;font-weight:700;margin-top:6px}
.agree-sec{background:var(--bg);border:1.5px solid var(--p-mid);border-radius:12px;padding:12px 14px;margin-bottom:9px}
.agree-sec-t{font-size:12px;font-weight:900;color:var(--p);margin-bottom:6px}
.agree-sec p{font-size:11px;color:var(--text);line-height:1.9;font-weight:500}
.agree-sec strong{color:var(--p);font-weight:800}
.note-sec{background:#fef2f2;border:1.5px solid #fca5a5;border-radius:12px;padding:12px 14px;margin-bottom:12px}
.note-sec .agree-sec-t{color:var(--red)}
.note-sec p{font-size:11px;color:#7f1d1d;line-height:1.9}
.agree-check{display:flex;align-items:flex-start;gap:9px;padding:11px 13px;background:var(--p-light);border-radius:11px;cursor:pointer}
.agree-check input{width:17px;height:17px;cursor:pointer;margin-top:2px;accent-color:var(--p);flex-shrink:0}
.agree-check label{font-size:11px;font-weight:700;cursor:pointer;line-height:1.7}
.agree-foot{padding:12px 18px;display:flex;gap:8px;border-top:1px solid var(--border);background:var(--white);flex-shrink:0}
.btn-agree{flex:1;padding:12px;background:var(--p);color:#fff;border:none;border-radius:11px;font-family:'Tajawal',sans-serif;font-size:14px;font-weight:800;cursor:pointer}
.btn-agree:disabled{opacity:.4;cursor:not-allowed}
.btn-back{padding:12px 14px;background:var(--bg);color:var(--muted);border:1.5px solid var(--border);border-radius:11px;font-family:'Tajawal',sans-serif;font-size:13px;font-weight:700;cursor:pointer}
.stars-pick{display:flex;gap:8px;justify-content:center;margin:12px 0}
.sp{font-size:32px;cursor:pointer;opacity:.3;transition:.15s;filter:grayscale(1)}
.sp.on{opacity:1;filter:none}
.req-detail-head{background:linear-gradient(135deg,var(--p),var(--p2));border-radius:14px;padding:20px;margin-bottom:14px;color:#fff}
.rdh-title{font-size:18px;font-weight:900;margin-bottom:8px}
.rdh-meta{display:flex;gap:10px;flex-wrap:wrap;opacity:.85;font-size:12px}
.rdh-meta span{display:flex;align-items:center;gap:4px}
.rdh-desc{margin-top:12px;font-size:13px;line-height:1.7;opacity:.9}
.tab-btns{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
.tab-btn{padding:8px 16px;border-radius:20px;font-size:13px;font-weight:700;cursor:pointer;border:1px solid var(--border);background:var(--white);color:var(--muted);font-family:'Tajawal',sans-serif;transition:.15s}
.tab-btn.on{background:var(--p);color:#fff;border-color:var(--p)}
.tab{display:none}.tab.on{display:block}
.empty{text-align:center;padding:36px 16px;color:var(--muted)}
.empty-ic{width:48px;height:48px;background:var(--p-light);border-radius:13px;display:flex;align-items:center;justify-content:center;margin:0 auto 10px}
.empty-ic svg{stroke:var(--p)}
.empty h4{font-size:13px;font-weight:700;color:var(--text);margin-bottom:3px}
.loading{text-align:center;padding:24px;color:var(--muted);font-size:13px}
.alert{padding:9px 12px;border-radius:8px;font-size:12px;font-weight:600;margin-bottom:10px;display:none}
.alert.ok{background:var(--green-l);color:var(--green);display:block}
.alert.err{background:var(--red-l);color:var(--red);display:block}
@media(max-width:900px){.stat-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:768px){
  .side,.topbar{display:none}.main{margin-right:0}
  .mob-head{display:flex}.bnav{display:block}
  .content{padding:10px 12px;padding-bottom:82px}
  .stat-grid{grid-template-columns:repeat(2,1fr);gap:8px}
  .sc{padding:12px}.sic{width:36px;height:36px}.sn{font-size:20px}
  .hero{padding:16px;flex-direction:column;gap:10px;text-align:center}
  .hero-btn{width:100%;padding:10px;justify-content:center}
  .card{padding:12px}
  .form-grid{grid-template-columns:1fr}.ff{grid-column:1}
  .form-btns,.bid-actions,.ri-actions{flex-direction:column}
  .btn-p,.btn-s,.btn-sm{width:100%;text-align:center;justify-content:center;padding:11px}
  .chat-wrap{height:320px}
}
</style>
</head>
<body>
<div class="side">
  <div class="side-head">
    <div class="logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></div>
    <div class="user-pill">
      <div class="av" id="userAv">Ø¹</div>
      <div><div class="av-name" id="userName">...</div><div class="av-role">Ø¹Ù…ÙŠÙ„</div></div>
    </div>
  </div>
  <div class="nav">
    <div class="nav-sec">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
    <button class="ni on" onclick="show('home',this,'home')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg></div>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="ni" onclick="show('requests',this,'requests')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>Ø·Ù„Ø¨Ø§ØªÙŠ</button>
    <button class="ni" onclick="showAgreement()"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg></div>Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
    <button class="ni" id="notif-ni" onclick="show('notifs',this,'notifs')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª<span class="badge" id="notif-badge" style="display:none">0</span></button>
  </div>
  <div class="side-foot">
    <button class="logoutbtn" onclick="logout()"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>
<div class="mob-head">
  <div class="mob-logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></div>
  <div class="mob-right">
    <button class="mob-notif" onclick="show('notifs',null,'notifs')"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg><span class="mob-notif-badge" id="mob-notif-badge">0</span></button>
    <div class="mob-av" id="mobAv">Ø¹</div>
    <button class="mob-out" onclick="logout()"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <div class="topbar-title" id="pageTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <button class="btn-new" onclick="showAgreement()"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
  </div>
  <div class="content">
    <div class="page on" id="page-home">
      <div class="hero"><div class="hero-t"><h2 id="welcomeName">Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹</h2><p>Ø§Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ ÙˆØ§Ø³ØªÙ‚Ø¨Ù„ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶</p></div><button class="hero-btn" onclick="showAgreement()">+ Ø£Ù†Ø´Ø± Ø·Ù„Ø¨Ø§Ù‹</button></div>
      <div class="stat-grid">
        <div class="sc"><div class="sic a"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><div><div class="sn" id="s-total">0</div><div class="st">Ø·Ù„Ø¨Ø§ØªÙŠ</div></div></div>
        <div class="sc"><div class="sic y"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div><div class="sn" id="s-open">0</div><div class="st">Ù†Ø´Ø·Ø©</div></div></div>
        <div class="sc"><div class="sic b"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div><div><div class="sn" id="s-prog">0</div><div class="st">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div></div></div>
        <div class="sc"><div class="sic g"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div><div class="sn" id="s-done">0</div><div class="st">Ù…ÙƒØªÙ…Ù„Ø©</div></div></div>
      </div>
      <div class="card"><div class="ch"><h3>Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§ØªÙŠ</h3><button class="ch-link" onclick="show('requests',null,'requests')">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</button></div><div id="home-reqs"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
    </div>
    <div class="page" id="page-requests">
      <div class="card"><div class="ch"><h3>Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§ØªÙŠ</h3></div><div id="all-reqs"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
    </div>
    <div class="page" id="page-detail">
      <button onclick="show('requests',null,'requests')" style="display:flex;align-items:center;gap:6px;background:none;border:none;cursor:pointer;font-family:'Tajawal',sans-serif;font-size:13px;font-weight:700;color:var(--muted);margin-bottom:12px"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>Ø±Ø¬ÙˆØ¹</button>
      <div id="detail-head"></div>
      <div class="tab-btns">
        <button class="tab-btn on" onclick="showTab('bids',this)">Ø§Ù„Ø¹Ø±ÙˆØ¶ <span id="bids-count" style="font-size:11px;opacity:.7"></span></button>
        <button class="tab-btn" onclick="showTab('chat',this)">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</button>
        <button class="tab-btn" onclick="showTab('actions',this)">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</button>
      </div>
      <div class="tab on" id="tab-bids"><div id="bids-list"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
      <div class="tab" id="tab-chat"><div id="chat-list"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
      <div class="tab" id="tab-actions"><div id="actions-wrap"></div></div>
    </div>
    <div class="page" id="page-new">
      <div class="card">
        <div class="ch"><h3>Ù†Ø´Ø± Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3></div>
        <div class="alert" id="new-msg"></div>
        <div class="form-grid">
          <div class="fg ff"><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨ *</label><input id="n-title" type="text" placeholder="Ù…Ø«Ø§Ù„: ØªØ±ÙƒÙŠØ¨ Ù…ÙƒÙŠÙ Ø³Ø¨Ù„ÙŠØª 2 Ø·Ù†"></div>
          <div class="fg"><label>Ø§Ù„ØªØµÙ†ÙŠÙ *</label><select id="n-cat" onchange="checkOther()"></select></div>
          <div class="fg" id="other-wrap" style="display:none"><label>Ø­Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµ</label><input id="n-other" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"></div>
          <div class="fg"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label><input id="n-city" type="text" placeholder="Ø§Ù„Ø±ÙŠØ§Ø¶"></div>
          <div class="fg ff"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label><input id="n-address" type="text" placeholder="Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰..."></div>
          <div class="fg"><label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input id="n-budget" type="number" placeholder="500" inputmode="numeric"></div>
          <div class="fg"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label><input id="n-deadline" type="date"></div>
          <div class="fg ff"><label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ *</label><textarea id="n-desc" placeholder="Ø§Ø´Ø±Ø­ Ø·Ù„Ø¨Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶..."></textarea></div>
        </div>
        <div class="form-btns">
          <button class="btn-p" id="n-btn" onclick="submitReq()">Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨</button>
          <button class="btn-s" onclick="show('home',null,'home')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </div>
    <div class="page" id="page-notifs">
      <div class="card"><div class="ch"><h3>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3><button class="ch-link" onclick="markAllRead()">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button></div><div id="notifs-list"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
    </div>
  </div>
</div>
<div class="bnav"><div class="bnav-inner">
  <button class="bni on" id="bn-home" onclick="show('home',null,'home')"><div class="bic"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg></div><span class="bt">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
  <button class="bni" id="bn-requests" onclick="show('requests',null,'requests')"><div class="bic"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><span class="bt">Ø·Ù„Ø¨Ø§ØªÙŠ</span></button>
  <button class="bni" onclick="showAgreement()"><div class="bic"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg></div><span class="bt">Ø¬Ø¯ÙŠØ¯</span></button>
  <button class="bni" id="bn-notifs" onclick="show('notifs',null,'notifs')"><div class="bic"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div><span class="bt">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span></button>
</div></div>
<div class="overlay" id="agreeOverlay">
  <div class="agree-modal">
    <div class="agree-hd"><h2>ğŸ“œ Ø§ØªÙØ§Ù‚ÙŠØ© Ø§Ù„Ø±Ø³ÙˆÙ…</h2><p>ÙŠØ±Ø¬Ù‰ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© ÙƒØ§Ù…Ù„Ø©Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±</p></div>
    <div class="agree-body">
      <div class="quran-box"><div class="quran-title">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</div><div class="quran-text">ï´¿ ÙˆÙØ£ÙÙˆÙ’ÙÙÙˆØ§ Ø¨ÙØ¹ÙÙ‡Ù’Ø¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¥ÙØ°ÙØ§ Ø¹ÙØ§Ù‡ÙØ¯ØªÙÙ‘Ù…Ù’ ÙˆÙÙ„ÙØ§ ØªÙÙ†Ù‚ÙØ¶ÙÙˆØ§ Ø§Ù„Ù’Ø£ÙÙŠÙ’Ù…ÙØ§Ù†Ù Ø¨ÙØ¹Ù’Ø¯Ù ØªÙÙˆÙ’ÙƒÙÙŠØ¯ÙÙ‡ÙØ§ ï´¾</div><div class="quran-src">ØµØ¯Ù‚ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…</div></div>
      <div class="agree-sec"><div class="agree-sec-t">Ø£ÙˆÙ„Ù‹Ø§: Ø§Ù„ØªØ¹Ù‡Ø¯ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…</div><p>Ø£ÙÙ‚Ø±Ù‘ ÙˆØ£ØªØ¹Ù‡Ø¯ Ø¨Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¨Ø§Ù„ØºØ© <strong>(1%)</strong> Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡.</p></div>
      <div class="agree-sec"><div class="agree-sec-t">Ø«Ø§Ù†ÙŠÙ‹Ø§: Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ø±Ø³ÙˆÙ…</div><p>ØªØ³ØªØ­Ù‚ Ø§Ù„Ø±Ø³ÙˆÙ… Ø¨Ù…Ø¬Ø±Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø§ØªÙØ§Ù‚ØŒ ÙˆÙŠÙ„ØªØ²Ù… Ø·Ø§Ù„Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ø³Ø¯Ø§Ø¯Ù‡Ø§ Ø®Ù„Ø§Ù„ <strong>(10) Ø£ÙŠØ§Ù…</strong> Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„.</p></div>
      <div class="note-sec"><div class="agree-sec-t">Ø«Ø§Ù„Ø«Ù‹Ø§: Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ø³Ø¯Ø§Ø¯</div><p>âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ²Ø§Ù… Ù…Ø§Ù„ÙŠ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø³Ø¯Ø§Ø¯ØŒ ÙˆÙ„Ø§ ØªØ¨Ø±Ø£ Ø°Ù…ØªÙƒ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„.</p></div>
      <div class="agree-check"><input type="checkbox" id="agreeCheck" onchange="document.getElementById('agreeBtn').disabled=!this.checked"><label for="agreeCheck">Ø£ÙÙ‚Ø±Ù‘ Ø¨Ø£Ù†Ù†ÙŠ Ø§Ø·Ù„Ø¹Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© ÙˆØ£ØªØ¹Ù‡Ø¯ Ø¨Ø³Ø¯Ø§Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© <strong>(1%)</strong> Ø®Ù„Ø§Ù„ Ø¹Ø´Ø±Ø© Ø£ÙŠØ§Ù…</label></div>
    </div>
    <div class="agree-foot"><button class="btn-agree" id="agreeBtn" disabled onclick="acceptAgree()">âœ“ Ø£ÙˆØ§ÙÙ‚ ÙˆØ£Ù†Ø´Ø± Ø·Ù„Ø¨ÙŠ</button><button class="btn-back" onclick="closeAgree()">Ø±Ø¬ÙˆØ¹</button></div>
  </div>
</div>
<div class="overlay" id="rateOverlay">
  <div class="modal">
    <div class="modal-drag"></div>
    <div class="modal-head"><h3>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø²ÙˆØ¯</h3><button class="modal-x" onclick="document.getElementById('rateOverlay').className='overlay'"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
    <div class="modal-body">
      <div class="alert" id="rate-msg"></div>
      <p style="text-align:center;font-size:12px;color:var(--muted)">ÙƒÙŠÙ ÙƒØ§Ù†Øª ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ø§Ù„Ù…Ø²ÙˆØ¯ØŸ</p>
      <div class="stars-pick" id="stars-pick"><span class="sp" onclick="setStar(1)">â­</span><span class="sp" onclick="setStar(2)">â­</span><span class="sp" onclick="setStar(3)">â­</span><span class="sp" onclick="setStar(4)">â­</span><span class="sp" onclick="setStar(5)">â­</span></div>
      <div class="fg"><label>ØªØ¹Ù„ÙŠÙ‚Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><textarea id="rate-comment" style="min-height:70px" placeholder="Ø´Ø§Ø±Ùƒ ØªØ¬Ø±Ø¨ØªÙƒ..."></textarea></div>
    </div>
    <div class="modal-foot"><button class="btn-p" id="rate-btn" onclick="submitRate()" style="flex:1">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button><button class="btn-s" onclick="document.getElementById('rateOverlay').className='overlay'">Ø¥Ù„ØºØ§Ø¡</button></div>
  </div>
</div>
<script>
var API='https://manaqasati-production.up.railway.app';
var user=JSON.parse(localStorage.getItem('user')||'{}');
var token=localStorage.getItem('token')||'';
if(!user.id){location.href='auth.html';}
var selRating=0,selProviderId=null,selRequestId=null,curRequestId=null,curChatReceiver=null;
var n=user.name||'Ø§Ù„Ø¹Ù…ÙŠÙ„';
document.getElementById('userName').textContent=n;
document.getElementById('welcomeName').textContent='Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ '+n.split(' ')[0]+' ğŸ‘‹';
document.getElementById('userAv').textContent=n.charAt(0);
document.getElementById('mobAv').textContent=n.charAt(0);
var CATS=['ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ','ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ø³Ø¨Ø§ÙƒØ©','Ù†Ø¬Ø§Ø±Ø©','ØªÙ†Ø¸ÙŠÙ','Ù†Ù‚Ù„ Ø¹ÙØ´','Ø­Ø¯Ø§Ø¯Ø©','Ø£Ù„Ù…Ù†ÙŠÙˆÙ…','Ù…Ø³Ø§Ø¨Ø­ (ØªÙ†ÙÙŠØ° ÙˆØµÙŠØ§Ù†Ø©)','ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ£Ù…Ù†','Ø´Ø¨ÙƒØ§Øª ÙˆØ¥Ù†ØªØ±Ù†Øª','Ù…Ø¸Ù„Ø§Øª ÙˆØ³ÙˆØ§ØªØ±','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ ÙˆØ£Ø³Ø·Ø­','Ø£Ø¨ÙˆØ§Ø¨','Ø£Ø¹Ù…Ø§Ù„ Ø¬Ø¨Ø³ ÙˆØ·Ø¨Ø§Ø´ÙŠØ±','Ù…ÙƒØ§ÙØ­Ø© Ø­Ø´Ø±Ø§Øª','Ø£Ø®Ø±Ù‰'];
var sel=document.getElementById('n-cat');
CATS.forEach(function(c){var o=document.createElement('option');o.value=c;o.textContent=c;sel.appendChild(o);});
function checkOther(){document.getElementById('other-wrap').style.display=document.getElementById('n-cat').value==='Ø£Ø®Ø±Ù‰'?'block':'none';}
function hdr(){return{headers:{'Content-Type':'application/json','Authorization':'Bearer '+token}};}
function show(pg,el,key){
  document.querySelectorAll('.page').forEach(function(p){p.className='page';});
  document.querySelectorAll('.ni').forEach(function(m){m.className='ni';});
  document.querySelectorAll('.bni').forEach(function(m){m.className='bni';});
  document.getElementById('page-'+pg).className='page on';
  if(el)el.className='ni on';
  if(key){var b=document.getElementById('bn-'+key);if(b)b.className='bni on';}
  var t={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',requests:'Ø·Ù„Ø¨Ø§ØªÙŠ',new:'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯',notifs:'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',detail:'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨'};
  document.getElementById('pageTitle').textContent=t[pg]||'';
  if(pg==='requests')loadReqs();
  if(pg==='home')loadHome();
  if(pg==='notifs')loadNotifs();
  window.scrollTo(0,0);
}
function showTab(t,el){
  document.querySelectorAll('.tab').forEach(function(x){x.className='tab';});
  document.querySelectorAll('.tab-btn').forEach(function(x){x.className='tab-btn';});
  document.getElementById('tab-'+t).className='tab on';
  el.className='tab-btn on';
  if(t==='bids')loadBids(curRequestId);
  if(t==='chat')loadChat(curRequestId);
  if(t==='actions')loadActions(curRequestId);
}
function logout(){localStorage.clear();location.href='auth.html';}
function showAgreement(){document.getElementById('agreeCheck').checked=false;document.getElementById('agreeBtn').disabled=true;document.getElementById('agreeOverlay').className='overlay show';}
function closeAgree(){document.getElementById('agreeOverlay').className='overlay';}
function acceptAgree(){closeAgree();show('new',null,'new');}
function stTag(s){if(s==='open')return '<span class="tag t-open">Ù†Ø´Ø·</span>';if(s==='in_progress')return '<span class="tag t-prog">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>';if(s==='done')return '<span class="tag t-done">Ù…ÙƒØªÙ…Ù„</span>';return '<span class="tag t-rev">Ù…Ø±Ø§Ø¬Ø¹Ø©</span>';}
function starsStr(n){var s='';for(var i=1;i<=5;i++)s+=i<=n?'â˜…':'â˜†';return s;}
function timeAgo(d){var diff=(new Date()-new Date(d))/1000;if(diff<60)return 'Ø§Ù„Ø¢Ù†';if(diff<3600)return Math.floor(diff/60)+' Ø¯';if(diff<86400)return Math.floor(diff/3600)+' Ø³';return Math.floor(diff/86400)+' ÙŠÙˆÙ…';}
function emptyH(t,s){return '<div class="empty"><div class="empty-ic"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><h4>'+t+'</h4>'+(s?'<p>'+s+'</p>':'')+'</div>';}
function riCard(r){
  var bids=r.bid_count>0?'<span class="rm">'+r.bid_count+' Ø¹Ø±ÙˆØ¶</span>':'';
  return '<div class="ri" onclick="openDetail('+r.id+',event)"><div class="ri-top"><div class="ri-title">'+r.title+'</div>'+stTag(r.status)+'</div><div class="ri-meta">'+(r.city?'<span class="rm">ğŸ“'+r.city+'</span>':'')+(r.address?'<span class="rm">'+r.address+'</span>':'')+(r.category?'<span class="rm">'+r.category+'</span>':'')+(r.budget_max?'<span class="rm">'+r.budget_max+' Ø±.Ø³</span>':'')+bids+'<span class="rm">'+timeAgo(r.created_at)+'</span></div></div>';
}
function loadHome(){
  fetch(API+'/api/requests/my',hdr()).then(function(r){return r.json();}).then(function(all){
    document.getElementById('s-total').textContent=all.length;
    document.getElementById('s-open').textContent=all.filter(function(r){return r.status==='open';}).length;
    document.getElementById('s-prog').textContent=all.filter(function(r){return r.status==='in_progress';}).length;
    document.getElementById('s-done').textContent=all.filter(function(r){return r.status==='done';}).length;
    document.getElementById('home-reqs').innerHTML=all.length?all.slice(0,5).map(riCard).join(''):emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯','Ø§Ù†Ø´Ø± Ø£ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†');
  }).catch(function(){document.getElementById('home-reqs').innerHTML=emptyH('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„','');});
  loadNotifCount();
}
function loadReqs(){
  document.getElementById('all-reqs').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/requests/my',hdr()).then(function(r){return r.json();}).then(function(all){
    document.getElementById('all-reqs').innerHTML=all.length?all.map(riCard).join(''):emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª','Ø§Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø£ÙˆÙ„');
  }).catch(function(){document.getElementById('all-reqs').innerHTML=emptyH('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„','');});
}
function openDetail(id,e){
  if(e)e.stopPropagation();
  curRequestId=id;curChatReceiver=null;
  document.querySelectorAll('.tab-btn').forEach(function(x,i){x.className=i===0?'tab-btn on':'tab-btn';});
  document.querySelectorAll('.tab').forEach(function(x,i){x.className=i===0?'tab on':'tab';});
  fetch(API+'/api/requests/'+id).then(function(r){return r.json();}).then(function(req){
    document.getElementById('detail-head').innerHTML='<div class="req-detail-head"><div class="rdh-title">'+req.title+'</div><div class="rdh-meta">'+(req.city?'<span>ğŸ“'+req.city+'</span>':'')+(req.address?'<span>'+req.address+'</span>':'')+(req.category?'<span>'+req.category+'</span>':'')+(req.budget_max?'<span>'+req.budget_max+' Ø±.Ø³</span>':'')+(req.deadline?'<span>ğŸ“…'+req.deadline+'</span>':'')+stTag(req.status)+'</div>'+(req.description?'<div class="rdh-desc">'+req.description+'</div>':'')+'</div>';
    loadBids(id);
  });
  show('detail',null,null);
}
function loadBids(id){
  document.getElementById('bids-list').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/requests/'+id+'/bids').then(function(r){return r.json();}).then(function(bids){
    document.getElementById('bids-count').textContent='('+bids.length+')';
    if(!bids.length){document.getElementById('bids-list').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø¨Ø¹Ø¯','Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹');return;}
    document.getElementById('bids-list').innerHTML=bids.map(function(b){
      var isAcc=b.status==='accepted',isRej=b.status==='rejected';
      var rating=b.avg_rating>0?'<span class="stars-row">'+starsStr(Math.round(b.avg_rating))+'</span> '+b.avg_rating:'Ø¬Ø¯ÙŠØ¯';
      var acts=!isAcc&&!isRej?'<div class="bid-actions"><button class="btn-sm bs-g" onclick="acceptBid('+b.id+','+id+')">âœ“ Ù‚Ø¨ÙˆÙ„</button><button class="btn-sm bs-r" onclick="rejectBid('+b.id+','+id+')">âœ— Ø±ÙØ¶</button><button class="btn-sm bs-p" onclick="startChat('+id+','+b.provider_id+',\''+b.provider_name+'\')">ğŸ’¬ Ù…Ø­Ø§Ø¯Ø«Ø©</button></div>':'';
      return '<div class="bid-item'+(isAcc?' accepted':'')+(isRej?' rejected':'')+'"><div class="bid-top"><div class="bid-name">'+b.provider_name+(isAcc?' âœ…':'')+(isRej?' âŒ':'')+'</div><div class="bid-price">'+b.price+' Ø±.Ø³</div></div><div class="bid-meta"><span class="rm">â± '+b.days+' Ø£ÙŠØ§Ù…</span><span class="rm">'+rating+'</span>'+(b.provider_city?'<span class="rm">ğŸ“'+b.provider_city+'</span>':'')+'</div>'+(b.note?'<div class="bid-note">"'+b.note+'"</div>':'')+acts+'</div>';
    }).join('');
  }).catch(function(){document.getElementById('bids-list').innerHTML=emptyH('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„','');});
}
function loadChat(id){
  if(!curChatReceiver){document.getElementById('chat-list').innerHTML=emptyH('Ø§Ø®ØªØ± Ù…Ø²ÙˆØ¯Ø§Ù‹','Ø§Ø°Ù‡Ø¨ Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ø¶ØºØ· Ù…Ø­Ø§Ø¯Ø«Ø©');return;}
  renderChat(id);
}
function startChat(reqId,providerId,providerName){
  curChatReceiver={id:providerId,name:providerName};
  document.querySelectorAll('.tab-btn')[1].click();
}
function renderChat(id){
  fetch(API+'/api/messages/'+id,hdr()).then(function(r){return r.json();}).then(function(msgs){
    var h='<div class="chat-wrap"><div class="chat-msgs" id="msgs-box">';
    if(!msgs.length)h+='<div style="text-align:center;color:var(--muted);font-size:12px;margin:auto">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ğŸ‘‹</div>';
    msgs.forEach(function(m){var isMe=m.sender_id==user.id;h+='<div class="msg-bubble '+(isMe?'msg-me':'msg-other')+'">'+(!isMe?'<div class="msg-name">'+m.sender_name+'</div>':'')+m.content+'<div class="msg-time">'+timeAgo(m.created_at)+'</div></div>';});
    h+='</div><div class="chat-input"><input class="chat-inp" id="chat-inp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeydown="if(event.key===\'Enter\')sendMsg('+id+')"><button class="chat-send" onclick="sendMsg('+id+')">Ø¥Ø±Ø³Ø§Ù„</button></div></div>';
    document.getElementById('chat-list').innerHTML=h;
    var box=document.getElementById('msgs-box');if(box)box.scrollTop=box.scrollHeight;
  });
}
function sendMsg(reqId){
  var inp=document.getElementById('chat-inp');
  if(!inp||!inp.value.trim()||!curChatReceiver)return;
  var content=inp.value.trim();inp.value='';
  fetch(API+'/api/messages',Object.assign({method:'POST',body:JSON.stringify({request_id:reqId,receiver_id:curChatReceiver.id,content:content})},hdr())).then(function(){renderChat(reqId);});
}
function loadActions(id){
  fetch(API+'/api/requests/'+id).then(function(r){return r.json();}).then(function(req){
    var h='';
    if(req.status==='in_progress'){
      h='<div class="card"><div class="ch"><h3>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3></div>';
      h+='<button class="btn-sm bs-g" onclick="markDone('+id+')" style="width:100%;padding:12px;margin-bottom:10px">âœ“ ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² â€” Ø£ÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨</button>';
      h+='<button class="btn-sm bs-p" onclick="openRate('+id+','+req.accepted_bid_id+')" style="width:100%;padding:12px">â­ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø²ÙˆØ¯</button></div>';
    } else if(req.status==='done'){
      h='<div class="card"><p style="text-align:center;font-size:13px;color:var(--green);font-weight:700">âœ… Ø§Ù„Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„</p></div>';
    } else {
      h='<div class="card"><p style="text-align:center;font-size:13px;color:var(--muted)">Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø«Ù… Ø§Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</p></div>';
    }
    document.getElementById('actions-wrap').innerHTML=h;
  });
}
function acceptBid(bidId,reqId){fetch(API+'/api/bids/'+bidId+'/accept',Object.assign({method:'PUT'},hdr())).then(function(){openDetail(reqId,null);});}
function rejectBid(bidId,reqId){fetch(API+'/api/bids/'+bidId+'/reject',Object.assign({method:'PUT'},hdr())).then(function(){loadBids(reqId);});}
function markDone(id){fetch(API+'/api/requests/'+id+'/status',Object.assign({method:'PUT',body:JSON.stringify({status:'done'})},hdr())).then(function(){openDetail(id,null);});}
function openRate(reqId,bidId){
  selRequestId=reqId;selRating=0;
  document.querySelectorAll('.sp').forEach(function(s){s.className='sp';});
  document.getElementById('rate-comment').value='';
  document.getElementById('rate-msg').className='alert';
  document.getElementById('rateOverlay').className='overlay show';
  if(bidId){fetch(API+'/api/requests/'+reqId+'/bids').then(function(r){return r.json();}).then(function(bids){var ab=bids.find(function(b){return b.status==='accepted';});if(ab)selProviderId=ab.provider_id;});}
}
function setStar(n){selRating=n;document.querySelectorAll('.sp').forEach(function(s,i){s.className=i<n?'sp on':'sp';});}
function submitRate(){
  if(!selRating){var e=document.getElementById('rate-msg');e.textContent='ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ…';e.className='alert err';return;}
  var btn=document.getElementById('rate-btn');btn.disabled=true;
  fetch(API+'/api/reviews',Object.assign({method:'POST',body:JSON.stringify({request_id:selRequestId,reviewed_id:selProviderId,rating:selRating,comment:document.getElementById('rate-comment').value,type:'client_to_provider'})},hdr()))
  .then(function(r){return r.json().then(function(d){return{ok:r.ok,d:d};});})
  .then(function(r){
    var e=document.getElementById('rate-msg');
    if(r.ok){e.textContent='âœ“ Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ùƒ';e.className='alert ok';setTimeout(function(){document.getElementById('rateOverlay').className='overlay';},1400);}
    else{e.textContent=r.d.message||'Ø­Ø¯Ø« Ø®Ø·Ø£';e.className='alert err';}
    btn.disabled=false;
  });
}
function loadNotifCount(){
  fetch(API+'/api/notifications',hdr()).then(function(r){return r.json();}).then(function(ns){
    var u=ns.filter(function(n){return!n.is_read;}).length;
    ['notif-badge','mob-notif-badge','bn-notif-badge'].forEach(function(id){var el=document.getElementById(id);if(!el)return;el.textContent=u;el.style.display=u>0?'flex':'none';});
  }).catch(function(){});
}
function loadNotifs(){
  document.getElementById('notifs-list').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/notifications',hdr()).then(function(r){return r.json();}).then(function(ns){
    if(!ns.length){document.getElementById('notifs-list').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª','');return;}
    document.getElementById('notifs-list').innerHTML=ns.map(function(n){return '<div class="notif-item'+(n.is_read?'':' unread')+'" onclick="handleNotif('+n.ref_id+',\''+n.type+'\')"><div class="notif-ic">'+n.title.charAt(0)+'</div><div><div class="notif-title">'+n.title+'</div><div class="notif-body">'+n.body+'</div><div class="notif-time">'+timeAgo(n.created_at)+'</div></div></div>';}).join('');
    markAllRead();
  }).catch(function(){document.getElementById('notifs-list').innerHTML=emptyH('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„','');});
}
function handleNotif(refId,type){if(refId&&(type==='bid'||type==='message'))openDetail(refId,null);}
function markAllRead(){
  fetch(API+'/api/notifications/read',Object.assign({method:'PUT'},hdr())).then(function(){['notif-badge','mob-notif-badge','bn-notif-badge'].forEach(function(id){var el=document.getElementById(id);if(el)el.style.display='none';});});
}
function submitReq(){
  var title=document.getElementById('n-title').value.trim();
  var desc=document.getElementById('n-desc').value.trim();
  var city=document.getElementById('n-city').value.trim();
  var cat=document.getElementById('n-cat').value;
  if(cat==='Ø£Ø®Ø±Ù‰'){var oth=document.getElementById('n-other').value.trim();if(oth)cat='Ø£Ø®Ø±Ù‰: '+oth;}
  if(!title||!desc||!city){showNewMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©','err');return;}
  var btn=document.getElementById('n-btn');btn.disabled=true;btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
  fetch(API+'/api/requests',Object.assign({method:'POST',body:JSON.stringify({title:title,description:desc,category:cat,city:city,address:document.getElementById('n-address').value.trim(),budget_max:parseInt(document.getElementById('n-budget').value)||null,deadline:document.getElementById('n-deadline').value||null})},hdr()))
  .then(function(r){return r.json().then(function(d){return{ok:r.ok,d:d};});})
  .then(function(r){
    if(r.ok){showNewMsg('âœ“ ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!','ok');['n-title','n-desc','n-city','n-address','n-budget','n-other'].forEach(function(id){var el=document.getElementById(id);if(el)el.value='';});document.getElementById('n-deadline').value='';setTimeout(function(){show('requests',null,'requests');},1600);}
    else{showNewMsg(r.d.message||'Ø­Ø¯Ø« Ø®Ø·Ø£','err');}
    btn.disabled=false;btn.textContent='Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨';
  }).catch(function(){showNewMsg('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„','err');btn.disabled=false;btn.textContent='Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨';});
}
function showNewMsg(t,c){var e=document.getElementById('new-msg');e.textContent=t;e.className='alert '+c;setTimeout(function(){e.className='alert';},5000);}
setInterval(loadNotifCount,30000);
loadHome();
</script>
</body>
</html>
