<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:#f1f5f9;min-height:100vh;display:flex}
.side{width:240px;background:#1e3a8a;min-height:100vh;padding:24px 0;position:fixed;right:0;top:0}
.side-logo{padding:0 20px 24px;border-bottom:1px solid rgba(255,255,255,0.1)}
.side-logo h1{font-size:22px;font-weight:900;color:#fff}
.side-logo h1 span{color:#60a5fa}
.side-logo p{font-size:11px;color:#93c5fd;margin-top:3px}
.menu{padding:16px 0}
.menu-item{display:flex;align-items:center;gap:10px;padding:12px 20px;color:#cbd5e1;cursor:pointer;transition:.2s;font-size:14px;font-weight:600;border:none;background:none;width:100%;text-align:right;font-family:'Tajawal',sans-serif}
.menu-item:hover{background:rgba(255,255,255,0.08);color:#fff}
.menu-item.on{background:rgba(255,255,255,0.12);color:#fff;border-right:3px solid #60a5fa}
.ic{font-size:18px;width:24px}
.main{margin-right:240px;flex:1;padding:24px}
.topbar{background:#fff;border-radius:12px;padding:16px 20px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
.topbar h2{font-size:18px;font-weight:800;color:#1e3a8a}
.topbar-right{display:flex;gap:10px;align-items:center}
.btn-new{background:linear-gradient(135deg,#1d4ed8,#1e40af);color:#fff;padding:9px 18px;border-radius:9px;font-size:14px;font-weight:700;cursor:pointer;border:none;font-family:'Tajawal',sans-serif}
.logout{background:#fee2e2;color:#dc2626;padding:7px 14px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;border:none;font-family:'Tajawal',sans-serif}
.page{display:none}
.page.on{display:block}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:20px}
.stat{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);text-align:center}
.stat-ic{font-size:28px;margin-bottom:6px}
.stat-n{font-size:26px;font-weight:900;color:#1e3a8a}
.stat-t{font-size:13px;color:#64748b;margin-top:3px;font-weight:600}
.card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:16px}
.card h3{font-size:16px;font-weight:800;color:#1e3a8a;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid #f1f5f9}
.req-card{border:1px solid #e2e8f0;border-radius:10px;padding:16px;margin-bottom:12px}
.req-title{font-size:15px;font-weight:800;color:#1e293b;margin-bottom:6px}
.req-meta{display:flex;gap:12px;flex-wrap:wrap}
.req-meta span{font-size:12px;color:#64748b}
.tag{padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700}
.tag-review{background:#fef3c7;color:#d97706}
.tag-open{background:#dcfce7;color:#16a34a}
.tag-done{background:#eff6ff;color:#1d4ed8}
.empty{text-align:center;padding:40px;color:#94a3b8;font-size:15px}
.loading{text-align:center;padding:30px;color:#64748b}
.g{margin-bottom:15px}
.g label{display:block;font-size:14px;font-weight:700;color:#1e3a8a;margin-bottom:6px}
.g input,.g textarea,.g select{width:100%;padding:11px 13px;border:1.5px solid #e2e8f0;border-radius:9px;font-family:'Tajawal',sans-serif;font-size:14px;color:#1e293b;outline:none}
.g input:focus,.g textarea:focus,.g select:focus{border-color:#1d4ed8}
.g textarea{min-height:100px;resize:vertical}
.btn-submit{width:100%;padding:13px;background:linear-gradient(135deg,#1d4ed8,#1e40af);color:#fff;border:none;border-radius:9px;font-family:'Tajawal',sans-serif;font-size:15px;font-weight:800;cursor:pointer;margin-top:4px}
.btn-submit:disabled{opacity:.65;cursor:not-allowed}
.msg{padding:10px 14px;border-radius:8px;font-size:14px;font-weight:600;margin-bottom:14px;display:none}
.msg.ok{background:#dcfce7;color:#16a34a;display:block}
.msg.err{background:#fee2e2;color:#dc2626;display:block}
</style>
</head>
<body>
<div class="side">
  <div class="side-logo">
    <h1>Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></h1>
    <p id="userName">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
  </div>
  <div class="menu">
    <button class="menu-item on" onclick="show('home',this)"><span class="ic">ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="menu-item" onclick="show('requests',this)"><span class="ic">ğŸ“‹</span> Ø·Ù„Ø¨Ø§ØªÙŠ</button>
    <button class="menu-item" onclick="show('new',this)"><span class="ic">â•</span> Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <h2 id="pageTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
    <div class="topbar-right">
      <button class="btn-new" onclick="show('new',null)">â• Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      <button class="logout" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
  <div class="page on" id="page-home">
    <div class="stats">
      <div class="stat"><div class="stat-ic">ğŸ“‹</div><div class="stat-n" id="s-total">0</div><div class="stat-t">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§ØªÙŠ</div></div>
      <div class="stat"><div class="stat-ic">â³</div><div class="stat-n" id="s-review">0</div><div class="stat-t">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div>
      <div class="stat"><div class="stat-ic">âœ…</div><div class="stat-n" id="s-open">0</div><div class="stat-t">Ù†Ø´Ø·Ø©</div></div>
    </div>
    <div class="card">
      <h3>Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
      <div id="recent-reqs"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
  </div>
  <div class="page" id="page-requests">
    <div class="card">
      <h3>Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
      <div id="all-reqs"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
  </div>
  <div class="page" id="page-new">
    <div class="card">
      <h3>â• Ù†Ø´Ø± Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
      <div class="msg" id="new-msg"></div>
      <div class="g"><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨ *</label><input type="text" id="n-title" placeholder="Ù…Ø«Ø§Ù„: ØªØ±ÙƒÙŠØ¨ Ù…ÙƒÙŠÙ Ø³Ø¨Ù„ÙŠØª"></div>
      <div class="g"><label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
        <select id="n-cat">
          <option>ØªÙƒÙŠÙŠÙ ÙˆØªØ¨Ø±ÙŠØ¯</option>
          <option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
          <option>Ø³Ø¨Ø§ÙƒØ©</option>
          <option>Ù†Ø¬Ø§Ø±Ø©</option>
          <option>Ø¯Ù‡Ø§Ù†Ø§Øª</option>
          <option>ØªÙ†Ø¸ÙŠÙ</option>
          <option>Ù†Ù‚Ù„ Ø¹ÙØ´</option>
          <option>Ø£Ø®Ø±Ù‰</option>
        </select>
      </div>
      <div class="g"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input type="text" id="n-city" placeholder="Ø§Ù„Ø±ÙŠØ§Ø¶"></div>
      <div class="g"><label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" id="n-budget" placeholder="500"></div>
      <div class="g"><label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ *</label><textarea id="n-desc" placeholder="Ø§Ø´Ø±Ø­ Ø·Ù„Ø¨Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea></div>
      <button class="btn-submit" id="n-btn" onclick="submitReq()">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>
</div>
<script>
var API='https://manaqasati-production.up.railway.app';
var user=JSON.parse(localStorage.getItem('user')||'{}');
if(!user.id){location.href='auth.html';}
document.getElementById('userName').textContent='Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ '+user.name;
function show(page,el){
  document.querySelectorAll('.page').forEach(function(p){p.className='page';});
  document.querySelectorAll('.menu-item').forEach(function(m){m.className='menu-item';});
  document.getElementById('page-'+page).className='page on';
  if(el)el.className='menu-item on';
  var titles={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',requests:'Ø·Ù„Ø¨Ø§ØªÙŠ',new:'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯'};
  document.getElementById('pageTitle').textContent=titles[page]||'';
  if(page==='requests')loadAllReqs();
  if(page==='home')loadHome();
}
function logout(){localStorage.clear();location.href='auth.html';}
function statusTag(s){
  if(s==='open')return '<span class="tag tag-open">Ù†Ø´Ø·</span>';
  if(s==='done')return '<span class="tag tag-done">Ù…ÙƒØªÙ…Ù„</span>';
  return '<span class="tag tag-review">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>';
}
function loadHome(){
  fetch(API+'/api/requests')
  .then(function(r){return r.json();})
  .then(function(all){
    var mine=all.filter(function(r){return r.client_id==user.id;});
    document.getElementById('s-total').textContent=mine.length;
    document.getElementById('s-review').textContent=mine.filter(function(r){return r.status==='review';}).length;
    document.getElementById('s-open').textContent=mine.filter(function(r){return r.status==='open';}).length;
    if(!mine.length){
      document.getElementById('recent-reqs').innerHTML='<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯<br><br><button onclick="show(\'new\',null)" style="background:#1d4ed8;color:#fff;padding:10px 20px;border:none;border-radius:8px;font-family:Tajawal,sans-serif;font-size:14px;font-weight:700;cursor:pointer">â• Ø£Ù†Ø´Ø± Ø£ÙˆÙ„ Ø·Ù„Ø¨</button></div>';
      return;
    }
    var html='';
    mine.slice(0,3).forEach(function(r){
      html+='<div class="req-card"><div class="req-title">'+r.title+'</div><div class="req-meta"><span>ğŸ“ '+(r.city||'â€“')+'</span><span>ğŸ—‚ï¸ '+(r.category||'â€“')+'</span>'+statusTag(r.status)+'</div></div>';
    });
    document.getElementById('recent-reqs').innerHTML=html;
  }).catch(function(){document.getElementById('recent-reqs').innerHTML='<div class="empty">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';});
}
function loadAllReqs(){
  document.getElementById('all-reqs').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/requests')
  .then(function(r){return r.json();})
  .then(function(all){
    var mine=all.filter(function(r){return r.client_id==user.id;});
    if(!mine.length){document.getElementById('all-reqs').innerHTML='<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>';return;}
    var html='';
    mine.forEach(function(r){
      html+='<div class="req-card"><div class="req-title">'+r.title+'</div><div class="req-meta"><span>ğŸ“ '+(r.city||'â€“')+'</span><span>ğŸ—‚ï¸ '+(r.category||'â€“')+'</span><span>ğŸ’° '+(r.budget_max||'â€“')+' Ø±.Ø³</span>'+statusTag(r.status)+'<span>ğŸ“… '+new Date(r.created_at).toLocaleDateString('ar')+'</span></div></div>';
    });
    document.getElementById('all-reqs').innerHTML=html;
  }).catch(function(){document.getElementById('all-reqs').innerHTML='<div class="empty">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';});
}
function submitReq(){
  var title=document.getElementById('n-title').value.trim();
  var desc=document.getElementById('n-desc').value.trim();
  var city=document.getElementById('n-city').value.trim()||'Ø§Ù„Ø±ÙŠØ§Ø¶';
  var cat=document.getElementById('n-cat').value;
  var budget=document.getElementById('n-budget').value||0;
  if(!title||!desc){showMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„','err');return;}
  var btn=document.getElementById('n-btn');
  btn.disabled=true;btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
  fetch(API+'/api/requests',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:title,description:desc,category:cat,city:city,budget_max:parseInt(budget),client_id:user.id})})
  .then(function(r){return r.json().then(function(d){return{ok:r.ok,d:d};});})
  .then(function(r){
    if(r.ok){showMsg('âœ… ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!','ok');document.getElementById('n-title').value='';document.getElementById('n-desc').value='';document.getElementById('n-budget').value='';}
    else{showMsg(r.d.message||'Ø­Ø¯Ø« Ø®Ø·Ø£','err');}
    btn.disabled=false;btn.textContent='ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨';
  }).catch(function(){showMsg('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…','err');btn.disabled=false;btn.textContent='ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨';});
}
function showMsg(t,c){var e=document.getElementById('new-msg');e.textContent=t;e.className='msg '+c;setTimeout(function(){e.className='msg';},4000);}
loadHome();
</script>
</body>
</html>
