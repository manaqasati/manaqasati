<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ù…Ù†Ø§Ù‚ØµØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
<style>
:root{
  --p:#7c3aed;--p2:#6d28d9;--pl:#ede9fe;--pm:#ddd6fe;
  --gold:#f59e0b;--gold2:#d97706;--gl:#fef3c7;--gl2:#fef9c3;
  --text:#111827;--sub:#6b7280;--b2:#e5e7eb;--bg:#f9fafb;--w:#fff;
  --red:#ef4444;--rl:#fee2e2;--gn:#16a34a;--gnl:#dcfce7;
  --blue:#3b82f6;--bl:#dbeafe;--or:#f97316;--ol:#ffedd5;
  --sb:248px;--top:52px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;font-size:14px}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}

/* â•â•â• SIDEBAR â•â•â• */
.sb{width:var(--sb);background:#111827;position:fixed;top:0;right:0;bottom:0;z-index:200;display:flex;flex-direction:column;transition:transform .25s}
.sb-top{padding:0 14px;height:var(--top);display:flex;align-items:center;gap:9px;border-bottom:1px solid rgba(255,255,255,.06)}
.sb-ic{width:28px;height:28px;border-radius:7px;background:linear-gradient(135deg,#f59e0b,#f97316);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.sb-brand{font-size:15px;font-weight:900;color:#fff}.sb-brand em{color:#f59e0b;font-style:normal}
.sb-user{padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.05);display:flex;align-items:center;gap:9px}
.sb-av{width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#7c3aed,#a855f7);color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sb-nm{font-size:12px;font-weight:700;color:#f3f4f6}
.sb-rl{font-size:10px;color:#6b7280;display:flex;align-items:center;gap:3px;margin-top:1px}
.sb-rl::before{content:'';width:5px;height:5px;border-radius:50%;background:#22c55e}
.sb-nav{flex:1;padding:6px 8px;overflow-y:auto;scrollbar-width:none}
.sb-nav::-webkit-scrollbar{display:none}
.sb-grp{font-size:9px;font-weight:700;color:#4b5563;letter-spacing:.8px;padding:10px 8px 4px;text-transform:uppercase}
.sbi{display:flex;align-items:center;gap:8px;padding:7px 9px;border-radius:7px;cursor:pointer;transition:.12s;margin-bottom:1px;border:none;background:transparent;width:100%;font-family:'Tajawal',sans-serif;text-align:right;color:#9ca3af;position:relative}
.sbi:hover{background:rgba(255,255,255,.05);color:#e5e7eb}
.sbi.on{background:rgba(124,58,237,.15);color:#c4b5fd}
.sbi.on::before{content:'';position:absolute;right:0;top:25%;height:50%;width:2px;background:#7c3aed;border-radius:0 2px 2px 0}
.sbi i{width:28px;height:28px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sbi i svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:1.5}
.sbi-lbl{font-size:12px;font-weight:600;flex:1;text-align:right}
.sbi.on .sbi-lbl{font-weight:700}
.sb-dot{background:#ef4444;color:#fff;font-size:9px;font-weight:800;padding:1px 5px;border-radius:20px;min-width:17px;text-align:center}
.sb-bot{padding:8px;border-top:1px solid rgba(255,255,255,.05)}
.sb-ver{text-align:center;font-size:9px;color:#374151;padding:5px 0 0}

/* â•â•â• MAIN â•â•â• */
.main{margin-right:var(--sb);flex:1;display:flex;flex-direction:column;min-height:100vh}
.topbar{background:var(--w);border-bottom:1px solid var(--b2);padding:0 20px;height:var(--top);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.tb-crumb{display:flex;align-items:center;gap:5px;font-size:12px}
.tb-crumb-h{color:var(--sub)}
.tb-crumb-s{color:#d1d5db;font-size:10px}
.tb-crumb-c{color:var(--text);font-weight:700}
.tb-r{display:flex;align-items:center;gap:6px}
.tb-clk{font-size:11px;font-weight:600;color:var(--sub);background:var(--bg);padding:4px 10px;border-radius:6px;border:1px solid var(--b2)}
.tb-ic{width:32px;height:32px;border-radius:7px;border:1px solid var(--b2);background:var(--w);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.12s;color:var(--sub)}
.tb-ic:hover{background:var(--bg);color:var(--text)}
.tb-ic svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:1.5}
.content{padding:18px 20px;flex:1}

/* â•â•â• PAGE HEADER â•â•â• */
.pghd{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px}
.pghd-t{font-size:16px;font-weight:900}
.pghd-s{font-size:11px;color:var(--sub);margin-top:2px}
.pghd-r{display:flex;gap:7px}

/* â•â•â• STATS â•â•â• */
.sgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px;margin-bottom:18px}
.sc{background:var(--w);border:1px solid var(--b2);border-radius:10px;padding:14px;cursor:default;transition:.15s;position:relative;overflow:hidden}
.sc:hover{box-shadow:0 2px 12px rgba(0,0,0,.06)}
.sc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.sc-ico{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center}
.sc-ico svg{width:16px;height:16px;stroke-width:1.5}
.sc-tr{font-size:9px;font-weight:700;padding:2px 6px;border-radius:20px}
.tup{background:#dcfce7;color:#16a34a}.twn{background:#ffedd5;color:#ea580c}
.sc-val{font-size:22px;font-weight:900;line-height:1;margin-bottom:2px}
.sc-lbl{font-size:11px;color:var(--sub)}
.sc-bar{height:2px;border-radius:2px;margin-top:10px;background:var(--b2);overflow:hidden}
.sc-bf{height:100%;border-radius:2px;transition:width 1.2s ease}

/* â•â•â• CARD â•â•â• */
.card{background:var(--w);border:1px solid var(--b2);border-radius:10px;overflow:hidden;margin-bottom:14px}
.card-hd{padding:12px 16px;border-bottom:1px solid var(--b2);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.card-hd-l{display:flex;align-items:center;gap:9px}
.card-hd-ic{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center}
.card-hd-ic svg{width:13px;height:13px;stroke-width:1.5}
.card-title{font-size:13px;font-weight:800}
.card-sub{font-size:10px;color:var(--sub)}
.card-body{padding:14px 16px}

/* â•â•â• TABLE â•â•â• */
.tw{overflow-x:auto}
.tbl{width:100%;border-collapse:collapse;min-width:650px}
.tbl th{text-align:right;padding:8px 12px;color:var(--sub);font-weight:700;font-size:10px;background:var(--bg);border-bottom:1px solid var(--b2);white-space:nowrap;letter-spacing:.2px}
.tbl td{padding:10px 12px;border-bottom:1px solid var(--b2);vertical-align:middle;font-size:12px}
.tbl tr:last-child td{border-bottom:none}
.tbl tr:hover td{background:#fafafa}
.tbl-av{width:30px;height:30px;border-radius:7px;color:#fff;font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}

/* â•â•â• TAGS â•â•â• */
.tag{padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;display:inline-flex;align-items:center;gap:3px;white-space:nowrap;border:1px solid}
.tag::before{content:'';width:4px;height:4px;border-radius:50%;flex-shrink:0}
.t-pend{background:#fefce8;color:#a16207;border-color:#fef08a}.t-pend::before{background:#ca8a04}
.t-open{background:var(--gnl);color:var(--gn);border-color:#bbf7d0}.t-open::before{background:var(--gn)}
.t-prog{background:var(--bl);color:#1d4ed8;border-color:#bfdbfe}.t-prog::before{background:var(--blue)}
.t-done{background:var(--pl);color:var(--p2);border-color:var(--pm)}.t-done::before{background:var(--p)}
.t-rej{background:var(--rl);color:#b91c1c;border-color:#fecaca}.t-rej::before{background:var(--red)}
.t-act{background:var(--gnl);color:var(--gn);border-color:#bbf7d0}.t-act::before{background:var(--gn)}
.t-off{background:#f3f4f6;color:#6b7280;border-color:var(--b2)}.t-off::before{background:#9ca3af}
.t-warn{background:#ffedd5;color:#c2410c;border-color:#fed7aa}.t-warn::before{background:#f97316}
.t-hide{background:#f3f4f6;color:#6b7280;border-color:var(--b2)}.t-hide::before{background:#9ca3af}

/* â•â•â• BADGE â•â•â• */
.bc{padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;display:inline-flex;align-items:center;gap:3px;border:1px solid}
.b-none{background:#f9fafb;color:#9ca3af;border-color:var(--b2)}
.b-verified{background:var(--bl);color:#1d4ed8;border-color:#93c5fd}
.b-star{background:var(--gl);color:var(--gold2);border-color:#fcd34d}
.b-partner{background:var(--pl);color:var(--p2);border-color:var(--pm)}
.b-top{background:var(--gnl);color:var(--gn);border-color:#86efac}

/* â•â•â• BUTTONS â•â•â• */
.btn{padding:7px 13px;border-radius:7px;font-family:'Tajawal',sans-serif;font-size:12px;font-weight:700;cursor:pointer;border:none;transition:.12s;display:inline-flex;align-items:center;gap:5px;white-space:nowrap}
.btn:active{transform:scale(.97)}
.btn svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:1.8;flex-shrink:0}
.btn-p{background:var(--p);color:#fff}.btn-p:hover{background:var(--p2)}
.btn-g{background:var(--gn);color:#fff}.btn-g:hover{background:#15803d}
.btn-r{background:var(--red);color:#fff}.btn-r:hover{background:#dc2626}
.btn-gold{background:var(--gold);color:#fff}.btn-gold:hover{background:var(--gold2)}
.btn-b{background:var(--blue);color:#fff}.btn-b:hover{background:#2563eb}
.btn-or{background:var(--or);color:#fff}.btn-or:hover{background:#ea580c}
.btn-ghost{background:var(--w);color:var(--text);border:1px solid var(--b2)}.btn-ghost:hover{border-color:#9ca3af}
.btn-light{background:var(--bg);color:var(--sub);border:1px solid var(--b2)}.btn-light:hover{color:var(--text)}
.btn-sm{padding:5px 10px;font-size:11px;border-radius:6px}
.btn-xs{padding:3px 7px;font-size:10px;border-radius:5px}

/* â•â•â• FILTER BAR â•â•â• */
.fbar{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:12px;align-items:center}
.sbox{flex:1;min-width:180px;display:flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--b2);border-radius:7px;padding:0 10px;transition:.12s}
.sbox:focus-within{border-color:#9ca3af;background:var(--w)}
.sbox svg{width:13px;height:13px;stroke:var(--sub);fill:none;stroke-width:1.8;flex-shrink:0}
.sbox input{border:none;outline:none;background:transparent;font-family:'Tajawal',sans-serif;font-size:12px;padding:7px 0;flex:1;color:var(--text)}
.fsel{padding:7px 9px;border:1px solid var(--b2);border-radius:7px;font-family:'Tajawal',sans-serif;font-size:12px;font-weight:600;background:var(--w);color:var(--text);outline:none;cursor:pointer}
.fsel:focus{border-color:#9ca3af}

/* â•â•â• PROJECT CARD â•â•â• */
.pc{background:var(--w);border:1px solid var(--b2);border-radius:10px;padding:14px;margin-bottom:9px;transition:.15s;position:relative;padding-right:18px}
.pc::before{content:'';position:absolute;right:0;top:0;bottom:0;width:3px;border-radius:0 10px 10px 0}
.pc-pend::before{background:var(--gold)}.pc-open::before{background:var(--gn)}.pc-prog::before{background:var(--blue)}.pc-done::before{background:var(--p)}.pc-rej::before{background:var(--red)}
.pc:hover{box-shadow:0 2px 12px rgba(0,0,0,.06)}
.pc-hd{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:7px}
.pc-num{font-size:9px;font-weight:700;color:var(--sub);font-family:monospace;margin-bottom:2px}
.pc-title{font-size:13px;font-weight:800;line-height:1.3}
.pc-meta{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:9px}
.pm{font-size:10px;color:var(--sub);background:var(--bg);padding:2px 7px;border-radius:20px;display:flex;align-items:center;gap:3px;font-weight:500;border:1px solid var(--b2)}
.pc-desc{font-size:11px;color:#4b5563;line-height:1.7;margin-bottom:9px;padding:8px 10px;background:var(--bg);border-radius:7px;border-right:2px solid var(--pm)}
.pc-imgs{display:flex;gap:5px;margin-bottom:9px;flex-wrap:wrap}
.pc-img{width:52px;height:52px;border-radius:7px;object-fit:cover;border:1px solid var(--b2);cursor:pointer;transition:.12s}
.pc-img:hover{border-color:var(--p);transform:scale(1.04)}
.pc-acts{display:flex;gap:5px;flex-wrap:wrap;align-items:center}

/* â•â•â• BID â•â•â• */
.bid-c{border:1px solid var(--b2);border-radius:8px;padding:11px;margin-bottom:7px;background:var(--w);transition:.12s}
.bid-c:hover{border-color:#d1d5db}
.bid-acc{border-color:#86efac;background:#f0fdf4}
.bid-rej2{border-color:#fecaca;background:#fff5f5;opacity:.7}
.bid-hd{display:flex;align-items:center;gap:9px;margin-bottom:7px}
.bid-av{width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,var(--p),#a855f7);color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.bid-nm{font-size:12px;font-weight:700}
.bid-lc{font-size:10px;color:var(--sub)}
.bid-st{color:#f59e0b;font-size:11px}
.bid-info{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:7px}
.bid-ii{background:var(--bg);border-radius:6px;padding:4px 9px;font-size:11px;font-weight:700;border:1px solid var(--b2)}
.bid-ii span{color:var(--sub);font-weight:500;margin-left:2px}
.bid-note{font-size:11px;color:#4b5563;background:var(--bg);padding:7px 9px;border-radius:6px;margin-bottom:7px;line-height:1.6;border-right:2px solid var(--pm)}

/* â•â•â• REVIEW â•â•â• */
.rev-c{border:1px solid var(--b2);border-radius:9px;padding:13px;margin-bottom:8px;background:var(--w);transition:.12s}
.rev-c:hover{border-color:#d1d5db}
.rev-c.rev-hidden{opacity:.5;border-style:dashed}
.rev-c.rev-pinned{border-color:var(--gold);background:#fffdf5}
.rev-hd{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:8px}
.rev-users{display:flex;align-items:center;gap:7px}
.rev-av{width:28px;height:28px;border-radius:7px;color:#fff;font-size:11px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.rev-nm{font-size:12px;font-weight:700}
.rev-sub{font-size:10px;color:var(--sub)}
.rev-arr{color:var(--sub);font-size:11px;padding:0 2px}
.rev-stars{display:flex;gap:1px;margin-bottom:5px}
.rev-star-on{color:#f59e0b;font-size:13px}
.rev-star-off{color:#e5e7eb;font-size:13px}
.rev-proj{font-size:9px;font-weight:700;color:var(--p);font-family:monospace;background:var(--pl);padding:2px 7px;border-radius:20px}
.rev-txt{font-size:12px;color:#4b5563;background:var(--bg);padding:9px 11px;border-radius:7px;line-height:1.7;margin:7px 0;border-right:2px solid var(--pm)}
.rev-reply{font-size:11px;color:var(--p2);background:var(--pl);padding:8px 11px;border-radius:7px;line-height:1.6;margin:5px 0;border-right:2px solid var(--p)}
.rev-reply-lbl{font-size:9px;font-weight:800;color:var(--p);margin-bottom:3px}
.rev-ft{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px}
.rev-date{font-size:10px;color:var(--sub)}
.rev-acts{display:flex;gap:4px;flex-wrap:wrap}
.rev-flag{font-size:9px;color:var(--red);background:var(--rl);padding:2px 7px;border-radius:20px;border:1px solid #fca5a5;font-weight:700}

/* â•â•â• DISPUTE â•â•â• */
.dis-c{border:1px solid var(--b2);border-radius:9px;padding:13px;margin-bottom:8px;background:var(--w)}
.dis-c.dis-open{border-right:3px solid var(--red)}
.dis-c.dis-resolve{border-right:3px solid var(--gn);opacity:.75}
.dis-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;flex-wrap:wrap;gap:6px}
.dis-title{font-size:12px;font-weight:800}
.dis-meta{font-size:10px;color:var(--sub)}
.dis-body{font-size:11px;color:#4b5563;background:var(--bg);padding:8px 11px;border-radius:7px;line-height:1.6;margin-bottom:8px}
.dis-parties{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.dis-party{display:flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--b2);border-radius:7px;padding:6px 10px}
.dis-party-av{width:26px;height:26px;border-radius:6px;color:#fff;font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.dis-party-nm{font-size:11px;font-weight:700}
.dis-party-rl{font-size:9px;color:var(--sub)}
.dis-res{background:var(--gnl);border-radius:7px;padding:8px 11px;font-size:11px;color:var(--gn);margin-bottom:8px;border-right:2px solid var(--gn)}

/* â•â•â• LOG â•â•â• */
.log-item{display:flex;align-items:flex-start;gap:10px;padding:9px 0;border-bottom:1px solid var(--b2)}
.log-item:last-child{border-bottom:none}
.log-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:4px}
.log-body{flex:1}
.log-action{font-size:12px;font-weight:700}
.log-detail{font-size:11px;color:var(--sub);margin-top:1px}
.log-time{font-size:10px;color:var(--sub);white-space:nowrap}

/* â•â•â• MODAL â•â•â• */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;align-items:center;justify-content:center;backdrop-filter:blur(5px);padding:14px}
.overlay.show{display:flex}
.modal{background:var(--w);border-radius:12px;width:100%;max-width:640px;max-height:92vh;overflow-y:auto;box-shadow:0 16px 50px rgba(0,0,0,.18)}
.modal::-webkit-scrollbar{width:3px}
.modal-hd{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--b2);position:sticky;top:0;background:var(--w);z-index:2;border-radius:12px 12px 0 0}
.modal-hd-l{display:flex;align-items:center;gap:9px}
.modal-hd-ic{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center}
.modal-hd-ic svg{width:14px;height:14px;stroke-width:1.8}
.modal-title{font-size:13px;font-weight:800}
.modal-x{width:28px;height:28px;border-radius:6px;background:var(--bg);border:1px solid var(--b2);cursor:pointer;font-size:17px;color:var(--sub);display:flex;align-items:center;justify-content:center;transition:.12s;line-height:1}
.modal-x:hover{background:var(--rl);border-color:#fca5a5;color:var(--red)}
.modal-body{padding:18px}
.modal-ft{display:flex;gap:7px;justify-content:flex-end;padding:12px 18px;border-top:1px solid var(--b2);background:var(--bg);border-radius:0 0 12px 12px}

/* â•â•â• FORM â•â•â• */
.fg{display:flex;flex-direction:column;gap:4px;margin-bottom:11px}
.fl{font-size:11px;font-weight:700;color:var(--text)}
.fl em{color:var(--sub);font-style:normal;font-weight:500;margin-right:3px}
.fi{padding:8px 10px;border:1px solid var(--b2);border-radius:7px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;background:var(--w);color:var(--text);transition:.12s;width:100%}
.fi:focus{border-color:#9ca3af;box-shadow:0 0 0 2px rgba(124,58,237,.07)}
.fsel2{padding:8px 10px;border:1px solid var(--b2);border-radius:7px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;background:var(--w);cursor:pointer;transition:.12s;width:100%}
.fsel2:focus{border-color:#9ca3af}
.fta{padding:8px 10px;border:1px solid var(--b2);border-radius:7px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;resize:vertical;min-height:76px;transition:.12s;width:100%}
.fta:focus{border-color:#9ca3af;box-shadow:0 0 0 2px rgba(124,58,237,.07)}
.f2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.f3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px}
.fsec{font-size:10px;font-weight:800;color:var(--p);padding:9px 0 5px;border-bottom:1px solid var(--pm);margin:3px 0 10px;letter-spacing:.3px;text-transform:uppercase}

/* â•â•â• SPECS â•â•â• */
.specs-box{border:1px solid var(--b2);border-radius:8px;background:var(--bg)}
.specs-hd{padding:7px 11px;border-bottom:1px solid var(--b2);display:flex;align-items:center;justify-content:space-between}
.specs-cnt{font-size:10px;font-weight:700;color:var(--p);background:var(--pl);padding:2px 7px;border-radius:20px}
.specs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;padding:9px;max-height:185px;overflow-y:auto}
.spec-it{display:flex;align-items:center;gap:5px;padding:5px 8px;border:1px solid var(--b2);border-radius:6px;cursor:pointer;transition:.1s;background:var(--w)}
.spec-it:hover{border-color:#9ca3af}
.spec-it.on{border-color:var(--p);background:var(--pl)}
.spec-it input{width:12px;height:12px;accent-color:var(--p);cursor:pointer;flex-shrink:0}
.spec-it label{font-size:11px;font-weight:600;cursor:pointer;color:var(--text)}
.spec-it.on label{color:var(--p2);font-weight:700}

/* â•â•â• IMG UPLOAD â•â•â• */
.img-up{border:1.5px dashed var(--b2);border-radius:8px;padding:18px;text-align:center;cursor:pointer;transition:.15s;background:var(--bg);position:relative}
.img-up:hover{border-color:var(--p);background:var(--pl)}
.img-up input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-up-ic{width:38px;height:38px;border-radius:9px;background:var(--pl);display:flex;align-items:center;justify-content:center;margin:0 auto 7px}
.img-up-ic svg{width:18px;height:18px;stroke:var(--p);fill:none;stroke-width:1.8}
.img-up-t{font-size:12px;font-weight:700;margin-bottom:2px}
.img-up-s{font-size:10px;color:var(--sub)}
.imgs-prev{display:flex;gap:6px;flex-wrap:wrap;margin-top:9px}
.img-p{position:relative;width:72px;height:72px;border-radius:7px;overflow:hidden;border:1px solid var(--b2)}
.img-p img{width:100%;height:100%;object-fit:cover}
.img-p-del{position:absolute;top:3px;left:3px;width:16px;height:16px;border-radius:50%;background:var(--red);color:#fff;border:none;cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;font-weight:900;line-height:1}

/* â•â•â• INFO ROWS â•â•â• */
.ib{background:var(--bg);border-radius:8px;padding:11px;margin-bottom:9px}
.ib-t{font-size:9px;font-weight:800;color:var(--sub);text-transform:uppercase;letter-spacing:.7px;margin-bottom:7px}
.ir{display:flex;justify-content:space-between;align-items:flex-start;padding:5px 0;border-bottom:1px solid var(--b2)}
.ir:last-child{border-bottom:none}
.ir-k{font-size:11px;color:var(--sub)}
.ir-v{font-size:11px;font-weight:700;text-align:left}

/* â•â•â• NOTIFICATION TARGETS â•â•â• */
.nt-wrap{display:flex;gap:5px;flex-wrap:wrap;margin-top:5px}
.ntt{padding:6px 12px;border-radius:7px;border:1px solid var(--b2);background:var(--w);font-family:'Tajawal',sans-serif;font-size:11px;font-weight:600;cursor:pointer;transition:.12s;color:var(--sub)}
.ntt:hover{border-color:#9ca3af;color:var(--text)}
.ntt.on{border-color:var(--p);background:var(--p);color:#fff}

/* â•â•â• REPORT PROGRESS â•â•â• */
.rpt-row{display:flex;align-items:center;gap:10px;margin-bottom:9px}
.rpt-lbl{font-size:12px;font-weight:600;width:120px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rpt-bar{flex:1;height:6px;border-radius:6px;background:var(--b2);overflow:hidden}
.rpt-bar-f{height:100%;border-radius:6px;transition:width 1s ease}
.rpt-val{font-size:11px;font-weight:700;color:var(--sub);width:35px;text-align:left;flex-shrink:0}

/* â•â•â• SETTINGS â•â•â• */
.set-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--b2)}
.set-row:last-child{border-bottom:none}
.set-info{flex:1}
.set-title{font-size:12px;font-weight:700}
.set-sub{font-size:10px;color:var(--sub);margin-top:2px}
.toggle{width:34px;height:18px;border-radius:20px;border:none;cursor:pointer;position:relative;transition:.2s;flex-shrink:0}
.toggle::after{content:'';position:absolute;top:2px;width:14px;height:14px;border-radius:50%;background:#fff;transition:.2s}
.toggle.on{background:var(--gn)}.toggle.on::after{right:2px}
.toggle.off{background:#d1d5db}.toggle.off::after{right:18px}

/* â•â•â• WARNING BADGE â•â•â• */
.warn-c{background:var(--ol);border:1px solid #fed7aa;border-radius:8px;padding:10px 12px;margin-bottom:7px;display:flex;align-items:center;gap:8px}
.warn-c svg{width:14px;height:14px;stroke:var(--or);fill:none;stroke-width:1.8;flex-shrink:0}
.warn-txt{font-size:11px;color:#9a3412;line-height:1.5}

/* â•â•â• TOAST â•â•â• */
.toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(12px);background:#111827;color:#fff;padding:9px 18px;border-radius:9px;font-size:12px;font-weight:600;z-index:999;opacity:0;transition:.22s;pointer-events:none;box-shadow:0 6px 20px rgba(0,0,0,.16);display:flex;align-items:center;gap:7px}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â• LOADING / EMPTY â•â•â• */
.loading{text-align:center;padding:38px;color:var(--sub)}
.spin{width:28px;height:28px;border:2px solid var(--pm);border-top-color:var(--p);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 9px}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:38px 18px}
.empty-ic{width:46px;height:46px;border-radius:10px;background:var(--bg);border:1.5px dashed var(--b2);display:flex;align-items:center;justify-content:center;margin:0 auto 9px}
.empty-ic svg{width:20px;height:20px;stroke:var(--b2);fill:none;stroke-width:1.5}
.empty h4{font-size:12px;font-weight:700;margin-bottom:3px}
.empty p{font-size:11px;color:var(--sub)}

/* â•â•â• STAMP â•â•â• */
.stamp{display:inline-flex;align-items:center;gap:3px;padding:3px 8px;border-radius:5px;font-size:9px;font-weight:800;border:1.5px solid;transform:rotate(-1deg);white-space:nowrap;flex-shrink:0}
.st-pend{background:#fefce8;color:#a16207;border-color:#fef08a}
.st-prog{background:var(--bl);color:#1d4ed8;border-color:#93c5fd}
.st-done{background:var(--gnl);color:var(--gn);border-color:#86efac}
.st-rej{background:var(--rl);color:#b91c1c;border-color:#fecaca}

/* â•â•â• BANNER â•â•â• */
.banner{background:#111827;border-radius:10px;padding:16px;margin-bottom:12px}
.banner-num{font-size:9px;font-weight:700;color:rgba(255,255,255,.3);letter-spacing:1px;margin-bottom:3px}
.banner-title{font-size:15px;font-weight:900;color:#fff;margin-bottom:8px;line-height:1.3}
.banner-meta{display:flex;gap:6px;flex-wrap:wrap}
.bm{font-size:10px;color:rgba(255,255,255,.45);background:rgba(255,255,255,.07);padding:2px 8px;border-radius:20px}

/* â•â•â• TWO COL â•â•â• */
.two-col{display:grid;grid-template-columns:1.3fr 1fr;gap:14px}
@media(max-width:1024px){.two-col{grid-template-columns:1fr}}

/* â•â•â• MOBILE â•â•â• */
.mob-btn{display:none;position:fixed;top:10px;left:10px;z-index:300;width:34px;height:34px;border-radius:8px;background:var(--p);border:none;cursor:pointer;align-items:center;justify-content:center}
.mob-btn svg{width:16px;height:16px;stroke:#fff;fill:none;stroke-width:2}
.mob-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:190}
@media(max-width:900px){
  .sb{transform:translateX(110%)}.sb.open{transform:translateX(0)}
  .main{margin-right:0}.mob-btn{display:flex}.mob-ov.show{display:block}
  .sgrid{grid-template-columns:repeat(2,1fr)}.content{padding:12px 14px}
  .topbar{padding:0 12px}.f2{grid-template-columns:1fr}.specs-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<button class="mob-btn" onclick="toggleSb()">
  <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<div class="mob-ov" id="mobOv" onclick="toggleSb()"></div>

<!-- SIDEBAR -->
<nav class="sb" id="sb">
  <div class="sb-top">
    <div class="sb-ic">âš¡</div>
    <div class="sb-brand">Ù…Ù†Ø§Ù‚ØµØ©<em>.</em></div>
  </div>
  <div class="sb-user">
    <div class="sb-av" id="sb-av">Ù…</div>
    <div>
      <div class="sb-nm" id="sb-name">Ø§Ù„Ù…Ø¯ÙŠØ±</div>
      <div class="sb-rl">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… â€¢ Ù…ØªØµÙ„</div>
    </div>
  </div>
  <div class="sb-nav">
    <div class="sb-grp">Ø¹Ø§Ù…</div>
    <button class="sbi on" onclick="go('home',this)">
      <i data-lucide="layout-dashboard"></i><span class="sbi-lbl">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
    </button>
    <div class="sb-grp">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
    <button class="sbi" onclick="go('pending',this)">
      <i data-lucide="clock"></i><span class="sbi-lbl">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
      <span class="sb-dot" id="sb-pend">0</span>
    </button>
    <button class="sbi" onclick="go('requests',this)">
      <i data-lucide="file-text"></i><span class="sbi-lbl">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
    </button>
    <div class="sb-grp">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
    <button class="sbi" onclick="go('providers',this)">
      <i data-lucide="users"></i><span class="sbi-lbl">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
    </button>
    <button class="sbi" onclick="go('clients',this)">
      <i data-lucide="user"></i><span class="sbi-lbl">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
    </button>
    <div class="sb-grp">Ø§Ù„ØªÙØ§Ø¹Ù„</div>
    <button class="sbi" onclick="go('reviews',this)">
      <i data-lucide="star"></i><span class="sbi-lbl">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
      <span class="sb-dot" id="sb-rep" style="display:none;background:#f97316">!</span>
    </button>
    <button class="sbi" onclick="go('disputes',this)">
      <i data-lucide="alert-triangle"></i><span class="sbi-lbl">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</span>
      <span class="sb-dot" id="sb-dis">0</span>
    </button>
    <button class="sbi" onclick="go('notifs',this)">
      <i data-lucide="bell"></i><span class="sbi-lbl">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
    </button>
    <div class="sb-grp">Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
    <button class="sbi" onclick="go('reports',this)">
      <i data-lucide="bar-chart-2"></i><span class="sbi-lbl">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
    </button>
    <button class="sbi" onclick="go('log',this)">
      <i data-lucide="activity"></i><span class="sbi-lbl">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</span>
    </button>
    <div class="sb-grp">Ø§Ù„Ù†Ø¸Ø§Ù…</div>
    <button class="sbi" onclick="go('settings',this)">
      <i data-lucide="settings"></i><span class="sbi-lbl">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
    </button>
  </div>
  <div class="sb-bot">
    <button class="sbi" onclick="logout()" style="width:100%">
      <i data-lucide="log-out"></i><span class="sbi-lbl">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
    </button>
    <div class="sb-ver">Ù…Ù†Ø§Ù‚ØµØ© Admin v3.0</div>
  </div>
</nav>

<div class="main">
  <div class="topbar">
    <div class="tb-crumb">
      <span class="tb-crumb-h">Ù…Ù†Ø§Ù‚ØµØ©</span>
      <span class="tb-crumb-s">â€º</span>
      <span class="tb-crumb-c" id="pg-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
    </div>
    <div class="tb-r">
      <div class="tb-clk" id="clock">--:--:--</div>
      <button class="tb-ic" onclick="go('notifs',null)">
        <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
      </button>
    </div>
  </div>
  <div class="content" id="content">
    <div class="loading"><div class="spin"></div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-hd">
      <div class="modal-hd-l">
        <div class="modal-hd-ic" id="m-ic"></div>
        <div class="modal-title" id="m-title">-</div>
      </div>
      <button class="modal-x" onclick="closeM()">Ã—</button>
    </div>
    <div class="modal-body" id="m-body"></div>
    <div class="modal-ft" id="m-ft"></div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
var API='https://manaqasati-production.up.railway.app';
var token=localStorage.getItem('token');
var me=JSON.parse(localStorage.getItem('user')||'{}');
var curPage='home';
var allReqs=[],allUsers=[],allRevs=[],allDis=[],actLog=[];
var imgData={};

if(!token||me.role!=='admin'){window.location.href='auth.html';}
document.getElementById('sb-name').textContent=me.name||'Ø§Ù„Ù…Ø¯ÙŠØ±';
document.getElementById('sb-av').textContent=(me.name||'Ù…').charAt(0);
setInterval(function(){document.getElementById('clock').textContent=new Date().toLocaleTimeString('ar-SA');},1000);

/* â”€â”€ CONSTANTS â”€â”€ */
var CATS=['ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ','ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ø³Ø¨Ø§ÙƒØ©','Ù†Ø¬Ø§Ø±Ø©','ØªÙ†Ø¸ÙŠÙ','Ù†Ù‚Ù„ Ø¹ÙØ´','Ø­Ø¯Ø§Ø¯Ø©','Ø£Ù„Ù…Ù†ÙŠÙˆÙ…','Ù…Ø³Ø§Ø¨Ø­','ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø©','Ø´Ø¨ÙƒØ§Øª ÙˆØ¥Ù†ØªØ±Ù†Øª','Ù…Ø¸Ù„Ø§Øª ÙˆØ³ÙˆØ§ØªØ±','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ','Ø£Ø¨ÙˆØ§Ø¨','Ø¬Ø¨Ø³ ÙˆØ·Ø¨Ø§Ø´ÙŠØ±','Ù…ÙƒØ§ÙØ­Ø© Ø­Ø´Ø±Ø§Øª','Ø£Ø®Ø±Ù‰'];
var CITIES=['Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©','Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©','Ø§Ù„Ø¯Ù…Ø§Ù…','Ø§Ù„Ø®Ø¨Ø±','Ø§Ù„Ø¸Ù‡Ø±Ø§Ù†','Ø§Ù„Ø£Ø­Ø³Ø§Ø¡','Ø§Ù„Ø·Ø§Ø¦Ù','ØªØ¨ÙˆÙƒ','Ø¨Ø±ÙŠØ¯Ø©','Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·','Ø£Ø¨Ù‡Ø§','Ù†Ø¬Ø±Ø§Ù†','Ø¬ÙŠØ²Ø§Ù†','Ø­Ø§Ø¦Ù„','ÙŠÙ†Ø¨Ø¹','Ø§Ù„Ø¬Ø¨ÙŠÙ„','Ø§Ù„Ù‚Ø·ÙŠÙ','Ø³ÙƒØ§ÙƒØ§','Ø¹Ø±Ø¹Ø±','Ø§Ù„Ø¨Ø§Ø­Ø©','Ø§Ù„Ø±Ø³','Ø±Ø§Ø¨Øº','Ø¨ÙŠØ´Ø©','ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±','Ø§Ù„Ø²Ù„ÙÙŠ','Ø§Ù„Ù‚Ø±ÙŠØ§Øª'];
var SL={pending_review:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',open:'Ù…ÙØªÙˆØ­',in_progress:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',completed:'Ù…ÙƒØªÙ…Ù„',rejected:'Ù…Ø±ÙÙˆØ¶'};
var ST={pending_review:'t-pend',open:'t-open',in_progress:'t-prog',completed:'t-done',rejected:'t-rej'};
var SC={pending_review:'pc-pend',open:'pc-open',in_progress:'pc-prog',completed:'pc-done',rejected:'pc-rej'};
var STAMPS={in_progress:'<span class="stamp st-prog">âœ“ ØªÙ… Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯</span>',completed:'<span class="stamp st-done">âœ“ Ù…ÙƒØªÙ…Ù„</span>',rejected:'<span class="stamp st-rej">âœ— Ù…Ø±ÙÙˆØ¶</span>'};
var BM={none:{c:'b-none',l:'Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…',i:'â€”'},verified:{c:'b-verified',l:'Ù…ÙˆØ«Ù‚',i:'âœ“'},star:{c:'b-star',l:'Ù…ØªÙ…ÙŠØ²',i:'â­'},partner:{c:'b-partner',l:'Ø´Ø±ÙŠÙƒ',i:'ğŸ’'},top:{c:'b-top',l:'Ø§Ù„Ø£ÙØ¶Ù„',i:'ğŸ†'}};
var COLORS=['#7c3aed','#2563eb','#16a34a','#d97706','#dc2626','#0891b2','#7e22ce','#9d174d'];

/* â”€â”€ HELPERS â”€â”€ */
function api(p,o){return fetch(API+p,Object.assign({headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'}},o)).then(function(r){return r.json();}).catch(function(){return{};});}
function toast(msg,type){
  var t=document.getElementById('toast');
  t.innerHTML='<span>'+(type==='success'?'âœ“':type==='error'?'âœ•':'â„¹')+'</span> '+msg;
  t.style.background=type==='error'?'#dc2626':type==='success'?'#16a34a':'#111827';
  t.className='toast show';setTimeout(function(){t.className='toast';},3000);
}
function closeM(){document.getElementById('overlay').className='overlay';}
function openM(title,body,ft,icSvg,icBg){
  document.getElementById('m-title').textContent=title;
  document.getElementById('m-body').innerHTML=body;
  document.getElementById('m-ft').innerHTML=ft||'';
  var ic=document.getElementById('m-ic');
  ic.innerHTML=icSvg||'';ic.style.background=icBg||'var(--pl)';
  document.getElementById('overlay').className='overlay show';
}
function toggleSb(){document.getElementById('sb').classList.toggle('open');document.getElementById('mobOv').classList.toggle('show');}
function logout(){localStorage.clear();window.location.href='auth.html';}
function go(page,btn){
  curPage=page;
  document.querySelectorAll('.sbi').forEach(function(i){i.classList.remove('on');});
  if(btn)btn.classList.add('on');
  var T={home:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',pending:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',requests:'ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',providers:'Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',clients:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',reviews:'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',disputes:'Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª',notifs:'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',reports:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',log:'Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'};
  document.getElementById('pg-title').textContent=T[page]||page;
  var P={home:pgHome,pending:pgPending,requests:pgRequests,providers:pgProviders,clients:pgClients,reviews:pgReviews,disputes:pgDisputes,notifs:pgNotifs,reports:pgReports,log:pgLog,settings:pgSettings};
  if(P[page])P[page]();
  document.getElementById('sb').classList.remove('open');document.getElementById('mobOv').classList.remove('show');
}
function cityOpts(sel){return '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>'+CITIES.map(function(c){return'<option value="'+c+'" '+(sel===c?'selected':'')+'>'+c+'</option>';}).join('')+'<option value="Ø£Ø®Ø±Ù‰" '+(sel==='Ø£Ø®Ø±Ù‰'?'selected':'')+'>Ø£Ø®Ø±Ù‰</option>';}
function specsHTML(sel){var cnt=sel?sel.length:0;return'<div class="specs-box"><div class="specs-hd"><span style="font-size:11px;font-weight:700">Ø§Ù„ØªØ®ØµØµØ§Øª</span><span class="specs-cnt" id="spCnt">'+cnt+' Ù…Ø­Ø¯Ø¯</span></div><div class="specs-grid">'+CATS.map(function(c,i){var on=sel&&sel.includes(c);return'<div class="spec-it '+(on?'on':'')+'" onclick="togSpec(this)"><input type="checkbox" id="sp'+i+'" value="'+c+'" '+(on?'checked':'')+' onchange="updSpCnt()"><label for="sp'+i+'">'+c+'</label></div>';}).join('')+'</div></div>';}
function togSpec(el){el.classList.toggle('on');el.querySelector('input').checked=el.classList.contains('on');updSpCnt();}
function updSpCnt(){var c=document.querySelectorAll('.spec-it.on').length;var el=document.getElementById('spCnt');if(el)el.textContent=c+' Ù…Ø­Ø¯Ø¯';}
function getSpecs(){return Array.from(document.querySelectorAll('.spec-it.on input')).map(function(i){return i.value;});}
function imgUpHTML(id){return'<div class="img-up" id="iu-'+id+'"><input type="file" accept="image/*" multiple onchange="handleImgs(this,\''+id+'\')"><div class="img-up-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="1.8"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div><div class="img-up-t">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø±ÙØ¹</div><div class="img-up-s">PNG, JPG â€” Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 ØµÙˆØ±</div></div><div class="imgs-prev" id="ip-'+id+'"></div>';}
function handleImgs(input,id){var files=Array.from(input.files);if(!imgData[id])imgData[id]=[];files.forEach(function(f){if(imgData[id].length>=5)return;var r=new FileReader();r.onload=function(e){imgData[id].push({name:f.name,data:e.target.result});renderImgPrev(id);};r.readAsDataURL(f);});}
function renderImgPrev(id){var el=document.getElementById('ip-'+id);if(!el)return;el.innerHTML=(imgData[id]||[]).map(function(img,i){return'<div class="img-p"><img src="'+img.data+'"><button class="img-p-del" onclick="delImg(\''+id+'\','+i+')">Ã—</button></div>';}).join('');}
function delImg(id,i){imgData[id].splice(i,1);renderImgPrev(id);}
function addLog(action,detail,color){actLog.unshift({action:action,detail:detail,color:color||'#7c3aed',time:new Date().toLocaleTimeString('ar-SA')});if(actLog.length>100)actLog.pop();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgHome(){
  document.getElementById('content').innerHTML='<div class="loading"><div class="spin"></div></div>';
  api('/api/admin/stats').then(function(s){
    document.getElementById('sb-pend').textContent=s.pending_review||0;
    var p=function(a,b){return b?Math.round(a/b*100):0;};
    document.getElementById('content').innerHTML=
    '<div class="pghd"><div><div class="pghd-t">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div><div style="font-size:11px;color:var(--sub);margin-top:2px">Ù…Ø±Ø­Ø¨Ø§Ù‹ '+me.name+'ØŒ Ù‡Ø°Ù‡ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©</div></div></div>'+
    '<div class="sgrid">'+
      sc('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',s.users||0,'var(--pl)','#7c3aed','users','100','var(--p)','â†‘ Ù†Ø´Ø·','tup')+
      sc('Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',s.providers||0,'var(--gl)','var(--gold2)','briefcase',p(s.providers,s.users),'var(--gold)','Ù…Ø²ÙˆØ¯ÙˆÙ†','tup')+
      sc('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',s.requests||0,'var(--bl)','var(--blue)','file-text','100','var(--blue)','Ù…Ø´Ø±ÙˆØ¹','tup')+
      sc('Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',s.pending_review||0,'#ffedd5','var(--or)','clock',p(s.pending_review,s.requests),'var(--or)','Ù…Ø¹Ù„Ù‚','twn')+
      sc('Ù…ÙƒØªÙ…Ù„Ø©',s.completed||0,'var(--gnl)','var(--gn)','check-circle',p(s.completed,s.requests),'var(--gn)','â†‘ Ù…Ù…ØªØ§Ø²','tup')+
      sc('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶',s.bids||0,'var(--pl)','var(--p2)','trending-up','100','var(--pm)','Ø¹Ø±Ø¶','tup')+
    '</div>'+
    '<div class="two-col">'+
      '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:#ffedd5"><svg viewBox="0 0 24 24" fill="none" stroke="var(--or)" stroke-width="1.8" width="13" height="13"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div><div class="card-title">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div class="card-sub">ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹ØªÙƒ Ø§Ù„Ø¢Ù†</div></div></div><button class="btn btn-light btn-sm" onclick="go(\'pending\',null)">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button></div><div class="card-body" id="hp"></div></div>'+
      '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--bl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="1.8" width="13" height="13"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><div class="card-title">Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©</div></div></div><div class="card-body" id="ha"></div></div>'+
    '</div>';
    lucide.createIcons();
    loadHomePend();loadHomeAct();
  });
}

function sc(lbl,val,ibg,ico,icon,pct,bclr,tr,trCls){
  return'<div class="sc"><div class="sc-top"><div class="sc-ico" style="background:'+ibg+'"><svg viewBox="0 0 24 24" fill="none" stroke="'+ico+'" stroke-width="1.5" width="16" height="16" data-lucide="'+icon+'"></svg></div><span class="sc-tr '+trCls+'">'+tr+'</span></div><div class="sc-val">'+val+'</div><div class="sc-lbl">'+lbl+'</div><div class="sc-bar"><div class="sc-bf" style="width:'+pct+'%;background:'+bclr+'"></div></div></div>';
}

function loadHomePend(){
  api('/api/admin/requests?status=pending_review').then(function(r){
    var el=document.getElementById('hp');if(!el)return;
    if(!r||!r.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© âœ…</h4></div>';return;}
    el.innerHTML=r.slice(0,4).map(function(req){
      return'<div class="pc pc-pend"><div class="pc-hd"><div><div class="pc-num">'+(req.project_number||'#'+req.id)+'</div><div class="pc-title">'+req.title+'</div></div><span class="stamp st-pend">â³ Ù…Ø±Ø§Ø¬Ø¹Ø©</span></div>'+
      '<div class="pc-meta"><span class="pm">ğŸ‘¤ '+req.client_name+'</span><span class="pm">ğŸ“ '+(req.city||'â€”')+'</span><span class="pm">ğŸ“‚ '+(req.category||'Ø¹Ø§Ù…')+'</span>'+(req.budget_max?'<span class="pm">ğŸ’° '+req.budget_max.toLocaleString()+' Ø±.Ø³</span>':'')+'</div>'+
      '<div class="pc-acts"><button class="btn btn-g btn-sm" onclick="approveReq('+req.id+')">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button><button class="btn btn-r btn-sm" onclick="rejectReq('+req.id+')">âœ— Ø±ÙØ¶</button><button class="btn btn-light btn-sm" onclick="viewReq('+req.id+')">ØªÙØ§ØµÙŠÙ„</button></div></div>';
    }).join('');
  });
}

function loadHomeAct(){
  api('/api/admin/requests').then(function(r){
    var el=document.getElementById('ha');if(!el)return;
    if(!r||!r.length){el.innerHTML='<div class="empty"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·</p></div>';return;}
    var dc={'open':'#16a34a','in_progress':'#3b82f6','completed':'#7c3aed','pending_review':'#f97316','rejected':'#ef4444'};
    el.innerHTML=r.slice(0,8).map(function(req){
      return'<div class="log-item"><div class="log-dot" style="background:'+(dc[req.status]||'#9ca3af')+'"></div><div class="log-body"><div class="log-action">'+req.title+'</div><div class="log-detail">'+req.client_name+' â€¢ '+(req.city||'â€”')+'</div></div><span class="tag '+ST[req.status]+'">'+SL[req.status]+'</span></div>';
    }).join('');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PENDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgPending(){
  document.getElementById('content').innerHTML='<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:#ffedd5"><svg viewBox="0 0 24 24" fill="none" stroke="var(--or)" stroke-width="1.8" width="13" height="13"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div><div class="card-title">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div></div><span class="tag t-pend" id="pCnt">0 Ø·Ù„Ø¨</span></div><div class="card-body" id="pList"><div class="loading"><div class="spin"></div></div></div></div>';
  api('/api/admin/requests?status=pending_review').then(function(r){
    document.getElementById('sb-pend').textContent=r.length;
    document.getElementById('pCnt').textContent=r.length+' Ø·Ù„Ø¨';
    if(!r.length){document.getElementById('pList').innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><h4>ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ âœ…</h4></div>';return;}
    document.getElementById('pList').innerHTML=r.map(function(req){return pcHTML(req,true);}).join('');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALL REQUESTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgRequests(){
  document.getElementById('content').innerHTML=
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--bl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="1.8" width="13" height="13"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><div class="card-title">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div></div>'+
  '<select class="fsel" id="rf-st" onchange="loadReqs()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="pending_review">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option><option value="open">Ù…ÙØªÙˆØ­</option><option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option value="completed">Ù…ÙƒØªÙ…Ù„</option><option value="rejected">Ù…Ø±ÙÙˆØ¶</option></select></div>'+
  '<div class="card-body"><div class="fbar"><div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="rf-q" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„..." oninput="filterReqs()"></div>'+
  '<select class="fsel" id="rf-ct" onchange="filterReqs()"><option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>'+CATS.map(function(c){return'<option value="'+c+'">'+c+'</option>';}).join('')+'</select>'+
  '<select class="fsel" id="rf-ci" onchange="filterReqs()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>'+CITIES.map(function(c){return'<option value="'+c+'">'+c+'</option>';}).join('')+'</select></div>'+
  '<div id="rList"><div class="loading"><div class="spin"></div></div></div></div></div>';
  loadReqs();
}

function loadReqs(){
  var st=(document.getElementById('rf-st')||{}).value||'';
  api('/api/admin/requests'+(st?'?status='+st:'')).then(function(r){allReqs=r;filterReqs();});
}

function filterReqs(){
  var q=((document.getElementById('rf-q')||{}).value||'').toLowerCase();
  var ct=((document.getElementById('rf-ct')||{}).value||'');
  var ci=((document.getElementById('rf-ci')||{}).value||'');
  var f=allReqs.filter(function(r){
    return(!q||r.title.toLowerCase().includes(q)||(r.client_name||'').toLowerCase().includes(q)||(r.project_number||'').toLowerCase().includes(q))&&(!ct||r.category===ct)&&(!ci||r.city===ci);
  });
  var el=document.getElementById('rList');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h4></div>';return;}
  el.innerHTML=f.map(function(r){return pcHTML(r,false);}).join('');
}

function pcHTML(r,isPend){
  var acts='<button class="btn btn-p btn-sm" onclick="viewReq('+r.id+')">ğŸ‘ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>';
  if(isPend||r.status==='pending_review'){acts+='<button class="btn btn-g btn-sm" onclick="approveReq('+r.id+')">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button><button class="btn btn-r btn-sm" onclick="rejectReq('+r.id+')">âœ— Ø±ÙØ¶</button>';}
  if(r.status==='in_progress'){acts+='<button class="btn btn-gold btn-sm" onclick="completeReq('+r.id+')">âœ“ Ø¥ÙƒÙ…Ø§Ù„</button><button class="btn btn-light btn-sm" onclick="assignManual('+r.id+')">ğŸ”§ Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ</button>';}
  if(r.status==='open'){acts+='<button class="btn btn-light btn-sm" onclick="assignManual('+r.id+')">ğŸ”§ Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ</button>';}
  acts+='<button class="btn btn-light btn-sm" onclick="editReqM('+r.id+')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>';
  if(['open','in_progress','pending_review'].includes(r.status)){acts+='<button class="btn btn-or btn-sm" onclick="openDispute('+r.id+')">âš  Ù†Ø²Ø§Ø¹</button>';}
  acts+='<button class="btn btn-r btn-sm" onclick="delReq('+r.id+')">ğŸ—‘</button>';
  return'<div class="pc '+SC[r.status]+'">'+
  '<div class="pc-hd"><div><div class="pc-num">'+(r.project_number||'#'+r.id)+'</div><div class="pc-title">'+r.title+'</div></div>'+(STAMPS[r.status]||'<span class="tag '+ST[r.status]+'">'+SL[r.status]+'</span>')+'</div>'+
  '<div class="pc-meta"><span class="pm">ğŸ‘¤ '+r.client_name+'</span>'+(r.provider_name?'<span class="pm" style="color:var(--gn)">ğŸ”§ '+r.provider_name+'</span>':'')+
  '<span class="pm">ğŸ“ '+(r.city||'â€”')+'</span>'+(r.address?'<span class="pm">ğŸ“Œ '+r.address+'</span>':'')+
  '<span class="pm">ğŸ“‚ '+(r.category||'Ø¹Ø§Ù…')+'</span>'+
  (r.budget_max?'<span class="pm">ğŸ’° '+r.budget_max.toLocaleString()+' Ø±.Ø³</span>':'')+
  (r.deadline?'<span class="pm">ğŸ“… '+r.deadline+'</span>':'')+
  '<span class="pm">ğŸ’¼ '+(r.bid_count||0)+' Ø¹Ø±ÙˆØ¶</span></div>'+
  (r.description?'<div class="pc-desc">'+r.description+'</div>':'')+
  '<div class="pc-acts">'+acts+'</div></div>';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REQUEST ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function approveReq(id){
  api('/api/admin/requests/'+id+'/review',{method:'PUT',body:JSON.stringify({status:'open',admin_notes:'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±'})}).then(function(){
    toast('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†ÙØ´Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');
    addLog('Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¹','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+id+' ØªÙ… Ù†Ø´Ø±Ù‡','#16a34a');
    reload();
  });
}

function rejectReq(id){
  openM('Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹','<div class="warn-c"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg><span class="warn-txt">Ø³ÙŠØµÙ„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</span></div><div class="fg"><label class="fl">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ <em>*</em></label><textarea class="fta" id="rReason" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ø¨ÙˆØ¶ÙˆØ­..."></textarea></div>',
  '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-r" onclick="doReject('+id+')">âœ— ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶</button>',
  '<svg viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="1.8" width="14" height="14"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>','var(--rl)');
}

function doReject(id){
  var r=(document.getElementById('rReason').value||'').trim()||'Ù„Ø§ ÙŠØ³ØªÙˆÙÙŠ Ø´Ø±ÙˆØ· Ø§Ù„Ù†Ø´Ø±';
  api('/api/admin/requests/'+id+'/review',{method:'PUT',body:JSON.stringify({status:'rejected',admin_notes:r})}).then(function(){
    closeM();toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹','error');
    addLog('Ø±ÙØ¶ Ù…Ø´Ø±ÙˆØ¹','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+id+': '+r,'#ef4444');
    reload();
  });
}

function completeReq(id){
  if(!confirm('Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†.'))return;
  api('/api/admin/requests/'+id+'/complete',{method:'PUT'}).then(function(){
    toast('ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');
    addLog('Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø´Ø±ÙˆØ¹','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+id,'#7c3aed');
    reload();
  });
}

function delReq(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.'))return;
  api('/api/admin/requests/'+id,{method:'DELETE'}).then(function(){
    toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');
    addLog('Ø­Ø°Ù Ù…Ø´Ø±ÙˆØ¹','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+id,'#ef4444');
    reload();
  });
}

function assignManual(reqId){
  api('/api/admin/providers').then(function(provs){
    if(!provs||!provs.length){toast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙˆÙ† Ù…ØªØ§Ø­ÙˆÙ†','error');return;}
    openM('Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹',
      '<div class="fg"><label class="fl">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø²ÙˆØ¯</label><select class="fsel2" id="am-prov">'+provs.map(function(p){return'<option value="'+p.id+'">'+p.name+(p.city?' â€” '+p.city:'')+'</option>';}).join('')+'</select></div>'+
      '<div class="fg"><label class="fl">Ù…Ù„Ø§Ø­Ø¸Ø©</label><textarea class="fta" id="am-note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©..."></textarea></div>',
      '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doAssign('+reqId+')">ğŸ”§ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯</button>',
      '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>','var(--pl)'
    );
  });
}

function doAssign(reqId){
  var pId=document.getElementById('am-prov').value;
  var note=document.getElementById('am-note').value;
  api('/api/admin/requests/'+reqId,{method:'PUT',body:JSON.stringify({assigned_provider_id:pId,status:'in_progress',admin_notes:note||'ØªÙ… Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±'})}).then(function(){
    closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ âœ…','success');
    addLog('Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+reqId,'#2563eb');
    reload();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW REQUEST (DETAIL + BIDS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function viewReq(id){
  api('/api/requests/'+id).then(function(r){
    api('/api/requests/'+id+'/bids').then(function(bids){
      var bHtml='';
      if(bids&&bids.length){
        bHtml='<div class="fsec">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ('+bids.length+')</div>'+bids.map(function(b){
          var s=Math.round(b.avg_rating||0);
          var cls=b.status==='accepted'?'bid-acc':b.status==='rejected'?'bid-rej2':'';
          return'<div class="bid-c '+cls+'"><div class="bid-hd"><div class="bid-av">'+b.provider_name.charAt(0)+'</div><div style="flex:1"><div class="bid-nm">'+b.provider_name+(b.status==='accepted'?' <span class="tag t-open" style="font-size:9px">âœ“ Ù…Ù‚Ø¨ÙˆÙ„</span>':b.status==='rejected'?' <span class="tag t-rej" style="font-size:9px">âœ— Ù…Ø±ÙÙˆØ¶</span>':'')+'</div><div class="bid-lc">ğŸ“ '+(b.provider_city||'â€”')+(b.provider_phone?' â€¢ '+b.provider_phone:'')+'</div><div class="bid-st">'+'â˜…'.repeat(s)+'â˜†'.repeat(5-s)+' <span style="font-size:10px;color:var(--sub)">('+( b.review_count||0)+' ØªÙ‚ÙŠÙŠÙ…)</span></div></div>'+
          (b.status==='pending'?'<div style="display:flex;gap:4px"><button class="btn btn-g btn-xs" onclick="accBid('+b.id+','+id+')">âœ“ Ù‚Ø¨ÙˆÙ„</button><button class="btn btn-r btn-xs" onclick="rejBid('+b.id+','+id+')">âœ— Ø±ÙØ¶</button><button class="btn btn-light btn-xs" onclick="editBid('+b.id+')">âœ ØªØ¹Ø¯ÙŠÙ„</button></div>':'')+
          '</div><div class="bid-info"><div class="bid-ii"><span>Ø§Ù„Ø³Ø¹Ø±:</span>'+b.price.toLocaleString()+' Ø±.Ø³</div><div class="bid-ii"><span>Ø§Ù„Ù…Ø¯Ø©:</span>'+b.days+' ÙŠÙˆÙ…</div></div>'+
          (b.note?'<div class="bid-note">'+b.note+'</div>':'')+
          '</div>';
        }).join('');
      }else{bHtml='<div style="text-align:center;color:var(--sub);font-size:12px;padding:12px">Ù„Ù… ÙŠÙÙ‚Ø¯ÙÙ‘Ù… Ø£ÙŠ Ø¹Ø±Ø¶ Ø¨Ø¹Ø¯</div>';}

      openM('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
        '<div class="banner"><div class="banner-num">'+(r.project_number||'#'+r.id)+'</div>'+
        '<div class="banner-title">'+r.title+'</div>'+
        '<div class="banner-meta"><span class="tag '+ST[r.status]+'">'+SL[r.status]+'</span><span class="bm">ğŸ“‚ '+(r.category||'â€”')+'</span>'+(r.city?'<span class="bm">ğŸ“ '+r.city+'</span>':'')+(r.address?'<span class="bm">ğŸ“Œ '+r.address+'</span>':'')+'</div></div>'+
        '<div class="ib"><div class="ib-t">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>'+
        '<div class="ir"><span class="ir-k">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰</span><span class="ir-v">'+(r.budget_max?r.budget_max.toLocaleString()+' Ø±.Ø³':'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')+'</span></div>'+
        '<div class="ir"><span class="ir-k">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><span class="ir-v">'+(r.deadline||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')+'</span></div>'+
        '<div class="ir"><span class="ir-k">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</span><span class="ir-v">'+(r.bid_count||0)+' Ø¹Ø±Ø¶</span></div></div>'+
        '<div class="ib"><div class="ib-t">Ø§Ù„Ø£Ø·Ø±Ø§Ù</div>'+
        '<div class="ir"><span class="ir-k">ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span><span class="ir-v">'+r.client_name+(r.client_phone?' â€” '+r.client_phone:'')+'</span></div>'+
        (r.provider_name?'<div class="ir"><span class="ir-k">Ø§Ù„Ù…Ø²ÙˆØ¯ Ø§Ù„Ù…ÙØ³Ù†Ø¯</span><span class="ir-v" style="color:var(--gn)">ğŸ”§ '+r.provider_name+(r.provider_phone?' â€” '+r.provider_phone:'')+'</span></div>':'')+
        (r.assigned_at?'<div class="ir"><span class="ir-k">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯</span><span class="ir-v">'+new Date(r.assigned_at).toLocaleDateString('ar-SA')+'</span></div>':'')+
        '</div>'+
        (r.description?'<div class="ib"><div class="ib-t">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div><div style="font-size:12px;line-height:1.8;color:#4b5563">'+r.description+'</div></div>':'')+
        (r.admin_notes?'<div style="background:var(--gl);border:1px solid #fcd34d;border-radius:8px;padding:10px 12px;margin-bottom:10px;font-size:12px"><div style="font-size:9px;font-weight:800;color:var(--gold2);margin-bottom:4px">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</div>'+r.admin_notes+'</div>':'')+
        bHtml,
        (r.status==='pending_review'?'<button class="btn btn-g" onclick="closeM();approveReq('+r.id+')">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button><button class="btn btn-r" onclick="closeM();rejectReq('+r.id+')">âœ— Ø±ÙØ¶</button>':'')+
        (r.status==='in_progress'?'<button class="btn btn-gold" onclick="closeM();completeReq('+r.id+')">âœ“ Ø¥ÙƒÙ…Ø§Ù„</button>':'')+
        '<button class="btn btn-ghost" onclick="closeM();editReqM('+r.id+')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button><button class="btn btn-ghost" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>',
        '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/></svg>','var(--pl)'
      );
    });
  });
}

function accBid(bId,rId){api('/api/bids/'+bId+'/accept',{method:'PUT'}).then(function(){toast('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¶ âœ…','success');closeM();setTimeout(function(){viewReq(rId);},300);});}
function rejBid(bId,rId){api('/api/bids/'+bId+'/reject',{method:'PUT'}).then(function(){toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¹Ø±Ø¶','error');closeM();setTimeout(function(){viewReq(rId);},300);});}

function editBid(bId){
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶',
    '<div class="f2"><div class="fg"><label class="fl">Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³)</label><input type="number" class="fi" id="eb-price" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯"></div><div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯Ø© (Ø£ÙŠØ§Ù…)</label><input type="number" class="fi" id="eb-days" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"></div></div>'+
    '<div class="fg"><label class="fl">Ù…Ù„Ø§Ø­Ø¸Ø©</label><textarea class="fta" id="eb-note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©..."></textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doEditBid('+bId+')">ğŸ’¾ Ø­ÙØ¸</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4z"/></svg>','var(--pl)'
  );
}

function doEditBid(bId){
  var p=document.getElementById('eb-price').value;
  var d=document.getElementById('eb-days').value;
  var n=document.getElementById('eb-note').value;
  if(!p&&!d){toast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø©','error');return;}
  api('/api/bids/'+bId,{method:'PUT',body:JSON.stringify({price:p||undefined,days:d||undefined,note:n||undefined})}).then(function(){
    closeM();toast('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ âœ…','success');
  });
}

function editReqM(id){
  var r=allReqs.find(function(x){return x.id===id;});
  if(!r){api('/api/requests/'+id).then(function(r2){showEditReq(r2);});return;}
  showEditReq(r);
}

function showEditReq(r){
  imgData['req']=[];
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ â€” '+(r.project_number||'#'+r.id),
    '<div class="fsec">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <em>*</em></label><input type="text" class="fi" id="er-title" value="'+r.title+'"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„ØªÙØ§ØµÙŠÙ„</label><textarea class="fta" id="er-desc">'+(r.description||'')+'</textarea></div>'+
    '<div class="f2">'+
    '<div class="fg"><label class="fl">Ø§Ù„ØªØµÙ†ÙŠÙ</label><select class="fsel2" id="er-cat">'+CATS.map(function(c){return'<option value="'+c+'" '+(r.category===c?'selected':'')+'>'+c+'</option>';}).join('')+'</select></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="fsel2" id="er-city">'+cityOpts(r.city)+'</select></div></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label><input type="text" class="fi" id="er-addr" value="'+(r.address||'')+'" placeholder="Ø­ÙŠØŒ Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰..."></div>'+
    '<div class="f2">'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰ (Ø±.Ø³)</label><input type="number" class="fi" id="er-bud" value="'+(r.budget_max||'')+'"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label><input type="date" class="fi" id="er-dl" value="'+(r.deadline||'')+'"></div></div>'+
    '<div class="fsec">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</div>'+
    '<div class="fg"><textarea class="fta" id="er-notes" style="min-height:60px">'+(r.admin_notes||'')+'</textarea></div>'+
    '<div class="fsec">ØµÙˆØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>'+imgUpHTML('req'),
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doEditReq('+r.id+')">ğŸ’¾ Ø­ÙØ¸</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4z"/></svg>','var(--pl)'
  );
}

function doEditReq(id){
  api('/api/admin/requests/'+id,{method:'PUT',body:JSON.stringify({
    title:document.getElementById('er-title').value,
    description:document.getElementById('er-desc').value,
    category:document.getElementById('er-cat').value,
    city:document.getElementById('er-city').value,
    address:document.getElementById('er-addr').value,
    budget_max:document.getElementById('er-bud').value||null,
    deadline:document.getElementById('er-dl').value||null,
    admin_notes:document.getElementById('er-notes').value
  })}).then(function(){closeM();toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success');addLog('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+id,'#f97316');reload();});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROVIDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgProviders(){
  document.getElementById('content').innerHTML=
  '<div class="card">'+
  '<div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--pl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="13" height="13"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div><div class="card-title">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div></div>'+
  '<div style="display:flex;gap:7px"><button class="btn btn-light btn-sm" onclick="sendWarnMulti()">âš  ØªØ­Ø°ÙŠØ± Ø¬Ù…Ø§Ø¹ÙŠ</button><button class="btn btn-p btn-sm" onclick="addUserM(\'provider\')">+ Ø¥Ø¶Ø§ÙØ©</button></div></div>'+
  '<div class="card-body">'+
  '<div class="fbar">'+
  '<div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="pf-q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." oninput="filterProvs()"></div>'+
  '<select class="fsel" id="pf-cat" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>'+CATS.map(function(c){return'<option>'+c+'</option>';}).join('')+'</select>'+
  '<select class="fsel" id="pf-ci" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>'+CITIES.map(function(c){return'<option>'+c+'</option>';}).join('')+'</select>'+
  '<select class="fsel" id="pf-bd" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆØ³Ù…Ø©</option><option value="none">Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…</option><option value="verified">Ù…ÙˆØ«Ù‚</option><option value="star">Ù…ØªÙ…ÙŠØ²</option><option value="partner">Ø´Ø±ÙŠÙƒ</option><option value="top">Ø§Ù„Ø£ÙØ¶Ù„</option></select>'+
  '<select class="fsel" id="pf-st" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="1">Ù†Ø´Ø·</option><option value="0">Ù…ÙˆÙ‚ÙˆÙ</option></select>'+
  '</div>'+
  '<div id="provList"><div class="loading"><div class="spin"></div></div></div></div></div>';
  api('/api/admin/users').then(function(u){allUsers=u.filter(function(x){return x.role==='provider';});filterProvs();});
}

function filterProvs(){
  var q=((document.getElementById('pf-q')||{}).value||'').toLowerCase();
  var cat=((document.getElementById('pf-cat')||{}).value||'');
  var ci=((document.getElementById('pf-ci')||{}).value||'');
  var bd=((document.getElementById('pf-bd')||{}).value||'');
  var st=((document.getElementById('pf-st')||{}).value||'');
  var f=allUsers.filter(function(u){
    return(!q||u.name.toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q)||(u.city||'').toLowerCase().includes(q))&&
    (!cat||(u.specialties&&u.specialties.includes(cat)))&&(!ci||u.city===ci)&&
    (!bd||(u.badge||'none')===bd)&&(st===''||(u.is_active?'1':'0')===st);
  });
  var el=document.getElementById('provList');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙˆÙ†</h4></div>';return;}
  el.innerHTML='<div class="tw"><table class="tbl"><thead><tr><th>Ø§Ù„Ù…Ø²ÙˆØ¯</th><th>Ø§Ù„ØªØ®ØµØµØ§Øª</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„ÙˆØ³Ø§Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>'+
  f.map(function(u){
    var b=BM[u.badge||'none']||BM.none;
    var bg=COLORS[u.id%COLORS.length];
    var specs=(u.specialties&&u.specialties.length)?u.specialties.slice(0,2).join(' â€¢ ')+(u.specialties.length>2?' +'+( u.specialties.length-2):''):'â€”';
    var rating=u.avg_rating?'â˜…'.repeat(Math.round(u.avg_rating))+'â˜†'.repeat(5-Math.round(u.avg_rating))+'<span style="font-size:9px;color:var(--sub)">('+( u.review_count||0)+')</span>':'â€”';
    return'<tr><td><div style="display:flex;align-items:center;gap:9px"><div class="tbl-av" style="background:'+bg+'">'+u.name.charAt(0)+'</div><div><div class="tbl-nm">'+u.name+'</div><div class="tbl-email">'+u.email+'</div>'+(u.phone?'<div class="tbl-email">'+u.phone+'</div>':'')+'</div></div></td>'+
    '<td style="font-size:11px;max-width:160px">'+specs+'</td>'+
    '<td style="font-size:11px;font-weight:600">'+(u.city||'â€”')+'</td>'+
    '<td style="font-size:11px;color:var(--gold)">'+rating+'</td>'+
    '<td><span class="bc '+b.c+'">'+b.i+' '+b.l+'</span></td>'+
    '<td><span class="tag '+(u.is_active?'t-act':'t-off')+'">'+(u.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ')+'</span></td>'+
    '<td><div style="display:flex;gap:3px;flex-wrap:wrap">'+
    '<button class="btn btn-xs btn-p" onclick="viewUser('+u.id+')">ğŸ‘</button>'+
    '<button class="btn btn-xs btn-light" onclick="editUserM('+u.id+')">âœ</button>'+
    '<button class="btn btn-xs btn-gold" onclick="setBadgeM('+u.id+',\''+u.name+'\')">ğŸ†</button>'+
    '<button class="btn btn-xs '+(u.is_active?'btn-r':'btn-g')+'" onclick="togUser('+u.id+')">'+(u.is_active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„')+'</button>'+
    '<button class="btn btn-xs btn-or" onclick="sendWarnM('+u.id+',\''+u.name+'\')">âš </button>'+
    '<button class="btn btn-xs btn-light" onclick="notifUserM('+u.id+',\''+u.name+'\')">ğŸ””</button>'+
    '<button class="btn btn-xs btn-r" onclick="delUser('+u.id+')">ğŸ—‘</button>'+
    '</div></td></tr>';
  }).join('')+'</tbody></table></div>';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLIENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgClients(){
  document.getElementById('content').innerHTML=
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--bl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="1.8" width="13" height="13"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><div class="card-title">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div></div>'+
  '<button class="btn btn-p btn-sm" onclick="addUserM(\'client\')">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button></div>'+
  '<div class="card-body"><div class="fbar">'+
  '<div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="cf-q" placeholder="Ø¨Ø­Ø«..." oninput="filterClients()"></div>'+
  '<select class="fsel" id="cf-ci" onchange="filterClients()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>'+CITIES.map(function(c){return'<option>'+c+'</option>';}).join('')+'</select>'+
  '<select class="fsel" id="cf-st" onchange="filterClients()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="1">Ù†Ø´Ø·</option><option value="0">Ù…ÙˆÙ‚ÙˆÙ</option></select>'+
  '</div><div id="cliList"><div class="loading"><div class="spin"></div></div></div></div></div>';
  api('/api/admin/users').then(function(u){allUsers=u.filter(function(x){return x.role==='client';});filterClients();});
}

function filterClients(){
  var q=((document.getElementById('cf-q')||{}).value||'').toLowerCase();
  var ci=((document.getElementById('cf-ci')||{}).value||'');
  var st=((document.getElementById('cf-st')||{}).value||'');
  var f=allUsers.filter(function(u){
    return(!q||u.name.toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q))&&(!ci||u.city===ci)&&(st===''||(u.is_active?'1':'0')===st);
  });
  var el=document.getElementById('cliList');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h4></div>';return;}
  el.innerHTML='<div class="tw"><table class="tbl"><thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>'+
  f.map(function(u){
    var bg=COLORS[u.id%COLORS.length];
    var date=u.created_at?new Date(u.created_at).toLocaleDateString('ar-SA'):'â€”';
    return'<tr><td><div style="display:flex;align-items:center;gap:9px"><div class="tbl-av" style="background:'+bg+'">'+u.name.charAt(0)+'</div><div><div class="tbl-nm">'+u.name+'</div><div class="tbl-email">'+u.email+'</div></div></div></td>'+
    '<td style="font-size:11px">'+(u.phone||'â€”')+'</td>'+
    '<td style="font-size:11px;font-weight:600">'+(u.city||'â€”')+'</td>'+
    '<td style="font-size:12px;font-weight:700;color:var(--p)">'+(u.request_count||0)+'</td>'+
    '<td style="font-size:11px;color:var(--sub)">'+date+'</td>'+
    '<td><span class="tag '+(u.is_active?'t-act':'t-off')+'">'+(u.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ')+'</span></td>'+
    '<td><div style="display:flex;gap:3px;flex-wrap:wrap">'+
    '<button class="btn btn-xs btn-p" onclick="viewUser('+u.id+')">ğŸ‘</button>'+
    '<button class="btn btn-xs btn-light" onclick="editUserM('+u.id+')">âœ</button>'+
    '<button class="btn btn-xs '+(u.is_active?'btn-r':'btn-g')+'" onclick="togUser('+u.id+')">'+(u.is_active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„')+'</button>'+
    '<button class="btn btn-xs btn-or" onclick="sendWarnM('+u.id+',\''+u.name+'\')">âš  ØªØ­Ø°ÙŠØ±</button>'+
    '<button class="btn btn-xs btn-light" onclick="notifUserM('+u.id+',\''+u.name+'\')">ğŸ””</button>'+
    '<button class="btn btn-xs btn-r" onclick="delUser('+u.id+')">ğŸ—‘</button>'+
    '</div></td></tr>';
  }).join('')+'</tbody></table></div>';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   USER MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function viewUser(id){
  var u=allUsers.find(function(x){return x.id===id;});
  if(!u){toast('Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…','error');return;}
  var bg=COLORS[u.id%COLORS.length];
  var b=BM[u.badge||'none']||BM.none;
  openM('Ù…Ù„Ù '+u.name,
    '<div style="background:#111827;border-radius:10px;padding:14px;display:flex;align-items:center;gap:12px;margin-bottom:14px">'+
    '<div style="width:44px;height:44px;border-radius:10px;background:'+bg+';color:#fff;font-size:18px;font-weight:800;display:flex;align-items:center;justify-content:center">'+u.name.charAt(0)+'</div>'+
    '<div><div style="font-size:14px;font-weight:800;color:#fff">'+u.name+'</div><div style="font-size:11px;color:rgba(255,255,255,.4)">'+u.email+'</div>'+
    '<div style="display:flex;gap:6px;margin-top:6px"><span class="tag '+(u.is_active?'t-act':'t-off')+'">'+(u.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ')+'</span><span class="bc '+b.c+'">'+b.i+' '+b.l+'</span></div></div></div>'+
    '<div class="ib"><div class="ib-t">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</div>'+
    '<div class="ir"><span class="ir-k">Ø§Ù„Ø¬ÙˆØ§Ù„</span><span class="ir-v">'+(u.phone||'â€”')+'</span></div>'+
    '<div class="ir"><span class="ir-k">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span><span class="ir-v">'+(u.city||'â€”')+'</span></div>'+
    '<div class="ir"><span class="ir-k">Ø§Ù„Ø¯ÙˆØ±</span><span class="ir-v">'+(u.role==='provider'?'Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':u.role==='client'?'Ø¹Ù…ÙŠÙ„':'Ù…Ø¯ÙŠØ±')+'</span></div>'+
    '<div class="ir"><span class="ir-k">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span><span class="ir-v">'+(u.created_at?new Date(u.created_at).toLocaleDateString('ar-SA'):'â€”')+'</span></div></div>'+
    (u.role==='provider'&&u.specialties&&u.specialties.length?'<div class="ib"><div class="ib-t">Ø§Ù„ØªØ®ØµØµØ§Øª</div><div style="display:flex;gap:5px;flex-wrap:wrap;margin-top:4px">'+u.specialties.map(function(s){return'<span style="background:var(--pl);color:var(--p2);padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;border:1px solid var(--pm)">'+s+'</span>';}).join('')+'</div></div>':'')+
    (u.bio?'<div class="ib"><div class="ib-t">Ù†Ø¨Ø°Ø©</div><div style="font-size:12px;line-height:1.7;color:#4b5563">'+u.bio+'</div></div>':'')+
    (u.warnings&&u.warnings.length?'<div class="ib" style="background:#fff7ed;border:1px solid #fed7aa"><div class="ib-t" style="color:#c2410c">Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª ('+u.warnings.length+')</div>'+u.warnings.map(function(w){return'<div class="ir"><span class="ir-k">'+new Date(w.date).toLocaleDateString('ar-SA')+'</span><span class="ir-v" style="color:#9a3412">'+w.reason+'</span></div>';}).join('')+'</div>':''),
    '<button class="btn btn-ghost" onclick="closeM();editUserM('+id+')">âœ ØªØ¹Ø¯ÙŠÙ„</button><button class="btn btn-ghost" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>','var(--pl)'
  );
}

function addUserM(role){
  var isProv=role==='provider';
  imgData['user']=[];
  openM('Ø¥Ø¶Ø§ÙØ© '+(isProv?'Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':'Ø¹Ù…ÙŠÙ„'),
    '<div class="fsec">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>'+
    '<div class="f2">'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø§Ø³Ù… <em>*</em></label><input type="text" class="fi" id="nu-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¨Ø±ÙŠØ¯ <em>*</em></label><input type="email" class="fi" id="nu-email"></div>'+
    '<div class="fg"><label class="fl">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± <em>*</em></label><input type="password" class="fi" id="nu-pass"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="fi" id="nu-phone" placeholder="05xxxxxxxx"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="fsel2" id="nu-city">'+cityOpts('')+'</select></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¯ÙˆØ±</label><select class="fsel2" id="nu-role" onchange="togProvF(this.value)"><option value="client" '+(isProv?'':'selected')+'>Ø¹Ù…ÙŠÙ„</option><option value="provider" '+(isProv?'selected':'')+'>Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©</option><option value="admin">Ù…Ø¯ÙŠØ±</option></select></div>'+
    '</div>'+
    (isProv?'<div id="provF"><div class="fsec">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯</div><div class="fg"><label class="fl">Ø§Ù„ØªØ®ØµØµØ§Øª</label><div style="margin-top:5px">'+specsHTML([])+'</div></div><div class="fg"><label class="fl">Ù†Ø¨Ø°Ø©</label><textarea class="fta" id="nu-bio" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø©..."></textarea></div><div class="fsec">ØµÙˆØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>'+imgUpHTML('user')+'</div>':'<div id="provF" style="display:none"></div>'),
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doAddUser()">âœ“ Ø¥Ø¶Ø§ÙØ©</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--gn)" stroke-width="1.8" width="14" height="14"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>','var(--gnl)'
  );
}

function togProvF(role){var el=document.getElementById('provF');if(el)el.style.display=role==='provider'?'':'none';}

function doAddUser(){
  var name=(document.getElementById('nu-name').value||'').trim();
  var email=(document.getElementById('nu-email').value||'').trim();
  var pass=document.getElementById('nu-pass').value;
  var role=document.getElementById('nu-role').value;
  if(!name||!email||!pass){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©','error');return;}
  api('/api/admin/users',{method:'POST',body:JSON.stringify({
    name:name,email:email,password:pass,
    phone:(document.getElementById('nu-phone').value||''),
    city:(document.getElementById('nu-city').value||''),
    role:role,
    specialties:role==='provider'?getSpecs():[],
    bio:role==='provider'&&document.getElementById('nu-bio')?document.getElementById('nu-bio').value:''
  })}).then(function(u){
    if(u.message&&!u.id){toast(u.message,'error');return;}
    closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…','success');
    addLog('Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…',name+' ('+role+')','#16a34a');
    reload();
  });
}

function editUserM(id){
  var u=allUsers.find(function(x){return x.id===id;});
  if(!u){toast('Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…','error');return;}
  var isProv=u.role==='provider';
  imgData['ue']=[];
  openM('ØªØ¹Ø¯ÙŠÙ„ â€” '+u.name,
    '<div class="fsec">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>'+
    '<div class="f2">'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø§Ø³Ù…</label><input type="text" class="fi" id="eu-name" value="'+u.name+'"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="fi" id="eu-phone" value="'+(u.phone||'')+'"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="fsel2" id="eu-city">'+cityOpts(u.city||'')+'</select></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø¯ÙˆØ±</label><select class="fsel2" id="eu-role" onchange="togProvF(this.value)"><option value="client" '+(u.role==='client'?'selected':'')+'>Ø¹Ù…ÙŠÙ„</option><option value="provider" '+(u.role==='provider'?'selected':'')+'>Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©</option><option value="admin" '+(u.role==='admin'?'selected':'')+'>Ù…Ø¯ÙŠØ±</option></select></div>'+
    '</div>'+
    '<div id="provF" style="'+(isProv?'':'display:none')+'">'+
    '<div class="fsec">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯</div>'+
    '<div class="fg"><label class="fl">Ø§Ù„ØªØ®ØµØµØ§Øª</label><div style="margin-top:5px">'+specsHTML(u.specialties||[])+'</div></div>'+
    '<div class="fg"><label class="fl">Ù†Ø¨Ø°Ø©</label><textarea class="fta" id="eu-bio">'+(u.bio||'')+'</textarea></div>'+
    '<div class="fsec">ØµÙˆØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>'+imgUpHTML('ue')+'</div>'+
    '<div class="fsec">Ø§Ù„ÙˆØ³Ø§Ù… ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ©</div>'+
    '<div class="f2">'+
    '<div class="fg"><label class="fl">Ø§Ù„ÙˆØ³Ø§Ù…</label><select class="fsel2" id="eu-badge">'+
    '<option value="none" '+((!u.badge||u.badge==='none')?'selected':'')+'>ğŸš« Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…</option>'+
    '<option value="verified" '+(u.badge==='verified'?'selected':'')+'>âœ“ Ù…ÙˆØ«Ù‚</option>'+
    '<option value="star" '+(u.badge==='star'?'selected':'')+'>â­ Ù…ØªÙ…ÙŠØ²</option>'+
    '<option value="partner" '+(u.badge==='partner'?'selected':'')+'>ğŸ’ Ø´Ø±ÙŠÙƒ</option>'+
    '<option value="top" '+(u.badge==='top'?'selected':'')+'>ğŸ† Ø§Ù„Ø£ÙØ¶Ù„</option>'+
    '</select></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ø­Ø§Ù„Ø©</label><select class="fsel2" id="eu-act"><option value="1" '+(u.is_active!==false?'selected':'')+'>âœ… Ù†Ø´Ø·</option><option value="0" '+(u.is_active===false?'selected':'')+'>ğŸš« Ù…ÙˆÙ‚ÙˆÙ</option></select></div>'+
    '</div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doEditUser('+id+')">ğŸ’¾ Ø­ÙØ¸</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4z"/></svg>','var(--pl)'
  );
}

function doEditUser(id){
  var u=allUsers.find(function(x){return x.id===id;})||{};
  var role=document.getElementById('eu-role').value;
  api('/api/admin/users/'+id,{method:'PUT',body:JSON.stringify({
    name:document.getElementById('eu-name').value,
    phone:document.getElementById('eu-phone').value,
    city:document.getElementById('eu-city').value,
    role:role,
    badge:document.getElementById('eu-badge').value,
    is_active:document.getElementById('eu-act').value==='1',
    specialties:role==='provider'?getSpecs():(u.specialties||[]),
    bio:document.getElementById('eu-bio')?document.getElementById('eu-bio').value:u.bio
  })}).then(function(res){
    if(res.message&&!res.id){toast(res.message,'error');return;}
    closeM();toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success');addLog('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…',u.name,'#f97316');reload();
  });
}

function setBadgeM(userId,name){
  openM('ÙˆØ³Ø§Ù… â€” '+name,
    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">'+
    '<button class="btn btn-ghost" style="justify-content:center;flex-direction:column;gap:4px;height:65px" onclick="doSetBadge('+userId+',\'none\')"><span style="font-size:18px">ğŸš«</span>Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…</button>'+
    '<button class="btn btn-b" style="justify-content:center;flex-direction:column;gap:4px;height:65px" onclick="doSetBadge('+userId+',\'verified\')"><span style="font-size:18px">âœ“</span>Ù…ÙˆØ«Ù‚</button>'+
    '<button class="btn btn-gold" style="justify-content:center;flex-direction:column;gap:4px;height:65px" onclick="doSetBadge('+userId+',\'star\')"><span style="font-size:18px">â­</span>Ù…ØªÙ…ÙŠØ²</button>'+
    '<button class="btn btn-p" style="justify-content:center;flex-direction:column;gap:4px;height:65px" onclick="doSetBadge('+userId+',\'partner\')"><span style="font-size:18px">ğŸ’</span>Ø´Ø±ÙŠÙƒ</button>'+
    '<button class="btn btn-g" style="justify-content:center;flex-direction:column;gap:4px;height:65px;grid-column:1/-1" onclick="doSetBadge('+userId+',\'top\')"><span style="font-size:18px">ğŸ†</span>Ø§Ù„Ø£ÙØ¶Ù„</button>'+
    '</div>','',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.8" width="14" height="14"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>','var(--gl)'
  );
}

function doSetBadge(userId,badge){
  api('/api/admin/users/'+userId+'/badge',{method:'PUT',body:JSON.stringify({badge:badge})}).then(function(){
    closeM();toast('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ³Ø§Ù… âœ…','success');
    addLog('ØªØ¹ÙŠÙŠÙ† ÙˆØ³Ø§Ù…','Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… #'+userId+' â€” '+badge,'#f59e0b');
    reload();
  });
}

function togUser(id){
  api('/api/admin/users/'+id+'/toggle',{method:'PUT'}).then(function(u){
    toast(u.is_active?'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…':'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨','success');
    addLog((u.is_active?'ØªÙØ¹ÙŠÙ„':'Ø¥ÙŠÙ‚Ø§Ù')+' Ø­Ø³Ø§Ø¨','Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… #'+id,u.is_active?'#16a34a':'#ef4444');
    reload();
  });
}

function delUser(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  api('/api/admin/users/'+id,{method:'DELETE'}).then(function(){
    toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');addLog('Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…','#'+id,'#ef4444');reload();
  });
}

function sendWarnM(userId,name){
  openM('Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø°ÙŠØ± Ø±Ø³Ù…ÙŠ Ù„Ù€ '+name,
    '<div class="warn-c"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span class="warn-txt">Ø³ÙŠÙØ³Ø¬ÙÙ‘Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø°ÙŠØ± ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙŠÙØ±Ø³ÙÙ„ Ù„Ù‡ Ø¥Ø´Ø¹Ø§Ø±</span></div>'+
    '<div class="fg"><label class="fl">Ø³Ø¨Ø¨ Ø§Ù„ØªØ­Ø°ÙŠØ± <em>*</em></label><select class="fsel2" id="wn-type"><option value="Ø³Ù„ÙˆÙƒ ØºÙŠØ± Ù„Ø§Ø¦Ù‚">Ø³Ù„ÙˆÙƒ ØºÙŠØ± Ù„Ø§Ø¦Ù‚</option><option value="Ù…Ø®Ø§Ù„ÙØ© Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…">Ù…Ø®Ø§Ù„ÙØ© Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</option><option value="ØªØ£Ø®Ø± ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„">ØªØ£Ø®Ø± ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„</option><option value="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¶Ù„Ù„Ø©">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¶Ù„Ù„Ø©</option><option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option></select></div>'+
    '<div class="fg"><label class="fl">ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</label><textarea class="fta" id="wn-detail" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-or" onclick="doSendWarn('+userId+')">âš  Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--or)" stroke-width="1.8" width="14" height="14"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/></svg>','var(--ol)'
  );
}

function doSendWarn(userId){
  var type=document.getElementById('wn-type').value;
  var detail=document.getElementById('wn-detail').value;
  api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:userId,title:'âš  ØªØ­Ø°ÙŠØ± Ø±Ø³Ù…ÙŠ',body:'ØªØ­Ø°ÙŠØ±: '+type+(detail?'. '+detail:''),type:'warning'})}).then(function(){
    closeM();toast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ± âœ…','success');
    addLog('ØªØ­Ø°ÙŠØ± Ø±Ø³Ù…ÙŠ','Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… #'+userId+' â€” '+type,'#f97316');
  });
}

function sendWarnMulti(){toast('Ù‚Ø±ÙŠØ¨Ø§Ù‹ â€” Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ','info');}

function notifUserM(userId,name){
  openM('Ø¥Ø´Ø¹Ø§Ø± Ù„Ù€ '+name,
    '<div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" class="fi" id="un-t" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù†Øµ</label><textarea class="fta" id="un-b"></textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doNotifUser('+userId+')">ğŸ”” Ø¥Ø±Ø³Ø§Ù„</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>','var(--pl)'
  );
}

function doNotifUser(userId){
  var t=(document.getElementById('un-t').value||'').trim();
  var b=(document.getElementById('un-b').value||'').trim();
  if(!t||!b){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:userId,title:t,body:b,type:'admin'})}).then(function(){closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…','success');});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVIEWS â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgReviews(){
  document.getElementById('content').innerHTML=
  '<div class="card">'+
  '<div class="card-hd">'+
  '<div class="card-hd-l"><div class="card-hd-ic" style="background:var(--gl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.8" width="13" height="13"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div><div><div class="card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div><div class="card-sub">ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div></div></div>'+
  '<div style="display:flex;gap:7px;align-items:center"><span class="tag t-warn" id="rep-cnt" style="display:none">0 Ø¥Ø¨Ù„Ø§Øº</span></div></div>'+
  '<div class="card-body">'+
  '<div class="fbar">'+
  '<div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="rvf-q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ÙŠÙÙ‘Ù… Ø£Ùˆ Ø§Ù„Ù…Ù‚ÙŠÙÙ‘Ù…..." oninput="filterRevs()"></div>'+
  '<select class="fsel" id="rvf-st" onchange="filterRevs()"><option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option><option value="all">Ø§Ù„ÙƒÙ„</option><option value="visible">Ø¸Ø§Ù‡Ø±Ø©</option><option value="hidden">Ù…Ø®ÙÙŠØ©</option><option value="pinned">Ù…Ø«Ø¨ØªØ©</option><option value="reported">Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡Ø§</option></select>'+
  '<select class="fsel" id="rvf-rt" onchange="filterRevs()"><option value="">ÙƒÙ„ Ø§Ù„Ù†Ø¬ÙˆÙ…</option><option value="5">5 Ù†Ø¬ÙˆÙ…</option><option value="4">4 Ù†Ø¬ÙˆÙ…</option><option value="3">3 Ù†Ø¬ÙˆÙ…</option><option value="2">2 Ù†Ø¬ÙˆÙ…</option><option value="1">Ù†Ø¬Ù…Ø©</option></select>'+
  '</div>'+
  '<div id="revList"><div class="loading"><div class="spin"></div></div></div></div></div>';
  api('/api/admin/reviews').then(function(r){
    allRevs=r||[];
    var reported=allRevs.filter(function(x){return x.reported;}).length;
    if(reported>0){
      var el=document.getElementById('rep-cnt');
      if(el){el.style.display='';el.textContent=reported+' Ø¥Ø¨Ù„Ø§Øº';}
      document.getElementById('sb-rep').style.display='';
    }
    filterRevs();
  });
}

function filterRevs(){
  var q=((document.getElementById('rvf-q')||{}).value||'').toLowerCase();
  var st=((document.getElementById('rvf-st')||{}).value||'');
  var rt=((document.getElementById('rvf-rt')||{}).value||'');
  var f=allRevs.filter(function(r){
    var mq=!q||(r.reviewer_name||'').toLowerCase().includes(q)||(r.reviewed_name||'').toLowerCase().includes(q);
    var ms=!st||st==='all'||(st==='visible'&&!r.hidden&&!r.pinned)||(st==='hidden'&&r.hidden)||(st==='pinned'&&r.pinned)||(st==='reported'&&r.reported);
    var mr=!rt||r.rating==rt;
    return mq&&ms&&mr;
  });
  var el=document.getElementById('revList');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h4></div>';return;}
  el.innerHTML=f.map(function(r){return revCard(r);}).join('');
}

function revCard(r){
  var stars='';
  for(var i=1;i<=5;i++)stars+='<span class="'+(i<=r.rating?'rev-star-on':'rev-star-off')+'">â˜…</span>';
  var cls=(r.hidden?'rev-hidden':r.pinned?'rev-pinned':'');
  var date=r.created_at?new Date(r.created_at).toLocaleDateString('ar-SA'):'â€”';
  var bg1=COLORS[(r.reviewer_id||1)%COLORS.length];
  var bg2=COLORS[(r.reviewed_id||2)%COLORS.length];
  return'<div class="rev-c '+cls+'" id="rc-'+r.id+'">'+
  '<div class="rev-hd">'+
  '<div style="display:flex;flex-direction:column;gap:5px">'+
  '<div class="rev-users"><div class="rev-av" style="background:'+bg1+'">'+(r.reviewer_name||'ØŸ').charAt(0)+'</div><span style="font-size:11px;font-weight:700">'+(r.reviewer_name||'â€”')+'</span><span class="rev-arr">â†</span><div class="rev-av" style="background:'+bg2+'">'+(r.reviewed_name||'ØŸ').charAt(0)+'</div><span style="font-size:11px;font-weight:700">'+(r.reviewed_name||'â€”')+'</span></div>'+
  '<div style="display:flex;gap:5px;align-items:center"><div class="rev-stars">'+stars+'</div><span class="rev-proj">'+(r.project_number||'#'+r.request_id)+'</span>'+
  (r.reported?'<span class="rev-flag">âš‘ Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡</span>':'')+
  (r.pinned?'<span style="font-size:9px;color:var(--gold2);font-weight:800;background:var(--gl);padding:2px 7px;border-radius:20px;border:1px solid #fcd34d">ğŸ“Œ Ù…Ø«Ø¨Øª</span>':'')+
  (r.hidden?'<span style="font-size:9px;color:var(--sub);font-weight:700;background:#f3f4f6;padding:2px 7px;border-radius:20px;border:1px solid var(--b2)">ğŸ™ˆ Ù…Ø®ÙÙŠ</span>':'')+
  '</div></div>'+
  '</div>'+
  '<div class="rev-date">'+date+'</div></div>'+
  (r.comment?'<div class="rev-txt">'+r.comment+'</div>':'')+
  (r.admin_reply?'<div class="rev-reply"><div class="rev-reply-lbl">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>'+r.admin_reply+'</div>':'')+
  '<div class="rev-ft">'+
  '<div class="rev-acts">'+
  '<button class="btn btn-xs btn-gold" onclick="replyRevM('+r.id+')">'+(r.admin_reply?'âœ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¯':'ğŸ’¬ Ø±Ø¯')+'</button>'+
  '<button class="btn btn-xs '+(r.pinned?'btn-ghost':'btn-gold')+'" onclick="togPin('+r.id+','+!r.pinned+')">'+(r.pinned?'ğŸ“Œ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª':'ğŸ“Œ ØªØ«Ø¨ÙŠØª')+'</button>'+
  '<button class="btn btn-xs '+(r.hidden?'btn-g':'btn-light')+'" onclick="togHide('+r.id+','+!r.hidden+')">'+(r.hidden?'ğŸ‘ Ø¥Ø¸Ù‡Ø§Ø±':'ğŸ™ˆ Ø¥Ø®ÙØ§Ø¡')+'</button>'+
  (r.reported?'<button class="btn btn-xs btn-or" onclick="resolveReport('+r.id+')">âœ“ Ø­Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</button>':'')+
  '<button class="btn btn-xs btn-r" onclick="delReview('+r.id+')">ğŸ—‘ Ø­Ø°Ù</button>'+
  '</div></div></div>';
}

function replyRevM(id){
  var r=allRevs.find(function(x){return x.id===id;});
  openM('Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…',
    (r&&r.comment?'<div class="rev-txt" style="margin-bottom:12px">'+r.comment+'</div>':'')+
    '<div class="fg"><label class="fl">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label><textarea class="fta" id="rr-body" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©...">'+(r&&r.admin_reply?r.admin_reply:'')+'</textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="doReplyRev('+id+')">ğŸ’¬ Ù†Ø´Ø± Ø§Ù„Ø±Ø¯</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.8" width="14" height="14"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>','var(--gl)'
  );
}

function doReplyRev(id){
  var body=(document.getElementById('rr-body').value||'').trim();
  if(!body){toast('Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯','error');return;}
  api('/api/admin/reviews/'+id+'/reply',{method:'PUT',body:JSON.stringify({reply:body})}).then(function(){
    closeM();toast('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø±Ø¯ âœ…','success');
    addLog('Ø±Ø¯ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…','Ø§Ù„ØªÙ‚ÙŠÙŠÙ… #'+id,'#f59e0b');
    pgReviews();
  });
}

function togPin(id,pin){
  api('/api/admin/reviews/'+id+'/pin',{method:'PUT',body:JSON.stringify({pinned:pin})}).then(function(){
    toast(pin?'ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª ğŸ“Œ':'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª','success');pgReviews();
  });
}

function togHide(id,hide){
  api('/api/admin/reviews/'+id+'/hide',{method:'PUT',body:JSON.stringify({hidden:hide})}).then(function(){
    toast(hide?'ØªÙ… Ø§Ù„Ø¥Ø®ÙØ§Ø¡ ğŸ™ˆ':'ØªÙ… Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø± ğŸ‘','success');pgReviews();
  });
}

function resolveReport(id){
  api('/api/admin/reviews/'+id+'/resolve',{method:'PUT'}).then(function(){
    toast('ØªÙ… Ø­Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº âœ…','success');addLog('Ø­Ù„ Ø¥Ø¨Ù„Ø§Øº','Ø§Ù„ØªÙ‚ÙŠÙŠÙ… #'+id,'#16a34a');pgReviews();
  });
}

function delReview(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  api('/api/admin/reviews/'+id,{method:'DELETE'}).then(function(){
    toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');addLog('Ø­Ø°Ù ØªÙ‚ÙŠÙŠÙ…','#'+id,'#ef4444');pgReviews();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISPUTES â€” Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgDisputes(){
  document.getElementById('content').innerHTML=
  '<div class="card">'+
  '<div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--rl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="1.8" width="13" height="13"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div><div><div class="card-title">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</div><div class="card-sub">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†</div></div></div>'+
  '<div style="display:flex;gap:7px"><select class="fsel" id="df-st" onchange="loadDis()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="open">Ù…ÙØªÙˆØ­Ø©</option><option value="resolved">Ù…Ø­Ù„ÙˆÙ„Ø©</option></select></div></div>'+
  '<div class="card-body" id="disList"><div class="loading"><div class="spin"></div></div></div></div>';
  loadDis();
}

function loadDis(){
  var st=((document.getElementById('df-st')||{}).value||'');
  api('/api/admin/disputes'+(st?'?status='+st:'')).then(function(r){
    allDis=r||[];
    document.getElementById('sb-dis').textContent=allDis.filter(function(d){return d.status==='open';}).length;
    var el=document.getElementById('disList');if(!el)return;
    if(!allDis.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø²Ø§Ø¹Ø§Øª âœ…</h4></div>';return;}
    el.innerHTML=allDis.map(function(d){
      var bg1=COLORS[(d.client_id||1)%COLORS.length];
      var bg2=COLORS[(d.provider_id||2)%COLORS.length];
      var date=d.created_at?new Date(d.created_at).toLocaleDateString('ar-SA'):'â€”';
      return'<div class="dis-c '+(d.status==='open'?'dis-open':'dis-resolve')+'">'+
      '<div class="dis-hd"><div><div class="dis-title">'+d.title+'</div><div class="dis-meta">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: '+(d.project_number||'#'+d.request_id)+' â€¢ '+date+'</div></div>'+
      '<span class="tag '+(d.status==='open'?'t-rej':'t-open')+'">'+(d.status==='open'?'Ù…ÙØªÙˆØ­':'Ù…Ø­Ù„ÙˆÙ„')+'</span></div>'+
      '<div class="dis-body">'+(d.description||'â€”')+'</div>'+
      '<div class="dis-parties">'+
      '<div class="dis-party"><div class="dis-party-av" style="background:'+bg1+'">'+( d.client_name||'ØŸ').charAt(0)+'</div><div><div class="dis-party-nm">'+(d.client_name||'â€”')+'</div><div class="dis-party-rl">Ø§Ù„Ø¹Ù…ÙŠÙ„</div></div></div>'+
      '<div style="display:flex;align-items:center;color:var(--sub);font-size:18px;padding:0 4px">â‡†</div>'+
      '<div class="dis-party"><div class="dis-party-av" style="background:'+bg2+'">'+( d.provider_name||'ØŸ').charAt(0)+'</div><div><div class="dis-party-nm">'+(d.provider_name||'â€”')+'</div><div class="dis-party-rl">Ø§Ù„Ù…Ø²ÙˆØ¯</div></div></div>'+
      '</div>'+
      (d.resolution?'<div class="dis-res">âœ“ Ø§Ù„Ù‚Ø±Ø§Ø±: '+d.resolution+'</div>':'')+
      '<div style="display:flex;gap:6px;flex-wrap:wrap">'+
      (d.status==='open'?'<button class="btn btn-g btn-sm" onclick="resolveDisM('+d.id+')">âœ“ Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹</button><button class="btn btn-b btn-sm" onclick="notifBothM('+d.client_id+','+d.provider_id+')">ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†</button>':'')+'<button class="btn btn-light btn-sm" onclick="viewReq('+d.request_id+')">ğŸ‘ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>'+
      '</div></div>';
    }).join('');
  });
}

function openDispute(reqId){
  openM('ÙØªØ­ Ù†Ø²Ø§Ø¹ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹',
    '<div class="warn-c"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span class="warn-txt">Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø²ÙˆØ¯ Ø¨ÙØªØ­ Ø§Ù„Ù†Ø²Ø§Ø¹</span></div>'+
    '<div class="fg"><label class="fl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø²Ø§Ø¹</label><input type="text" class="fi" id="od-title" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù†Ø²Ø§Ø¹"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„ØªÙØ§ØµÙŠÙ„</label><textarea class="fta" id="od-desc" placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ ÙØªØ­ Ø§Ù„Ù†Ø²Ø§Ø¹..."></textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-or" onclick="doOpenDispute('+reqId+')">âš  ÙØªØ­ Ø§Ù„Ù†Ø²Ø§Ø¹</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--or)" stroke-width="1.8" width="14" height="14"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/></svg>','var(--ol)'
  );
}

function doOpenDispute(reqId){
  var title=(document.getElementById('od-title').value||'').trim();
  var desc=(document.getElementById('od-desc').value||'').trim();
  if(!title){toast('Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø²Ø§Ø¹','error');return;}
  api('/api/admin/disputes',{method:'POST',body:JSON.stringify({request_id:reqId,title:title,description:desc})}).then(function(){
    closeM();toast('ØªÙ… ÙØªØ­ Ø§Ù„Ù†Ø²Ø§Ø¹ âœ…','success');addLog('ÙØªØ­ Ù†Ø²Ø§Ø¹','Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ #'+reqId,'#ef4444');
  });
}

function resolveDisM(id){
  openM('Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹',
    '<div class="fg"><label class="fl">Ù‚Ø±Ø§Ø± Ø§Ù„Ø­Ù„ <em>*</em></label><select class="fsel2" id="rd-side"><option value="client">Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ù…ÙŠÙ„</option><option value="provider">Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø²ÙˆØ¯</option><option value="mutual">ØªØ³ÙˆÙŠØ© Ù…Ø´ØªØ±ÙƒØ©</option></select></div>'+
    '<div class="fg"><label class="fl">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø±</label><textarea class="fta" id="rd-res" placeholder="Ø§ÙƒØªØ¨ Ù‚Ø±Ø§Ø± Ø§Ù„Ø­Ù„..."></textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-g" onclick="doResolveDis('+id+')">âœ“ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ù„</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--gn)" stroke-width="1.8" width="14" height="14"><polyline points="20 6 9 17 4 12"/></svg>','var(--gnl)'
  );
}

function doResolveDis(id){
  var side=document.getElementById('rd-side').value;
  var res=(document.getElementById('rd-res').value||'').trim();
  api('/api/admin/disputes/'+id+'/resolve',{method:'PUT',body:JSON.stringify({resolution:res||side,decision:side})}).then(function(){
    closeM();toast('ØªÙ… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹ âœ…','success');addLog('Ø­Ù„ Ù†Ø²Ø§Ø¹','#'+id,'#16a34a');loadDis();
  });
}

function notifBothM(cId,pId){
  openM('Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†',
    '<div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" class="fi" id="nb-t" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>'+
    '<div class="fg"><label class="fl">Ø§Ù„Ù†Øµ</label><textarea class="fta" id="nb-b"></textarea></div>',
    '<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doNotifBoth('+cId+','+pId+')">ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±ÙÙŠÙ†</button>',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="14" height="14"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/></svg>','var(--pl)'
  );
}

function doNotifBoth(cId,pId){
  var t=(document.getElementById('nb-t').value||'').trim();
  var b=(document.getElementById('nb-b').value||'').trim();
  if(!t||!b){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  Promise.all([
    api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:cId,title:t,body:b,type:'admin'})}),
    api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:pId,title:t,body:b,type:'admin'})})
  ]).then(function(){closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±ÙÙŠÙ† âœ…','success');});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgNotifs(){
  document.getElementById('content').innerHTML=
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--pl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="13" height="13"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div><div><div class="card-title">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div><div class="card-sub">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div></div></div></div>'+
  '<div class="card-body">'+
  '<div class="fg"><label class="fl">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙˆÙ†</label><div class="nt-wrap" style="margin-top:6px"><button class="ntt on" onclick="setNT(this,\'\')">ğŸ‘¥ Ø§Ù„Ø¬Ù…ÙŠØ¹</button><button class="ntt" onclick="setNT(this,\'provider\')">ğŸ”§ Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†</button><button class="ntt" onclick="setNT(this,\'client\')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button></div></div>'+
  '<input type="hidden" id="nt-role" value="">'+
  '<div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <em>*</em></label><input type="text" class="fi" id="nt-t" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>'+
  '<div class="fg"><label class="fl">Ø§Ù„Ù†Øµ <em>*</em></label><textarea class="fta" id="nt-b" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±..."></textarea></div>'+
  '<div style="display:flex;gap:8px">'+
  '<button class="btn btn-p" onclick="sendNotif()"><svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="#fff" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>Ø¥Ø±Ø³Ø§Ù„</button>'+
  '<button class="btn btn-light" onclick="clearNotif()">Ù…Ø³Ø­</button>'+
  '</div></div></div>';
}

function setNT(btn,role){document.querySelectorAll('.ntt').forEach(function(b){b.classList.remove('on');});btn.classList.add('on');document.getElementById('nt-role').value=role;}
function clearNotif(){document.getElementById('nt-t').value='';document.getElementById('nt-b').value='';}
function sendNotif(){
  var t=(document.getElementById('nt-t').value||'').trim();
  var b=(document.getElementById('nt-b').value||'').trim();
  var role=document.getElementById('nt-role').value;
  if(!t||!b){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  api('/api/admin/notify',{method:'POST',body:JSON.stringify({title:t,body:b,role:role||undefined,type:'admin'})}).then(function(){
    toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…','success');addLog('Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù…',t+(role?' â†’ '+(role==='provider'?'Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†':'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'):''),'#7c3aed');clearNotif();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgReports(){
  document.getElementById('content').innerHTML='<div class="loading"><div class="spin"></div></div>';
  Promise.all([api('/api/admin/stats'),api('/api/admin/requests')]).then(function(results){
    var s=results[0];var reqs=results[1]||[];
    var cities={};var cats={};
    reqs.forEach(function(r){
      if(r.city)cities[r.city]=(cities[r.city]||0)+1;
      if(r.category)cats[r.category]=(cats[r.category]||0)+1;
    });
    var topCities=Object.entries(cities).sort(function(a,b){return b[1]-a[1];}).slice(0,8);
    var topCats=Object.entries(cats).sort(function(a,b){return b[1]-a[1];}).slice(0,8);
    var maxC=topCities.length?topCities[0][1]:1;
    var maxCat=topCats.length?topCats[0][1]:1;
    var compRate=reqs.length?Math.round((s.completed||0)/reqs.length*100):0;

    document.getElementById('content').innerHTML=
    '<div class="pghd"><div><div class="pghd-t">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div></div></div>'+
    '<div class="sgrid" style="margin-bottom:18px">'+
      miniStat('Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„',compRate+'%','#16a34a','var(--gnl)')+
      miniStat('Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø±ÙˆØ¶/Ù…Ø´Ø±ÙˆØ¹',reqs.length?Math.round((s.bids||0)/reqs.length):0,'var(--p)','var(--pl)')+
      miniStat('Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©',(s.open||0)+(s.in_progress||0),'var(--blue)','var(--bl)')+
      miniStat('Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ÙÙˆØ¶Ø©',s.rejected||0,'var(--red)','var(--rl)')+
    '</div>'+
    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">'+
    '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--bl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="1.8" width="13" height="13"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div><div class="card-title">Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø¯Ù† Ø·Ù„Ø¨Ø§Ù‹</div></div></div>'+
    '<div class="card-body">'+topCities.map(function(c){return'<div class="rpt-row"><div class="rpt-lbl">'+c[0]+'</div><div class="rpt-bar"><div class="rpt-bar-f" style="width:'+Math.round(c[1]/maxC*100)+'%;background:var(--blue)"></div></div><div class="rpt-val">'+c[1]+'</div></div>';}).join('')+'</div></div>'+
    '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--pl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="13" height="13"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div><div class="card-title">Ø£ÙƒØ«Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø·Ù„Ø¨Ø§Ù‹</div></div></div>'+
    '<div class="card-body">'+topCats.map(function(c){return'<div class="rpt-row"><div class="rpt-lbl">'+c[0]+'</div><div class="rpt-bar"><div class="rpt-bar-f" style="width:'+Math.round(c[1]/maxCat*100)+'%;background:var(--p)"></div></div><div class="rpt-val">'+c[1]+'</div></div>';}).join('')+'</div></div>'+
    '</div>';
  });
}

function miniStat(lbl,val,color,bg){
  return'<div class="sc"><div style="font-size:22px;font-weight:900;color:'+color+';margin-bottom:3px">'+val+'</div><div style="font-size:11px;color:var(--sub)">'+lbl+'</div></div>';
}

var rptBarsDone=false;
function animRptBars(){if(rptBarsDone)return;rptBarsDone=true;document.querySelectorAll('.rpt-bar-f').forEach(function(el){var w=el.style.width;el.style.width='0';setTimeout(function(){el.style.width=w;},100);});}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVITY LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgLog(){
  document.getElementById('content').innerHTML=
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--gnl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gn)" stroke-width="1.8" width="13" height="13"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><div><div class="card-title">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</div><div class="card-sub">Ø¬Ù…ÙŠØ¹ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</div></div></div>'+
  '<button class="btn btn-light btn-sm" onclick="actLog=[];pgLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button></div>'+
  '<div class="card-body">'+
  (actLog.length?actLog.map(function(l){
    return'<div class="log-item"><div class="log-dot" style="background:'+l.color+'"></div><div class="log-body"><div class="log-action">'+l.action+'</div><div class="log-detail">'+l.detail+'</div></div><div class="log-time">'+l.time+'</div></div>';
  }).join(''):
  '<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><h4>Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº</h4><p>Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ®Ø°Ù‡Ø§</p></div>')+
  '</div></div>';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgSettings(){
  document.getElementById('content').innerHTML=
  '<div class="pghd"><div><div class="pghd-t">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØµØ©</div></div></div>'+
  '<div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">'+
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--pl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="1.8" width="13" height="13"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg></div><div class="card-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</div></div></div>'+
  '<div class="card-body">'+
  setRow('Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ','Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ³Ø¬ÙŠÙ„ Ù…Ø²ÙˆØ¯ÙŠÙ† Ø¬Ø¯Ø¯ Ø¨Ø¯ÙˆÙ† Ù…Ø±Ø§Ø¬Ø¹Ø©','auto-reg','off')+
  setRow('Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±','ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ØªÙ…Ø± Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹','review-req','on')+
  setRow('Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯','email-notif','on')+
  setRow('ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©','Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„ØµÙŠØ§Ù†Ø©','maintenance','off')+
  '</div></div>'+
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--gnl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gn)" stroke-width="1.8" width="13" height="13"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></div><div class="card-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</div></div></div>'+
  '<div class="card-body">'+
  setRow('Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (OTP)','Ø¥Ù„Ø²Ø§Ù…ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„','otp','on')+
  setRow('Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Rate Limiting)','Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ«ÙŠØ±Ø©','rate-limit','on')+
  setRow('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„','email-verify','off')+
  '</div></div>'+
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--gl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.8" width="13" height="13"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg></div><div class="card-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div></div></div>'+
  '<div class="card-body">'+
  '<div class="fg"><label class="fl">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" class="fi" value="100" placeholder="100"></div>'+
  '<div class="fg"><label class="fl">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</label><input type="number" class="fi" value="20" placeholder="20"></div>'+
  '<div class="fg"><label class="fl">Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…ÙØªÙˆØ­ (Ø£ÙŠØ§Ù…)</label><input type="number" class="fi" value="30" placeholder="30"></div>'+
  '<button class="btn btn-p btn-sm" onclick="toast(\'ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…\',\'success\')">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>'+
  '</div></div>'+
  '<div class="card"><div class="card-hd"><div class="card-hd-l"><div class="card-hd-ic" style="background:var(--rl)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="1.8" width="13" height="13"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></div><div class="card-title">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</div></div></div>'+
  '<div class="card-body">'+
  '<div class="set-row"><div class="set-info"><div class="set-title" style="color:var(--red)">Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div><div class="set-sub">Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†</div></div><button class="btn btn-r btn-sm" onclick="toast(\'Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹\',\'error\')">Ø­Ø°Ù</button></div>'+
  '<div class="set-row"><div class="set-info"><div class="set-title" style="color:var(--red)">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div><div class="set-sub">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª</div></div><button class="btn btn-r btn-sm" onclick="toast(\'Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹\',\'error\')">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button></div>'+
  '</div></div>'+
  '</div>';
}

function setRow(title,sub,key,def){
  var isOn=def==='on';
  return'<div class="set-row"><div class="set-info"><div class="set-title">'+title+'</div><div class="set-sub">'+sub+'</div></div>'+
  '<button class="toggle '+(isOn?'on':'off')+'" id="st-'+key+'" onclick="togSet(this)"></button></div>';
}

function togSet(btn){
  btn.classList.toggle('on');btn.classList.toggle('off');
  toast('ØªÙ… Ø§Ù„Ø­ÙØ¸','success');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function reload(){
  var P={home:pgHome,pending:pgPending,requests:pgRequests,providers:pgProviders,clients:pgClients,reviews:pgReviews,disputes:pgDisputes,reports:pgReports,log:pgLog,settings:pgSettings};
  if(P[curPage])P[curPage]();
}

document.getElementById('overlay').addEventListener('click',function(e){if(e.target===this)closeM();});

// INIT
lucide.createIcons();
go('home',document.querySelector('.sbi.on'));
</script>
</body>
</html>
