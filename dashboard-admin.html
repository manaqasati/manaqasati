<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± â€“ Ù…Ù†Ø§Ù‚ØµØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --p:#7c3aed;--p2:#6d28d9;--p-l:#ede9fe;--p-m:#ddd6fe;
  --gold:#f59e0b;--gold2:#d97706;--gold-l:#fef3c7;
  --text:#0f0a1e;--muted:#64748b;--border:#e2e8f0;--bg:#f8f7ff;--white:#fff;
  --red:#ef4444;--red-l:#fee2e2;--green:#16a34a;--green-l:#dcfce7;
  --blue:#2563eb;--blue-l:#dbeafe;--orange:#ea580c;--orange-l:#ffedd5;
  --sb:265px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;overflow-x:hidden}

/* SIDEBAR */
.sidebar{width:var(--sb);background:linear-gradient(180deg,#130330 0%,#1e0545 45%,#2d0f6b 100%);position:fixed;top:0;right:0;bottom:0;z-index:100;display:flex;flex-direction:column;box-shadow:-2px 0 24px rgba(0,0,0,0.18)}
.sb-logo{padding:20px 18px 15px;border-bottom:1px solid rgba(255,255,255,0.07)}
.sb-logo-row{display:flex;align-items:center;gap:10px}
.sb-logo-ic{width:38px;height:38px;border-radius:11px;background:linear-gradient(135deg,#f59e0b,#f97316);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;box-shadow:0 3px 12px rgba(245,158,11,.3)}
.sb-brand{font-size:19px;font-weight:900;color:#fff}
.sb-brand em{color:var(--gold);font-style:normal}
.sb-brand-sub{font-size:9px;color:rgba(255,255,255,.28);font-weight:600;letter-spacing:1.2px;margin-top:1px}
.sb-user{display:flex;align-items:center;gap:10px;padding:13px 18px;border-bottom:1px solid rgba(255,255,255,.07);background:rgba(255,255,255,.03)}
.sb-av{width:38px;height:38px;border-radius:11px;background:linear-gradient(135deg,var(--gold),var(--p));color:#fff;font-size:16px;font-weight:900;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sb-uname{font-size:13px;font-weight:800;color:#fff}
.sb-urole{font-size:10px;color:rgba(255,255,255,.38);display:flex;align-items:center;gap:4px;margin-top:1px}
.sb-urole::before{content:'';width:5px;height:5px;border-radius:50%;background:#22c55e;display:inline-block}
.sb-nav{flex:1;padding:10px 12px;overflow-y:auto;scrollbar-width:none}
.sb-nav::-webkit-scrollbar{display:none}
.sb-sec{font-size:9px;font-weight:800;color:rgba(255,255,255,.2);letter-spacing:1.5px;padding:10px 8px 5px;margin-top:4px}
.sbi{display:flex;align-items:center;gap:9px;padding:9px 11px;border-radius:11px;cursor:pointer;transition:.15s;margin-bottom:2px;border:1px solid transparent;background:transparent;width:100%;font-family:'Tajawal',sans-serif;text-align:right;position:relative}
.sbi:hover{background:rgba(255,255,255,.07)}
.sbi.on{background:rgba(255,255,255,.11);border-color:rgba(255,255,255,.07)}
.sbi.on::after{content:'';position:absolute;right:0;top:20%;height:60%;width:3px;background:var(--gold);border-radius:0 2px 2px 0}
.sbi-ic{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sbi.on .sbi-ic{background:rgba(255,255,255,.1)}
.sbi svg{width:15px;height:15px;stroke:rgba(255,255,255,.4);transition:.15s}
.sbi.on svg,.sbi:hover svg{stroke:#fff}
.sbi-lbl{font-size:13px;font-weight:700;color:rgba(255,255,255,.5);flex:1;transition:.15s}
.sbi.on .sbi-lbl,.sbi:hover .sbi-lbl{color:#fff}
.sb-cnt{background:var(--red);color:#fff;font-size:9px;font-weight:800;padding:2px 7px;border-radius:20px;min-width:20px;text-align:center;flex-shrink:0}
.sb-bot{padding:12px;border-top:1px solid rgba(255,255,255,.07)}

/* MAIN */
.main{margin-right:var(--sb);flex:1;display:flex;flex-direction:column;min-height:100vh}
.topbar{background:var(--white);border-bottom:1px solid var(--border);padding:0 26px;height:58px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;box-shadow:0 1px 8px rgba(0,0,0,.04)}
.tb-l{display:flex;align-items:center;gap:12px}
.tb-title{font-size:16px;font-weight:900}
.tb-sub{font-size:10px;color:var(--muted);font-weight:600}
.tb-r{display:flex;align-items:center;gap:8px}
.tb-clock{font-size:11px;font-weight:700;color:var(--muted);background:var(--bg);padding:5px 11px;border-radius:8px;border:1.5px solid var(--border)}
.tb-btn{width:36px;height:36px;border-radius:9px;border:1.5px solid var(--border);background:var(--white);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.15s}
.tb-btn:hover{border-color:var(--p);background:var(--p-l)}
.tb-btn svg{width:16px;height:16px;stroke:var(--muted);transition:.15s}
.tb-btn:hover svg{stroke:var(--p)}
.content{padding:22px;flex:1}

/* STATS */
.sgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(165px,1fr));gap:13px;margin-bottom:22px}
.sc{background:var(--white);border:1.5px solid var(--border);border-radius:17px;padding:17px;position:relative;overflow:hidden;transition:.2s}
.sc:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,.07)}
.sc-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px}
.sc-ic{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center}
.sc-ic svg{width:19px;height:19px}
.sc-badge{font-size:9px;font-weight:800;padding:3px 8px;border-radius:20px}
.up{background:var(--green-l);color:var(--green)}
.warn{background:var(--orange-l);color:var(--orange)}
.sc-num{font-size:28px;font-weight:900;line-height:1;margin-bottom:3px}
.sc-lbl{font-size:11px;color:var(--muted);font-weight:600}
.sc-bar{height:3px;border-radius:2px;margin-top:11px;background:var(--border);overflow:hidden}
.sc-bar-f{height:100%;border-radius:2px;transition:width 1s ease}

/* SECTION */
.sec{background:var(--white);border:1.5px solid var(--border);border-radius:17px;overflow:hidden;margin-bottom:18px}
.sec-hd{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.sec-hd-l{display:flex;align-items:center;gap:10px}
.sec-ic{width:32px;height:32px;border-radius:9px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sec-ic svg{width:15px;height:15px}
.sec-title{font-size:14px;font-weight:900}
.sec-cnt{font-size:10px;color:var(--muted);background:var(--bg);padding:2px 9px;border-radius:20px;font-weight:700;border:1px solid var(--border)}
.sec-body{padding:16px 20px}

/* TABLE */
.tbl-wrap{overflow-x:auto}
.tbl{width:100%;border-collapse:collapse;font-size:12px;min-width:700px}
.tbl th{text-align:right;padding:10px 12px;color:var(--muted);font-weight:800;border-bottom:2px solid var(--border);white-space:nowrap;font-size:10px;background:#fafbff}
.tbl td{padding:11px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
.tbl tr:last-child td{border-bottom:none}
.tbl tr:hover td{background:#fafbff}
.tbl-av{width:34px;height:34px;border-radius:10px;color:#fff;font-size:13px;font-weight:900;display:flex;align-items:center;justify-content:center;flex-shrink:0}

/* TAGS */
.tag{padding:3px 10px;border-radius:20px;font-size:10px;font-weight:800;display:inline-flex;align-items:center;gap:3px;white-space:nowrap}
.tag::before{content:'';width:5px;height:5px;border-radius:50%;flex-shrink:0}
.t-pend{background:#fef3c7;color:#d97706}.t-pend::before{background:#d97706}
.t-open{background:var(--green-l);color:var(--green)}.t-open::before{background:var(--green)}
.t-prog{background:var(--blue-l);color:var(--blue)}.t-prog::before{background:var(--blue)}
.t-done{background:var(--p-l);color:var(--p)}.t-done::before{background:var(--p)}
.t-rej{background:var(--red-l);color:var(--red)}.t-rej::before{background:var(--red)}

/* BADGE */
.bc{padding:4px 10px;border-radius:20px;font-size:10px;font-weight:800;display:inline-flex;align-items:center;gap:3px;border:1.5px solid}
.b-none{background:#f1f5f9;color:#94a3b8;border-color:#e2e8f0}
.b-verified{background:var(--blue-l);color:var(--blue);border-color:#93c5fd}
.b-star{background:var(--gold-l);color:var(--gold2);border-color:#fcd34d}
.b-partner{background:var(--p-l);color:var(--p);border-color:var(--p-m)}
.b-top{background:var(--green-l);color:var(--green);border-color:#86efac}

/* BTNS */
.btn{padding:8px 15px;border-radius:10px;font-family:'Tajawal',sans-serif;font-size:12px;font-weight:800;cursor:pointer;border:none;transition:.15s;display:inline-flex;align-items:center;gap:5px;white-space:nowrap}
.btn:active{transform:scale(.97)}
.btn svg{width:13px;height:13px;stroke:currentColor;fill:none;flex-shrink:0;stroke-width:2}
.btn-p{background:var(--p);color:#fff}.btn-p:hover{background:var(--p2);box-shadow:0 4px 14px rgba(124,58,237,.3)}
.btn-g{background:var(--green);color:#fff}.btn-g:hover{background:#15803d;box-shadow:0 4px 14px rgba(22,163,74,.3)}
.btn-r{background:var(--red);color:#fff}.btn-r:hover{background:#dc2626}
.btn-gold{background:var(--gold);color:#fff}.btn-gold:hover{background:var(--gold2)}
.btn-b{background:var(--blue);color:#fff}.btn-b:hover{background:#1d4ed8}
.btn-ghost{background:var(--bg);color:var(--text);border:1.5px solid var(--border)}.btn-ghost:hover{border-color:var(--p);color:var(--p);background:var(--p-l)}
.btn-sm{padding:6px 11px;font-size:11px;border-radius:8px}
.btn-xs{padding:4px 8px;font-size:10px;border-radius:7px}

/* SEARCH */
.search-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
.sbox{flex:1;min-width:200px;display:flex;align-items:center;gap:7px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;padding:0 12px;transition:.15s}
.sbox:focus-within{border-color:var(--p);background:var(--white)}
.sbox svg{width:14px;height:14px;stroke:var(--muted);flex-shrink:0}
.sbox input{border:none;outline:none;background:transparent;font-family:'Tajawal',sans-serif;font-size:13px;padding:8px 0;flex:1;color:var(--text)}
.fsel{padding:9px 11px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:12px;font-weight:700;background:var(--white);color:var(--text);outline:none;cursor:pointer;transition:.15s}
.fsel:focus{border-color:var(--p)}

/* PROJECT CARD */
.pc{border:1.5px solid var(--border);border-radius:16px;padding:18px;margin-bottom:12px;background:var(--white);transition:.2s;position:relative;overflow:hidden}
.pc::before{content:'';position:absolute;top:0;right:0;left:0;height:3px}
.pc-pend::before{background:linear-gradient(90deg,var(--gold),#f97316)}
.pc-open::before{background:linear-gradient(90deg,var(--green),#4ade80)}
.pc-prog::before{background:linear-gradient(90deg,var(--blue),#60a5fa)}
.pc-done::before{background:linear-gradient(90deg,var(--p),#a855f7)}
.pc-rej::before{background:linear-gradient(90deg,var(--red),#f87171)}
.pc:hover{box-shadow:0 6px 24px rgba(0,0,0,.08);transform:translateY(-1px)}
.pc.pc-pend{background:#fffdf5}
.pc.pc-prog{background:#f0f7ff}
.pc.pc-done{background:#f5f0ff}
.pc.pc-rej{background:#fff5f5}
.pc-hd{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:10px}
.pc-num{font-size:10px;font-weight:800;color:var(--muted);font-family:monospace;letter-spacing:.5px;margin-bottom:4px}
.pc-title{font-size:15px;font-weight:900;line-height:1.3}
.pc-meta{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.pm{font-size:11px;color:var(--muted);background:var(--bg);padding:4px 10px;border-radius:20px;display:flex;align-items:center;gap:4px;font-weight:600;border:1px solid var(--border)}
.pc-desc{font-size:12px;color:#475569;line-height:1.7;margin-bottom:12px;padding:10px 14px;background:var(--bg);border-radius:10px;border-right:3px solid var(--p-m)}
.pc-imgs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.pc-img{width:60px;height:60px;border-radius:9px;object-fit:cover;border:2px solid var(--border);cursor:pointer;transition:.15s}
.pc-img:hover{border-color:var(--p);transform:scale(1.05)}
.pc-acts{display:flex;gap:6px;flex-wrap:wrap}

/* STAMP */
.stamp{display:inline-flex;align-items:center;gap:4px;padding:5px 11px;border-radius:9px;font-size:10px;font-weight:900;border:2px solid;transform:rotate(-1.5deg);flex-shrink:0}
.st-pend{background:#fef3c7;color:#d97706;border-color:#fcd34d}
.st-prog{background:#dbeafe;color:#1d4ed8;border-color:#93c5fd}
.st-done{background:#dcfce7;color:#16a34a;border-color:#86efac}
.st-rej{background:#fee2e2;color:#dc2626;border-color:#fca5a5}

/* BID */
.bid-c{border:1.5px solid var(--border);border-radius:12px;padding:14px;margin-bottom:8px;background:var(--white);transition:.15s}
.bid-c:hover{border-color:var(--p-m)}
.bid-c.bid-acc{border-color:#86efac;background:#f0fdf4}
.bid-c.bid-rej2{border-color:#fca5a5;background:#fff5f5;opacity:.7}
.bid-hd{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.bid-av{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--p),#a855f7);color:#fff;font-size:14px;font-weight:900;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.bid-name{font-size:13px;font-weight:800}
.bid-loc{font-size:10px;color:var(--muted)}
.bid-stars{color:var(--gold);font-size:12px}
.bid-info{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.bid-ii{background:var(--bg);border-radius:8px;padding:6px 12px;font-size:12px;font-weight:800;border:1px solid var(--border)}
.bid-ii span{color:var(--muted);font-weight:600;font-size:11px;margin-left:3px}
.bid-note{font-size:12px;color:#475569;background:var(--bg);padding:8px 12px;border-radius:8px;margin-bottom:8px;line-height:1.6;border-right:2px solid var(--p-m)}

/* MODAL */
.overlay{display:none;position:fixed;inset:0;background:rgba(8,3,22,.72);z-index:400;align-items:center;justify-content:center;backdrop-filter:blur(8px);padding:16px}
.overlay.show{display:flex}
.modal{background:var(--white);border-radius:20px;width:100%;max-width:640px;max-height:92vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.28)}
.modal::-webkit-scrollbar{width:4px}.modal::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
.modal-hd{display:flex;align-items:center;justify-content:space-between;padding:17px 22px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--white);z-index:2;border-radius:20px 20px 0 0}
.modal-hd-l{display:flex;align-items:center;gap:10px}
.modal-hd-ic{width:35px;height:35px;border-radius:10px;display:flex;align-items:center;justify-content:center}
.modal-hd-ic svg{width:17px;height:17px}
.modal-title{font-size:15px;font-weight:900}
.modal-x{width:32px;height:32px;border-radius:9px;background:var(--bg);border:1.5px solid var(--border);cursor:pointer;font-size:18px;color:var(--muted);display:flex;align-items:center;justify-content:center;transition:.15s}
.modal-x:hover{background:var(--red-l);border-color:var(--red);color:var(--red)}
.modal-body{padding:22px}
.modal-ft{display:flex;gap:8px;justify-content:flex-end;padding:14px 22px;border-top:1px solid var(--border);background:#fafbff;border-radius:0 0 20px 20px}

/* FORM */
.fg{display:flex;flex-direction:column;gap:5px;margin-bottom:13px}
.fl{font-size:11px;font-weight:800;color:var(--text)}
.fl-s{font-size:10px;color:var(--muted);font-weight:600;margin-right:4px}
.fi{padding:10px 13px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;background:var(--white);color:var(--text);transition:.15s;width:100%}
.fi:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(124,58,237,.08)}
.fsel2{padding:10px 13px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;background:var(--white);cursor:pointer;transition:.15s;width:100%}
.fsel2:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(124,58,237,.08)}
.fta{padding:10px 13px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;resize:vertical;min-height:85px;transition:.15s;width:100%}
.fta:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(124,58,237,.08)}
.f2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.f3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.fsec{font-size:11px;font-weight:800;color:var(--p);padding:8px 0 4px;border-bottom:2px solid var(--p-m);margin-bottom:12px}

/* SPECS */
.specs-wrap{border:1.5px solid var(--border);border-radius:11px;padding:12px;background:var(--bg)}
.specs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;max-height:210px;overflow-y:auto}
.spec-it{display:flex;align-items:center;gap:6px;padding:7px 10px;border:1.5px solid var(--border);border-radius:9px;cursor:pointer;transition:.15s;background:var(--white)}
.spec-it:hover{border-color:var(--p-m);background:var(--p-l)}
.spec-it.on{border-color:var(--p);background:var(--p-l)}
.spec-it input[type=checkbox]{width:14px;height:14px;accent-color:var(--p);cursor:pointer;flex-shrink:0}
.spec-it label{font-size:11px;font-weight:700;cursor:pointer;line-height:1.3}

/* IMAGE UPLOAD */
.img-up{border:2px dashed var(--border);border-radius:12px;padding:22px;text-align:center;cursor:pointer;transition:.2s;background:var(--bg);position:relative}
.img-up:hover{border-color:var(--p);background:var(--p-l)}
.img-up input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-up-ic{width:44px;height:44px;border-radius:12px;background:var(--p-l);display:flex;align-items:center;justify-content:center;margin:0 auto 8px}
.img-up-ic svg{width:21px;height:21px;stroke:var(--p)}
.img-up-text{font-size:12px;font-weight:700;color:var(--text);margin-bottom:3px}
.img-up-sub{font-size:10px;color:var(--muted)}
.imgs-prev{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.img-p{position:relative;width:80px;height:80px;border-radius:10px;overflow:hidden;border:2px solid var(--border)}
.img-p img{width:100%;height:100%;object-fit:cover}
.img-p-del{position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:var(--red);color:#fff;border:none;cursor:pointer;font-size:11px;display:flex;align-items:center;justify-content:center;font-weight:900}

/* INFO BLOCK */
.ib{background:var(--bg);border-radius:12px;padding:14px;margin-bottom:10px}
.ib-t{font-size:9px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px}
.ir{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border)}
.ir:last-child{border-bottom:none}
.ir-k{font-size:11px;color:var(--muted);font-weight:600}
.ir-v{font-size:12px;font-weight:800}

/* NOTIFY */
.ntargets{display:flex;gap:8px;flex-wrap:wrap}
.nt{padding:8px 15px;border-radius:10px;border:1.5px solid var(--border);background:var(--white);font-family:'Tajawal',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:.15s;display:flex;align-items:center;gap:5px}
.nt:hover{border-color:var(--p);color:var(--p)}
.nt.on{border-color:var(--p);background:var(--p);color:#fff}

/* TOAST */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(16px);background:#1e0545;color:#fff;padding:11px 22px;border-radius:14px;font-size:13px;font-weight:700;z-index:999;opacity:0;transition:.3s;pointer-events:none;box-shadow:0 8px 28px rgba(0,0,0,.2);display:flex;align-items:center;gap:8px}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* LOAD */
.loading{text-align:center;padding:44px;color:var(--muted)}
.spin{width:34px;height:34px;border:3px solid var(--p-m);border-top-color:var(--p);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 10px}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:44px 20px;color:var(--muted)}
.empty-ic{width:54px;height:54px;border-radius:15px;background:var(--bg);border:2px dashed var(--border);display:flex;align-items:center;justify-content:center;margin:0 auto 12px}
.empty-ic svg{width:24px;height:24px;stroke:var(--border)}
.empty h4{font-size:14px;font-weight:800;margin-bottom:4px}
.empty p{font-size:12px}

/* MOBILE */
.mob-btn{display:none;position:fixed;top:12px;left:12px;z-index:300;width:40px;height:40px;border-radius:11px;background:var(--p);border:none;cursor:pointer;align-items:center;justify-content:center;box-shadow:0 4px 14px rgba(124,58,237,.4)}
.mob-btn svg{width:18px;height:18px;stroke:#fff}
.mob-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:99}

/* PROJ DETAIL HEADER */
.pd-hd{background:linear-gradient(135deg,#130330,#2d0f6b);border-radius:14px;padding:20px;margin-bottom:14px}
.pd-num{font-size:10px;font-weight:800;color:rgba(255,255,255,.4);letter-spacing:1px;margin-bottom:5px}
.pd-title{font-size:17px;font-weight:900;color:#fff;margin-bottom:10px;line-height:1.3}
.pd-meta{display:flex;gap:8px;flex-wrap:wrap}
.pdm{font-size:11px;color:rgba(255,255,255,.6);background:rgba(255,255,255,.08);padding:4px 10px;border-radius:20px;font-weight:600}

/* GALLERY */
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:8px;margin-top:8px}
.gallery img{width:100%;height:88px;object-fit:cover;border-radius:10px;border:2px solid var(--border);cursor:pointer;transition:.15s}
.gallery img:hover{border-color:var(--p);transform:scale(1.03)}

@media(max-width:900px){
  .sidebar{transform:translateX(110%)}.sidebar.open{transform:translateX(0)}
  .main{margin-right:0}.mob-btn{display:flex}.mob-ov.show{display:block}
  .sgrid{grid-template-columns:repeat(2,1fr)}.content{padding:14px}
  .topbar{padding:0 14px}.f2{grid-template-columns:1fr}.f3{grid-template-columns:1fr 1fr}
  .specs-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<button class="mob-btn" onclick="toggleSb()">
  <svg viewBox="0 0 24 24" fill="none"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<div class="mob-ov" id="mobOv" onclick="toggleSb()"></div>

<nav class="sidebar" id="sb">
  <div class="sb-logo">
    <div class="sb-logo-row">
      <div class="sb-logo-ic">âš¡</div>
      <div>
        <div class="sb-brand">Ù…Ù†Ø§Ù‚ØµØ©<em>.</em></div>
        <div class="sb-brand-sub">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
      </div>
    </div>
  </div>
  <div class="sb-user">
    <div class="sb-av" id="sb-av">Ù…</div>
    <div>
      <div class="sb-uname" id="sb-name">Ø§Ù„Ù…Ø¯ÙŠØ±</div>
      <div class="sb-urole">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… â€¢ Ù…ØªØµÙ„</div>
    </div>
  </div>
  <div class="sb-nav">
    <div class="sb-sec">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <button class="sbi on" onclick="go('home',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg></div>
      <span class="sbi-lbl">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </button>
    <div class="sb-sec">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
    <button class="sbi" onclick="go('pending',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
      <span class="sbi-lbl">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
      <span class="sb-cnt" id="sb-pend">0</span>
    </button>
    <button class="sbi" onclick="go('requests',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
      <span class="sbi-lbl">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
    </button>
    <div class="sb-sec">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
    <button class="sbi" onclick="go('providers',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      <span class="sbi-lbl">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
    </button>
    <button class="sbi" onclick="go('clients',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
      <span class="sbi-lbl">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
    </button>
    <div class="sb-sec">Ø§Ù„ØªÙˆØ§ØµÙ„</div>
    <button class="sbi" onclick="go('notifs',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>
      <span class="sbi-lbl">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
    </button>
    <div class="sb-sec">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
    <button class="sbi" onclick="go('reviews',this)">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>
      <span class="sbi-lbl">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
    </button>
  </div>
  <div class="sb-bot">
    <button class="sbi" onclick="logout()" style="width:100%">
      <div class="sbi-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
      <span class="sbi-lbl">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
    </button>
  </div>
</nav>

<div class="main">
  <div class="topbar">
    <div class="tb-l">
      <div>
        <div class="tb-title" id="pg-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="tb-sub" id="pg-sub">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©</div>
      </div>
    </div>
    <div class="tb-r">
      <div class="tb-clock" id="clock">--:--:--</div>
      <button class="tb-btn" onclick="go('notifs',null)">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
      </button>
    </div>
  </div>
  <div class="content" id="content">
    <div class="loading"><div class="spin"></div></div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-hd">
      <div class="modal-hd-l">
        <div class="modal-hd-ic" id="m-ic"></div>
        <div class="modal-title" id="m-title">-</div>
      </div>
      <button class="modal-x" onclick="closeM()">Ã—</button>
    </div>
    <div class="modal-body" id="m-body"></div>
    <div class="modal-ft" id="m-ft"></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
var API='https://manaqasati-production.up.railway.app';
var token=localStorage.getItem('token');
var me=JSON.parse(localStorage.getItem('user')||'{}');
var curPage='home';
var allReqs=[],allUsers=[];
var uploadedImgs=[];

if(!token||me.role!=='admin'){window.location.href='auth.html';}

document.getElementById('sb-name').textContent=me.name||'Ø§Ù„Ù…Ø¯ÙŠØ±';
document.getElementById('sb-av').textContent=(me.name||'Ù…').charAt(0);
setInterval(function(){document.getElementById('clock').textContent=new Date().toLocaleTimeString('ar-SA');},1000);

// DATA
var CATS=['ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ','ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ø³Ø¨Ø§ÙƒØ©','Ù†Ø¬Ø§Ø±Ø©','ØªÙ†Ø¸ÙŠÙ','Ù†Ù‚Ù„ Ø¹ÙØ´','Ø­Ø¯Ø§Ø¯Ø©','Ø£Ù„Ù…Ù†ÙŠÙˆÙ…','Ù…Ø³Ø§Ø¨Ø­ (ØªÙ†ÙÙŠØ° ÙˆØµÙŠØ§Ù†Ø©)','ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ£Ù…Ù†','Ø´Ø¨ÙƒØ§Øª ÙˆØ¥Ù†ØªØ±Ù†Øª','Ù…Ø¸Ù„Ø§Øª ÙˆØ³ÙˆØ§ØªØ±','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ ÙˆØ£Ø³Ø·Ø­','Ø£Ø¨ÙˆØ§Ø¨','Ø£Ø¹Ù…Ø§Ù„ Ø¬Ø¨Ø³ ÙˆØ·Ø¨Ø§Ø´ÙŠØ±','Ù…ÙƒØ§ÙØ­Ø© Ø­Ø´Ø±Ø§Øª','Ø£Ø®Ø±Ù‰'];

var CITIES=['Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©','Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©','Ø§Ù„Ø¯Ù…Ø§Ù…','Ø§Ù„Ø®Ø¨Ø±','Ø§Ù„Ø¸Ù‡Ø±Ø§Ù†','Ø§Ù„Ø£Ø­Ø³Ø§Ø¡','Ø§Ù„Ø·Ø§Ø¦Ù','ØªØ¨ÙˆÙƒ','Ø¨Ø±ÙŠØ¯Ø©','Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·','Ø£Ø¨Ù‡Ø§','Ù†Ø¬Ø±Ø§Ù†','Ø¬ÙŠØ²Ø§Ù†','Ø­Ø§Ø¦Ù„','Ø§Ù„Ù‚ØµÙŠÙ…','ÙŠÙ†Ø¨Ø¹','Ø§Ù„Ø¬Ø¨ÙŠÙ„','Ø§Ù„Ù‚Ø·ÙŠÙ','Ø³ÙƒØ§ÙƒØ§','Ø¹Ø±Ø¹Ø±','Ø§Ù„Ø¨Ø§Ø­Ø©','Ø§Ù„Ø±Ø³','Ø±Ø§Ø¨Øº','Ø¨ÙŠØ´Ø©','ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±','Ø§Ù„Ø²Ù„ÙÙŠ'];

var SL={pending_review:'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',open:'Ù…ÙØªÙˆØ­',in_progress:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',completed:'Ù…ÙƒØªÙ…Ù„',rejected:'Ù…Ø±ÙÙˆØ¶'};
var ST={pending_review:'t-pend',open:'t-open',in_progress:'t-prog',completed:'t-done',rejected:'t-rej'};
var SC={pending_review:'pc-pend',open:'pc-open',in_progress:'pc-prog',completed:'pc-done',rejected:'pc-rej'};
var STAMPS={in_progress:'<div class="stamp st-prog">âœ“ ØªÙ… Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯</div>',completed:'<div class="stamp st-done">âœ“ Ù…ÙƒØªÙ…Ù„</div>',rejected:'<div class="stamp st-rej">âœ— Ù…Ø±ÙÙˆØ¶</div>'};
var BM={none:{c:'b-none',l:'Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…',i:'â€”'},verified:{c:'b-verified',l:'Ù…ÙˆØ«Ù‚',i:'âœ“'},star:{c:'b-star',l:'Ù…ØªÙ…ÙŠØ²',i:'â­'},partner:{c:'b-partner',l:'Ø´Ø±ÙŠÙƒ',i:'ğŸ’'},top:{c:'b-top',l:'Ø§Ù„Ø£ÙØ¶Ù„',i:'ğŸ†'}};
var COLORS=['#7c3aed','#2563eb','#16a34a','#d97706','#dc2626','#0891b2','#7e22ce','#0f766e'];

function api(path,opts){
  return fetch(API+path,Object.assign({headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'}},opts)).then(function(r){return r.json();});
}

function toast(msg,type){
  var t=document.getElementById('toast');
  var ic={success:'âœ…',error:'âŒ',info:'â„¹ï¸'};
  t.innerHTML=(ic[type]||'ğŸ’¬')+' '+msg;
  t.style.background=type==='error'?'#dc2626':type==='success'?'#16a34a':'#1e0545';
  t.className='toast show';
  setTimeout(function(){t.className='toast';},3500);
}

function closeM(){document.getElementById('overlay').className='overlay';}

function openM(title,body,ft,icHtml,icBg){
  document.getElementById('m-title').textContent=title;
  document.getElementById('m-body').innerHTML=body;
  document.getElementById('m-ft').innerHTML=ft||'';
  var ic=document.getElementById('m-ic');
  ic.innerHTML=icHtml||'';
  ic.style.background=icBg||'var(--p-l)';
  document.getElementById('overlay').className='overlay show';
}

function toggleSb(){
  document.getElementById('sb').classList.toggle('open');
  document.getElementById('mobOv').classList.toggle('show');
}

function logout(){localStorage.clear();window.location.href='auth.html';}

function go(page,btn){
  curPage=page;
  document.querySelectorAll('.sbi').forEach(function(i){i.classList.remove('on');});
  if(btn)btn.classList.add('on');
  var titles={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',pending:'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',requests:'ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',providers:'Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',clients:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',notifs:'Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',reviews:'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª'};
  var subs={home:'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©',pending:'Ù…Ø´Ø§Ø±ÙŠØ¹ ØªÙ†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚ØªÙƒ',requests:'Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù†ØµØ©',providers:'Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©',clients:'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',notifs:'ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',reviews:'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª'};
  document.getElementById('pg-title').textContent=titles[page]||page;
  document.getElementById('pg-sub').textContent=subs[page]||'';
  var pages={home:pgHome,pending:pgPending,requests:pgRequests,providers:pgProviders,clients:pgClients,notifs:pgNotifs,reviews:pgReviews};
  if(pages[page])pages[page]();
  document.getElementById('sb').classList.remove('open');
  document.getElementById('mobOv').classList.remove('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• CITY SELECT HTML â•â•â•â•â•â•â•â•â•â•â•â• */
function citySelect(id,val){
  return `<select class="fsel2" id="${id}">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
    ${CITIES.map(function(c){return`<option value="${c}" ${val===c?'selected':''}>${c}</option>`;}).join('')}
    <option value="Ø£Ø®Ø±Ù‰" ${val==='Ø£Ø®Ø±Ù‰'?'selected':''}>Ø£Ø®Ø±Ù‰</option>
  </select>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• SPECS CHECKBOXES â•â•â•â•â•â•â•â•â•â•â•â• */
function specsHTML(sel){
  return `<div class="specs-wrap"><div class="specs-grid">${CATS.map(function(c,i){
    var on=sel&&sel.includes(c);
    return `<div class="spec-it ${on?'on':''}" onclick="togSpec(this)">
      <input type="checkbox" id="sp${i}" value="${c}" ${on?'checked':''}>
      <label for="sp${i}">${c}</label>
    </div>`;
  }).join('')}</div></div>`;
}

function togSpec(el){
  el.classList.toggle('on');
  el.querySelector('input').checked=el.classList.contains('on');
}

function getSpecs(){
  return Array.from(document.querySelectorAll('.spec-it.on input')).map(function(i){return i.value;});
}

/* â•â•â•â•â•â•â•â•â•â•â•â• IMAGE UPLOAD â•â•â•â•â•â•â•â•â•â•â•â• */
function imgUploadHTML(id){
  return `<div class="img-up" id="img-up-${id}">
    <input type="file" accept="image/*" multiple onchange="handleImgs(this,'${id}')">
    <div class="img-up-ic"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div>
    <div class="img-up-text">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø±ÙØ¹</div>
    <div class="img-up-sub">PNG, JPG, WEBP â€” Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 ØµÙˆØ±</div>
  </div>
  <div class="imgs-prev" id="imgs-prev-${id}"></div>`;
}

var imgData={};

function handleImgs(input,id){
  var files=Array.from(input.files);
  if(!imgData[id])imgData[id]=[];
  files.forEach(function(f){
    if(imgData[id].length>=5)return;
    var r=new FileReader();
    r.onload=function(e){
      imgData[id].push({name:f.name,data:e.target.result});
      renderPrevs(id);
    };
    r.readAsDataURL(f);
  });
}

function renderPrevs(id){
  var el=document.getElementById('imgs-prev-'+id);if(!el)return;
  el.innerHTML=(imgData[id]||[]).map(function(img,i){
    return `<div class="img-p"><img src="${img.data}" alt=""><button class="img-p-del" onclick="delImg('${id}',${i})">Ã—</button></div>`;
  }).join('');
}

function delImg(id,i){
  imgData[id].splice(i,1);
  renderPrevs(id);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â• */
function pgHome(){
  document.getElementById('content').innerHTML='<div class="loading"><div class="spin"></div></div>';
  api('/api/admin/stats').then(function(s){
    document.getElementById('sb-pend').textContent=s.pending_review||0;
    var pct=function(a,b){return b?Math.round(a/b*100):0;};
    document.getElementById('content').innerHTML=`
      <div class="sgrid">
        <div class="sc"><div class="sc-top"><div class="sc-ic" style="background:var(--p-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div><span class="sc-badge up">â†‘ Ù†Ø´Ø·</span></div><div class="sc-num" style="color:var(--p)">${s.users||0}</div><div class="sc-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div><div class="sc-bar"><div class="sc-bar-f" style="width:100%;background:var(--p)"></div></div></div>
        <div class="sc"><div class="sc-top"><div class="sc-ic" style="background:var(--gold-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div><span class="sc-badge up">Ù…Ø²ÙˆØ¯ÙˆÙ†</span></div><div class="sc-num" style="color:var(--gold2)">${s.providers||0}</div><div class="sc-lbl">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div><div class="sc-bar"><div class="sc-bar-f" style="width:${pct(s.providers,s.users)}%;background:var(--gold)"></div></div></div>
        <div class="sc"><div class="sc-top"><div class="sc-ic" style="background:var(--blue-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><span class="sc-badge up">Ù…Ø´Ø§Ø±ÙŠØ¹</span></div><div class="sc-num" style="color:var(--blue)">${s.requests||0}</div><div class="sc-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="sc-bar"><div class="sc-bar-f" style="width:100%;background:var(--blue)"></div></div></div>
        <div class="sc"><div class="sc-top"><div class="sc-ic" style="background:var(--orange-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--orange)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><span class="sc-badge warn">âš  Ù…Ø¹Ù„Ù‚Ø©</span></div><div class="sc-num" style="color:var(--orange)">${s.pending_review||0}</div><div class="sc-lbl">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div class="sc-bar"><div class="sc-bar-f" style="width:${pct(s.pending_review,s.requests)}%;background:var(--orange)"></div></div></div>
        <div class="sc"><div class="sc-top"><div class="sc-ic" style="background:var(--green-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg></div><span class="sc-badge up">â†‘ Ù…Ù†Ø¬Ø²Ø©</span></div><div class="sc-num" style="color:var(--green)">${s.completed||0}</div><div class="sc-lbl">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙƒØªÙ…Ù„Ø©</div><div class="sc-bar"><div class="sc-bar-f" style="width:${pct(s.completed,s.requests)}%;background:var(--green)"></div></div></div>
        <div class="sc"><div class="sc-top"><div class="sc-ic" style="background:var(--p-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg></div><span class="sc-badge up">Ø¹Ø±ÙˆØ¶</span></div><div class="sc-num" style="color:var(--p)">${s.bids||0}</div><div class="sc-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶</div><div class="sc-bar"><div class="sc-bar-f" style="width:100%;background:var(--p-m)"></div></div></div>
      </div>
      <div style="display:grid;grid-template-columns:1.3fr 1fr;gap:16px">
        <div class="sec">
          <div class="sec-hd">
            <div class="sec-hd-l">
              <div class="sec-ic" style="background:var(--orange-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--orange)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
              <div><div class="sec-title">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div style="font-size:10px;color:var(--muted)">ØªØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚ØªÙƒ Ø§Ù„Ø¢Ù†</div></div>
            </div>
            <button class="btn btn-sm btn-p" onclick="go('pending',null)">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
          </div>
          <div class="sec-body" id="home-pend"></div>
        </div>
        <div class="sec">
          <div class="sec-hd">
            <div class="sec-hd-l">
              <div class="sec-ic" style="background:var(--blue-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div>
              <div class="sec-title">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</div>
            </div>
          </div>
          <div class="sec-body" id="home-act"></div>
        </div>
      </div>`;
    loadHomePend();
    loadHomeAct();
  });
}

function loadHomePend(){
  api('/api/admin/requests?status=pending_review').then(function(r){
    var el=document.getElementById('home-pend');if(!el)return;
    if(!r.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24" fill="none"><polyline points="20 6 9 17 4 12"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© âœ…</h4></div>';return;}
    el.innerHTML=r.slice(0,4).map(function(req){
      return `<div class="pc pc-pend" style="margin-bottom:10px">
        <div class="pc-hd"><div><div class="pc-num">${req.project_number||'#'+req.id}</div><div class="pc-title">${req.title}</div></div><div class="stamp st-pend">â³ Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div>
        <div class="pc-meta"><span class="pm">ğŸ‘¤ ${req.client_name}</span><span class="pm">ğŸ“ ${req.city||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span><span class="pm">ğŸ“‚ ${req.category||'Ø¹Ø§Ù…'}</span>${req.budget_max?`<span class="pm">ğŸ’° ${req.budget_max.toLocaleString()} Ø±.Ø³</span>`:''}</div>
        <div class="pc-acts">
          <button class="btn btn-sm btn-g" onclick="approveReq(${req.id})">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button>
          <button class="btn btn-sm btn-r" onclick="rejectReq(${req.id})">âœ— Ø±ÙØ¶</button>
          <button class="btn btn-sm btn-ghost" onclick="viewReq(${req.id})">ØªÙØ§ØµÙŠÙ„</button>
        </div></div>`;
    }).join('');
  });
}

function loadHomeAct(){
  api('/api/admin/requests').then(function(r){
    var el=document.getElementById('home-act');if(!el)return;
    if(!r.length){el.innerHTML='<div class="empty"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø· Ø¨Ø¹Ø¯</p></div>';return;}
    el.innerHTML=r.slice(0,7).map(function(req){
      var dot={open:'var(--green)',in_progress:'var(--blue)',completed:'var(--p)',pending_review:'var(--orange)',rejected:'var(--red)'}[req.status]||'var(--muted)';
      return `<div style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border)">
        <div style="width:8px;height:8px;border-radius:50%;background:${dot};flex-shrink:0"></div>
        <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${req.title}</div><div style="font-size:10px;color:var(--muted)">${req.client_name} â€¢ ${req.city||'â€”'}</div></div>
        <span class="tag ${ST[req.status]}" style="font-size:9px">${SL[req.status]}</span>
      </div>`;
    }).join('');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â• PENDING â•â•â•â•â•â•â•â•â•â•â•â• */
function pgPending(){
  document.getElementById('content').innerHTML=`
    <div class="sec">
      <div class="sec-hd"><div class="sec-hd-l"><div class="sec-ic" style="background:var(--orange-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--orange)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div><div class="sec-title">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div style="font-size:10px;color:var(--muted)">Ø±Ø§Ø¬Ø¹ ÙˆÙ‚Ø±Ø± Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø£Ùˆ Ø§Ù„Ø±ÙØ¶</div></div></div><span class="tag t-pend" id="pend-cnt">0 Ø·Ù„Ø¨</span></div>
      <div class="sec-body" id="pend-list"><div class="loading"><div class="spin"></div></div></div>
    </div>`;
  api('/api/admin/requests?status=pending_review').then(function(r){
    document.getElementById('pend-cnt').textContent=r.length+' Ø·Ù„Ø¨';
    document.getElementById('sb-pend').textContent=r.length;
    if(!r.length){document.getElementById('pend-list').innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24" fill="none"><polyline points="20 6 9 17 4 12"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</h4><p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ âœ…</p></div>';return;}
    document.getElementById('pend-list').innerHTML=r.map(function(req){
      return `<div class="pc pc-pend">
        <div class="pc-hd"><div><div class="pc-num">${req.project_number||'#'+req.id}</div><div class="pc-title">${req.title}</div></div><div class="stamp st-pend">â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div>
        <div class="pc-meta">
          <span class="pm">ğŸ‘¤ ${req.client_name}</span>
          <span class="pm">ğŸ“ ${req.city||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
          <span class="pm">ğŸ“‚ ${req.category||'Ø¹Ø§Ù…'}</span>
          ${req.budget_max?`<span class="pm">ğŸ’° ${req.budget_max.toLocaleString()} Ø±.Ø³</span>`:''}
          ${req.deadline?`<span class="pm">ğŸ“… ${req.deadline}</span>`:''}
          <span class="pm">ğŸ’¼ ${req.bid_count||0} Ø¹Ø±ÙˆØ¶</span>
          ${req.address?`<span class="pm">ğŸ“Œ ${req.address}</span>`:''}
        </div>
        ${req.description?`<div class="pc-desc">${req.description}</div>`:''}
        <div class="pc-acts">
          <button class="btn btn-g" onclick="approveReq(${req.id})">âœ“ Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†Ø´Ø±</button>
          <button class="btn btn-r" onclick="rejectReq(${req.id})">âœ— Ø±ÙØ¶</button>
          <button class="btn btn-ghost" onclick="editReqM(${req.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn btn-p" onclick="viewReq(${req.id})">ğŸ‘ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶</button>
        </div>
      </div>`;
    }).join('');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â• ALL REQUESTS â•â•â•â•â•â•â•â•â•â•â•â• */
function pgRequests(){
  document.getElementById('content').innerHTML=`
    <div class="sec">
      <div class="sec-hd">
        <div class="sec-hd-l"><div class="sec-ic" style="background:var(--blue-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><div class="sec-title">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div></div>
        <select class="fsel" id="rf-status" onchange="loadReqs()">
          <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="pending_review">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
          <option value="open">Ù…ÙØªÙˆØ­</option>
          <option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
          <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
          <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
        </select>
      </div>
      <div class="sec-body">
        <div class="search-row">
          <div class="sbox"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="rf-q" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." oninput="filterReqs()"></div>
          <select class="fsel" id="rf-city" onchange="filterReqs()">
            <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>
            ${CITIES.map(function(c){return`<option value="${c}">${c}</option>`;}).join('')}
          </select>
        </div>
        <div id="req-list"><div class="loading"><div class="spin"></div></div></div>
      </div>
    </div>`;
  loadReqs();
}

function loadReqs(){
  var st=(document.getElementById('rf-status')||{value:''}).value;
  api('/api/admin/requests'+(st?'?status='+st:'')).then(function(r){allReqs=r;filterReqs();});
}

function filterReqs(){
  var q=((document.getElementById('rf-q')||{}).value||'').toLowerCase();
  var city=((document.getElementById('rf-city')||{}).value||'');
  var f=allReqs.filter(function(r){
    var mq=!q||r.title.toLowerCase().includes(q)||(r.client_name||'').toLowerCase().includes(q)||(r.project_number||'').toLowerCase().includes(q)||(r.city||'').toLowerCase().includes(q);
    var mc=!city||r.city===city;
    return mq&&mc;
  });
  var el=document.getElementById('req-list');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h4></div>';return;}
  el.innerHTML=f.map(function(r){
    return `<div class="pc ${SC[r.status]||''}">
      <div class="pc-hd"><div><div class="pc-num">${r.project_number||'#'+r.id}</div><div class="pc-title">${r.title}</div></div>${STAMPS[r.status]||`<span class="tag ${ST[r.status]}">${SL[r.status]}</span>`}</div>
      <div class="pc-meta">
        <span class="pm">ğŸ‘¤ ${r.client_name}</span>
        ${r.provider_name?`<span class="pm" style="color:var(--green)">ğŸ”§ ${r.provider_name}</span>`:''}
        <span class="pm">ğŸ“ ${r.city||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
        ${r.address?`<span class="pm">ğŸ“Œ ${r.address}</span>`:''}
        <span class="pm">ğŸ“‚ ${r.category||'Ø¹Ø§Ù…'}</span>
        <span class="pm">ğŸ’¼ ${r.bid_count||0} Ø¹Ø±ÙˆØ¶</span>
        ${r.budget_max?`<span class="pm">ğŸ’° ${r.budget_max.toLocaleString()} Ø±.Ø³</span>`:''}
        ${r.deadline?`<span class="pm">ğŸ“… ${r.deadline}</span>`:''}
      </div>
      <div class="pc-acts">
        <button class="btn btn-sm btn-p" onclick="viewReq(${r.id})">ğŸ‘ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶</button>
        ${r.status==='pending_review'?`<button class="btn btn-sm btn-g" onclick="approveReq(${r.id})">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button><button class="btn btn-sm btn-r" onclick="rejectReq(${r.id})">âœ— Ø±ÙØ¶</button>`:''}
        ${r.status==='in_progress'?`<button class="btn btn-sm btn-gold" onclick="completeReq(${r.id})">âœ“ Ø¥ÙƒÙ…Ø§Ù„</button>`:''}
        <button class="btn btn-sm btn-ghost" onclick="editReqM(${r.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn btn-sm btn-r" onclick="delReq(${r.id})">ğŸ—‘</button>
      </div>
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• PROVIDERS â•â•â•â•â•â•â•â•â•â•â•â• */
function pgProviders(){
  document.getElementById('content').innerHTML=`
    <div class="sec">
      <div class="sec-hd">
        <div class="sec-hd-l"><div class="sec-ic" style="background:var(--p-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div><div class="sec-title">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div></div>
        <button class="btn btn-p" onclick="addUserM('provider')"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Ø¥Ø¶Ø§ÙØ© Ù…Ø²ÙˆØ¯</button>
      </div>
      <div class="sec-body">
        <div class="search-row">
          <div class="sbox"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="pf-q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." oninput="filterProvs()"></div>
          <select class="fsel" id="pf-cat" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>${CATS.map(function(c){return`<option value="${c}">${c}</option>`;}).join('')}</select>
          <select class="fsel" id="pf-city" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(function(c){return`<option value="${c}">${c}</option>`;}).join('')}</select>
          <select class="fsel" id="pf-badge" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆØ³Ù…Ø©</option><option value="none">Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…</option><option value="verified">Ù…ÙˆØ«Ù‚</option><option value="star">Ù…ØªÙ…ÙŠØ²</option><option value="partner">Ø´Ø±ÙŠÙƒ</option><option value="top">Ø§Ù„Ø£ÙØ¶Ù„</option></select>
        </div>
        <div id="prov-list"><div class="loading"><div class="spin"></div></div></div>
      </div>
    </div>`;
  api('/api/admin/users').then(function(u){allUsers=u.filter(function(x){return x.role==='provider';});filterProvs();});
}

function filterProvs(){
  var q=((document.getElementById('pf-q')||{}).value||'').toLowerCase();
  var cat=((document.getElementById('pf-cat')||{}).value||'');
  var city=((document.getElementById('pf-city')||{}).value||'');
  var badge=((document.getElementById('pf-badge')||{}).value||'');
  var f=allUsers.filter(function(u){
    var mq=!q||u.name.toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q)||(u.city||'').toLowerCase().includes(q);
    var mc=!cat||(u.specialties&&u.specialties.includes(cat));
    var mci=!city||u.city===city;
    var mb=!badge||(u.badge||'none')===badge;
    return mq&&mc&&mci&&mb;
  });
  var el=document.getElementById('prov-list');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><div class="empty-ic"><svg viewBox="0 0 24 24" fill="none"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙˆÙ†</h4></div>';return;}
  el.innerHTML=`<div class="tbl-wrap"><table class="tbl">
    <thead><tr><th>Ø§Ù„Ù…Ø²ÙˆØ¯</th><th>Ø§Ù„ØªØ®ØµØµØ§Øª</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ÙˆØ³Ø§Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
    <tbody>${f.map(function(u){
      var b=BM[u.badge||'none']||BM.none;
      var bg=COLORS[u.id%COLORS.length];
      var specs=u.specialties&&u.specialties.length?u.specialties.join(' â€¢ '):'â€”';
      return `<tr>
        <td><div style="display:flex;align-items:center;gap:10px">
          <div class="tbl-av" style="background:${bg}">${u.name.charAt(0)}</div>
          <div><div style="font-size:13px;font-weight:800">${u.name}</div><div style="font-size:10px;color:var(--muted)">${u.email}</div>${u.phone?`<div style="font-size:10px;color:var(--muted)">${u.phone}</div>`:''}</div>
        </div></td>
        <td style="font-size:11px;max-width:180px;line-height:1.7">${specs}</td>
        <td style="font-size:12px;font-weight:700">${u.city||'â€”'}</td>
        <td><span class="bc ${b.c}">${b.i} ${b.l}</span></td>
        <td><span class="tag ${u.is_active?'t-open':'t-rej'}">${u.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ'}</span></td>
        <td><div style="display:flex;gap:4px;flex-wrap:wrap">
          <button class="btn btn-xs btn-p" onclick="editUserM(${u.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn btn-xs btn-gold" onclick="setBadgeM(${u.id},'${u.name}')">ğŸ† ÙˆØ³Ø§Ù…</button>
          <button class="btn btn-xs ${u.is_active?'btn-r':'btn-g'}" onclick="togUser(${u.id})">${u.is_active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„'}</button>
          <button class="btn btn-xs btn-ghost" onclick="notifUserM(${u.id},'${u.name}')">ğŸ””</button>
          <button class="btn btn-xs btn-r" onclick="delUser(${u.id})">ğŸ—‘</button>
        </div></td>
      </tr>`;
    }).join('')}</tbody>
  </table></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• CLIENTS â•â•â•â•â•â•â•â•â•â•â•â• */
function pgClients(){
  document.getElementById('content').innerHTML=`
    <div class="sec">
      <div class="sec-hd">
        <div class="sec-hd-l"><div class="sec-ic" style="background:var(--blue-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><div class="sec-title">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div></div>
        <button class="btn btn-p" onclick="addUserM('client')"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
      </div>
      <div class="sec-body">
        <div class="search-row">
          <div class="sbox"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="cf-q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." oninput="filterClients()"></div>
          <select class="fsel" id="cf-city" onchange="filterClients()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(function(c){return`<option value="${c}">${c}</option>`;}).join('')}</select>
        </div>
        <div id="cli-list"><div class="loading"><div class="spin"></div></div></div>
      </div>
    </div>`;
  api('/api/admin/users').then(function(u){allUsers=u.filter(function(x){return x.role==='client';});filterClients();});
}

function filterClients(){
  var q=((document.getElementById('cf-q')||{}).value||'').toLowerCase();
  var city=((document.getElementById('cf-city')||{}).value||'');
  var f=allUsers.filter(function(u){
    var mq=!q||u.name.toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q)||(u.city||'').toLowerCase().includes(q);
    var mc=!city||u.city===city;
    return mq&&mc;
  });
  var el=document.getElementById('cli-list');if(!el)return;
  if(!f.length){el.innerHTML='<div class="empty"><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h4></div>';return;}
  el.innerHTML=`<div class="tbl-wrap"><table class="tbl">
    <thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
    <tbody>${f.map(function(u){
      var bg=COLORS[u.id%COLORS.length];
      var date=u.created_at?new Date(u.created_at).toLocaleDateString('ar-SA'):'â€”';
      return `<tr>
        <td><div style="display:flex;align-items:center;gap:10px"><div class="tbl-av" style="background:${bg}">${u.name.charAt(0)}</div><div><div style="font-size:13px;font-weight:800">${u.name}</div><div style="font-size:10px;color:var(--muted)">${u.email}</div></div></div></td>
        <td style="font-size:12px">${u.phone||'â€”'}</td>
        <td style="font-size:12px;font-weight:700">${u.city||'â€”'}</td>
        <td style="font-size:11px;color:var(--muted)">${date}</td>
        <td><span class="tag ${u.is_active?'t-open':'t-rej'}">${u.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ'}</span></td>
        <td><div style="display:flex;gap:4px">
          <button class="btn btn-xs btn-p" onclick="editUserM(${u.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn btn-xs ${u.is_active?'btn-r':'btn-g'}" onclick="togUser(${u.id})">${u.is_active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„'}</button>
          <button class="btn btn-xs btn-ghost" onclick="notifUserM(${u.id},'${u.name}')">ğŸ””</button>
          <button class="btn btn-xs btn-r" onclick="delUser(${u.id})">ğŸ—‘</button>
        </div></td>
      </tr>`;
    }).join('')}</tbody>
  </table></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â• */
function pgNotifs(){
  document.getElementById('content').innerHTML=`
    <div class="sec">
      <div class="sec-hd"><div class="sec-hd-l"><div class="sec-ic" style="background:var(--p-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div><div><div class="sec-title">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div><div style="font-size:10px;color:var(--muted)">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø£Ùˆ ÙØ¦Ø© Ù…Ø¹ÙŠÙ†Ø©</div></div></div></div>
      <div class="sec-body">
        <div class="fg"><div class="fl">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙˆÙ†</div><div class="ntargets" style="margin-top:8px">
          <button class="nt on" onclick="setNT(this,'')">ğŸ‘¥ Ø§Ù„ÙƒÙ„</button>
          <button class="nt" onclick="setNT(this,'provider')">ğŸ”§ Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ† ÙÙ‚Ø·</button>
          <button class="nt" onclick="setNT(this,'client')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙ‚Ø·</button>
        </div></div>
        <input type="hidden" id="nt-role" value="">
        <div class="fg"><label class="fl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="fl-s">*</span></label><input type="text" class="fi" id="nt-title" placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ù…Ù†ØµØ© Ù…Ù†Ø§Ù‚ØµØ©"></div>
        <div class="fg"><label class="fl">Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="fl-s">*</span></label><textarea class="fta" id="nt-body" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ ÙˆÙ…ÙØµÙ‘Ù„..."></textarea></div>
        <div style="display:flex;gap:10px;margin-top:4px">
          <button class="btn btn-p" onclick="sendNotif()"><svg viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</button>
          <button class="btn btn-ghost" onclick="document.getElementById('nt-title').value='';document.getElementById('nt-body').value=''">Ù…Ø³Ø­</button>
        </div>
      </div>
    </div>`;
}

function setNT(btn,role){
  document.querySelectorAll('.nt').forEach(function(b){b.className='nt';});
  btn.className='nt on';
  document.getElementById('nt-role').value=role;
}

function sendNotif(){
  var title=(document.getElementById('nt-title').value||'').trim();
  var body=(document.getElementById('nt-body').value||'').trim();
  var role=document.getElementById('nt-role').value;
  if(!title||!body){toast('Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Øµ','error');return;}
  api('/api/admin/notify',{method:'POST',body:JSON.stringify({title:title,body:body,role:role||undefined,type:'admin'})}).then(function(){
    toast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…','success');
    document.getElementById('nt-title').value='';
    document.getElementById('nt-body').value='';
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â• REVIEWS â•â•â•â•â•â•â•â•â•â•â•â• */
function pgReviews(){
  document.getElementById('content').innerHTML=`
    <div class="sec">
      <div class="sec-hd"><div class="sec-hd-l"><div class="sec-ic" style="background:var(--gold-l)"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div><div class="sec-title">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div></div></div>
      <div class="sec-body" id="rev-list"><div class="loading"><div class="spin"></div></div></div>
    </div>`;
  api('/api/admin/reviews').then(function(r){
    var el=document.getElementById('rev-list');
    if(!r||!r.length){el.innerHTML='<div class="empty"><h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯</h4></div>';return;}
    el.innerHTML=`<div class="tbl-wrap"><table class="tbl">
      <thead><tr><th>Ø§Ù„Ù…Ù‚ÙŠÙÙ‘Ù…</th><th>Ø§Ù„Ù…Ù‚ÙŠÙÙ‘Ù…</th><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
      <tbody>${r.map(function(rev){
        var date=rev.created_at?new Date(rev.created_at).toLocaleDateString('ar-SA'):'â€”';
        return `<tr>
          <td style="font-size:12px;font-weight:800">${rev.reviewer_name}</td>
          <td style="font-size:12px;font-weight:800">${rev.reviewed_name}</td>
          <td><div style="font-size:11px;font-weight:800;font-family:monospace;color:var(--p)">${rev.project_number||'#'+rev.request_id}</div></td>
          <td><span style="color:var(--gold);font-size:14px">${'â˜…'.repeat(rev.rating)}${'â˜†'.repeat(5-rev.rating)}</span> <span style="font-size:10px;color:var(--muted)">${rev.rating}/5</span></td>
          <td style="font-size:11px;color:#475569;max-width:200px">${rev.comment||'â€”'}</td>
          <td style="font-size:11px;color:var(--muted)">${date}</td>
          <td><button class="btn btn-xs btn-r" onclick="delReview(${rev.id})">ğŸ—‘ Ø­Ø°Ù</button></td>
        </tr>`;
      }).join('')}</tbody>
    </table></div>`;
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â• REQUEST ACTIONS â•â•â•â•â•â•â•â•â•â•â•â• */
function approveReq(id){
  api('/api/admin/requests/'+id+'/review',{method:'PUT',body:JSON.stringify({status:'open',admin_notes:'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±'})}).then(function(){
    toast('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†ÙØ´Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');
    if(curPage==='pending')pgPending();else if(curPage==='requests')loadReqs();else pgHome();
  });
}

function rejectReq(id){
  openM('Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div style="background:var(--red-l);border-radius:11px;padding:12px;margin-bottom:14px;display:flex;align-items:center;gap:8px"><svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg><span style="font-size:12px;color:var(--red);font-weight:700">Ø³ÙŠØµÙ„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù‚Ø±Ø§Ø± Ø§Ù„Ø±ÙØ¶ Ù…Ø¹ Ø§Ù„Ø³Ø¨Ø¨</span></div>
    <div class="fg"><label class="fl">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ <span class="fl-s">*</span></label><textarea class="fta" id="rej-reason" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ø¨ÙˆØ¶ÙˆØ­..."></textarea></div>`,
    `<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-r" onclick="doReject(${id})">âœ— ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶</button>`,
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2" width="17" height="17"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>','var(--red-l)'
  );
}

function doReject(id){
  var reason=(document.getElementById('rej-reason').value||'').trim()||'Ù„Ø§ ÙŠØ³ØªÙˆÙÙŠ Ø´Ø±ÙˆØ· Ø§Ù„Ù†Ø´Ø±';
  api('/api/admin/requests/'+id+'/review',{method:'PUT',body:JSON.stringify({status:'rejected',admin_notes:reason})}).then(function(){
    closeM();toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹','error');
    if(curPage==='pending')pgPending();else loadReqs();
  });
}

function completeReq(id){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†.'))return;
  api('/api/admin/requests/'+id+'/complete',{method:'PUT'}).then(function(){toast('ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');loadReqs();});
}

function delReq(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.'))return;
  api('/api/admin/requests/'+id,{method:'DELETE'}).then(function(){toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');loadReqs();});
}

function viewReq(id){
  api('/api/requests/'+id).then(function(r){
    api('/api/requests/'+id+'/bids').then(function(bids){
      var bHtml='';
      if(bids&&bids.length){
        bHtml=`<div class="ib"><div class="ib-t">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (${bids.length})</div>${bids.map(function(b){
          var stars=Math.round(b.avg_rating||0);
          var bClass=b.status==='accepted'?'bid-acc':b.status==='rejected'?'bid-rej2':'';
          return `<div class="bid-c ${bClass}">
            <div class="bid-hd">
              <div class="bid-av">${b.provider_name.charAt(0)}</div>
              <div style="flex:1">
                <div class="bid-name">${b.provider_name} ${b.status==='accepted'?'<span class="tag t-open" style="font-size:9px">âœ“ Ù…Ù‚Ø¨ÙˆÙ„</span>':b.status==='rejected'?'<span class="tag t-rej" style="font-size:9px">âœ— Ù…Ø±ÙÙˆØ¶</span>':''}</div>
                <div class="bid-loc">ğŸ“ ${b.provider_city||'â€”'} ${b.provider_phone?'â€¢ '+b.provider_phone:''}</div>
                <div class="bid-stars">${'â˜…'.repeat(stars)}${'â˜†'.repeat(5-stars)} <span style="font-size:10px;color:var(--muted)">(${b.review_count||0} ØªÙ‚ÙŠÙŠÙ…)</span></div>
              </div>
              ${b.status==='pending'?`<div style="display:flex;gap:4px;flex-shrink:0"><button class="btn btn-xs btn-g" onclick="accBid(${b.id},${r.id})">âœ“ Ù‚Ø¨ÙˆÙ„</button><button class="btn btn-xs btn-r" onclick="rejBid(${b.id},${r.id})">âœ— Ø±ÙØ¶</button></div>`:''}
            </div>
            <div class="bid-info"><div class="bid-ii"><span>Ø§Ù„Ø³Ø¹Ø±:</span>${b.price.toLocaleString()} Ø±.Ø³</div><div class="bid-ii"><span>Ø§Ù„Ù…Ø¯Ø©:</span>${b.days} ÙŠÙˆÙ…</div></div>
            ${b.note?`<div class="bid-note">${b.note}</div>`:''}
            ${b.provider_specialties&&b.provider_specialties.length?`<div style="font-size:10px;color:var(--muted)">Ø§Ù„ØªØ®ØµØµØ§Øª: ${b.provider_specialties.join(' â€¢ ')}</div>`:''}
          </div>`;
        }).join('')}</div>`;
      }else{bHtml='<div class="ib"><div style="text-align:center;color:var(--muted);font-size:12px;padding:12px">Ù„Ù… ÙŠÙÙ‚Ø¯ÙÙ‘Ù… Ø£ÙŠ Ø¹Ø±Ø¶ Ø¨Ø¹Ø¯</div></div>';}

      openM('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
        `<div style="background:linear-gradient(135deg,#130330,#2d0f6b);border-radius:14px;padding:18px;margin-bottom:14px">
          <div style="font-size:10px;font-weight:800;color:rgba(255,255,255,.38);letter-spacing:1px;margin-bottom:4px">Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>
          <div style="font-size:20px;font-weight:900;color:var(--gold);font-family:monospace;margin-bottom:8px">${r.project_number||'#'+r.id}</div>
          <div style="font-size:16px;font-weight:900;color:#fff;margin-bottom:10px;line-height:1.3">${r.title}</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag ${ST[r.status]}">${SL[r.status]}</span>
            <span style="font-size:11px;color:rgba(255,255,255,.5);background:rgba(255,255,255,.08);padding:3px 10px;border-radius:20px">ğŸ“‚ ${r.category||'â€”'}</span>
            ${r.city?`<span style="font-size:11px;color:rgba(255,255,255,.5);background:rgba(255,255,255,.08);padding:3px 10px;border-radius:20px">ğŸ“ ${r.city}</span>`:''}
          </div>
        </div>
        <div class="ib">
          <div class="ib-t">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>
          ${r.address?`<div class="ir"><span class="ir-k">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</span><span class="ir-v">ğŸ“Œ ${r.address}</span></div>`:''}
          <div class="ir"><span class="ir-k">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span><span class="ir-v">${r.city||'â€”'}</span></div>
          <div class="ir"><span class="ir-k">Ø§Ù„ØªØµÙ†ÙŠÙ</span><span class="ir-v">${r.category||'â€”'}</span></div>
          <div class="ir"><span class="ir-k">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰</span><span class="ir-v">${r.budget_max?r.budget_max.toLocaleString()+' Ø±.Ø³':'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></div>
          <div class="ir"><span class="ir-k">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><span class="ir-v">${r.deadline||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></div>
          <div class="ir"><span class="ir-k">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</span><span class="ir-v">${r.bid_count||0} Ø¹Ø±Ø¶</span></div>
        </div>
        <div class="ib">
          <div class="ib-t">Ø§Ù„Ø£Ø·Ø±Ø§Ù</div>
          <div class="ir"><span class="ir-k">ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span><span class="ir-v">${r.client_name} ${r.client_phone?'â€” '+r.client_phone:''}</span></div>
          ${r.provider_name?`<div class="ir"><span class="ir-k">Ø§Ù„Ù…Ø²ÙˆØ¯ Ø§Ù„Ù…ÙØ³Ù†Ø¯</span><span class="ir-v" style="color:var(--green)">ğŸ”§ ${r.provider_name} ${r.provider_phone?'â€” '+r.provider_phone:''}</span></div>`:''}
          ${r.assigned_at?`<div class="ir"><span class="ir-k">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯</span><span class="ir-v">${new Date(r.assigned_at).toLocaleDateString('ar-SA')}</span></div>`:''}
          ${r.completed_at?`<div class="ir"><span class="ir-k">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</span><span class="ir-v" style="color:var(--green)">${new Date(r.completed_at).toLocaleDateString('ar-SA')}</span></div>`:''}
        </div>
        ${r.description?`<div class="ib"><div class="ib-t">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div><div style="font-size:12px;line-height:1.8;color:#475569">${r.description}</div></div>`:''}
        ${r.admin_notes?`<div class="ib" style="background:var(--gold-l)"><div class="ib-t" style="color:var(--gold2)">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</div><div style="font-size:12px;line-height:1.7">${r.admin_notes}</div></div>`:''}
        ${bHtml}`,
        `${r.status==='pending_review'?`<button class="btn btn-g" onclick="closeM();approveReq(${r.id})">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button><button class="btn btn-r" onclick="closeM();rejectReq(${r.id})">âœ— Ø±ÙØ¶</button>`:''}
         ${r.status==='in_progress'?`<button class="btn btn-gold" onclick="closeM();completeReq(${r.id})">âœ“ Ø¥ÙƒÙ…Ø§Ù„</button>`:''}
         <button class="btn btn-ghost" onclick="closeM();editReqM(${r.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
         <button class="btn btn-ghost" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>`,
        '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2" width="17" height="17"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>','var(--p-l)'
      );
    });
  });
}

function accBid(bidId,reqId){
  api('/api/bids/'+bidId+'/accept',{method:'PUT'}).then(function(){toast('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');closeM();setTimeout(function(){viewReq(reqId);},300);});
}
function rejBid(bidId,reqId){
  api('/api/bids/'+bidId+'/reject',{method:'PUT'}).then(function(){toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¹Ø±Ø¶','error');closeM();setTimeout(function(){viewReq(reqId);},300);});
}

function editReqM(id){
  var r=allReqs.find(function(x){return x.id===id;});
  if(!r){api('/api/requests/'+id).then(function(r2){showEditReq(r2);});return;}
  showEditReq(r);
}

function showEditReq(r){
  imgData['req']=[];
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ â€” '+(r.project_number||'#'+r.id),
    `<div class="fsec">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>
    <div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span class="fl-s">*</span></label><input type="text" class="fi" id="er-title" value="${r.title}"></div>
    <div class="fg"><label class="fl">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><textarea class="fta" id="er-desc">${r.description||''}</textarea></div>
    <div class="f2">
      <div class="fg"><label class="fl">Ø§Ù„ØªØµÙ†ÙŠÙ</label><select class="fsel2" id="er-cat">${CATS.map(function(c){return`<option value="${c}" ${r.category===c?'selected':''}>${c}</option>`;}).join('')}</select></div>
      <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>${citySelect('er-city',r.city)}</div>
    </div>
    <div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ <span class="fl-s">(Ø­ÙŠØŒ Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰)</span></label><input type="text" class="fi" id="er-addr" value="${r.address||''}" placeholder="Ù…Ø«Ø§Ù„: Ø­ÙŠ Ø§Ù„Ù†Ø²Ù‡Ø©ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ØŒ Ù…Ø¨Ù†Ù‰ Ø±Ù‚Ù… 14"></div>
    <div class="f2">
      <div class="fg"><label class="fl">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰ (Ø±.Ø³)</label><input type="number" class="fi" id="er-budget" value="${r.budget_max||''}"></div>
      <div class="fg"><label class="fl">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label><input type="date" class="fi" id="er-deadline" value="${r.deadline||''}"></div>
    </div>
    <div class="fsec" style="margin-top:6px">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</div>
    <div class="fg"><textarea class="fta" id="er-notes" style="min-height:65px" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±...">${r.admin_notes||''}</textarea></div>
    <div class="fsec">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ù„Ù„Ù…Ø´Ø±ÙˆØ¹</div>
    ${imgUploadHTML('req')}`,
    `<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doEditReq(${r.id})">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>`,
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2" width="17" height="17"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>','var(--p-l)'
  );
}

function doEditReq(id){
  api('/api/admin/requests/'+id,{method:'PUT',body:JSON.stringify({
    title:document.getElementById('er-title').value,
    description:document.getElementById('er-desc').value,
    category:document.getElementById('er-cat').value,
    city:document.getElementById('er-city').value,
    address:document.getElementById('er-addr').value,
    budget_max:document.getElementById('er-budget').value||null,
    deadline:document.getElementById('er-deadline').value||null,
    admin_notes:document.getElementById('er-notes').value
  })}).then(function(){closeM();toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…','success');loadReqs();});
}

/* â•â•â•â•â•â•â•â•â•â•â•â• USER MODALS â•â•â•â•â•â•â•â•â•â•â•â• */
function addUserM(role){
  var isProv=role==='provider';
  imgData['user']=[];
  openM('Ø¥Ø¶Ø§ÙØ© '+(isProv?'Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':'Ø¹Ù…ÙŠÙ„'),
    `<div class="fsec">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
    <div class="f2">
      <div class="fg"><label class="fl">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="fl-s">*</span></label><input type="text" class="fi" id="nu-name" placeholder="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯"></div>
      <div class="fg"><label class="fl">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="fl-s">*</span></label><input type="email" class="fi" id="nu-email" placeholder="example@email.com"></div>
      <div class="fg"><label class="fl">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± <span class="fl-s">*</span></label><input type="password" class="fi" id="nu-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <div class="fg"><label class="fl">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="fi" id="nu-phone" placeholder="05xxxxxxxx"></div>
    </div>
    <div class="f2">
      <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>${citySelect('nu-city','')}</div>
      <div class="fg"><label class="fl">Ø§Ù„Ø¯ÙˆØ±</label><select class="fsel2" id="nu-role"><option value="client" ${!isProv?'selected':''}>Ø¹Ù…ÙŠÙ„</option><option value="provider" ${isProv?'selected':''}>Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©</option><option value="admin">Ù…Ø¯ÙŠØ±</option></select></div>
    </div>
    ${isProv?`
    <div class="fsec">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯</div>
    <div class="fg"><label class="fl">Ø§Ù„ØªØ®ØµØµØ§Øª <span class="fl-s">(Ø§Ø®ØªØ± ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø£Ùˆ Ø£ÙƒØ«Ø±)</span></label><div style="margin-top:6px">${specsHTML([])}</div></div>
    <div class="fg"><label class="fl">Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø²ÙˆØ¯</label><textarea class="fta" id="nu-bio" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù† Ø®Ø¨Ø±Ø© Ø§Ù„Ù…Ø²ÙˆØ¯ ÙˆÙ…Ø§ ÙŠÙ‚Ø¯Ù…Ù‡..."></textarea></div>
    <div class="fsec">ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© / ØµÙˆØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>
    ${imgUploadHTML('user')}`:''}`,
    `<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doAddUser()">âœ“ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>`,
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2" width="17" height="17"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>','var(--green-l)'
  );
}

function doAddUser(){
  var name=(document.getElementById('nu-name').value||'').trim();
  var email=(document.getElementById('nu-email').value||'').trim();
  var pass=document.getElementById('nu-pass').value;
  var role=document.getElementById('nu-role').value;
  if(!name||!email||!pass){toast('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©','error');return;}
  var specs=role==='provider'?getSpecs():[];
  var bio=document.getElementById('nu-bio')?document.getElementById('nu-bio').value:'';
  api('/api/admin/users',{method:'POST',body:JSON.stringify({
    name:name,email:email,password:pass,
    phone:(document.getElementById('nu-phone').value||''),
    city:(document.getElementById('nu-city').value||''),
    role:role,specialties:specs,bio:bio
  })}).then(function(u){
    if(u.message){toast(u.message,'error');return;}
    closeM();toast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… âœ…','success');
    if(curPage==='providers')pgProviders();else if(curPage==='clients')pgClients();
  });
}

function editUserM(id){
  var u=allUsers.find(function(x){return x.id===id;});
  if(!u){toast('Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…','error');return;}
  var isProv=u.role==='provider';
  imgData['uedit']=[];
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â€” '+u.name,
    `<div style="background:linear-gradient(135deg,#130330,#2d0f6b);border-radius:12px;padding:14px;display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:46px;height:46px;border-radius:13px;background:linear-gradient(135deg,var(--gold),var(--p));color:#fff;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center">${u.name.charAt(0)}</div>
      <div><div style="font-size:14px;font-weight:900;color:#fff">${u.name}</div><div style="font-size:11px;color:rgba(255,255,255,.45)">${u.email}</div></div>
    </div>
    <div class="fsec">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
    <div class="f2">
      <div class="fg"><label class="fl">Ø§Ù„Ø§Ø³Ù… <span class="fl-s">*</span></label><input type="text" class="fi" id="eu-name" value="${u.name}"></div>
      <div class="fg"><label class="fl">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="fi" id="eu-phone" value="${u.phone||''}"></div>
      <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>${citySelect('eu-city',u.city||'')}</div>
      <div class="fg"><label class="fl">Ø§Ù„Ø¯ÙˆØ±</label><select class="fsel2" id="eu-role" onchange="togProvFields(this.value)"><option value="client" ${u.role==='client'?'selected':''}>Ø¹Ù…ÙŠÙ„</option><option value="provider" ${u.role==='provider'?'selected':''}>Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©</option><option value="admin" ${u.role==='admin'?'selected':''}>Ù…Ø¯ÙŠØ±</option></select></div>
    </div>
    <div id="prov-fields" style="${isProv?'':'display:none'}">
      <div class="fsec">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯</div>
      <div class="fg"><label class="fl">Ø§Ù„ØªØ®ØµØµØ§Øª <span class="fl-s">(Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)</span></label><div style="margin-top:6px">${specsHTML(u.specialties||[])}</div></div>
      <div class="fg"><label class="fl">Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø²ÙˆØ¯</label><textarea class="fta" id="eu-bio">${u.bio||''}</textarea></div>
      <div class="fsec">ØµÙˆØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>
      ${imgUploadHTML('uedit')}
    </div>
    <div class="fsec">Ø§Ù„ÙˆØ³Ø§Ù… ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ©</div>
    <div class="f2">
      <div class="fg"><label class="fl">Ø§Ù„ÙˆØ³Ø§Ù…</label><select class="fsel2" id="eu-badge">
        <option value="none" ${(u.badge||'none')==='none'?'selected':''}>ğŸš« Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…</option>
        <option value="verified" ${u.badge==='verified'?'selected':''}>âœ“ Ù…ÙˆØ«Ù‚</option>
        <option value="star" ${u.badge==='star'?'selected':''}>â­ Ù…ØªÙ…ÙŠØ²</option>
        <option value="partner" ${u.badge==='partner'?'selected':''}>ğŸ’ Ø´Ø±ÙŠÙƒ</option>
        <option value="top" ${u.badge==='top'?'selected':''}>ğŸ† Ø§Ù„Ø£ÙØ¶Ù„</option>
      </select></div>
      <div class="fg"><label class="fl">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</label><select class="fsel2" id="eu-active">
        <option value="1" ${u.is_active!==false?'selected':''}>âœ… Ù†Ø´Ø·</option>
        <option value="0" ${u.is_active===false?'selected':''}>ğŸš« Ù…ÙˆÙ‚ÙˆÙ</option>
      </select></div>
    </div>`,
    `<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doEditUser(${id})">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>`,
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2" width="17" height="17"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>','var(--p-l)'
  );
}

function togProvFields(role){
  var el=document.getElementById('prov-fields');
  if(el)el.style.display=role==='provider'?'':'none';
}

function doEditUser(id){
  var u=allUsers.find(function(x){return x.id===id;})||{};
  var role=document.getElementById('eu-role').value;
  var specs=role==='provider'?getSpecs():(u.specialties||[]);
  var bio=document.getElementById('eu-bio')?document.getElementById('eu-bio').value:u.bio;
  var isActive=document.getElementById('eu-active').value==='1';
  api('/api/admin/users/'+id,{method:'PUT',body:JSON.stringify({
    name:document.getElementById('eu-name').value,
    phone:document.getElementById('eu-phone').value,
    city:document.getElementById('eu-city').value,
    role:role,badge:document.getElementById('eu-badge').value,
    is_active:isActive,specialties:specs,bio:bio
  })}).then(function(res){
    if(res.message&&!res.id){toast(res.message,'error');return;}
    closeM();toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…','success');
    if(curPage==='providers')pgProviders();else pgClients();
  });
}

function setBadgeM(userId,name){
  openM('ØªØ¹ÙŠÙŠÙ† ÙˆØ³Ø§Ù… â€” '+name,
    `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <button class="btn btn-ghost" style="justify-content:center;flex-direction:column;gap:5px;height:72px;font-size:13px" onclick="doSetBadge(${userId},'none')"><span style="font-size:22px">ğŸš«</span>Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø§Ù…</button>
      <button class="btn btn-b" style="justify-content:center;flex-direction:column;gap:5px;height:72px;font-size:13px" onclick="doSetBadge(${userId},'verified')"><span style="font-size:22px">âœ“</span>Ù…ÙˆØ«Ù‚</button>
      <button class="btn btn-gold" style="justify-content:center;flex-direction:column;gap:5px;height:72px;font-size:13px" onclick="doSetBadge(${userId},'star')"><span style="font-size:22px">â­</span>Ù…ØªÙ…ÙŠØ²</button>
      <button class="btn btn-p" style="justify-content:center;flex-direction:column;gap:5px;height:72px;font-size:13px" onclick="doSetBadge(${userId},'partner')"><span style="font-size:22px">ğŸ’</span>Ø´Ø±ÙŠÙƒ</button>
      <button class="btn btn-g" style="justify-content:center;flex-direction:column;gap:5px;height:72px;font-size:13px;grid-column:1/-1" onclick="doSetBadge(${userId},'top')"><span style="font-size:22px">ğŸ†</span>Ø§Ù„Ø£ÙØ¶Ù„</button>
    </div>`,'',
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="2" width="17" height="17"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>','var(--gold-l)'
  );
}

function doSetBadge(userId,badge){
  api('/api/admin/users/'+userId+'/badge',{method:'PUT',body:JSON.stringify({badge:badge})}).then(function(){
    closeM();toast('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ³Ø§Ù… âœ…','success');pgProviders();
  });
}

function togUser(id){
  api('/api/admin/users/'+id+'/toggle',{method:'PUT'}).then(function(u){
    toast(u.is_active?'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…':'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨','success');
    if(curPage==='providers')pgProviders();else pgClients();
  });
}

function delUser(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  api('/api/admin/users/'+id,{method:'DELETE'}).then(function(){
    toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');
    if(curPage==='providers')pgProviders();else pgClients();
  });
}

function notifUserM(userId,name){
  openM('Ø¥Ø´Ø¹Ø§Ø± Ø®Ø§Øµ Ù„Ù€ '+name,
    `<div class="fg"><label class="fl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="fl-s">*</span></label><input type="text" class="fi" id="un-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>
     <div class="fg"><label class="fl">Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="fl-s">*</span></label><textarea class="fta" id="un-body" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±..."></textarea></div>`,
    `<button class="btn btn-ghost" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="doNotifUser(${userId})">ğŸ”” Ø¥Ø±Ø³Ø§Ù„</button>`,
    '<svg viewBox="0 0 24 24" fill="none" stroke="var(--p)" stroke-width="2" width="17" height="17"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>','var(--p-l)'
  );
}

function doNotifUser(userId){
  var title=(document.getElementById('un-title').value||'').trim();
  var body=(document.getElementById('un-body').value||'').trim();
  if(!title||!body){toast('Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Øµ','error');return;}
  api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:userId,title:title,body:body,type:'admin'})}).then(function(){
    closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…','success');
  });
}

function delReview(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŸ'))return;
  api('/api/admin/reviews/'+id,{method:'DELETE'}).then(function(){toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');pgReviews();});
}

// CLOSE OVERLAY ON BACKGROUND CLICK
document.getElementById('overlay').addEventListener('click',function(e){if(e.target===this)closeM();});

// INIT
go('home',document.querySelector('.sbi.on'));
</script>
</body>
</html>
