<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€” Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS â€” SALLA INSPIRED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  /* Neutrals */
  --n0:#ffffff;
  --n50:#f8f9fb;
  --n100:#f1f3f7;
  --n150:#e8ecf2;
  --n200:#dde2ea;
  --n300:#c4ccd8;
  --n400:#98a2b3;
  --n500:#667085;
  --n600:#475467;
  --n700:#344054;
  --n800:#1d2939;
  --n900:#101828;

  /* Brand â€” Violet */
  --p50:#f5f3ff;
  --p100:#ede9fe;
  --p200:#ddd6fe;
  --p300:#c4b5fd;
  --p400:#a78bfa;
  --p500:#8b5cf6;
  --p600:#7c3aed;
  --p700:#6d28d9;

  /* Accent â€” Gold */
  --a50:#fffbeb;
  --a100:#fef3c7;
  --a400:#fbbf24;
  --a500:#f59e0b;
  --a600:#d97706;

  /* Semantic */
  --success-bg:#ecfdf5;--success-border:#a7f3d0;--success-text:#065f46;--success:#10b981;
  --warning-bg:#fffbeb;--warning-border:#fde68a;--warning-text:#92400e;--warning:#f59e0b;
  --error-bg:#fff1f2;--error-border:#fecdd3;--error-text:#9f1239;--error:#f43f5e;
  --info-bg:#eff6ff;--info-border:#bfdbfe;--info-text:#1e40af;--info:#3b82f6;

  /* Layout */
  --sb-w:260px;
  --tb-h:60px;

  /* Radius */
  --r4:4px;--r6:6px;--r8:8px;--r10:10px;--r12:12px;--r16:16px;--r20:20px;--r24:24px;--rfull:9999px;

  /* Shadow */
  --sh1:0 1px 2px rgba(16,24,40,.05);
  --sh2:0 1px 3px rgba(16,24,40,.1),0 1px 2px rgba(16,24,40,.06);
  --sh3:0 4px 8px -2px rgba(16,24,40,.1),0 2px 4px -2px rgba(16,24,40,.06);
  --sh4:0 12px 16px -4px rgba(16,24,40,.08),0 4px 6px -2px rgba(16,24,40,.03);
  --sh5:0 24px 48px -12px rgba(16,24,40,.18);

  /* Transition */
  --t1:80ms ease;--t2:150ms ease;--t3:250ms ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth}
body{
  font-family:'Tajawal',system-ui,sans-serif;
  font-size:14px;line-height:1.6;
  color:var(--n800);
  background:var(--n50);
  display:flex;min-height:100vh;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
button{font-family:inherit;cursor:pointer;border:none;background:none;outline:none;}
input,select,textarea{font-family:inherit;font-size:inherit;outline:none;}
a{text-decoration:none;color:inherit;}
img{max-width:100%;display:block;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--n200);border-radius:var(--rfull);}
::-webkit-scrollbar-thumb:hover{background:var(--n300);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sb{
  width:var(--sb-w);
  background:var(--n0);
  border-left:1px solid var(--n150);
  position:fixed;top:0;right:0;bottom:0;
  z-index:400;
  display:flex;flex-direction:column;
  transition:transform var(--t3);
  overflow:hidden;
}

/* Logo */
.sb-logo{
  height:var(--tb-h);
  display:flex;align-items:center;
  padding:0 20px;
  border-bottom:1px solid var(--n150);
  flex-shrink:0;gap:10px;
}
.logo-icon{
  width:34px;height:34px;
  border-radius:var(--r8);
  background:linear-gradient(135deg,var(--p600) 0%,var(--p400) 100%);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
  box-shadow:0 2px 8px rgba(124,58,237,.3);
}
.logo-icon svg{width:18px;height:18px;stroke:#fff;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;}
.logo-name{font-size:17px;font-weight:900;color:var(--n900);letter-spacing:-.5px;}
.logo-name b{color:var(--p600);font-weight:900;}
.logo-tag{font-size:9px;font-weight:700;background:var(--p100);color:var(--p700);padding:1px 7px;border-radius:var(--rfull);margin-right:2px;}

/* User Card */
.sb-user{
  margin:12px;
  background:var(--n50);
  border:1px solid var(--n150);
  border-radius:var(--r12);
  padding:12px;
  flex-shrink:0;
}
.sb-user-row{display:flex;align-items:center;gap:10px;}
.sb-av{
  width:38px;height:38px;border-radius:var(--r10);
  background:linear-gradient(135deg,var(--p600),var(--p400));
  color:#fff;font-size:15px;font-weight:800;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;letter-spacing:-.3px;
}
.sb-av-nm{font-size:13px;font-weight:700;color:var(--n800);line-height:1.3;}
.sb-av-role{font-size:10px;font-weight:600;color:var(--n400);margin-top:1px;}
.sb-online{display:flex;align-items:center;gap:5px;margin-top:8px;}
.online-dot{width:7px;height:7px;border-radius:50%;background:var(--success);flex-shrink:0;box-shadow:0 0 0 2px var(--success-bg);animation:onPulse 2.5s ease infinite;}
@keyframes onPulse{0%,100%{opacity:1;}50%{opacity:.5;}}
.online-txt{font-size:10px;font-weight:600;color:var(--success-text);}

/* Stats Strip */
.sb-strip{
  display:grid;grid-template-columns:repeat(3,1fr);
  border-top:1px solid var(--n150);
  border-bottom:1px solid var(--n150);
  flex-shrink:0;
}
.sb-strip-item{
  padding:10px 8px;text-align:center;
  border-left:1px solid var(--n150);
  position:relative;
}
.sb-strip-item:last-child{border-left:none;}
.ss-val{font-size:16px;font-weight:900;color:var(--n900);letter-spacing:-.4px;line-height:1;}
.ss-lbl{font-size:9px;font-weight:600;color:var(--n400);margin-top:3px;text-transform:uppercase;letter-spacing:.4px;}

/* Nav */
.sb-nav{flex:1;overflow-y:auto;padding:8px;scrollbar-width:none;}
.sb-nav::-webkit-scrollbar{display:none;}
.sb-section{font-size:9px;font-weight:700;color:var(--n300);letter-spacing:1px;text-transform:uppercase;padding:14px 10px 5px;}
.ni{
  display:flex;align-items:center;gap:10px;
  padding:9px 11px;border-radius:var(--r8);
  color:var(--n500);font-size:12.5px;font-weight:600;
  cursor:pointer;transition:all var(--t1);
  margin-bottom:1px;width:100%;text-align:right;
  position:relative;
}
.ni:hover{background:var(--n50);color:var(--n700);}
.ni.on{background:var(--p50);color:var(--p600);font-weight:700;}
.ni.on .ni-ic{background:var(--p100);}
.ni.on .ni-ic svg{stroke:var(--p600);}
.ni-ic{
  width:30px;height:30px;
  border-radius:var(--r6);
  background:transparent;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;transition:background var(--t1);
}
.ni-ic svg{width:15px;height:15px;stroke:var(--n400);fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;transition:stroke var(--t1);}
.ni:hover .ni-ic{background:var(--n100);}
.ni:hover .ni-ic svg{stroke:var(--n600);}
.ni-lbl{flex:1;}
.ni-badge{
  font-size:10px;font-weight:700;
  min-width:20px;height:20px;
  border-radius:var(--rfull);
  display:flex;align-items:center;justify-content:center;
  padding:0 6px;flex-shrink:0;
}
.nb-warn{background:var(--warning-bg);color:var(--warning-text);border:1px solid var(--warning-border);}
.nb-err{background:var(--error-bg);color:var(--error-text);border:1px solid var(--error-border);}
.nb-info{background:var(--info-bg);color:var(--info-text);border:1px solid var(--info-border);}
.nb-ok{background:var(--success-bg);color:var(--success-text);border:1px solid var(--success-border);}

/* Sidebar Bottom */
.sb-foot{padding:10px;border-top:1px solid var(--n150);flex-shrink:0;}
.sb-ver{text-align:center;font-size:9px;color:var(--n300);padding:6px 0 0;font-weight:600;letter-spacing:.3px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{
  margin-right:var(--sb-w);
  flex:1;display:flex;flex-direction:column;
  min-height:100vh;
  max-width:calc(100vw - var(--sb-w));
}

/* Topbar */
.topbar{
  height:var(--tb-h);
  background:var(--n0);
  border-bottom:1px solid var(--n150);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 24px;
  position:sticky;top:0;z-index:200;
  flex-shrink:0;
}
.bc{display:flex;align-items:center;gap:8px;}
.bc-home{color:var(--n400);font-size:12px;font-weight:600;}
.bc-sep{color:var(--n300);font-size:12px;}
.bc-cur{color:var(--n800);font-size:13px;font-weight:700;}
.tb-actions{display:flex;align-items:center;gap:8px;}
.tb-clock{
  font-size:11px;font-weight:700;
  color:var(--n500);
  background:var(--n50);
  border:1px solid var(--n150);
  border-radius:var(--r6);
  padding:5px 12px;
  font-variant-numeric:tabular-nums;
  letter-spacing:.5px;
}
.icon-btn{
  width:34px;height:34px;
  border-radius:var(--r8);
  border:1px solid var(--n200);
  background:var(--n0);
  display:flex;align-items:center;justify-content:center;
  color:var(--n500);cursor:pointer;
  transition:all var(--t1);position:relative;
}
.icon-btn:hover{background:var(--n50);border-color:var(--n300);color:var(--n700);}
.icon-btn svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;}
.notif-dot{position:absolute;top:5px;left:5px;width:7px;height:7px;border-radius:50%;background:var(--error);border:2px solid var(--n0);}

/* Page */
.page{padding:24px;flex:1;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pghd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px;gap:16px;flex-wrap:wrap;}
.pghd-left{}
.pg-title{font-size:22px;font-weight:800;color:var(--n900);letter-spacing:-.5px;line-height:1.25;}
.pg-sub{font-size:13px;color:var(--n400);margin-top:4px;font-weight:500;}
.pghd-right{display:flex;gap:8px;align-items:center;flex-shrink:0;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STAT CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:16px;margin-bottom:24px;}
.stat-card{
  background:var(--n0);
  border:1px solid var(--n150);
  border-radius:var(--r16);
  padding:20px;
  transition:box-shadow var(--t2),transform var(--t2);
  position:relative;overflow:hidden;
}
.stat-card:hover{box-shadow:var(--sh3);transform:translateY(-2px);}
.stat-card::after{content:'';position:absolute;top:0;right:0;width:3px;height:100%;border-radius:0 var(--r16) var(--r16) 0;background:var(--accent-color,var(--p600));}
.stat-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.stat-icon{width:40px;height:40px;border-radius:var(--r10);display:flex;align-items:center;justify-content:center;}
.stat-icon svg{width:18px;height:18px;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;}
.stat-trend{font-size:10px;font-weight:700;padding:2px 7px;border-radius:var(--rfull);}
.trend-up{background:var(--success-bg);color:var(--success-text);}
.trend-down{background:var(--error-bg);color:var(--error-text);}
.stat-val{font-size:28px;font-weight:900;color:var(--n900);letter-spacing:-.7px;line-height:1;margin-bottom:5px;}
.stat-lbl{font-size:12px;font-weight:600;color:var(--n500);}
.stat-bar{height:3px;background:var(--n100);border-radius:var(--rfull);margin-top:16px;overflow:hidden;}
.stat-fill{height:100%;border-radius:var(--rfull);background:var(--accent-color,var(--p600));transition:width 1.5s cubic-bezier(.4,0,.2,1);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{
  background:var(--n0);
  border:1px solid var(--n150);
  border-radius:var(--r16);
  overflow:hidden;
  margin-bottom:16px;
}
.card-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:16px 20px;
  border-bottom:1px solid var(--n100);
  gap:12px;flex-wrap:wrap;
}
.card-header-left{display:flex;align-items:center;gap:12px;}
.card-icon{
  width:34px;height:34px;border-radius:var(--r8);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.card-icon svg{width:15px;height:15px;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;}
.card-title{font-size:14px;font-weight:700;color:var(--n800);}
.card-sub{font-size:11px;color:var(--n400);margin-top:2px;font-weight:500;}
.card-header-right{display:flex;gap:7px;align-items:center;}
.card-body{padding:20px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:7px;
  padding:9px 18px;border-radius:var(--r8);
  font-size:13px;font-weight:700;line-height:1;
  cursor:pointer;border:none;
  transition:all var(--t1);white-space:nowrap;user-select:none;
  font-family:inherit;
}
.btn:active{transform:scale(.97);}
.btn svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;flex-shrink:0;}

/* Variants */
.btn-primary{background:var(--p600);color:#fff;box-shadow:0 1px 2px rgba(124,58,237,.2);}
.btn-primary:hover{background:var(--p700);box-shadow:0 4px 8px rgba(124,58,237,.3);}
.btn-success{background:var(--success);color:#fff;}
.btn-success:hover{background:#059669;}
.btn-danger{background:var(--error);color:#fff;}
.btn-danger:hover{background:#e11d48;}
.btn-warning{background:var(--a500);color:#fff;}
.btn-warning:hover{background:var(--a600);}
.btn-info{background:var(--info);color:#fff;}
.btn-info:hover{background:#2563eb;}
.btn-white{background:var(--n0);color:var(--n700);border:1px solid var(--n200);}
.btn-white:hover{background:var(--n50);border-color:var(--n300);}
.btn-ghost{background:var(--n100);color:var(--n600);}
.btn-ghost:hover{background:var(--n150);color:var(--n800);}
.btn-ghost-p{background:var(--p50);color:var(--p600);border:1px solid var(--p200);}
.btn-ghost-p:hover{background:var(--p100);}

/* Sizes */
.btn-sm{padding:6px 12px;font-size:12px;border-radius:var(--r6);gap:5px;}
.btn-sm svg{width:12px;height:12px;}
.btn-xs{padding:4px 9px;font-size:11px;border-radius:var(--r6);gap:4px;}
.btn-xs svg{width:11px;height:11px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.badge{
  display:inline-flex;align-items:center;gap:5px;
  padding:3px 10px;border-radius:var(--rfull);
  font-size:11px;font-weight:700;white-space:nowrap;
}
.badge::before{content:'';width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.badge-pending{background:var(--warning-bg);color:var(--warning-text);border:1px solid var(--warning-border);}
.badge-pending::before{background:var(--warning);}
.badge-open{background:var(--success-bg);color:var(--success-text);border:1px solid var(--success-border);}
.badge-open::before{background:var(--success);}
.badge-progress{background:var(--info-bg);color:var(--info-text);border:1px solid var(--info-border);}
.badge-progress::before{background:var(--info);}
.badge-done{background:var(--p50);color:var(--p700);border:1px solid var(--p200);}
.badge-done::before{background:var(--p600);}
.badge-rejected{background:var(--error-bg);color:var(--error-text);border:1px solid var(--error-border);}
.badge-rejected::before{background:var(--error);}
.badge-active{background:var(--success-bg);color:var(--success-text);border:1px solid var(--success-border);}
.badge-active::before{background:var(--success);}
.badge-inactive{background:var(--n100);color:var(--n500);border:1px solid var(--n200);}
.badge-inactive::before{background:var(--n400);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   META CHIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chip{
  display:inline-flex;align-items:center;gap:4px;
  padding:3px 9px;border-radius:var(--rfull);
  background:var(--n50);border:1px solid var(--n150);
  font-size:11px;font-weight:600;color:var(--n600);
}
.chip svg{width:10px;height:10px;stroke:currentColor;fill:none;stroke-width:2;flex-shrink:0;stroke-linecap:round;stroke-linejoin:round;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;align-items:center;}
.search-box{
  flex:1;min-width:220px;
  display:flex;align-items:center;gap:8px;
  background:var(--n0);border:1px solid var(--n200);
  border-radius:var(--r8);padding:0 13px;
  transition:all var(--t1);
}
.search-box:focus-within{border-color:var(--p400);box-shadow:0 0 0 3px rgba(124,58,237,.08);}
.search-box svg{width:14px;height:14px;stroke:var(--n300);fill:none;stroke-width:1.75;flex-shrink:0;stroke-linecap:round;stroke-linejoin:round;}
.search-box input{border:none;background:transparent;font-size:13px;padding:9px 0;flex:1;color:var(--n800);font-family:inherit;}
.search-box input::placeholder{color:var(--n300);}
.flt-sel{
  padding:9px 12px;border:1px solid var(--n200);border-radius:var(--r8);
  font-size:12px;font-weight:600;background:var(--n0);color:var(--n700);
  cursor:pointer;transition:border-color var(--t1);font-family:inherit;
}
.flt-sel:focus{border-color:var(--p400);box-shadow:0 0 0 3px rgba(124,58,237,.08);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROJECT CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.proj-card{
  background:var(--n0);border:1px solid var(--n150);
  border-radius:var(--r12);padding:18px 20px;
  margin-bottom:10px;
  transition:box-shadow var(--t2),border-color var(--t2);
  border-right:3px solid transparent;
}
.proj-card:hover{box-shadow:var(--sh3);border-color:var(--n200);}
.proj-card.st-pending{border-right-color:var(--warning);}
.proj-card.st-open{border-right-color:var(--success);}
.proj-card.st-progress{border-right-color:var(--info);}
.proj-card.st-done{border-right-color:var(--p600);}
.proj-card.st-rejected{border-right-color:var(--error);}
.proj-num{font-size:10px;font-weight:700;color:var(--n300);letter-spacing:.5px;font-variant-numeric:tabular-nums;margin-bottom:4px;text-transform:uppercase;}
.proj-title{font-size:15px;font-weight:800;color:var(--n900);line-height:1.35;letter-spacing:-.3px;}
.proj-meta{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0;}
.proj-desc{
  font-size:12.5px;color:var(--n500);line-height:1.7;
  padding:10px 14px;
  background:var(--n50);border-radius:var(--r8);
  border-right:2px solid var(--p200);
  margin-bottom:14px;
}
.proj-actions{display:flex;gap:7px;flex-wrap:wrap;align-items:center;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tbl-wrap{overflow-x:auto;}
.tbl{width:100%;border-collapse:collapse;min-width:620px;}
.tbl thead th{
  text-align:right;padding:11px 16px;
  font-size:11px;font-weight:700;color:var(--n400);
  background:var(--n50);border-bottom:1px solid var(--n150);
  white-space:nowrap;text-transform:uppercase;letter-spacing:.4px;
}
.tbl tbody td{padding:13px 16px;border-bottom:1px solid var(--n100);vertical-align:middle;}
.tbl tbody tr:last-child td{border-bottom:none;}
.tbl tbody tr{transition:background var(--t1);}
.tbl tbody tr:hover td{background:var(--n50);}
.tbl-av{width:32px;height:32px;border-radius:var(--r8);color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{
  display:none;position:fixed;inset:0;z-index:600;
  background:rgba(16,24,40,.4);
  backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
  align-items:center;justify-content:center;padding:20px;
}
.overlay.show{display:flex;}
.modal{
  background:var(--n0);border-radius:var(--r20);
  width:100%;max-width:680px;max-height:90vh;overflow-y:auto;
  box-shadow:var(--sh5);
  animation:modalIn .22s cubic-bezier(.34,1.56,.64,1);
}
@keyframes modalIn{from{opacity:0;transform:scale(.94) translateY(12px);}to{opacity:1;transform:scale(1) translateY(0);}}
.modal::-webkit-scrollbar{width:4px;}
.modal-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 22px;border-bottom:1px solid var(--n100);
  position:sticky;top:0;background:var(--n0);z-index:2;
  border-radius:var(--r20) var(--r20) 0 0;
}
.modal-header-left{display:flex;align-items:center;gap:12px;}
.modal-ico{width:34px;height:34px;border-radius:var(--r8);display:flex;align-items:center;justify-content:center;}
.modal-ico svg{width:15px;height:15px;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;}
.modal-title{font-size:15px;font-weight:800;color:var(--n900);letter-spacing:-.3px;}
.modal-close{
  width:30px;height:30px;border-radius:var(--r6);
  background:var(--n100);color:var(--n500);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;line-height:1;cursor:pointer;transition:all var(--t1);
}
.modal-close:hover{background:var(--error-bg);color:var(--error);}
.modal-body{padding:22px;}
.modal-footer{
  display:flex;gap:8px;justify-content:flex-end;
  padding:14px 22px;border-top:1px solid var(--n100);
  background:var(--n50);border-radius:0 0 var(--r20) var(--r20);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.form-group{display:flex;flex-direction:column;gap:6px;margin-bottom:16px;}
.form-label{font-size:12px;font-weight:700;color:var(--n700);}
.form-hint{color:var(--n300);font-weight:500;margin-right:4px;}
.form-input{
  padding:10px 13px;border:1.5px solid var(--n200);border-radius:var(--r8);
  font-size:13px;background:var(--n0);color:var(--n800);
  transition:all var(--t1);width:100%;font-family:inherit;
}
.form-input:focus{border-color:var(--p500);box-shadow:0 0 0 3px rgba(124,58,237,.08);}
.form-input::placeholder{color:var(--n300);}
.form-select{
  padding:10px 13px;border:1.5px solid var(--n200);border-radius:var(--r8);
  font-size:13px;background:var(--n0);color:var(--n800);
  cursor:pointer;width:100%;font-family:inherit;
  transition:all var(--t1);
}
.form-select:focus{border-color:var(--p500);box-shadow:0 0 0 3px rgba(124,58,237,.08);}
.form-textarea{
  padding:10px 13px;border:1.5px solid var(--n200);border-radius:var(--r8);
  font-size:13px;resize:vertical;min-height:90px;
  width:100%;color:var(--n800);line-height:1.6;font-family:inherit;
  transition:all var(--t1);
}
.form-textarea:focus{border-color:var(--p500);box-shadow:0 0 0 3px rgba(124,58,237,.08);}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}
.form-section{
  font-size:10px;font-weight:800;color:var(--p600);
  padding:12px 0 8px;border-bottom:1px solid var(--p100);
  margin:6px 0 16px;letter-spacing:.7px;text-transform:uppercase;
}

/* Specs */
.specs-wrap{border:1.5px solid var(--n200);border-radius:var(--r10);overflow:hidden;}
.specs-head{
  padding:10px 14px;background:var(--n50);border-bottom:1px solid var(--n150);
  display:flex;align-items:center;justify-content:space-between;
}
.specs-head-lbl{font-size:12px;font-weight:700;color:var(--n700);}
.specs-count{font-size:10px;font-weight:700;color:var(--p600);background:var(--p50);padding:2px 8px;border-radius:var(--rfull);border:1px solid var(--p100);}
.specs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;padding:8px;max-height:200px;overflow-y:auto;}
.spec-chip{
  display:flex;align-items:center;gap:7px;
  padding:7px 10px;border:1.5px solid var(--n150);border-radius:var(--r6);
  cursor:pointer;transition:all var(--t1);background:var(--n0);
}
.spec-chip:hover{border-color:var(--n300);background:var(--n50);}
.spec-chip.active{border-color:var(--p400);background:var(--p50);}
.spec-chip input{width:13px;height:13px;accent-color:var(--p600);cursor:pointer;flex-shrink:0;}
.spec-chip label{font-size:11px;font-weight:600;cursor:pointer;color:var(--n500);}
.spec-chip.active label{color:var(--p700);font-weight:700;}

/* Image Upload */
.img-upload{
  border:2px dashed var(--n200);border-radius:var(--r10);padding:24px;
  text-align:center;cursor:pointer;transition:all var(--t2);
  background:var(--n50);position:relative;
}
.img-upload:hover{border-color:var(--p400);background:var(--p50);}
.img-upload input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.img-upload-icon{width:44px;height:44px;border-radius:var(--r10);background:var(--p100);display:flex;align-items:center;justify-content:center;margin:0 auto 10px;}
.img-upload-icon svg{width:20px;height:20px;stroke:var(--p600);fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;}
.img-upload-title{font-size:13px;font-weight:700;color:var(--n700);margin-bottom:3px;}
.img-upload-sub{font-size:11px;color:var(--n400);}
.img-previews{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.img-preview{position:relative;width:76px;height:76px;border-radius:var(--r8);overflow:hidden;border:1.5px solid var(--n150);}
.img-preview img{width:100%;height:100%;object-fit:cover;}
.img-preview-del{position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:var(--error);color:#fff;border:none;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:800;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALERTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.alert{
  display:flex;align-items:flex-start;gap:10px;
  padding:12px 14px;border-radius:var(--r8);
  margin-bottom:14px;font-size:12.5px;line-height:1.5;font-weight:600;
}
.alert svg{width:15px;height:15px;flex-shrink:0;margin-top:1px;fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;}
.alert-info{background:var(--info-bg);border:1px solid var(--info-border);color:var(--info-text);}
.alert-info svg{stroke:var(--info);}
.alert-warn{background:var(--warning-bg);border:1px solid var(--warning-border);color:var(--warning-text);}
.alert-warn svg{stroke:var(--warning);}
.alert-ok{background:var(--success-bg);border:1px solid var(--success-border);color:var(--success-text);}
.alert-ok svg{stroke:var(--success);}
.alert-err{background:var(--error-bg);border:1px solid var(--error-border);color:var(--error-text);}
.alert-err svg{stroke:var(--error);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO ROWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-block{background:var(--n50);border-radius:var(--r10);padding:14px;margin-bottom:12px;border:1px solid var(--n100);}
.info-block-title{font-size:9px;font-weight:800;color:var(--n300);text-transform:uppercase;letter-spacing:.9px;margin-bottom:10px;}
.info-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--n100);}
.info-row:last-child{border-bottom:none;}
.info-key{font-size:12px;color:var(--n400);font-weight:600;}
.info-val{font-size:12px;font-weight:700;color:var(--n700);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;bottom:24px;left:50%;
  transform:translateX(-50%) translateY(20px);
  background:var(--n900);color:#fff;
  padding:12px 20px;border-radius:var(--r10);
  font-size:13px;font-weight:600;z-index:9999;
  opacity:0;transition:all .22s cubic-bezier(.34,1.56,.64,1);
  pointer-events:none;display:flex;align-items:center;gap:10px;
  box-shadow:var(--sh5);white-space:nowrap;
  font-family:'Tajawal',sans-serif;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast-icon{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:900;flex-shrink:0;}
.toast-ok{background:var(--success);}
.toast-err{background:var(--error);}
.toast-inf{background:var(--n700);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING / EMPTY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.loading-state{display:flex;flex-direction:column;align-items:center;padding:56px 24px;color:var(--n300);}
.spinner{width:30px;height:30px;border:2.5px solid var(--p100);border-top-color:var(--p600);border-radius:50%;animation:spin .7s linear infinite;margin-bottom:14px;}
@keyframes spin{to{transform:rotate(360deg);}}
.loading-txt{font-size:13px;font-weight:600;color:var(--n400);}
.empty-state{display:flex;flex-direction:column;align-items:center;padding:56px 24px;text-align:center;}
.empty-icon{width:56px;height:56px;border-radius:var(--r16);background:var(--n50);border:2px dashed var(--n200);display:flex;align-items:center;justify-content:center;margin-bottom:14px;}
.empty-icon svg{width:24px;height:24px;stroke:var(--n300);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round;}
.empty-title{font-size:15px;font-weight:800;color:var(--n700);margin-bottom:5px;}
.empty-sub{font-size:13px;color:var(--n400);font-weight:500;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog-row{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.prog-label{font-size:12px;font-weight:600;color:var(--n600);min-width:110px;text-align:right;}
.prog-track{flex:1;height:6px;background:var(--n100);border-radius:var(--rfull);overflow:hidden;}
.prog-bar{height:100%;border-radius:var(--rfull);transition:width 1.5s cubic-bezier(.4,0,.2,1);}
.prog-num{font-size:12px;font-weight:700;color:var(--n500);min-width:28px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOG ITEMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.log-item{display:flex;align-items:center;gap:12px;padding:9px 0;border-bottom:1px solid var(--n100);}
.log-item:last-child{border-bottom:none;}
.log-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.log-content{flex:1;}
.log-action{font-size:12.5px;font-weight:700;color:var(--n800);}
.log-detail{font-size:11px;color:var(--n400);font-weight:500;margin-top:1px;}
.log-time{font-size:10px;color:var(--n300);font-weight:600;flex-shrink:0;font-variant-numeric:tabular-nums;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVIEW CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.review-card{border:1.5px solid var(--n150);border-radius:var(--r12);padding:18px;margin-bottom:10px;background:var(--n0);transition:all var(--t2);}
.review-card:hover{box-shadow:var(--sh2);}
.review-card.flagged{border-color:var(--error-border);background:var(--error-bg);}
.rev-top{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:12px;}
.rev-av{width:34px;height:34px;border-radius:var(--r8);color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.rev-name{font-size:13px;font-weight:700;color:var(--n800);}
.rev-sub{font-size:11px;color:var(--n400);font-weight:500;margin-top:2px;}
.stars{font-size:14px;letter-spacing:1px;}
.rev-body{font-size:13px;color:var(--n600);background:var(--n50);padding:11px 14px;border-radius:var(--r8);line-height:1.7;border-right:2px solid var(--p200);margin-bottom:12px;}
.admin-reply-box{background:var(--p50);border:1px solid var(--p100);border-radius:var(--r8);padding:11px 14px;margin-bottom:12px;}
.reply-label{font-size:9px;font-weight:800;color:var(--p600);margin-bottom:5px;text-transform:uppercase;letter-spacing:.6px;}
.reply-body{font-size:12px;color:var(--p700);line-height:1.6;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISPUTE CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dispute-card{border:1.5px solid var(--n150);border-radius:var(--r12);padding:18px;margin-bottom:10px;background:var(--n0);border-right:3px solid var(--error);}
.dispute-card.resolved{border-right-color:var(--success);}
.disp-title{font-size:14px;font-weight:800;color:var(--n900);margin-bottom:4px;}
.disp-meta{font-size:11px;color:var(--n400);font-weight:600;margin-bottom:12px;}
.disp-desc{font-size:12.5px;color:var(--n500);line-height:1.7;background:var(--n50);padding:11px 14px;border-radius:var(--r8);margin-bottom:14px;}
.disp-parties{display:grid;grid-template-columns:1fr 40px 1fr;align-items:center;gap:8px;background:var(--n50);border-radius:var(--r10);padding:14px;margin-bottom:14px;border:1px solid var(--n100);}
.party-name{font-size:12px;font-weight:700;color:var(--n800);}
.party-role{font-size:10px;color:var(--n400);font-weight:600;margin-top:2px;}
.disp-vs{text-align:center;font-size:16px;color:var(--n300);}
.disp-resolution{background:var(--success-bg);border:1px solid var(--success-border);border-radius:var(--r8);padding:10px 14px;margin-bottom:12px;font-size:12.5px;color:var(--success-text);font-weight:600;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.setting-row{display:flex;align-items:center;gap:14px;padding:13px 0;border-bottom:1px solid var(--n100);}
.setting-row:last-child{border-bottom:none;}
.setting-info{flex:1;}
.setting-title{font-size:13px;font-weight:700;color:var(--n800);margin-bottom:2px;}
.setting-desc{font-size:11px;color:var(--n400);font-weight:500;}
.toggle{position:relative;flex-shrink:0;cursor:pointer;}
.toggle input{opacity:0;width:0;height:0;position:absolute;}
.toggle-track{width:40px;height:22px;border-radius:var(--rfull);background:var(--n200);transition:background var(--t2);position:relative;}
.toggle input:checked + .toggle-track{background:var(--success);}
.toggle-thumb{position:absolute;top:3px;right:3px;width:16px;height:16px;border-radius:50%;background:#fff;transition:right var(--t2);box-shadow:0 1px 3px rgba(16,24,40,.15);}
.toggle input:checked + .toggle-track .toggle-thumb{right:21px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFY TARGETS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.target-btns{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;}
.target-btn{
  padding:7px 18px;border-radius:var(--rfull);border:1.5px solid var(--n200);
  font-size:12.5px;font-weight:700;color:var(--n500);
  cursor:pointer;transition:all var(--t1);background:var(--n0);font-family:inherit;
}
.target-btn:hover{border-color:var(--n300);color:var(--n700);}
.target-btn.active{border-color:var(--p500);background:var(--p50);color:var(--p700);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.two-col{display:grid;grid-template-columns:1.4fr 1fr;gap:18px;}
.three-col{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
.divider{height:1px;background:var(--n100);margin:16px 0;}
.gap-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mob-menu-btn{
  display:none;position:fixed;top:12px;left:12px;z-index:500;
  width:38px;height:38px;border-radius:var(--r8);
  background:var(--p600);border:none;cursor:pointer;
  align-items:center;justify-content:center;box-shadow:var(--sh3);
}
.mob-menu-btn svg{width:17px;height:17px;stroke:#fff;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;}
.mob-overlay{display:none;position:fixed;inset:0;background:rgba(16,24,40,.4);z-index:300;}
@media(max-width:1024px){
  .sb{transform:translateX(110%);}
  .sb.open{transform:translateX(0);}
  .main{margin-right:0;}
  .mob-menu-btn{display:flex;}
  .mob-overlay.show{display:block;}
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .two-col{grid-template-columns:1fr;}
  .three-col{grid-template-columns:1fr;}
  .page{padding:14px;}
  .topbar{padding:0 16px;}
  .grid-2{grid-template-columns:1fr;}
  .grid-3{grid-template-columns:1fr;}
  .specs-grid{grid-template-columns:repeat(2,1fr);}
}
</style>
</head>
<body>

<button class="mob-menu-btn" onclick="openSb()">
  <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<div class="mob-overlay" id="mobOverlay" onclick="closeSb()"></div>

<!-- â•â• SIDEBAR â•â• -->
<aside class="sb" id="sb">

  <div class="sb-logo">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
    </div>
    <div>
      <div class="logo-name">Ù…Ù†Ø§Ù‚ØµØ©<b>.</b></div>
    </div>
    <div class="logo-tag">Admin</div>
  </div>

  <div class="sb-user">
    <div class="sb-user-row">
      <div class="sb-av" id="sbAv">Ù…</div>
      <div style="flex:1;min-width:0">
        <div class="sb-av-nm" id="sbNm">Ø§Ù„Ù…Ø¯ÙŠØ±</div>
        <div class="sb-av-role">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      </div>
    </div>
    <div class="sb-online">
      <div class="online-dot"></div>
      <span class="online-txt">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span>
    </div>
  </div>

  <div class="sb-strip">
    <div class="sb-strip-item">
      <div class="ss-val" id="sUsers">â€”</div>
      <div class="ss-lbl">Ù…Ø³ØªØ®Ø¯Ù…</div>
    </div>
    <div class="sb-strip-item">
      <div class="ss-val" id="sProjs">â€”</div>
      <div class="ss-lbl">Ù…Ø´Ø±ÙˆØ¹</div>
    </div>
    <div class="sb-strip-item">
      <div class="ss-val" id="sPend">â€”</div>
      <div class="ss-lbl">Ø§Ù†ØªØ¸Ø§Ø±</div>
    </div>
  </div>

  <nav class="sb-nav">
    <div class="sb-section">Ø¹Ø§Ù…</div>
    <button class="ni on" onclick="go('home',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </button>

    <div class="sb-section">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
    <button class="ni" onclick="go('pending',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
      <span class="ni-lbl">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
      <span class="ni-badge nb-warn" id="nbPend">0</span>
    </button>
    <button class="ni" onclick="go('projects',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
      <span class="ni-lbl">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
    </button>

    <div class="sb-section">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
    <button class="ni" onclick="go('providers',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg></div>
      <span class="ni-lbl">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
    </button>
    <button class="ni" onclick="go('clients',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
    </button>

    <div class="sb-section">Ø§Ù„ØªÙØ§Ø¹Ù„</div>
    <button class="ni" onclick="go('reviews',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>
      <span class="ni-lbl">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
      <span class="ni-badge nb-err" id="nbRevs" style="display:none">0</span>
    </button>
    <button class="ni" onclick="go('disputes',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</span>
      <span class="ni-badge nb-err" id="nbDisp" style="display:none">0</span>
    </button>
    <button class="ni" onclick="go('notifs',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>
      <span class="ni-lbl">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
    </button>

    <div class="sb-section">Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
    <button class="ni" onclick="go('reports',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div>
      <span class="ni-lbl">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
    </button>
    <button class="ni" onclick="go('log',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
      <span class="ni-lbl">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</span>
    </button>

    <div class="sb-section">Ø§Ù„Ù†Ø¸Ø§Ù…</div>
    <button class="ni" onclick="go('settings',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
    </button>
  </nav>

  <div class="sb-foot">
    <button class="ni" onclick="logout()" style="width:100%;color:var(--error);">
      <div class="ni-ic"><svg viewBox="0 0 24 24" style="stroke:var(--error)!important"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
      <span class="ni-lbl">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
    </button>
    <div class="sb-ver">Manaqasa Admin v3.0</div>
  </div>
</aside>

<!-- â•â• MAIN â•â• -->
<div class="main">
  <header class="topbar">
    <div class="bc">
      <span class="bc-home">Ù…Ù†Ø§Ù‚ØµØ©</span>
      <span class="bc-sep">/</span>
      <span class="bc-cur" id="pgTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="tb-actions">
      <div class="tb-clock" id="clk">--:--:--</div>
      <div class="icon-btn" onclick="go('notifs',null)" title="Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
        <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <div class="notif-dot" id="topDot" style="display:none"></div>
      </div>
    </div>
  </header>

  <main class="page" id="pg">
    <div class="loading-state"><div class="spinner"></div><div class="loading-txt">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div></div>
  </main>
</div>

<!-- â•â• MODAL â•â• -->
<div class="overlay" id="ov">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-ico" id="mIco"></div>
        <span class="modal-title" id="mTitle">â€”</span>
      </div>
      <button class="modal-close" onclick="closeM()">Ã—</button>
    </div>
    <div class="modal-body" id="mBody"></div>
    <div class="modal-footer" id="mFoot"></div>
  </div>
</div>

<div class="toast" id="toast">
  <div class="toast-icon" id="tIco"></div>
  <span id="tMsg"></span>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const API='https://manaqasati-production.up.railway.app';
const token=localStorage.getItem('token');
const me=JSON.parse(localStorage.getItem('user')||'{}');
if(!token||me.role!=='admin')location.href='auth.html';

let allReqs=[],allUsers=[],allRevs=[],allDisps=[];
let uploadedImgs={},actLog=[];

const CATS=['ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ','ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ø³Ø¨Ø§ÙƒØ©','Ù†Ø¬Ø§Ø±Ø©','ØªÙ†Ø¸ÙŠÙ','Ù†Ù‚Ù„ Ø¹ÙØ´','Ø­Ø¯Ø§Ø¯Ø©','Ø£Ù„Ù…Ù†ÙŠÙˆÙ…','Ù…Ø³Ø§Ø¨Ø­','ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø©','Ø´Ø¨ÙƒØ§Øª ÙˆØ¥Ù†ØªØ±Ù†Øª','Ù…Ø¸Ù„Ø§Øª ÙˆØ³ÙˆØ§ØªØ±','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ','Ø£Ø¨ÙˆØ§Ø¨','Ø¬Ø¨Ø³ ÙˆØ·Ø¨Ø§Ø´ÙŠØ±','Ù…ÙƒØ§ÙØ­Ø© Ø­Ø´Ø±Ø§Øª','Ø£Ø®Ø±Ù‰'];
const CITIES=['Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©','Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©','Ø§Ù„Ø¯Ù…Ø§Ù…','Ø§Ù„Ø®Ø¨Ø±','Ø§Ù„Ø¸Ù‡Ø±Ø§Ù†','Ø§Ù„Ø£Ø­Ø³Ø§Ø¡','Ø§Ù„Ø·Ø§Ø¦Ù','ØªØ¨ÙˆÙƒ','Ø¨Ø±ÙŠØ¯Ø©','Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·','Ø£Ø¨Ù‡Ø§','Ù†Ø¬Ø±Ø§Ù†','Ø¬ÙŠØ²Ø§Ù†','Ø­Ø§Ø¦Ù„','ÙŠÙ†Ø¨Ø¹','Ø§Ù„Ø¬Ø¨ÙŠÙ„','Ø§Ù„Ù‚Ø·ÙŠÙ','Ø³ÙƒØ§ÙƒØ§','Ø¹Ø±Ø¹Ø±','Ø§Ù„Ø¨Ø§Ø­Ø©','Ø§Ù„Ø±Ø³','Ø±Ø§Ø¨Øº','Ø¨ÙŠØ´Ø©','ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±','Ø§Ù„Ø²Ù„ÙÙŠ','Ø§Ù„Ù‚Ø±ÙŠØ§Øª'];
const AVC=['#7c3aed','#2563eb','#059669','#d97706','#e11d48','#0891b2','#7e22ce','#92400e'];
const SL={pending_review:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',open:'Ù…ÙØªÙˆØ­',in_progress:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',completed:'Ù…ÙƒØªÙ…Ù„',rejected:'Ù…Ø±ÙÙˆØ¶'};
const SB_CLS={pending_review:'badge-pending',open:'badge-open',in_progress:'badge-progress',completed:'badge-done',rejected:'badge-rejected'};
const PC_CLS={pending_review:'st-pending',open:'st-open',in_progress:'st-progress',completed:'st-done',rejected:'st-rejected'};
const BADGES={none:{label:'Ø¨Ø¯ÙˆÙ†',icon:'â€”'},verified:{label:'Ù…ÙˆØ«Ù‚',icon:'âœ“'},star:{label:'Ù…ØªÙ…ÙŠØ²',icon:'â­'},partner:{label:'Ø´Ø±ÙŠÙƒ',icon:'ğŸ’'},top:{label:'Ø§Ù„Ø£ÙØ¶Ù„',icon:'ğŸ†'}};

document.getElementById('sbAv').textContent=(me.name||'Ù…')[0];
document.getElementById('sbNm').textContent=me.name||'Ø§Ù„Ù…Ø¯ÙŠØ±';
setInterval(()=>{document.getElementById('clk').textContent=new Date().toLocaleTimeString('ar-SA',{hour12:false});},1000);

/* â”€â”€ UTILS â”€â”€ */
async function api(path,opts={}){
  try{const r=await fetch(API+path,{headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'},...opts});return await r.json();}
  catch{return{};}
}
let tTimer;
function toast(msg,type='info'){
  const el=document.getElementById('toast');
  const colors={success:'var(--success)',error:'var(--error)',info:'var(--n700)'};
  const icons={success:'âœ“',error:'âœ•',info:'i'};
  const iEl=document.getElementById('tIco');
  iEl.textContent=icons[type]||'i';
  iEl.className=`toast-icon toast-${type==='success'?'ok':type==='error'?'err':'inf'}`;
  document.getElementById('tMsg').textContent=msg;
  el.classList.add('show');
  clearTimeout(tTimer);
  tTimer=setTimeout(()=>el.classList.remove('show'),3500);
}
function openM(title,body,foot,iSvg,iBg='var(--p100)'){
  document.getElementById('mTitle').textContent=title;
  document.getElementById('mBody').innerHTML=body;
  document.getElementById('mFoot').innerHTML=foot||'';
  const ic=document.getElementById('mIco');
  ic.innerHTML=iSvg||'';ic.style.background=iBg;
  if(iSvg){const s=ic.querySelector('svg');if(s)s.style.cssText='width:15px;height:15px;fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round;';}
  document.getElementById('ov').classList.add('show');
}
function closeM(){document.getElementById('ov').classList.remove('show');}
function setPage(html){document.getElementById('pg').innerHTML=html;}
function loading(){setPage(`<div class="loading-state"><div class="spinner"></div><div class="loading-txt">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div></div>`);}
function openSb(){document.getElementById('sb').classList.add('open');document.getElementById('mobOverlay').classList.add('show');}
function closeSb(){document.getElementById('sb').classList.remove('open');document.getElementById('mobOverlay').classList.remove('show');}
function logout(){localStorage.clear();location.href='auth.html';}
function log(action,detail,color='var(--p600)'){actLog.unshift({action,detail,color,time:new Date().toLocaleTimeString('ar-SA',{hour12:false})});if(actLog.length>200)actLog.pop();}

function go(page,btn){
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('on'));
  if(btn)btn.classList.add('on');
  const titles={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',pending:'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',projects:'ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',providers:'Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',clients:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',reviews:'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',disputes:'Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª',notifs:'Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',reports:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',log:'Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'};
  document.getElementById('pgTitle').textContent=titles[page]||page;
  const pages={home:pgHome,pending:pgPending,projects:pgProjects,providers:pgProviders,clients:pgClients,reviews:pgReviews,disputes:pgDisputes,notifs:pgNotifs,reports:pgReports,log:pgLog,settings:pgSettings};
  if(pages[page])pages[page]();
  closeSb();
}

/* SVG helper */
function svg(paths,color='currentColor'){return `<svg viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">${paths}</svg>`;}
const IC={
  proj:`<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/>`,
  send:`<line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>`,
  star:`<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>`,
  check:`<polyline points="20 6 9 17 4 12"/>`,
  x:`<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>`,
  eye:`<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>`,
  edit:`<path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>`,
  trash:`<polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/>`,
  map:`<path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>`,
  folder:`<path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>`,
  dollar:`<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>`,
  zap:`<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>`,
  bell:`<path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/>`,
  user:`<path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/>`,
  img:`<rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>`,
  cal:`<rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>`,
  alert:`<path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>`,
  info:`<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>`,
  plus:`<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>`,
  shield:`<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>`,
  bars:`<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>`,
  save:`<path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>`,
  phone:`<path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.8a19.79 19.79 0 01-3.07-8.63A2 2 0 012 0h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 14.92z"/>`,
};

function ac(id){return AVC[(id||0)%AVC.length];}
function al(name){return (name||'ØŸ')[0];}
function stars(n){return[1,2,3,4,5].map(i=>`<span style="color:${i<=Math.round(n)?'#f59e0b':'#e5e7eb'}">â˜…</span>`).join('');}
function fdt(d){return d?new Date(d).toLocaleDateString('ar-SA'):'â€”';}
function fpr(p){return p?Number(p).toLocaleString('ar-SA')+' Ø±.Ø³':'â€”';}
function cityOpts(sel=''){return`<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>`+CITIES.map(c=>`<option value="${c}"${c===sel?' selected':''}>${c}</option>`).join('');}
function catOpts(sel=''){return`<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>`+CATS.map(c=>`<option value="${c}"${c===sel?' selected':''}>${c}</option>`).join('');}
function imgUp(id){return`<div class="img-upload"><input type="file" accept="image/*" multiple onchange="handleImgs(this,'${id}')"><div class="img-upload-icon">${svg(IC.img,'var(--p600)')}</div><div class="img-upload-title">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø±ÙØ¹</div><div class="img-upload-sub">PNG, JPG â€” Ø­ØªÙ‰ 5 ØµÙˆØ±</div></div><div class="img-previews" id="ipv_${id}"></div>`;}
function handleImgs(input,id){if(!uploadedImgs[id])uploadedImgs[id]=[];[...input.files].forEach(f=>{if(uploadedImgs[id].length>=5)return;const r=new FileReader();r.onload=e=>{uploadedImgs[id].push(e.target.result);renderPvs(id);};r.readAsDataURL(f);});}
function renderPvs(id){const el=document.getElementById(`ipv_${id}`);if(!el)return;el.innerHTML=(uploadedImgs[id]||[]).map((s,i)=>`<div class="img-preview"><img src="${s}"><button class="img-preview-del" onclick="delImg('${id}',${i})">Ã—</button></div>`).join('');}
function delImg(id,i){uploadedImgs[id].splice(i,1);renderPvs(id);}
function specsHtml(sel=[]){return`<div class="specs-wrap"><div class="specs-head"><span class="specs-head-lbl">Ø§Ù„ØªØ®ØµØµØ§Øª</span><span class="specs-count" id="spCnt">${sel.length} Ù…Ø­Ø¯Ø¯</span></div><div class="specs-grid">${CATS.map((c,i)=>{const on=sel.includes(c);return`<div class="spec-chip${on?' active':''}" onclick="togSpec(this)"><input type="checkbox" id="sp${i}" value="${c}"${on?' checked':''} onchange="updSpCnt()"><label for="sp${i}">${c}</label></div>`;}).join('')}</div></div>`;}
function togSpec(el){el.classList.toggle('active');el.querySelector('input').checked=el.classList.contains('active');updSpCnt();}
function updSpCnt(){const c=document.querySelectorAll('.spec-chip.active').length;const el=document.getElementById('spCnt');if(el)el.textContent=`${c} Ù…Ø­Ø¯Ø¯`;}
function getSpecs(){return[...document.querySelectorAll('.spec-chip.active input')].map(i=>i.value);}

function statCard(label,val,iconPaths,iconColor,iconBg,accentColor,pct){
  return`<div class="stat-card" style="--accent-color:${accentColor}">
    <div class="stat-top">
      <div class="stat-icon" style="background:${iconBg}">${svg(iconPaths,iconColor)}</div>
    </div>
    <div class="stat-val">${val}</div>
    <div class="stat-lbl">${label}</div>
    <div class="stat-bar"><div class="stat-fill" style="width:${Math.min(pct||0,100)}%"></div></div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgHome(){
  loading();
  const [stats,reqs]=await Promise.all([api('/api/admin/stats'),api('/api/admin/requests')]);
  const s=stats||{};allReqs=reqs||[];
  const pend=allReqs.filter(r=>r.status==='pending_review');

  document.getElementById('sUsers').textContent=s.total_users||0;
  document.getElementById('sProjs').textContent=allReqs.length;
  document.getElementById('sPend').textContent=pend.length;
  document.getElementById('nbPend').textContent=pend.length;

  setPage(`
    <div class="pghd">
      <div class="pghd-left">
        <div class="pg-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${me.name||'Ø§Ù„Ù…Ø¯ÙŠØ±'} ğŸ‘‹</div>
        <div class="pg-sub">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€” Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ù…Ù†ØµØ© Ù…Ù†Ø§Ù‚ØµØ©</div>
      </div>
      <div class="pghd-right">
        <button class="btn btn-white btn-sm" onclick="go('log',null)">${svg('<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>')} Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</button>
        <button class="btn btn-primary btn-sm" onclick="go('pending',null)">${svg('<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>')} Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      </div>
    </div>

    <div class="stats-grid">
      ${statCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',s.total_users||0,IC.user,'var(--p600)','var(--p50)','var(--p600)',100)}
      ${statCard('Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',s.providers||0,`<path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/>`,'#2563eb','#eff6ff','#2563eb',s.providers&&s.total_users?Math.round(s.providers/s.total_users*100):0)}
      ${statCard('Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø©',pend.length,IC.alert,'var(--warning)','var(--warning-bg)','var(--warning)',100)}
      ${statCard('Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙƒØªÙ…Ù„Ø©',s.completed||0,IC.check,'var(--success)','var(--success-bg)','var(--success)',allReqs.length?Math.round((s.completed||0)/allReqs.length*100):0)}
      ${statCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶',s.total_bids||0,IC.send,'#0891b2','#ecfeff','#0891b2',100)}
      ${statCard('Ù†Ø²Ø§Ø¹Ø§Øª Ù…ÙØªÙˆØ­Ø©',s.disputes||0,IC.alert,'var(--error)','var(--error-bg)','var(--error)',100)}
    </div>

    <div class="two-col">
      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:var(--warning-bg)">${svg(IC.alert,'var(--warning)')}</div>
            <div>
              <div class="card-title">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
              <div class="card-sub">${pend.length} Ù…Ø´Ø±ÙˆØ¹ ÙŠØ­ØªØ§Ø¬ Ù‚Ø±Ø§Ø±Ùƒ</div>
            </div>
          </div>
          ${pend.length?`<button class="btn btn-warning btn-sm" onclick="go('pending',null)">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>`:''}
        </div>
        <div class="card-body">
          ${pend.length?pend.slice(0,5).map(r=>`
            <div style="display:flex;align-items:center;justify-content:space-between;padding:11px 0;border-bottom:1px solid var(--n100)">
              <div style="flex:1;min-width:0;margin-left:12px">
                <div style="font-size:13px;font-weight:700;color:var(--n800);margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${r.title}</div>
                <div style="display:flex;gap:5px">
                  <span class="chip">${svg(IC.map)} ${r.city||'â€”'}</span>
                  <span class="chip">${svg(IC.folder)} ${r.category||'Ø¹Ø§Ù…'}</span>
                </div>
              </div>
              <div style="display:flex;gap:5px;flex-shrink:0">
                <button class="btn btn-success btn-xs" onclick="approveProj(${r.id})">${svg(IC.check)} Ù‚Ø¨ÙˆÙ„</button>
                <button class="btn btn-danger btn-xs" onclick="rejectModal(${r.id})">Ø±ÙØ¶</button>
              </div>
            </div>`).join(''):`
            <div class="empty-state" style="padding:28px">
              <div class="empty-icon">${svg(IC.check)}</div>
              <div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© âœ…</div>
            </div>`}
        </div>
      </div>

      <div>
        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--info-bg)">${svg(IC.bars,'var(--info)')}</div>
              <div class="card-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            </div>
          </div>
          <div class="card-body">
            ${[{l:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',k:'pending_review',c:'var(--warning)'},{l:'Ù…ÙØªÙˆØ­',k:'open',c:'var(--success)'},{l:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',k:'in_progress',c:'var(--info)'},{l:'Ù…ÙƒØªÙ…Ù„',k:'completed',c:'var(--p600)'},{l:'Ù…Ø±ÙÙˆØ¶',k:'rejected',c:'var(--error)'}].map(it=>{
              const cnt=s[it.k]||0;const pct=allReqs.length?Math.round(cnt/allReqs.length*100):0;
              return`<div class="prog-row"><div class="prog-label">${it.l}</div><div class="prog-track"><div class="prog-bar" style="width:${pct}%;background:${it.c}"></div></div><div class="prog-num">${cnt}</div></div>`;
            }).join('')}
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--p50)">${svg('<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>','var(--p600)')}</div>
              <div class="card-title">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</div>
            </div>
          </div>
          <div class="card-body" style="max-height:200px;overflow-y:auto">
            ${actLog.length?actLog.slice(0,8).map(l=>`<div class="log-item"><div class="log-dot" style="background:${l.color}"></div><div class="log-content"><div class="log-action">${l.action}</div><div class="log-detail">${l.detail}</div></div><div class="log-time">${l.time}</div></div>`).join(''):`<div class="empty-state" style="padding:20px"><div class="empty-sub">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø¨Ø¹Ø¯</div></div>`}
          </div>
        </div>
      </div>
    </div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PENDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgPending(){
  loading();
  const data=await api('/api/admin/requests?status=pending_review');
  const pend=data||[];
  document.getElementById('nbPend').textContent=pend.length;
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div class="pg-sub">${pend.length} Ù…Ø´Ø±ÙˆØ¹ ÙŠÙ†ØªØ¸Ø± Ù‚Ø±Ø§Ø±Ùƒ</div></div>
    </div>
    <div class="card"><div class="card-body">
      ${pend.length?pend.map(r=>projCard(r,true)).join(''):`<div class="empty-state"><div class="empty-icon">${svg(IC.check)}</div><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø¹Ù„Ù‚Ø© âœ…</div><div class="empty-sub">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§</div></div>`}
    </div></div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALL PROJECTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgProjects(){
  loading();
  const data=await api('/api/admin/requests');
  allReqs=data||[];
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="pg-sub">${allReqs.length} Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹</div></div>
    </div>
    <div class="card"><div class="card-body">
      <div class="filter-bar">
        <div class="search-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="pQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…â€¦" oninput="filterProjs()"></div>
        <select class="flt-sel" id="pSt" onchange="filterProjs()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="pending_review">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option><option value="open">Ù…ÙØªÙˆØ­</option><option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option value="completed">Ù…ÙƒØªÙ…Ù„</option><option value="rejected">Ù…Ø±ÙÙˆØ¶</option></select>
        <select class="flt-sel" id="pCat" onchange="filterProjs()"><option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>${CATS.map(c=>`<option>${c}</option>`).join('')}</select>
        <select class="flt-sel" id="pCit" onchange="filterProjs()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(c=>`<option>${c}</option>`).join('')}</select>
      </div>
      <div id="pList">${renderProjs(allReqs)}</div>
    </div></div>
  `);
}
function filterProjs(){
  const q=(document.getElementById('pQ')?.value||'').toLowerCase();
  const st=document.getElementById('pSt')?.value||'';
  const cat=document.getElementById('pCat')?.value||'';
  const cit=document.getElementById('pCit')?.value||'';
  const f=allReqs.filter(r=>(!q||r.title.toLowerCase().includes(q)||(r.project_number||'').toLowerCase().includes(q))&&(!st||r.status===st)&&(!cat||r.category===cat)&&(!cit||r.city===cit));
  const el=document.getElementById('pList');if(el)el.innerHTML=renderProjs(f);
}
function renderProjs(list){
  if(!list.length)return`<div class="empty-state"><div class="empty-icon">${svg(IC.proj)}</div><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>`;
  return list.map(r=>projCard(r,r.status==='pending_review')).join('');
}
function projCard(r,showApprove=false){
  return`<div class="proj-card ${PC_CLS[r.status]||''}">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px">
      <div><div class="proj-num">${r.project_number||'#'+r.id}</div><div class="proj-title">${r.title}</div></div>
      <span class="badge ${SB_CLS[r.status]||''}">${SL[r.status]||r.status}</span>
    </div>
    <div class="proj-meta">
      <span class="chip">${svg(IC.map)} ${r.city||'â€”'}</span>
      <span class="chip">${svg(IC.folder)} ${r.category||'Ø¹Ø§Ù…'}</span>
      ${r.budget_max?`<span class="chip">${svg(IC.dollar)} ${Number(r.budget_max).toLocaleString()} Ø±.Ø³</span>`:''}
      ${r.deadline?`<span class="chip">${svg(IC.cal)} ${r.deadline}</span>`:''}
      <span class="chip">${svg(IC.send)} ${r.bid_count||0} Ø¹Ø±Ø¶</span>
      ${r.client_name?`<span class="chip">${svg(IC.user)} ${r.client_name}</span>`:''}
    </div>
    ${r.description?`<div class="proj-desc">${r.description.slice(0,200)}${r.description.length>200?'â€¦':''}</div>`:''}
    <div class="proj-actions">
      ${showApprove?`<button class="btn btn-success btn-sm" onclick="approveProj(${r.id})">${svg(IC.check)} Ù‚Ø¨ÙˆÙ„ ÙˆÙ†Ø´Ø±</button><button class="btn btn-danger btn-sm" onclick="rejectModal(${r.id})">${svg(IC.x)} Ø±ÙØ¶</button>`:''}
      <button class="btn btn-ghost btn-sm" onclick="viewProjModal(${r.id})">${svg(IC.eye)} Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
      <button class="btn btn-ghost-p btn-sm" onclick="editProjModal(${r.id})">${svg(IC.edit)} ØªØ¹Ø¯ÙŠÙ„</button>
      ${r.status==='open'?`<button class="btn btn-info btn-sm" onclick="assignModal(${r.id})">Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ</button>`:''}
      ${r.status==='in_progress'?`<button class="btn btn-success btn-sm" onclick="completeProj(${r.id})">ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØªÙ…Ù„</button>`:''}
      <button class="btn btn-danger btn-sm" onclick="deleteProj(${r.id})">${svg(IC.trash)}</button>
    </div>
  </div>`;
}

/* Project actions */
async function approveProj(id){
  await api(`/api/admin/requests/${id}/review`,{method:'PUT',body:JSON.stringify({action:'approve'})});
  toast('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');log('Ù‚Ø¨ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--success)');
  document.getElementById('pgTitle').textContent==='Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'?pgPending():pgProjects();
}
function rejectModal(id){
  openM('Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div class="alert alert-err">${svg(IC.alert,'var(--error)')} Ø³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ù„Ø±ÙØ¶</div>
     <div class="form-group"><label class="form-label">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</label><textarea class="form-textarea" id="rejR" placeholder="Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶â€¦"></textarea></div>`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-danger" onclick="confirmReject(${id})">${svg(IC.x)} ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--error)">${IC.x}</svg>`,'var(--error-bg)'
  );
}
async function confirmReject(id){
  const reason=document.getElementById('rejR')?.value||'';
  await api(`/api/admin/requests/${id}/review`,{method:'PUT',body:JSON.stringify({action:'reject',reason})});
  closeM();toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹','error');log('Ø±ÙØ¶ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--error)');pgPending();
}
async function completeProj(id){
  if(!confirm('ØªØ¹ÙŠÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒÙ…ÙƒØªÙ…Ù„ØŸ'))return;
  await api(`/api/admin/requests/${id}/complete`,{method:'PUT'});
  toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…','success');log('Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--p600)');pgProjects();
}
async function deleteProj(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  await api(`/api/admin/requests/${id}`,{method:'DELETE'});
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');log('Ø­Ø°Ù Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--error)');pgProjects();
}
async function viewProjModal(id){
  const [r,bids]=await Promise.all([api(`/api/requests/${id}`),api(`/api/requests/${id}/bids`)]);
  const bl=bids||[];
  openM('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div style="background:var(--n900);border-radius:var(--r12);padding:18px;margin-bottom:18px">
       <div style="font-size:10px;font-weight:700;color:rgba(255,255,255,.3);letter-spacing:1px;margin-bottom:5px">${r.project_number||'#'+r.id}</div>
       <div style="font-size:16px;font-weight:800;color:#fff;margin-bottom:12px;line-height:1.3">${r.title}</div>
       <div style="display:flex;gap:6px;flex-wrap:wrap">
         <span class="badge ${SB_CLS[r.status]||''}">${SL[r.status]||r.status}</span>
         ${r.category?`<span style="font-size:10px;color:rgba(255,255,255,.4);background:rgba(255,255,255,.08);padding:2px 10px;border-radius:var(--rfull)">ğŸ“‚ ${r.category}</span>`:''}
         ${r.city?`<span style="font-size:10px;color:rgba(255,255,255,.4);background:rgba(255,255,255,.08);padding:2px 10px;border-radius:var(--rfull)">ğŸ“ ${r.city}</span>`:''}
       </div>
     </div>
     <div class="info-block">
       <div class="info-block-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ø¹Ù…ÙŠÙ„</span><span class="info-val">${r.client_name||'â€”'}</span></div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span><span class="info-val" style="color:var(--success)">${fpr(r.budget_max)}</span></div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><span class="info-val">${r.deadline||'â€”'}</span></div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span><span class="info-val">${r.address||'â€”'}</span></div>
       <div class="info-row"><span class="info-key">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</span><span class="info-val">${bl.length}</span></div>
       <div class="info-row"><span class="info-key">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</span><span class="info-val">${fdt(r.created_at)}</span></div>
     </div>
     ${r.description?`<div class="info-block"><div class="info-block-title">Ø§Ù„ÙˆØµÙ</div><div style="font-size:13px;line-height:1.8;color:var(--n600)">${r.description}</div></div>`:''}`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.eye}</svg>`,'var(--p100)'
  );
}
function editProjModal(id){
  const r=allReqs.find(x=>x.id===id)||{};
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div class="form-group"><label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" class="form-input" id="eTi" value="${r.title||''}"></div>
     <div class="grid-2">
       <div class="form-group"><label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ</label><select class="form-select" id="eCat">${catOpts(r.category)}</select></div>
       <div class="form-group"><label class="form-label">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" class="form-input" id="eBg" value="${r.budget_max||''}"></div>
     </div>
     <div class="form-group"><label class="form-label">Ø§Ù„ÙˆØµÙ</label><textarea class="form-textarea" id="eDsc">${r.description||''}</textarea></div>
     <div class="grid-2">
       <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="form-select" id="eCit">${cityOpts(r.city)}</select></div>
       <div class="form-group"><label class="form-label">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label><input type="date" class="form-input" id="eDl" value="${r.deadline||''}"></div>
     </div>`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-primary" onclick="saveEditProj(${id})">${svg(IC.save)} Ø­ÙØ¸</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.edit}</svg>`,'var(--p100)'
  );
}
async function saveEditProj(id){
  const body={title:document.getElementById('eTi')?.value?.trim(),category:document.getElementById('eCat')?.value,description:document.getElementById('eDsc')?.value?.trim(),budget_max:document.getElementById('eBg')?.value?parseFloat(document.getElementById('eBg').value):null,city:document.getElementById('eCit')?.value,deadline:document.getElementById('eDl')?.value||null};
  if(!body.title){toast('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨','error');return;}
  await api(`/api/admin/requests/${id}`,{method:'PUT',body:JSON.stringify(body)});
  closeM();toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success');log('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'#2563eb');pgProjects();
}
function assignModal(reqId){
  openM('Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ Ù„Ù…Ø²ÙˆØ¯',
    `<div class="alert alert-info">${svg(IC.info,'var(--info)')} Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø²ÙˆØ¯ ÙˆØ§Ù„Ø³Ø¹Ø± Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
     <div class="grid-2">
       <div class="form-group"><label class="form-label">ID Ø§Ù„Ù…Ø²ÙˆØ¯</label><input type="number" class="form-input" id="asPr" placeholder="Ù…Ø«Ø§Ù„: 42"></div>
       <div class="form-group"><label class="form-label">Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³)</label><input type="number" class="form-input" id="asPc" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡"></div>
     </div>`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-primary" onclick="confirmAssign(${reqId})">${svg(IC.check)} Ø¥Ø³Ù†Ø§Ø¯</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.user}</svg>`,'var(--p100)'
  );
}
async function confirmAssign(reqId){
  const provId=document.getElementById('asPr')?.value;
  const price=document.getElementById('asPc')?.value;
  if(!provId){toast('Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ø²ÙˆØ¯','error');return;}
  await api(`/api/admin/requests/${reqId}/assign`,{method:'PUT',body:JSON.stringify({provider_id:parseInt(provId),price:price?parseFloat(price):undefined})});
  closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ âœ…','success');log('Ø¥Ø³Ù†Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹',`#${reqId} â†’ Ù…Ø²ÙˆØ¯ #${provId}`,'#2563eb');pgProjects();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROVIDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgProviders(){
  loading();
  const data=await api('/api/admin/providers');
  allUsers=data||[];
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div><div class="pg-sub">${allUsers.length} Ù…Ø²ÙˆØ¯ Ù…Ø³Ø¬Ù„</div></div>
      <div class="pghd-right"><button class="btn btn-primary btn-sm" onclick="addUserModal('provider')">${svg(IC.plus)} Ø¥Ø¶Ø§ÙØ© Ù…Ø²ÙˆØ¯</button></div>
    </div>
    <div class="card"><div class="card-body">
      <div class="filter-bar">
        <div class="search-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="prQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯â€¦" oninput="filterProvs()"></div>
        <select class="flt-sel" id="prSp" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>${CATS.map(c=>`<option>${c}</option>`).join('')}</select>
        <select class="flt-sel" id="prCit" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(c=>`<option>${c}</option>`).join('')}</select>
        <select class="flt-sel" id="prSt" onchange="filterProvs()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="active">Ù†Ø´Ø·</option><option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option></select>
      </div>
      <div class="tbl-wrap">
        <table class="tbl">
          <thead><tr><th>Ø§Ù„Ù…Ø²ÙˆØ¯</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ØªØ®ØµØµ</th><th>Ø§Ù„ÙˆØ³Ø§Ù…</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
          <tbody id="provBody">${renderProvs(allUsers)}</tbody>
        </table>
      </div>
    </div></div>
  `);
}
function filterProvs(){
  const q=(document.getElementById('prQ')?.value||'').toLowerCase();
  const sp=document.getElementById('prSp')?.value||'';
  const cit=document.getElementById('prCit')?.value||'';
  const st=document.getElementById('prSt')?.value||'';
  const f=allUsers.filter(u=>(!q||(u.name||'').toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q))&&(!sp||(u.specialties||[]).includes(sp))&&(!cit||u.city===cit)&&(!st||(st==='active'?u.is_active!==false:u.is_active===false)));
  const el=document.getElementById('provBody');if(el)el.innerHTML=renderProvs(f);
}
function renderProvs(list){
  if(!list.length)return`<tr><td colspan="8"><div class="empty-state" style="padding:28px"><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙŠÙ†</div></div></td></tr>`;
  return list.map(u=>{
    const bg=ac(u.id||1);const bdg=BADGES[u.badge||'none']||BADGES.none;const active=u.is_active!==false;
    return`<tr>
      <td><div style="display:flex;align-items:center;gap:10px"><div class="tbl-av" style="background:${bg}">${al(u.name)}</div><div><div style="font-size:13px;font-weight:700;color:var(--n800)">${u.name||'â€”'}</div><div style="font-size:11px;color:var(--n400)">${u.email||'â€”'}</div></div></div></td>
      <td style="font-size:12px;color:var(--n600)">${u.city||'â€”'}</td>
      <td style="font-size:11px;color:var(--n500)">${(u.specialties||[]).slice(0,2).join('ØŒ ')||'â€”'}</td>
      <td style="font-size:12px;font-weight:700">${bdg.icon} ${bdg.label}</td>
      <td style="font-size:13px;color:var(--a500)">${u.avg_rating?Number(u.avg_rating).toFixed(1)+'â˜…':'â€”'}</td>
      <td style="font-size:13px;font-weight:700">${u.completed_projects||0}</td>
      <td><span class="badge ${active?'badge-active':'badge-inactive'}">${active?'Ù†Ø´Ø·':'ØºÙŠØ± Ù†Ø´Ø·'}</span></td>
      <td><div style="display:flex;gap:4px;flex-wrap:wrap">
        <button class="btn btn-ghost btn-xs" onclick="viewUserModal(${u.id})">${svg(IC.eye)}</button>
        <button class="btn btn-ghost-p btn-xs" onclick="editUserModal(${u.id},'provider')">${svg(IC.edit)}</button>
        <button class="btn btn-warning btn-xs" onclick="setBadgeModal(${u.id},'${u.badge||'none'}')">ğŸ†</button>
        <button class="btn ${active?'btn-ghost':'btn-success'} btn-xs" onclick="toggleUser(${u.id},${active})">${active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„'}</button>
        <button class="btn btn-danger btn-xs" onclick="deleteUser(${u.id})">${svg(IC.trash)}</button>
      </div></td>
    </tr>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLIENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgClients(){
  loading();
  const data=await api('/api/admin/users?role=client');
  allUsers=data||[];
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div><div class="pg-sub">${allUsers.length} Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¬Ù„</div></div>
      <div class="pghd-right"><button class="btn btn-primary btn-sm" onclick="addUserModal('client')">${svg(IC.plus)} Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button></div>
    </div>
    <div class="card"><div class="card-body">
      <div class="filter-bar">
        <div class="search-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="clQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯â€¦" oninput="filterClis()"></div>
        <select class="flt-sel" id="clCit" onchange="filterClis()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(c=>`<option>${c}</option>`).join('')}</select>
        <select class="flt-sel" id="clSt" onchange="filterClis()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="active">Ù†Ø´Ø·</option><option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option></select>
      </div>
      <div class="tbl-wrap">
        <table class="tbl">
          <thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
          <tbody id="cliBody">${renderClis(allUsers)}</tbody>
        </table>
      </div>
    </div></div>
  `);
}
function filterClis(){
  const q=(document.getElementById('clQ')?.value||'').toLowerCase();
  const cit=document.getElementById('clCit')?.value||'';
  const st=document.getElementById('clSt')?.value||'';
  const f=allUsers.filter(u=>(!q||(u.name||'').toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q))&&(!cit||u.city===cit)&&(!st||(st==='active'?u.is_active!==false:u.is_active===false)));
  const el=document.getElementById('cliBody');if(el)el.innerHTML=renderClis(f);
}
function renderClis(list){
  if(!list.length)return`<tr><td colspan="7"><div class="empty-state" style="padding:28px"><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</div></div></td></tr>`;
  return list.map(u=>{
    const bg=ac(u.id||1);const active=u.is_active!==false;
    return`<tr>
      <td><div style="display:flex;align-items:center;gap:10px"><div class="tbl-av" style="background:${bg}">${al(u.name)}</div><div><div style="font-size:13px;font-weight:700;color:var(--n800)">${u.name||'â€”'}</div><div style="font-size:11px;color:var(--n400)">${u.email||'â€”'}</div></div></div></td>
      <td style="font-size:12px;color:var(--n600)">${u.city||'â€”'}</td>
      <td style="font-size:12px;font-variant-numeric:tabular-nums">${u.phone||'â€”'}</td>
      <td style="font-size:13px;font-weight:700">${u.total_projects||0}</td>
      <td><span class="badge ${active?'badge-active':'badge-inactive'}">${active?'Ù†Ø´Ø·':'ØºÙŠØ± Ù†Ø´Ø·'}</span></td>
      <td style="font-size:11px;color:var(--n400)">${fdt(u.created_at)}</td>
      <td><div style="display:flex;gap:4px;flex-wrap:wrap">
        <button class="btn btn-ghost btn-xs" onclick="viewUserModal(${u.id})">${svg(IC.eye)}</button>
        <button class="btn btn-ghost-p btn-xs" onclick="editUserModal(${u.id},'client')">${svg(IC.edit)}</button>
        <button class="btn ${active?'btn-ghost':'btn-success'} btn-xs" onclick="toggleUser(${u.id},${active})">${active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„'}</button>
        <button class="btn btn-danger btn-xs" onclick="deleteUser(${u.id})">${svg(IC.trash)}</button>
      </div></td>
    </tr>`;
  }).join('');
}

/* User actions */
async function viewUserModal(id){
  const u=await api(`/api/admin/users/${id}`);const bg=ac(u.id||1);
  openM('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
    `<div style="display:flex;align-items:center;gap:14px;padding:18px;background:var(--n50);border-radius:var(--r12);margin-bottom:18px;border:1px solid var(--n150)">
       <div style="width:52px;height:52px;border-radius:var(--r12);background:${bg};color:#fff;font-size:22px;font-weight:900;display:flex;align-items:center;justify-content:center">${al(u.name)}</div>
       <div><div style="font-size:16px;font-weight:800;color:var(--n900)">${u.name||'â€”'}</div><div style="font-size:12px;color:var(--n400);margin-top:3px">${u.email||'â€”'}</div></div>
     </div>
     <div class="info-block">
       <div class="info-block-title">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ø¯ÙˆØ±</span><span class="info-val">${u.role==='provider'?'Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':u.role==='client'?'Ø¹Ù…ÙŠÙ„':'Ù…Ø¯ÙŠØ±'}</span></div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ø¬ÙˆØ§Ù„</span><span class="info-val">${u.phone||'â€”'}</span></div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span><span class="info-val">${u.city||'â€”'}</span></div>
       <div class="info-row"><span class="info-key">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span><span class="info-val">${fdt(u.created_at)}</span></div>
       <div class="info-row"><span class="info-key">Ø§Ù„Ø­Ø§Ù„Ø©</span><span class="info-val"><span class="badge ${u.is_active!==false?'badge-active':'badge-inactive'}">${u.is_active!==false?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ'}</span></span></div>
       ${u.role==='provider'?`<div class="info-row"><span class="info-key">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span><span class="info-val" style="color:var(--a500)">${u.avg_rating?Number(u.avg_rating).toFixed(1)+'â˜…':'â€”'}</span></div>`:''}
     </div>
     ${(u.specialties||[]).length?`<div class="info-block"><div class="info-block-title">Ø§Ù„ØªØ®ØµØµØ§Øª</div><div style="display:flex;gap:5px;flex-wrap:wrap;padding-top:5px">${u.specialties.map(s=>`<span style="background:var(--p50);color:var(--p700);padding:3px 10px;border-radius:var(--rfull);font-size:11px;font-weight:700;border:1px solid var(--p200)">${s}</span>`).join('')}</div></div>`:''}`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.user}</svg>`,'var(--p100)'
  );
}
function addUserModal(role){
  uploadedImgs['addU']=[];
  openM(role==='provider'?'Ø¥Ø¶Ø§ÙØ© Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„',
    `<div class="form-section">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
     <div class="grid-2">
       <div class="form-group"><label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="form-hint">*</span></label><input type="text" class="form-input" id="auNm" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div>
       <div class="form-group"><label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="form-hint">*</span></label><input type="email" class="form-input" id="auEm" placeholder="example@email.com"></div>
     </div>
     <div class="grid-2">
       <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="form-input" id="auPh" placeholder="05xxxxxxxx"></div>
       <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="form-select" id="auCit">${cityOpts()}</select></div>
     </div>
     <div class="form-group"><label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± <span class="form-hint">*</span></label><input type="password" class="form-input" id="auPw" placeholder="8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"></div>
     ${role==='provider'?`<div class="form-section">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯</div>
       <div class="form-group"><label class="form-label">Ø§Ù„ØªØ®ØµØµØ§Øª</label>${specsHtml([])}</div>
       <div class="form-group"><label class="form-label">Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø©</label><textarea class="form-textarea" id="auBio" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø²ÙˆØ¯â€¦"></textarea></div>`:``}`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-primary" onclick="saveNewUser('${role}')">${svg(IC.plus)} Ø¥Ø¶Ø§ÙØ©</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.user}</svg>`,'var(--p100)'
  );
}
async function saveNewUser(role){
  const body={name:document.getElementById('auNm')?.value?.trim(),email:document.getElementById('auEm')?.value?.trim(),phone:document.getElementById('auPh')?.value||'',city:document.getElementById('auCit')?.value||'',password:document.getElementById('auPw')?.value||'',role};
  if(!body.name||!body.email||!body.password){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©','error');return;}
  if(role==='provider'){body.specialties=getSpecs();body.bio=document.getElementById('auBio')?.value||'';}
  const res=await api('/api/admin/users',{method:'POST',body:JSON.stringify(body)});
  if(res.message&&!res.id){toast(res.message,'error');return;}
  closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…','success');log(`Ø¥Ø¶Ø§ÙØ© ${role==='provider'?'Ù…Ø²ÙˆØ¯':'Ø¹Ù…ÙŠÙ„'}`,body.name,'var(--success)');
  role==='provider'?pgProviders():pgClients();
}
function editUserModal(id,role){
  const u=allUsers.find(x=>x.id===id)||{};uploadedImgs['editU']=[];
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
    `<div class="grid-2">
       <div class="form-group"><label class="form-label">Ø§Ù„Ø§Ø³Ù…</label><input type="text" class="form-input" id="euNm" value="${u.name||''}"></div>
       <div class="form-group"><label class="form-label">Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="form-input" id="euPh" value="${u.phone||''}"></div>
     </div>
     <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="form-select" id="euCit">${cityOpts(u.city)}</select></div>
     ${role==='provider'?`<div class="form-group"><label class="form-label">Ø§Ù„ØªØ®ØµØµØ§Øª</label>${specsHtml(u.specialties||[])}</div><div class="form-group"><label class="form-label">Ø§Ù„Ù†Ø¨Ø°Ø©</label><textarea class="form-textarea" id="euBio">${u.bio||''}</textarea></div>`:''}`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-primary" onclick="saveEditUser(${id},'${role}')">${svg(IC.save)} Ø­ÙØ¸</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.edit}</svg>`,'var(--p100)'
  );
}
async function saveEditUser(id,role){
  const body={name:document.getElementById('euNm')?.value?.trim()||'',phone:document.getElementById('euPh')?.value||'',city:document.getElementById('euCit')?.value||''};
  if(role==='provider'){body.specialties=getSpecs();body.bio=document.getElementById('euBio')?.value||'';}
  await api(`/api/admin/users/${id}`,{method:'PUT',body:JSON.stringify(body)});
  closeM();toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success');log('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…',`#${id}`,'#2563eb');
  role==='provider'?pgProviders():pgClients();
}
function setBadgeModal(id,cur){
  openM('Ù…Ù†Ø­ Ø§Ù„ÙˆØ³Ø§Ù…',
    `<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
       ${Object.entries(BADGES).map(([k,b])=>`<div onclick="document.querySelectorAll('.bdg-opt').forEach(x=>{x.style.border='1.5px solid var(--n200)';x.style.background='var(--n0)';});this.style.border='1.5px solid var(--p500)';this.style.background='var(--p50)';document.getElementById('selBdg').value='${k}'" class="bdg-opt" style="padding:14px;border-radius:var(--r12);border:1.5px solid ${k===cur?'var(--p500)':'var(--n200)'};text-align:center;cursor:pointer;background:${k===cur?'var(--p50)':'var(--n0)'}"><div style="font-size:24px;margin-bottom:6px">${b.icon}</div><div style="font-size:12px;font-weight:700">${b.label}</div></div>`).join('')}
     </div><input type="hidden" id="selBdg" value="${cur}">`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-warning" onclick="saveBadge(${id})">${svg(IC.star)} Ù…Ù†Ø­</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--a500)">${IC.star}</svg>`,'var(--a50)'
  );
}
async function saveBadge(id){
  const badge=document.getElementById('selBdg')?.value||'none';
  await api(`/api/admin/users/${id}/badge`,{method:'PUT',body:JSON.stringify({badge})});
  closeM();toast('ØªÙ… Ù…Ù†Ø­ Ø§Ù„ÙˆØ³Ø§Ù… âœ…','success');log('Ù…Ù†Ø­ ÙˆØ³Ø§Ù…',`#${id} â†’ ${badge}`,'var(--a500)');pgProviders();
}
async function toggleUser(id,isActive){
  await api(`/api/admin/users/${id}/toggle`,{method:'PUT',body:JSON.stringify({active:!isActive})});
  toast(isActive?'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨':'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨',isActive?'error':'success');
  log(isActive?'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø³ØªØ®Ø¯Ù…':'ØªÙØ¹ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…',`#${id}`,isActive?'var(--error)':'var(--success)');
  document.getElementById('pgTitle').textContent==='Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©'?pgProviders():pgClients();
}
async function deleteUser(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  await api(`/api/admin/users/${id}`,{method:'DELETE'});
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');log('Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…',`#${id}`,'var(--error)');
  document.getElementById('pgTitle').textContent==='Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©'?pgProviders():pgClients();
}

/* Overlay close */
document.getElementById('ov').addEventListener('click',function(e){if(e.target===this)closeM();});

/* BOOT */
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVIEWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgReviews(){
  loading();
  const data=await api('/api/admin/reviews');
  allRevs=data||[];
  const flagged=allRevs.filter(r=>r.reported).length;
  const nb=document.getElementById('nbRevs');
  if(nb){nb.style.display=flagged?'':'none';nb.textContent=flagged;}

  setPage(`
    <div class="pghd">
      <div class="pghd-left">
        <div class="pg-title">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
        <div class="pg-sub">${allRevs.length} ØªÙ‚ÙŠÙŠÙ… Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹ ${flagged?`<span style="color:var(--error);font-weight:700">â€¢ ${flagged} Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡</span>`:''}
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="filter-bar">
          <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="text" id="rvQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹â€¦" oninput="filterRevs()">
          </div>
          <select class="flt-sel" id="rvF" onchange="filterRevs()">
            <option value="">ÙƒÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
            <option value="reported">Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡Ø§</option>
            <option value="hidden">Ù…Ø®ÙÙŠØ©</option>
            <option value="pinned">Ù…Ø«Ø¨ØªØ©</option>
          </select>
          <select class="flt-sel" id="rvSt" onchange="filterRevs()">
            <option value="">ÙƒÙ„ Ø§Ù„Ù†Ø¬ÙˆÙ…</option>
            ${[5,4,3,2,1].map(n=>`<option value="${n}">${n} â˜…</option>`).join('')}
          </select>
        </div>
        <div id="revList">${renderRevs(allRevs)}</div>
      </div>
    </div>
  `);
}

function filterRevs(){
  const q=(document.getElementById('rvQ')?.value||'').toLowerCase();
  const f=document.getElementById('rvF')?.value||'';
  const st=document.getElementById('rvSt')?.value||'';
  const res=allRevs.filter(r=>{
    const mq=!q||(r.reviewer_name||'').toLowerCase().includes(q)||(r.reviewed_name||'').toLowerCase().includes(q)||(r.project_number||'').toLowerCase().includes(q);
    const mf=!f||(f==='reported'&&r.reported)||(f==='hidden'&&r.hidden)||(f==='pinned'&&r.pinned);
    const ms=!st||r.rating==st;
    return mq&&mf&&ms;
  });
  const el=document.getElementById('revList');
  if(el)el.innerHTML=renderRevs(res);
}

function renderRevs(list){
  if(!list.length)return`<div class="empty-state"><div class="empty-icon">${svg(IC.star)}</div><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div></div>`;
  return list.map(r=>{
    const bg1=ac(r.reviewer_id||1);
    const bg2=ac(r.reviewed_id||2);
    return`<div class="review-card${r.reported?' flagged':''}">
      <div class="rev-top">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="rev-av" style="background:${bg1}">${al(r.reviewer_name)}</div>
          <div>
            <div class="rev-name">${r.reviewer_name||'â€”'}</div>
            <div class="rev-sub">
              Ù‚ÙŠÙ‘Ù… â† 
              <span style="display:inline-flex;align-items:center;gap:5px">
                <span style="display:inline-block;width:18px;height:18px;border-radius:5px;background:${bg2};color:#fff;font-size:9px;font-weight:800;line-height:18px;text-align:center">${al(r.reviewed_name)}</span>
                ${r.reviewed_name||'â€”'}
              </span>
            </div>
          </div>
        </div>
        <div style="text-align:left">
          <div class="stars">${stars(r.rating)}</div>
          <div style="font-size:10px;color:var(--n400);margin-top:3px;font-weight:600">${fdt(r.created_at)}</div>
          <div style="display:flex;gap:4px;margin-top:5px;justify-content:flex-end;flex-wrap:wrap">
            ${r.reported?`<span style="background:var(--error-bg);color:var(--error-text);padding:1px 7px;border-radius:var(--rfull);font-size:9px;font-weight:700;border:1px solid var(--error-border)">ğŸš© Ù…ÙØ¨Ù„ÙÙ‘Øº</span>`:''}
            ${r.pinned?`<span style="background:var(--warning-bg);color:var(--warning-text);padding:1px 7px;border-radius:var(--rfull);font-size:9px;font-weight:700;border:1px solid var(--warning-border)">ğŸ“Œ Ù…Ø«Ø¨Øª</span>`:''}
            ${r.hidden?`<span style="background:var(--n100);color:var(--n500);padding:1px 7px;border-radius:var(--rfull);font-size:9px;font-weight:700;border:1px solid var(--n200)">ğŸ™ˆ Ù…Ø®ÙÙŠ</span>`:''}
          </div>
        </div>
      </div>
      <div style="font-size:10px;font-weight:600;color:var(--n300);margin-bottom:9px;display:flex;align-items:center;gap:4px">
        ${svg(IC.proj,'var(--n300)')} ${r.project_number||'Ù…Ø´Ø±ÙˆØ¹ #'+r.request_id}
      </div>
      ${r.comment?`<div class="rev-body">${r.comment}</div>`:''}
      ${r.admin_reply?`<div class="admin-reply-box"><div class="reply-label">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div><div class="reply-body">${r.admin_reply}</div></div>`:''}
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <button class="btn btn-warning btn-xs" onclick="replyRevModal(${r.id},'${(r.comment||'').replace(/'/g,'')}','${(r.admin_reply||'').replace(/'/g,'')}')">
          ${svg('<path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>')} Ø±Ø¯
        </button>
        <button class="btn btn-ghost btn-xs" onclick="pinRev(${r.id},${!r.pinned})">${r.pinned?'ğŸ“Œ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª':'ğŸ“Œ ØªØ«Ø¨ÙŠØª'}</button>
        <button class="btn btn-ghost btn-xs" onclick="hideRev(${r.id},${!r.hidden})">${r.hidden?'ğŸ‘ Ø¥Ø¸Ù‡Ø§Ø±':'ğŸ™ˆ Ø¥Ø®ÙØ§Ø¡'}</button>
        ${r.reported?`<button class="btn btn-success btn-xs" onclick="resolveReport(${r.id})">âœ“ Ø­Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</button>`:''}
        <button class="btn btn-danger btn-xs" onclick="deleteRev(${r.id})">${svg(IC.trash)}</button>
      </div>
    </div>`;
  }).join('');
}

function replyRevModal(id,comment,currentReply){
  openM('Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…',
    `${comment?`<div class="rev-body" style="margin-bottom:16px">"${comment}"</div>`:''}
     <div class="form-group">
       <label class="form-label">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© <span class="form-hint">*</span></label>
       <textarea class="form-textarea" id="replyTxt" style="min-height:100px" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙˆÙ…â€¦">${currentReply||''}</textarea>
     </div>`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button>
     <button class="btn btn-warning" onclick="saveReply(${id})">${svg('<path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>')} Ù†Ø´Ø± Ø§Ù„Ø±Ø¯</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--a500)"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>`,'var(--a50)'
  );
}
async function saveReply(id){
  const reply=document.getElementById('replyTxt')?.value?.trim();
  if(!reply){toast('Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯','error');return;}
  await api(`/api/admin/reviews/${id}/reply`,{method:'PUT',body:JSON.stringify({reply})});
  closeM();toast('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø±Ø¯ âœ…','success');
  log('Ø±Ø¯ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…',`#${id}`,'var(--a500)');
  pgReviews();
}
async function pinRev(id,pin){
  await api(`/api/admin/reviews/${id}/pin`,{method:'PUT',body:JSON.stringify({pinned:pin})});
  toast(pin?'ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª ğŸ“Œ':'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª','success');
  log(pin?'ØªØ«Ø¨ÙŠØª ØªÙ‚ÙŠÙŠÙ…':'Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª',`#${id}`,'var(--a500)');
  pgReviews();
}
async function hideRev(id,hide){
  await api(`/api/admin/reviews/${id}/hide`,{method:'PUT',body:JSON.stringify({hidden:hide})});
  toast(hide?'ØªÙ… Ø§Ù„Ø¥Ø®ÙØ§Ø¡':'ØªÙ… Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø±','info');
  log(hide?'Ø¥Ø®ÙØ§Ø¡ ØªÙ‚ÙŠÙŠÙ…':'Ø¥Ø¸Ù‡Ø§Ø± ØªÙ‚ÙŠÙŠÙ…',`#${id}`,'var(--n500)');
  pgReviews();
}
async function resolveReport(id){
  await api(`/api/admin/reviews/${id}/resolve`,{method:'PUT'});
  toast('ØªÙ… Ø­Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº âœ…','success');
  log('Ø­Ù„ Ø¥Ø¨Ù„Ø§Øº',`#${id}`,'var(--success)');
  pgReviews();
}
async function deleteRev(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  await api(`/api/admin/reviews/${id}`,{method:'DELETE'});
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');
  log('Ø­Ø°Ù ØªÙ‚ÙŠÙŠÙ…',`#${id}`,'var(--error)');
  pgReviews();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISPUTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgDisputes(){
  loading();
  const data=await api('/api/admin/disputes');
  allDisps=data||[];
  const open=allDisps.filter(d=>d.status==='open').length;
  const nb=document.getElementById('nbDisp');
  if(nb){nb.style.display=open?'':'none';nb.textContent=open;}

  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</div><div class="pg-sub">${open} Ù†Ø²Ø§Ø¹ Ù…ÙØªÙˆØ­ Ù…Ù† Ø£ØµÙ„ ${allDisps.length}</div></div>
      <div class="pghd-right">
        <select class="flt-sel" id="dFSt" onchange="filterDisps()">
          <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="open">Ù…ÙØªÙˆØ­Ø©</option>
          <option value="resolved">Ù…Ø­Ù„ÙˆÙ„Ø©</option>
        </select>
      </div>
    </div>
    <div id="dispList">${renderDisps(allDisps)}</div>
  `);
}

function filterDisps(){
  const st=document.getElementById('dFSt')?.value||'';
  const f=st?allDisps.filter(d=>d.status===st):allDisps;
  const el=document.getElementById('dispList');
  if(el)el.innerHTML=renderDisps(f);
}

function renderDisps(list){
  if(!list.length)return`<div class="card"><div class="card-body"><div class="empty-state"><div class="empty-icon">${svg(IC.check)}</div><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø²Ø§Ø¹Ø§Øª Ù…ÙØªÙˆØ­Ø© âœ…</div></div></div></div>`;
  return list.map(d=>{
    const bg1=ac(d.client_id||1);
    const bg2=ac(d.provider_id||2);
    return`<div class="dispute-card${d.status==='resolved'?' resolved':''}">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:6px">
        <div>
          <div class="disp-title">${d.title}</div>
          <div class="disp-meta">${d.project_number||'Ù…Ø´Ø±ÙˆØ¹ #'+d.request_id} â€¢ ${fdt(d.created_at)}</div>
        </div>
        <span class="badge ${d.status==='open'?'badge-rejected':'badge-open'}">${d.status==='open'?'Ù…ÙØªÙˆØ­':'Ù…Ø­Ù„ÙˆÙ„'}</span>
      </div>
      ${d.description?`<div class="disp-desc">${d.description}</div>`:''}
      <div class="disp-parties">
        <div style="display:flex;align-items:center;gap:9px">
          <div style="width:34px;height:34px;border-radius:var(--r8);background:${bg1};color:#fff;font-size:14px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">${al(d.client_name)}</div>
          <div>
            <div class="party-name">${d.client_name||'â€”'}</div>
            <div class="party-role">ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
          </div>
        </div>
        <div class="disp-vs">â‡†</div>
        <div style="display:flex;align-items:center;gap:9px">
          <div style="width:34px;height:34px;border-radius:var(--r8);background:${bg2};color:#fff;font-size:14px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">${al(d.provider_name)}</div>
          <div>
            <div class="party-name">${d.provider_name||'â€”'}</div>
            <div class="party-role">ğŸ”§ Ø§Ù„Ù…Ø²ÙˆØ¯</div>
          </div>
        </div>
      </div>
      ${d.resolution?`<div class="disp-resolution">âœ“ Ø§Ù„Ù‚Ø±Ø§Ø±: ${d.resolution}</div>`:''}
      <div style="display:flex;gap:7px;flex-wrap:wrap">
        ${d.status==='open'?`
          <button class="btn btn-success btn-sm" onclick="resolveDispModal(${d.id})">${svg(IC.check)} Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹</button>
          <button class="btn btn-info btn-sm" onclick="notifyBothModal(${d.client_id||0},${d.provider_id||0})">${svg(IC.bell)} Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†</button>
        `:''}
        <button class="btn btn-ghost btn-sm" onclick="viewProjModal(${d.request_id})">${svg(IC.proj)} Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
      </div>
    </div>`;
  }).join('');
}

function resolveDispModal(id){
  openM('Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹',
    `<div class="form-group">
       <label class="form-label">Ø§Ù„Ù‚Ø±Ø§Ø± <span class="form-hint">*</span></label>
       <select class="form-select" id="rdSide">
         <option value="client">Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
         <option value="provider">Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø²ÙˆØ¯</option>
         <option value="mutual">ØªØ³ÙˆÙŠØ© Ù…Ø´ØªØ±ÙƒØ©</option>
       </select>
     </div>
     <div class="form-group">
       <label class="form-label">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø±</label>
       <textarea class="form-textarea" id="rdRes" placeholder="Ø§Ø´Ø±Ø­ Ù‚Ø±Ø§Ø± Ø§Ù„Ø­Ù„ Ø¨ÙˆØ¶ÙˆØ­â€¦"></textarea>
     </div>`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button>
     <button class="btn btn-success" onclick="confirmResolveDisp(${id})">${svg(IC.check)} ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ù„</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--success)">${IC.check}</svg>`,'var(--success-bg)'
  );
}
async function confirmResolveDisp(id){
  const side=document.getElementById('rdSide')?.value;
  const resolution=document.getElementById('rdRes')?.value?.trim()||side;
  await api(`/api/admin/disputes/${id}/resolve`,{method:'PUT',body:JSON.stringify({resolution,decision:side})});
  closeM();toast('ØªÙ… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹ âœ…','success');
  log('Ø­Ù„ Ù†Ø²Ø§Ø¹',`#${id}`,'var(--success)');
  pgDisputes();
}
function notifyBothModal(cId,pId){
  openM('Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†',
    `<div class="alert alert-info">${svg(IC.info,'var(--info)')} Ø³ÙŠÙØ±Ø³ÙÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø²ÙˆØ¯ ÙÙˆØ±Ø§Ù‹</div>
     <div class="form-group"><label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span class="form-hint">*</span></label><input type="text" class="form-input" id="nbTi" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>
     <div class="form-group"><label class="form-label">Ø§Ù„Ù†Øµ <span class="form-hint">*</span></label><textarea class="form-textarea" id="nbBd" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±â€¦"></textarea></div>`,
    `<button class="btn btn-white" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button>
     <button class="btn btn-primary" onclick="confirmNotifyBoth(${cId},${pId})">${svg(IC.send)} Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±ÙÙŠÙ†</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--p600)">${IC.bell}</svg>`,'var(--p100)'
  );
}
async function confirmNotifyBoth(cId,pId){
  const title=document.getElementById('nbTi')?.value?.trim();
  const body=document.getElementById('nbBd')?.value?.trim();
  if(!title||!body){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  await Promise.all([
    api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:cId,title,body,type:'admin'})}),
    api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:pId,title,body,type:'admin'})})
  ]);
  closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±ÙÙŠÙ† âœ…','success');
  log('Ø¥Ø´Ø¹Ø§Ø± Ø·Ø±ÙÙŠ Ù†Ø²Ø§Ø¹',title,'var(--p600)');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgNotifs(){
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div><div class="pg-sub">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù…Ù†ØµØ©</div></div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px">
      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:var(--p100)">${svg(IC.bell,'var(--p600)')}</div>
            <div><div class="card-title">Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ</div><div class="card-sub">ÙŠØµÙ„ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ† ÙÙˆØ±Ø§Ù‹</div></div>
          </div>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙˆÙ†</label>
            <div class="target-btns">
              <button class="target-btn active" onclick="setTarget(this,'')">ğŸ‘¥ Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
              <button class="target-btn" onclick="setTarget(this,'provider')">ğŸ”§ Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†</button>
              <button class="target-btn" onclick="setTarget(this,'client')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
            </div>
            <input type="hidden" id="notifRole" value="">
          </div>
          <div class="divider"></div>
          <div class="form-group"><label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="form-hint">*</span></label><input type="text" class="form-input" id="notifTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø¶Ø­ ÙˆØ¬Ø°Ø§Ø¨â€¦"></div>
          <div class="form-group"><label class="form-label">Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="form-hint">*</span></label><textarea class="form-textarea" id="notifBody" style="min-height:110px" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§â€¦"></textarea></div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-primary" onclick="sendBroadcast()">${svg(IC.send)} Ø¥Ø±Ø³Ø§Ù„</button>
            <button class="btn btn-ghost" onclick="document.getElementById('notifTitle').value='';document.getElementById('notifBody').value=''">Ù…Ø³Ø­</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:var(--info-bg)">${svg(IC.user,'var(--info)')}</div>
            <div><div class="card-title">Ø¥Ø´Ø¹Ø§Ø± ÙØ±Ø¯ÙŠ</div><div class="card-sub">Ø£Ø±Ø³Ù„ Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹ÙŠÙ†Ù‡</div></div>
          </div>
        </div>
        <div class="card-body">
          <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ID)</label><input type="number" class="form-input" id="indId" placeholder="Ù…Ø«Ø§Ù„: 42"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span class="form-hint">*</span></label><input type="text" class="form-input" id="indTitle" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù†Øµ <span class="form-hint">*</span></label><textarea class="form-textarea" id="indBody" style="min-height:110px" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±â€¦"></textarea></div>
          <button class="btn btn-info" onclick="sendIndividual()">${svg(IC.send)} Ø¥Ø±Ø³Ø§Ù„ ÙØ±Ø¯ÙŠ</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon" style="background:var(--success-bg)">${svg(IC.info,'var(--success)')}</div>
          <div class="card-title">Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø©</div>
        </div>
      </div>
      <div class="card-body">
        <div class="three-col">
          ${[['ğŸ¯','ÙƒÙ† Ù…Ø­Ø¯Ø¯Ø§Ù‹','Ø§Ø°ÙƒØ± Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„ÙˆØ§Ø¶Ø­ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø± Ø­ØªÙ‰ ÙŠØªØ®Ø° Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØµØ­ÙŠØ­'],['âš¡','ÙƒÙ† Ù…ÙˆØ¬Ø²Ø§Ù‹','Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‚ØµÙŠØ± ÙŠÙÙ‚Ø±Ø£ Ø£ÙƒØ«Ø± â€” Ø¬Ù…Ù„Ø© Ø£Ùˆ Ø¬Ù…Ù„ØªØ§Ù† ÙƒØ§ÙÙŠØªØ§Ù†'],['ğŸ•˜','Ø§Ø®ØªØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª','Ø£Ø±Ø³Ù„ ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† 9 ØµØ¨Ø§Ø­Ø§Ù‹ Ø­ØªÙ‰ 9 Ù…Ø³Ø§Ø¡Ù‹']].map(([ic,t,d])=>`
            <div style="background:var(--n50);border-radius:var(--r12);padding:16px;border:1px solid var(--n100)">
              <div style="font-size:26px;margin-bottom:10px">${ic}</div>
              <div style="font-size:13px;font-weight:800;color:var(--n800);margin-bottom:5px">${t}</div>
              <div style="font-size:12px;color:var(--n400);font-weight:500;line-height:1.6">${d}</div>
            </div>`).join('')}
        </div>
      </div>
    </div>
  `);
}

function setTarget(btn,role){
  document.querySelectorAll('.target-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('notifRole').value=role;
}
async function sendBroadcast(){
  const title=document.getElementById('notifTitle')?.value?.trim();
  const body=document.getElementById('notifBody')?.value?.trim();
  const role=document.getElementById('notifRole')?.value||'';
  if(!title||!body){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  await api('/api/admin/notify',{method:'POST',body:JSON.stringify({title,body,role:role||undefined,type:'admin'})});
  toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…','success');
  log('Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ',title+(role?` â† ${role==='provider'?'Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†':'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'}':''),'var(--p600)');
  document.getElementById('notifTitle').value='';
  document.getElementById('notifBody').value='';
}
async function sendIndividual(){
  const userId=document.getElementById('indId')?.value;
  const title=document.getElementById('indTitle')?.value?.trim();
  const body=document.getElementById('indBody')?.value?.trim();
  if(!userId||!title||!body){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  await api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:parseInt(userId),title,body,type:'admin'})});
  toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…','success');
  log('Ø¥Ø´Ø¹Ø§Ø± ÙØ±Ø¯ÙŠ',`#${userId}: ${title}`,'#2563eb');
  document.getElementById('indTitle').value='';
  document.getElementById('indBody').value='';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgReports(){
  loading();
  const [stats,reqs]=await Promise.all([api('/api/admin/stats'),api('/api/admin/requests')]);
  const s=stats||{};const rq=reqs||[];

  const cityCount={},catCount={};
  rq.forEach(r=>{
    if(r.city)cityCount[r.city]=(cityCount[r.city]||0)+1;
    if(r.category)catCount[r.category]=(catCount[r.category]||0)+1;
  });
  const topCities=Object.entries(cityCount).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const topCats=Object.entries(catCount).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const maxC=topCities[0]?.[1]||1;
  const maxCat=topCats[0]?.[1]||1;
  const compRate=rq.length?Math.round((s.completed||0)/rq.length*100):0;

  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div><div class="pg-sub">Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ù…Ù†ØµØ© Ù…Ù†Ø§Ù‚ØµØ©</div></div>
    </div>

    <div class="stats-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:22px">
      ${[
        ['Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„',compRate+'%','var(--success)','var(--success-bg)'],
        ['Ù…ØªÙˆØ³Ø· Ø¹Ø±ÙˆØ¶/Ù…Ø´Ø±ÙˆØ¹',rq.length?Math.round((s.total_bids||0)/rq.length):0,'var(--p600)','var(--p50)'],
        ['Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©',(s.open||0)+(s.in_progress||0),'#2563eb','#eff6ff'],
        ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',rq.length,'var(--a600)','var(--a50)'],
      ].map(([l,v,c,bg])=>`
        <div class="stat-card" style="--accent-color:${c}">
          <div class="stat-val" style="color:${c}">${v}</div>
          <div class="stat-lbl">${l}</div>
        </div>`).join('')}
    </div>

    <div class="two-col">
      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:var(--info-bg)">${svg(IC.bars,'var(--info)')}</div>
            <div><div class="card-title">Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø¯Ù† Ø·Ù„Ø¨Ø§Ù‹</div></div>
          </div>
        </div>
        <div class="card-body">
          ${topCities.length?topCities.map(([city,count])=>`
            <div class="prog-row">
              <div class="prog-label">${city}</div>
              <div class="prog-track"><div class="prog-bar" style="width:${Math.round(count/maxC*100)}%;background:var(--info)"></div></div>
              <div class="prog-num">${count}</div>
            </div>`).join(''):`<div class="empty-state" style="padding:20px"><div class="empty-sub">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div></div>`}
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:var(--p50)">${svg(IC.bars,'var(--p600)')}</div>
            <div><div class="card-title">Ø£ÙƒØ«Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø·Ù„Ø¨Ø§Ù‹</div></div>
          </div>
        </div>
        <div class="card-body">
          ${topCats.length?topCats.map(([cat,count])=>`
            <div class="prog-row">
              <div class="prog-label" style="min-width:120px">${cat}</div>
              <div class="prog-track"><div class="prog-bar" style="width:${Math.round(count/maxCat*100)}%;background:var(--p600)"></div></div>
              <div class="prog-num">${count}</div>
            </div>`).join(''):`<div class="empty-state" style="padding:20px"><div class="empty-sub">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div></div>`}
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon" style="background:var(--success-bg)">${svg(IC.zap,'var(--success)')}</div>
          <div class="card-title">ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
        </div>
      </div>
      <div class="card-body">
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;text-align:center">
          ${[
            {label:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',key:'pending_review',color:'var(--warning)',bg:'var(--warning-bg)',border:'var(--warning-border)'},
            {label:'Ù…ÙØªÙˆØ­',key:'open',color:'var(--success)',bg:'var(--success-bg)',border:'var(--success-border)'},
            {label:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',key:'in_progress',color:'var(--info)',bg:'var(--info-bg)',border:'var(--info-border)'},
            {label:'Ù…ÙƒØªÙ…Ù„',key:'completed',color:'var(--p600)',bg:'var(--p50)',border:'var(--p200)'},
            {label:'Ù…Ø±ÙÙˆØ¶',key:'rejected',color:'var(--error)',bg:'var(--error-bg)',border:'var(--error-border)'},
          ].map(it=>`
            <div style="background:${it.bg};border-radius:var(--r16);padding:20px 12px;border:1px solid ${it.border};cursor:default;transition:transform var(--t2)" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform=''">
              <div style="font-size:30px;font-weight:900;color:${it.color};margin-bottom:6px;letter-spacing:-.7px">${s[it.key]||0}</div>
              <div style="font-size:11px;font-weight:700;color:var(--n600)">${it.label}</div>
              <div style="font-size:10px;color:var(--n400);margin-top:4px;font-weight:600">${rq.length?Math.round((s[it.key]||0)/rq.length*100):0}%</div>
            </div>`).join('')}
        </div>
      </div>
    </div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVITY LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgLog(){
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</div><div class="pg-sub">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ù‡Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©</div></div>
      <div class="pghd-right">
        <button class="btn btn-ghost btn-sm" onclick="actLog=[];pgLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        ${actLog.length?actLog.map(l=>`
          <div class="log-item">
            <div class="log-dot" style="background:${l.color}"></div>
            <div class="log-content">
              <div class="log-action">${l.action}</div>
              <div class="log-detail">${l.detail}</div>
            </div>
            <div class="log-time">${l.time}</div>
          </div>`).join(''):`
          <div class="empty-state">
            <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--n300)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
            <div class="empty-title">Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº</div>
            <div class="empty-sub">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙƒÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ®Ø°Ù‡Ø§</div>
          </div>`}
      </div>
    </div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgSettings(){
  setPage(`
    <div class="pghd">
      <div class="pghd-left"><div class="pg-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØµØ©</div><div class="pg-sub">ØªØ­ÙƒÙ… ÙÙŠ Ø³Ù„ÙˆÙƒ Ù…Ù†ØµØ© Ù…Ù†Ø§Ù‚ØµØ©</div></div>
    </div>

    <div class="two-col">
      <div>
        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--p100)">${svg('<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>','var(--p600)')}</div>
              <div class="card-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</div>
            </div>
          </div>
          <div class="card-body">
            ${mkToggle('Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±','ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹ ÙŠÙ…Ø± Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹',true)}
            ${mkToggle('Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†','Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ³Ø¬ÙŠÙ„ Ù…Ø²ÙˆØ¯ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ù…Ø±Ø§Ø¬Ø¹Ø©',false)}
            ${mkToggle('Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯',true)}
            ${mkToggle('ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©','Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„ØµÙŠØ§Ù†Ø©',false)}
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--a50)">${svg(IC.dollar,'var(--a500)')}</div>
              <div class="card-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            </div>
          </div>
          <div class="card-body">
            <div class="form-group"><label class="form-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" class="form-input" value="100"></div>
            <div class="form-group"><label class="form-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</label><input type="number" class="form-input" value="20"></div>
            <div class="form-group"><label class="form-label">Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…ÙØªÙˆØ­ (Ø£ÙŠØ§Ù…)</label><input type="number" class="form-input" value="30"></div>
            <button class="btn btn-primary btn-sm" onclick="toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…','success')">${svg(IC.save)} Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          </div>
        </div>
      </div>

      <div>
        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--success-bg)">${svg(IC.shield,'var(--success)')}</div>
              <div class="card-title">Ø§Ù„Ø£Ù…Ø§Ù†</div>
            </div>
          </div>
          <div class="card-body">
            ${mkToggle('Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (OTP)','Ø¥Ù„Ø²Ø§Ù…ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯',true)}
            ${mkToggle('Rate Limiting','Ø­Ù…Ø§ÙŠØ© API Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØ±Ø·Ø©',true)}
            ${mkToggle('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„',false)}
            ${mkToggle('ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø°Ùˆ Ø¹Ø§Ù…Ù„ÙŠÙ†','Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·',false)}
          </div>
        </div>

        <div class="card" style="border-color:var(--error-border)">
          <div class="card-header" style="background:var(--error-bg)">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--error-bg);border:1px solid var(--error-border)">${svg(IC.alert,'var(--error)')}</div>
              <div><div class="card-title" style="color:var(--error-text)">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</div></div>
            </div>
          </div>
          <div class="card-body">
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-title" style="color:var(--error)">Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
                <div class="setting-desc">Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</div>
              </div>
              <button class="btn btn-danger btn-sm" onclick="toast('ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹','error')">Ø­Ø°Ù</button>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-title" style="color:var(--error)">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                <div class="setting-desc">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
              </div>
              <button class="btn btn-danger btn-sm" onclick="toast('ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹','error')">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <div class="card-icon" style="background:var(--info-bg)">${svg(IC.info,'var(--info)')}</div>
              <div class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
            </div>
          </div>
          <div class="card-body">
            <div class="info-block">
              <div class="info-row"><span class="info-key">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</span><span class="info-val">v3.0.0</span></div>
              <div class="info-row"><span class="info-key">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±</span><span class="info-val">${me.name||'â€”'}</span></div>
              <div class="info-row"><span class="info-key">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span><span class="info-val">${me.email||'â€”'}</span></div>
              <div class="info-row"><span class="info-key">Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„</span><span class="info-val">${new Date().toLocaleDateString('ar-SA')}</span></div>
              <div class="info-row"><span class="info-key">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span><span class="info-val" style="color:var(--success)">â— Ù…ØªØµÙ„Ø©</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `);
}

function mkToggle(title,desc,defaultOn){
  const id='tog_'+Math.random().toString(36).slice(2,8);
  return`<div class="setting-row">
    <label class="toggle" for="${id}">
      <input type="checkbox" id="${id}"${defaultOn?' checked':''} onchange="toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success')">
      <div class="toggle-track"><div class="toggle-thumb"></div></div>
    </label>
    <div class="setting-info">
      <div class="setting-title">${title}</div>
      <div class="setting-desc">${desc}</div>
    </div>
  </div>`;
}
go('home',document.querySelector('.ni.on'));
</script>
</body>
</html>
