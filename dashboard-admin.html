<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--p:#7c3aed;--p2:#6d28d9;--p-light:#ede9fe;--p-mid:#ddd6fe;--text:#1e1b4b;--muted:#6b7280;--border:#e5e7eb;--bg:#f5f3ff;--white:#fff;--red:#ef4444;--red-l:#fee2e2;--green:#16a34a;--green-l:#dcfce7;--yellow:#d97706;--yellow-l:#fef3c7;--blue:#2563eb;--blue-l:#dbeafe}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.side{width:252px;background:var(--white);border-left:1px solid var(--border);height:100vh;position:fixed;right:0;top:0;display:flex;flex-direction:column;z-index:100;box-shadow:2px 0 20px rgba(124,58,237,0.06)}
.side-head{padding:20px 16px 16px;border-bottom:1px solid var(--border)}
.logo{font-size:22px;font-weight:900;color:var(--p);margin-bottom:12px}.logo span{color:#f59e0b}
.admin-badge{background:linear-gradient(135deg,var(--p),var(--p2));border-radius:13px;padding:11px;display:flex;align-items:center;gap:10px}
.ab-ic{width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,0.18);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ab-ic svg{stroke:#fff}
.ab-name{font-size:13px;font-weight:800;color:#fff}.ab-role{font-size:10px;color:rgba(255,255,255,0.7);font-weight:600;margin-top:1px}
.nav{padding:12px 8px;flex:1;overflow-y:auto}
.nav-sec{font-size:10px;font-weight:800;color:var(--muted);letter-spacing:.8px;padding:0 8px;margin:12px 0 4px;text-transform:uppercase}
.ni{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:11px;color:var(--muted);cursor:pointer;font-size:13px;font-weight:600;border:none;background:none;width:100%;text-align:right;font-family:'Tajawal',sans-serif;margin-bottom:1px;transition:.15s}
.ni:hover{background:var(--bg);color:var(--text)}.ni.on{background:var(--p-light);color:var(--p)}
.ni-ic{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s}
.ni.on .ni-ic{background:var(--p)}.ni.on .ni-ic svg{stroke:#fff}.ni-ic svg{stroke:currentColor}
.side-foot{padding:10px 16px;border-top:1px solid var(--border)}
.logoutbtn{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:10px;color:var(--red);cursor:pointer;font-size:13px;font-weight:700;border:none;background:none;width:100%;font-family:'Tajawal',sans-serif;transition:.15s}
.logoutbtn:hover{background:var(--red-l)}
.main{margin-right:252px;min-height:100vh;display:flex;flex-direction:column}
.topbar{background:var(--white);border-bottom:1px solid var(--border);height:56px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar-title{font-size:15px;font-weight:800}
.topbar-time{font-size:12px;color:var(--muted);font-weight:600}
.content{padding:20px 24px;flex:1}
.page{display:none}.page.on{display:block}
.mob-head{display:none;background:linear-gradient(135deg,var(--p),var(--p2));height:52px;padding:0 14px;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.mob-logo{font-size:18px;font-weight:900;color:#fff}.mob-logo span{color:#fbbf24}
.mob-time{font-size:10px;color:rgba(255,255,255,0.7);font-weight:600;margin-top:1px}
.mob-out{background:rgba(255,255,255,0.15);border:none;border-radius:9px;padding:6px 10px;color:#fff;font-size:12px;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif}
.bnav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--white);border-top:1px solid var(--border);z-index:100;padding:3px 0 calc(env(safe-area-inset-bottom,0px) + 3px)}
.bnav-inner{display:flex}
.bni{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 2px;border:none;background:none;cursor:pointer;font-family:'Tajawal',sans-serif;color:var(--muted);transition:.15s}
.bni .bic{width:20px;height:20px;display:flex;align-items:center;justify-content:center}
.bni .bic svg{stroke:currentColor}
.bni .bt{font-size:9px;font-weight:700}
.bni.on{color:var(--p)}
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:18px}
.sc{background:var(--white);border:1px solid var(--border);border-radius:13px;padding:14px;display:flex;align-items:center;gap:10px;transition:.2s}
.sc:hover{border-color:var(--p-mid);box-shadow:0 3px 12px rgba(124,58,237,0.07)}
.sic{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sic.a{background:var(--p-light)}.sic.a svg{stroke:var(--p)}
.sic.y{background:var(--yellow-l)}.sic.y svg{stroke:var(--yellow)}
.sic.g{background:var(--green-l)}.sic.g svg{stroke:var(--green)}
.sic.pk{background:#fce7f3}.sic.pk svg{stroke:#db2777}
.sn{font-size:22px;font-weight:900}.st{font-size:10px;color:var(--muted);margin-top:2px}
.comm-banner{background:linear-gradient(135deg,#064e3b,#065f46);border-radius:16px;padding:20px 24px;margin-bottom:18px;display:grid;grid-template-columns:repeat(3,1fr);gap:14px;position:relative;overflow:hidden}
.comm-banner::before{content:'';position:absolute;width:180px;height:180px;border-radius:50%;background:rgba(255,255,255,0.04);top:-40px;left:-40px}
.ci{text-align:center;position:relative}
.ci+.ci{border-right:1px solid rgba(255,255,255,0.1)}
.cn{font-size:24px;font-weight:900;color:#fff;line-height:1}.cn span{font-size:12px}
.ct{font-size:10px;color:rgba(255,255,255,0.6);margin-top:3px}
.cl{display:inline-block;background:rgba(255,255,255,0.1);border-radius:20px;padding:2px 8px;font-size:9px;color:rgba(255,255,255,0.8);font-weight:700;margin-top:4px}
.card{background:var(--white);border:1px solid var(--border);border-radius:13px;padding:16px;margin-bottom:14px}
.ch{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px}
.ch h3{font-size:14px;font-weight:800}
.ch-link{font-size:12px;color:var(--p);font-weight:700;background:none;border:none;cursor:pointer;font-family:'Tajawal',sans-serif}
.search-inp{padding:7px 11px;border:1.5px solid var(--border);border-radius:8px;font-family:'Tajawal',sans-serif;font-size:13px;outline:none;transition:.15s}
.search-inp:focus{border-color:var(--p)}
.tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
.tbl{width:100%;border-collapse:collapse;min-width:500px}
.tbl th{font-size:11px;font-weight:700;color:var(--muted);padding:8px 10px;text-align:right;background:var(--bg);border-bottom:1px solid var(--border);white-space:nowrap}
.tbl td{font-size:12px;padding:10px;border-bottom:1px solid var(--border);color:var(--text);font-weight:500;white-space:nowrap}
.tbl tr:last-child td{border-bottom:none}
.tbl tr:hover td{background:#faf9ff}
.tag{padding:3px 8px;border-radius:20px;font-size:10px;font-weight:700;display:inline-flex;align-items:center;gap:3px;white-space:nowrap}
.t-open{background:var(--green-l);color:var(--green)}.t-prog{background:var(--blue-l);color:var(--blue)}.t-done{background:var(--p-light);color:var(--p)}.t-rev{background:var(--yellow-l);color:var(--yellow)}
.t-cl{background:#e0f2fe;color:#0369a1}.t-pr{background:var(--green-l);color:var(--green)}.t-ad{background:var(--p-light);color:var(--p)}
.t-paid{background:var(--green-l);color:var(--green)}
.comm-amt{font-size:13px;font-weight:800;color:#059669}
.btn-pay{padding:5px 10px;background:var(--green-l);color:var(--green);border:none;border-radius:7px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;transition:.15s}
.btn-pay:hover{background:#bbf7d0}
.late{color:var(--red)!important;font-weight:700}
.home-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.user-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border)}
.user-row:last-child{border-bottom:none}
.user-av{width:32px;height:32px;border-radius:9px;background:var(--p);color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.user-name{font-size:13px;font-weight:700}
.user-meta{font-size:11px;color:var(--muted)}
.empty{text-align:center;padding:32px 16px;color:var(--muted)}
.empty h4{font-size:13px;font-weight:700;color:var(--text);margin-bottom:3px}
.loading{text-align:center;padding:24px;color:var(--muted);font-size:13px}
@media(max-width:1024px){.stat-grid{grid-template-columns:repeat(2,1fr)}.home-grid{grid-template-columns:1fr}}
@media(max-width:768px){
  .side,.topbar{display:none}.main{margin-right:0}
  .mob-head{display:flex}.bnav{display:block}
  .content{padding:10px 12px;padding-bottom:82px}
  .stat-grid{grid-template-columns:repeat(2,1fr);gap:8px}
  .sc{padding:12px}.sic{width:36px;height:36px}.sn{font-size:20px}
  .comm-banner{grid-template-columns:1fr;padding:14px;gap:10px}
  .ci+.ci{border-right:none;border-top:1px solid rgba(255,255,255,0.1);padding-top:10px}
  .cn{font-size:20px}
  .card{padding:12px}
  .ch{flex-direction:column;align-items:flex-start}
  .search-inp{width:100%}
}
</style>
</head>
<body>
<div class="side">
  <div class="side-head">
    <div class="logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></div>
    <div class="admin-badge">
      <div class="ab-ic"><svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
      <div><div class="ab-name">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</div><div class="ab-role">ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©</div></div>
    </div>
  </div>
  <div class="nav">
    <div class="nav-sec">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    <button class="ni on" onclick="show('home',this,'home')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg></div>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="ni" onclick="show('comms',this,'comms')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg></div>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</button>
    <button class="ni" onclick="show('reqs',this,'reqs')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
    <button class="ni" onclick="show('users',this,'users')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</button>
    <button class="ni" onclick="show('revs',this,'revs')"><div class="ni-ic"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
  </div>
  <div class="side-foot">
    <button class="logoutbtn" onclick="logout()"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>
<div class="mob-head">
  <div><div class="mob-logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span> ğŸ›¡ï¸</div><div class="mob-time" id="clock-m"></div></div>
  <button class="mob-out" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</div>
<div class="main">
  <div class="topbar">
    <div class="topbar-title">ğŸ›¡ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</div>
    <div class="topbar-time" id="clock"></div>
  </div>
  <div class="content">
    <div class="page on" id="page-home">
      <div class="stat-grid">
        <div class="sc"><div class="sic a"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div><div><div class="sn" id="st-u">â€“</div><div class="st">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div></div></div>
        <div class="sc"><div class="sic y"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><div><div class="sn" id="st-r">â€“</div><div class="st">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div></div></div>
        <div class="sc"><div class="sic g"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 7H4a2 2 0 00-2 2v6a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg></div><div><div class="sn" id="st-p">â€“</div><div class="st">Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†</div></div></div>
        <div class="sc"><div class="sic pk"><svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg></div><div><div class="sn" id="st-b">â€“</div><div class="st">Ø§Ù„Ø¹Ø±ÙˆØ¶</div></div></div>
      </div>
      <div class="comm-banner">
        <div class="ci"><div class="cn" id="hc-total">0 <span>Ø±.Ø³</span></div><div class="ct">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙ‚Ø§Øª</div><div class="cl">ğŸ’¼ Ø§Ù„ÙƒÙ„</div></div>
        <div class="ci"><div class="cn" id="hc-due">0 <span>Ø±.Ø³</span></div><div class="ct">Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø³ØªØ­Ù‚Ø© 1%</div><div class="cl">ğŸ’° Ù…Ø³ØªØ­Ù‚Ø©</div></div>
        <div class="ci"><div class="cn" id="hc-paid">0 <span>Ø±.Ø³</span></div><div class="ct">Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø­ØµÙ‘Ù„Ø©</div><div class="cl">âœ“ Ù…Ø­ØµÙ‘Ù„Ø©</div></div>
      </div>
      <div class="home-grid">
        <div class="card"><div class="ch"><h3>Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><button class="ch-link" onclick="show('reqs',null,'reqs')">Ø§Ù„ÙƒÙ„ â†</button></div><div id="home-reqs"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
        <div class="card"><div class="ch"><h3>Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3><button class="ch-link" onclick="show('users',null,'users')">Ø§Ù„ÙƒÙ„ â†</button></div><div id="home-users"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div>
      </div>
    </div>
    <div class="page" id="page-comms">
      <div class="comm-banner" style="margin-bottom:16px">
        <div class="ci"><div class="cn" id="cc-total">0 <span>Ø±.Ø³</span></div><div class="ct">Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="cl">ğŸ’¼ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div></div>
        <div class="ci"><div class="cn" id="cc-due">0 <span>Ø±.Ø³</span></div><div class="ct">Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø³ØªØ­Ù‚Ø© 1%</div><div class="cl">â³ Ù…Ø³ØªØ­Ù‚Ø©</div></div>
        <div class="ci"><div class="cn" id="cc-pend">0</div><div class="ct">Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­ØµÙŠÙ„</div><div class="cl">ğŸ“Š Ù…Ø¹Ù„Ù‘Ù‚Ø©</div></div>
      </div>
      <div class="card"><div class="ch"><h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</h3><input class="search-inp" id="comm-s" placeholder="Ø¨Ø­Ø«..." oninput="filterComms()"></div><div class="tbl-wrap"><div id="comm-tbl"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div></div>
    </div>
    <div class="page" id="page-reqs">
      <div class="card"><div class="ch"><h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><input class="search-inp" id="req-s" placeholder="Ø¨Ø­Ø«..." oninput="filterReqs()"></div><div class="tbl-wrap"><div id="reqs-tbl"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div></div>
    </div>
    <div class="page" id="page-users">
      <div class="card"><div class="ch"><h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3><input class="search-inp" id="usr-s" placeholder="Ø¨Ø­Ø«..." oninput="filterUsers()"></div><div class="tbl-wrap"><div id="users-tbl"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div></div>
    </div>
    <div class="page" id="page-revs">
      <div class="card"><div class="ch"><h3>ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†</h3></div><div class="tbl-wrap"><div id="revs-tbl"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div></div></div>
    </div>
  </div>
</div>
<div class="bnav"><div class="bnav-inner">
  <button class="bni on" id="bn-home" onclick="show('home',null,'home')"><div class="bic"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg></div><span class="bt">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
  <button class="bni" id="bn-comms" onclick="show('comms',null,'comms')"><div class="bic"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg></div><span class="bt">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</span></button>
  <button class="bni" id="bn-reqs" onclick="show('reqs',null,'reqs')"><div class="bic"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/></svg></div><span class="bt">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span></button>
  <button class="bni" id="bn-users" onclick="show('users',null,'users')"><div class="bic"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div><span class="bt">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</span></button>
  <button class="bni" id="bn-revs" onclick="show('revs',null,'revs')"><div class="bic"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div><span class="bt">ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span></button>
</div></div>
<script>
var API='https://manaqasati-production.up.railway.app';
var user=JSON.parse(localStorage.getItem('user')||'{}');
var token=localStorage.getItem('token')||'';
if(!user.id||user.role!=='admin'){location.href='auth.html';}
var allReqs=[],allUsers=[],allComms=[];
var paidComms=JSON.parse(localStorage.getItem('paidComms')||'[]');

function clk(){var n=new Date(),t=n.toLocaleDateString('ar-SA')+' â€“ '+n.toLocaleTimeString('ar-SA');var c=document.getElementById('clock');var cm=document.getElementById('clock-m');if(c)c.textContent=t;if(cm)cm.textContent=t;}
setInterval(clk,1000);clk();

function hdr(){return{headers:{'Content-Type':'application/json','Authorization':'Bearer '+token}};}

function show(pg,el,key){
  document.querySelectorAll('.page').forEach(function(p){p.className='page';});
  document.querySelectorAll('.ni').forEach(function(m){m.className='ni';});
  document.querySelectorAll('.bni').forEach(function(m){m.className='bni';});
  document.getElementById('page-'+pg).className='page on';
  if(el)el.className='ni on';
  if(key){var b=document.getElementById('bn-'+key);if(b)b.className='bni on';}
  if(pg==='home')loadHome();
  if(pg==='comms')loadComms();
  if(pg==='reqs')loadReqs();
  if(pg==='users')loadUsers();
  if(pg==='revs')loadRevs();
  window.scrollTo(0,0);
}

function logout(){localStorage.clear();location.href='auth.html';}

function stTag(s){
  if(s==='open')return '<span class="tag t-open">Ù†Ø´Ø·</span>';
  if(s==='in_progress')return '<span class="tag t-prog">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>';
  if(s==='done')return '<span class="tag t-done">Ù…ÙƒØªÙ…Ù„</span>';
  return '<span class="tag t-rev">Ù…Ø±Ø§Ø¬Ø¹Ø©</span>';
}
function roleTag(r){if(r==='provider')return '<span class="tag t-pr">Ù…Ø²ÙˆØ¯</span>';if(r==='admin')return '<span class="tag t-ad">Ù…Ø¯ÙŠØ±</span>';return '<span class="tag t-cl">Ø¹Ù…ÙŠÙ„</span>';}
function stars(n){var s='';for(var i=1;i<=5;i++)s+=i<=n?'â˜…':'â˜†';return s;}
function timeAgo(d){var diff=(new Date()-new Date(d))/1000;if(diff<60)return 'Ø§Ù„Ø¢Ù†';if(diff<3600)return Math.floor(diff/60)+' Ø¯';if(diff<86400)return Math.floor(diff/3600)+' Ø³';return Math.floor(diff/86400)+' ÙŠÙˆÙ…';}
function emptyH(t){return '<div class="empty"><h4>'+t+'</h4></div>';}

function loadHome(){
  fetch(API+'/api/admin/stats',hdr()).then(function(r){return r.json();}).then(function(s){
    document.getElementById('st-u').textContent=s.users||0;
    document.getElementById('st-r').textContent=s.requests||0;
    document.getElementById('st-p').textContent=s.providers||0;
    document.getElementById('st-b').textContent=s.bids||0;
  }).catch(function(){});
  fetch(API+'/api/admin/requests',hdr()).then(function(r){return r.json();}).then(function(reqs){
    allReqs=reqs;
    var done=reqs.filter(function(r){return r.status==='done';});
    var tot=done.reduce(function(s,r){return s+(r.budget_max||0);},0);
    var due=Math.round(tot*0.01);
    var pd=paidComms.reduce(function(s,id){var r=done.find(function(x){return x.id==id;});return s+(r?Math.round((r.budget_max||0)*0.01):0);},0);
    document.getElementById('hc-total').innerHTML=tot.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('hc-due').innerHTML=due.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('hc-paid').innerHTML=pd.toLocaleString()+' <span>Ø±.Ø³</span>';
    if(!reqs.length){document.getElementById('home-reqs').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª');return;}
    var h='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
    reqs.slice(0,8).forEach(function(r){h+='<tr><td>#'+r.id+'</td><td>'+r.title+'</td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.budget_max?r.budget_max.toLocaleString()+' Ø±.Ø³':'â€“')+'</td><td>'+stTag(r.status)+'</td></tr>';});
    document.getElementById('home-reqs').innerHTML=h+'</tbody></table>';
  }).catch(function(){});
  fetch(API+'/api/admin/users',hdr()).then(function(r){return r.json();}).then(function(users){
    allUsers=users;
    if(!users.length){document.getElementById('home-users').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');return;}
    document.getElementById('home-users').innerHTML=users.slice(0,8).map(function(u){
      return '<div class="user-row"><div class="user-av">'+u.name.charAt(0)+'</div><div style="flex:1"><div class="user-name">'+u.name+'</div><div class="user-meta">'+u.email+'</div></div>'+roleTag(u.role)+'</div>';
    }).join('');
  }).catch(function(){});
}

function loadComms(){
  fetch(API+'/api/admin/requests',hdr()).then(function(r){return r.json();}).then(function(reqs){
    allComms=reqs.filter(function(r){return r.status==='done';});
    var tot=allComms.reduce(function(s,r){return s+(r.budget_max||0);},0);
    var due=Math.round(tot*0.01);
    var pend=allComms.filter(function(r){return paidComms.indexOf(r.id)===-1;}).length;
    document.getElementById('cc-total').innerHTML=tot.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('cc-due').innerHTML=due.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('cc-pend').textContent=pend;
    renderComms(allComms);
  }).catch(function(){});
}
function renderComms(list){
  if(!list.length){document.getElementById('comm-tbl').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©');return;}
  var h='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙÙ‚Ø©</th><th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© 1%</th><th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¯ÙØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
  list.forEach(function(r){
    var comm=Math.round((r.budget_max||0)*0.01);
    var isPaid=paidComms.indexOf(r.id)!==-1;
    var dl=new Date(r.created_at);dl.setDate(dl.getDate()+10);
    var late=!isPaid&&new Date()>dl;
    h+='<tr><td>#'+r.id+'</td><td>'+r.title+'</td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.city||'â€“')+'</td><td>'+(r.budget_max||0).toLocaleString()+' Ø±.Ø³</td><td class="comm-amt">'+comm.toLocaleString()+' Ø±.Ø³</td><td class="'+(late?'late':'')+'">'+dl.toLocaleDateString('ar')+'</td><td>'+(isPaid?'<span class="tag t-paid">âœ“ Ù…Ø­ØµÙ‘Ù„Ø©</span>':'<button class="btn-pay" onclick="markPaid('+r.id+')">ØªØ­ØµÙŠÙ„</button>')+'</td></tr>';
  });
  document.getElementById('comm-tbl').innerHTML=h+'</tbody></table>';
}
function filterComms(){
  var q=document.getElementById('comm-s').value.toLowerCase();
  renderComms(allComms.filter(function(r){return r.title.toLowerCase().includes(q)||(r.client_name||'').toLowerCase().includes(q);}));
}
function markPaid(id){
  if(paidComms.indexOf(id)===-1){paidComms.push(id);localStorage.setItem('paidComms',JSON.stringify(paidComms));}
  loadComms();loadHome();
}

function loadReqs(){
  document.getElementById('reqs-tbl').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/admin/requests',hdr()).then(function(r){return r.json();}).then(function(r){allReqs=r;renderReqs(r);}).catch(function(){});
}
function renderReqs(reqs){
  if(!reqs.length){document.getElementById('reqs-tbl').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª');return;}
  var h='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„ØªØµÙ†ÙŠÙ</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ø¹Ø±ÙˆØ¶</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead><tbody>';
  reqs.forEach(function(r){h+='<tr><td>#'+r.id+'</td><td>'+r.title+'</td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.category||'â€“')+'</td><td>'+(r.city||'â€“')+'</td><td>'+(r.budget_max?r.budget_max.toLocaleString()+' Ø±.Ø³':'â€“')+'</td><td>'+(r.bid_count||0)+'</td><td>'+stTag(r.status)+'</td><td>'+new Date(r.created_at).toLocaleDateString('ar')+'</td></tr>';});
  document.getElementById('reqs-tbl').innerHTML=h+'</tbody></table>';
}
function filterReqs(){
  var q=document.getElementById('req-s').value.toLowerCase();
  renderReqs(allReqs.filter(function(r){return r.title.toLowerCase().includes(q)||(r.client_name||'').toLowerCase().includes(q)||(r.category||'').toLowerCase().includes(q)||(r.city||'').toLowerCase().includes(q);}));
}

function loadUsers(){
  document.getElementById('users-tbl').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/admin/users',hdr()).then(function(r){return r.json();}).then(function(u){allUsers=u;renderUsers(u);}).catch(function(){});
}
function renderUsers(users){
  if(!users.length){document.getElementById('users-tbl').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');return;}
  var h='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„ØªØ®ØµØµØ§Øª</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr></thead><tbody>';
  users.forEach(function(u){
    var specs=u.specialties&&u.specialties.length?u.specialties.slice(0,2).join('ØŒ ')+(u.specialties.length>2?' +'+(u.specialties.length-2):''):'â€“';
    h+='<tr><td>#'+u.id+'</td><td>'+u.name+'</td><td>'+u.email+'</td><td>'+(u.phone||'â€“')+'</td><td>'+(u.city||'â€“')+'</td><td>'+roleTag(u.role)+'</td><td style="max-width:150px;white-space:normal;font-size:11px">'+specs+'</td><td>'+new Date(u.created_at).toLocaleDateString('ar')+'</td></tr>';
  });
  document.getElementById('users-tbl').innerHTML=h+'</tbody></table>';
}
function filterUsers(){
  var q=document.getElementById('usr-s').value.toLowerCase();
  renderUsers(allUsers.filter(function(u){return u.name.toLowerCase().includes(q)||u.email.toLowerCase().includes(q)||(u.city||'').toLowerCase().includes(q);}));
}

function loadRevs(){
  document.getElementById('revs-tbl').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/admin/users',hdr()).then(function(r){return r.json();}).then(function(users){
    var provs=users.filter(function(u){return u.role==='provider';});
    if(!provs.length){document.getElementById('revs-tbl').innerHTML=emptyH('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙŠÙ† Ø¨Ø¹Ø¯');return;}
    Promise.all(provs.map(function(p){return fetch(API+'/api/reviews/provider/'+p.id).then(function(r){return r.json();}).then(function(d){return{p:p,d:d};});})).then(function(res){
      var h='<table class="tbl"><thead><tr><th>Ø§Ù„Ù…Ø²ÙˆØ¯</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ØªØ®ØµØµØ§Øª</th><th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</th><th>Ø§Ù„Ù…ØªÙˆØ³Ø·</th><th>Ø§Ù„Ù†Ø¬ÙˆÙ…</th></tr></thead><tbody>';
      res.sort(function(a,b){return b.d.average-a.d.average;}).forEach(function(x){
        var specs=x.p.specialties&&x.p.specialties.length?x.p.specialties.slice(0,2).join('ØŒ '):'â€“';
        h+='<tr><td>'+x.p.name+'</td><td>'+(x.p.city||'â€“')+'</td><td style="font-size:11px">'+specs+'</td><td>'+x.d.count+'</td><td><strong>'+(x.d.average||0)+'</strong></td><td style="color:#f59e0b;letter-spacing:2px">'+stars(Math.round(x.d.average||0))+'</td></tr>';
      });
      document.getElementById('revs-tbl').innerHTML=h+'</tbody></table>';
    });
  }).catch(function(){});
}

loadHome();
</script>
</body>
</html>
