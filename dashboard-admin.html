<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--p:#7c3aed;--p2:#6d28d9;--p-light:#ede9fe;--p-mid:#ddd6fe;--text:#1e1b4b;--muted:#6b7280;--border:#e5e7eb;--bg:#f8f7ff}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh}
.side{width:260px;background:#fff;border-left:1px solid var(--border);min-height:100vh;position:fixed;right:0;top:0;display:flex;flex-direction:column;box-shadow:2px 0 20px rgba(0,0,0,0.04)}
.side-head{padding:24px 20px;border-bottom:1px solid var(--border)}
.side-logo{font-size:22px;font-weight:900;color:var(--p);margin-bottom:16px}
.side-logo span{color:#f59e0b}
.admin-badge{background:linear-gradient(135deg,var(--p),var(--p2));border-radius:14px;padding:14px;display:flex;align-items:center;gap:12px}
.admin-av{width:42px;height:42px;border-radius:12px;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.admin-name{font-size:14px;font-weight:800;color:#fff}
.admin-role{font-size:11px;color:rgba(255,255,255,0.7);font-weight:600;margin-top:2px}
.menu{padding:16px 12px;flex:1}
.menu-sec{font-size:11px;font-weight:700;color:var(--muted);padding:0 8px;margin:16px 0 8px}
.menu-item{display:flex;align-items:center;gap:10px;padding:11px 12px;border-radius:12px;color:var(--muted);cursor:pointer;transition:.2s;font-size:14px;font-weight:600;border:none;background:none;width:100%;text-align:right;font-family:'Tajawal',sans-serif;margin-bottom:2px}
.menu-item:hover{background:var(--bg);color:var(--text)}
.menu-item.on{background:var(--p-light);color:var(--p)}
.menu-item .ic{font-size:18px;width:26px;text-align:center}
.side-foot{padding:16px 20px;border-top:1px solid var(--border)}
.logout-btn{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;color:#ef4444;cursor:pointer;font-size:14px;font-weight:700;border:none;background:none;width:100%;font-family:'Tajawal',sans-serif}
.logout-btn:hover{background:#fee2e2}
.main{margin-right:260px;flex:1;display:flex;flex-direction:column}
.topbar{background:#fff;border-bottom:1px solid var(--border);padding:0 28px;height:64px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar-title{font-size:18px;font-weight:800}
.topbar-time{font-size:13px;color:var(--muted);font-weight:600}
.content{padding:28px;flex:1}
.page{display:none}.page.on{display:block}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.stat-card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;display:flex;align-items:center;gap:14px;transition:.2s}
.stat-card:hover{border-color:var(--p-mid);box-shadow:0 4px 20px rgba(124,58,237,0.08);transform:translateY(-2px)}
.stat-ic{width:50px;height:50px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.si1{background:var(--p-light)}.si2{background:#fef3c7}.si3{background:#dcfce7}.si4{background:#fce7f3}
.stat-n{font-size:26px;font-weight:900}
.stat-t{font-size:12px;color:var(--muted);margin-top:2px}
.commission-banner{background:linear-gradient(135deg,#064e3b,#065f46);border-radius:20px;padding:24px 28px;margin-bottom:24px;display:grid;grid-template-columns:repeat(3,1fr);gap:20px;position:relative;overflow:hidden}
.commission-banner::before{content:'';position:absolute;top:-40px;left:-40px;width:200px;height:200px;background:rgba(255,255,255,0.04);border-radius:50%}
.comm-item{text-align:center;position:relative}
.comm-item+.comm-item{border-right:1px solid rgba(255,255,255,0.1)}
.comm-n{font-size:32px;font-weight:900;color:#fff}
.comm-n span{font-size:16px}
.comm-t{font-size:13px;color:rgba(255,255,255,0.6);margin-top:4px}
.comm-label{display:inline-block;background:rgba(255,255,255,0.1);border-radius:20px;padding:3px 12px;font-size:11px;color:rgba(255,255,255,0.8);font-weight:700;margin-top:6px}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:20px}
.card-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;padding-bottom:14px;border-bottom:1px solid var(--border)}
.card-head h3{font-size:15px;font-weight:800}
.tbl{width:100%;border-collapse:collapse}
.tbl th{font-size:12px;font-weight:700;color:var(--muted);padding:10px 12px;text-align:right;background:var(--bg);border-bottom:1px solid var(--border)}
.tbl td{font-size:13px;padding:12px;border-bottom:1px solid var(--border);color:var(--text);font-weight:500}
.tbl tr:last-child td{border-bottom:none}
.tbl tr:hover td{background:var(--bg)}
.tag{padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;display:inline-block}
.t-review{background:#fef3c7;color:#d97706}
.t-open{background:#dcfce7;color:#16a34a}
.t-done{background:var(--p-light);color:var(--p)}
.t-client{background:#e0f2fe;color:#0369a1}
.t-provider{background:#dcfce7;color:#16a34a}
.t-admin{background:var(--p-light);color:var(--p)}
.t-paid{background:#dcfce7;color:#16a34a}
.comm-row-done td{background:#f0fdf4}
.comm-amount{font-size:14px;font-weight:800;color:#059669}
.btn-paid{padding:5px 12px;background:#dcfce7;color:#16a34a;border:none;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;transition:.2s}
.btn-paid:hover{background:#bbf7d0}
.empty{text-align:center;padding:40px;color:var(--muted)}
.empty-ic{font-size:40px;margin-bottom:10px}
.loading{text-align:center;padding:32px;color:var(--muted);font-size:14px}
.search-bar{padding:9px 14px;border:1.5px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;font-size:14px;outline:none;width:220px;transition:.2s}
.search-bar:focus{border-color:var(--p)}
</style>
</head>
<body>
<div class="side">
  <div class="side-head">
    <div class="side-logo">Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></div>
    <div class="admin-badge">
      <div class="admin-av">ğŸ‘‘</div>
      <div><div class="admin-name">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</div><div class="admin-role">ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©</div></div>
    </div>
  </div>
  <div class="menu">
    <div class="menu-sec">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    <button class="menu-item on" onclick="show('home',this)"><span class="ic">ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="menu-item" onclick="show('commissions',this)"><span class="ic">ğŸ’°</span> Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</button>
    <button class="menu-item" onclick="show('requests',this)"><span class="ic">ğŸ“‹</span> Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
    <button class="menu-item" onclick="show('users',this)"><span class="ic">ğŸ‘¥</span> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</button>
    <button class="menu-item" onclick="show('reviews',this)"><span class="ic">â­</span> Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
  </div>
  <div class="side-foot">
    <button class="logout-btn" onclick="logout()"><span>ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <div class="topbar-title">ğŸ‘‘ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</div>
    <div class="topbar-time" id="clock"></div>
  </div>
  <div class="content">
    <div class="page on" id="page-home">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-ic si1">ğŸ‘¥</div><div><div class="stat-n" id="st-users">â€“</div><div class="stat-t">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div></div></div>
        <div class="stat-card"><div class="stat-ic si2">ğŸ“‹</div><div><div class="stat-n" id="st-reqs">â€“</div><div class="stat-t">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div></div></div>
        <div class="stat-card"><div class="stat-ic si3">ğŸ”§</div><div><div class="stat-n" id="st-providers">â€“</div><div class="stat-t">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div></div></div>
        <div class="stat-card"><div class="stat-ic si4">ğŸ’°</div><div><div class="stat-n" id="st-bids">â€“</div><div class="stat-t">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶</div></div></div>
      </div>
      <div class="commission-banner">
        <div class="comm-item"><div class="comm-n" id="comm-total">0 <span>Ø±.Ø³</span></div><div class="comm-t">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="comm-label">ğŸ’¼ Ø§Ù„ØµÙÙ‚Ø§Øª</div></div>
        <div class="comm-item"><div class="comm-n" id="comm-due">0 <span>Ø±.Ø³</span></div><div class="comm-t">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© (1%)</div><div class="comm-label">ğŸ’° Ù…Ø³ØªØ­Ù‚Ø©</div></div>
        <div class="comm-item"><div class="comm-n" id="comm-paid">0 <span>Ø±.Ø³</span></div><div class="comm-t">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø­ØµÙ‘Ù„Ø©</div><div class="comm-label">âœ… Ù…Ø­ØµÙ‘Ù„Ø©</div></div>
      </div>
      <div class="card">
        <div class="card-head"><h3>ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3></div>
        <div id="home-reqs"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
    <div class="page" id="page-commissions">
      <div class="commission-banner" style="margin-bottom:24px">
        <div class="comm-item"><div class="comm-n" id="c-total">0 <span>Ø±.Ø³</span></div><div class="comm-t">Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="comm-label">ğŸ’¼ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div></div>
        <div class="comm-item"><div class="comm-n" id="c-due">0 <span>Ø±.Ø³</span></div><div class="comm-t">Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø³ØªØ­Ù‚Ø© (1%)</div><div class="comm-label">â³ Ù…Ø³ØªØ­Ù‚Ø©</div></div>
        <div class="comm-item"><div class="comm-n" id="c-pending-count">0</div><div class="comm-t">Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</div><div class="comm-label">ğŸ“Š Ù…Ø¹Ù„Ù‘Ù‚Ø©</div></div>
      </div>
      <div class="card">
        <div class="card-head"><h3>ğŸ’° Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª â€“ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3></div>
        <div id="comm-table"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
    <div class="page" id="page-requests">
      <div class="card">
        <div class="card-head"><h3>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><input class="search-bar" id="req-search" placeholder="ğŸ” Ø¨Ø­Ø«..." oninput="filterReqs()"></div>
        <div id="reqs-table"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
    <div class="page" id="page-users">
      <div class="card">
        <div class="card-head"><h3>ğŸ‘¥ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3><input class="search-bar" id="user-search" placeholder="ğŸ” Ø¨Ø­Ø«..." oninput="filterUsers()"></div>
        <div id="users-table"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
    <div class="page" id="page-reviews">
      <div class="card">
        <div class="card-head"><h3>â­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3></div>
        <div id="reviews-table"><div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
      </div>
    </div>
  </div>
</div>
<script>
var API='https://manaqasati-production.up.railway.app';
var user=JSON.parse(localStorage.getItem('user')||'{}');
if(!user.id||user.role!=='admin'){location.href='auth.html';}
var allReqs=[],allUsers=[],paidComms=JSON.parse(localStorage.getItem('paidComms')||'[]');
function updateClock(){var n=new Date();document.getElementById('clock').textContent=n.toLocaleDateString('ar-SA')+' â€“ '+n.toLocaleTimeString('ar-SA');}
setInterval(updateClock,1000);updateClock();
function show(page,el){
  document.querySelectorAll('.page').forEach(function(p){p.className='page';});
  document.querySelectorAll('.menu-item').forEach(function(m){m.className='menu-item';});
  document.getElementById('page-'+page).className='page on';
  if(el)el.className='menu-item on';
  if(page==='home')loadHome();
  if(page==='commissions')loadCommissions();
  if(page==='requests')loadRequests();
  if(page==='users')loadUsers();
  if(page==='reviews')loadReviews();
}
function logout(){localStorage.clear();location.href='auth.html';}
function statusTag(s){if(s==='open')return '<span class="tag t-open">Ù†Ø´Ø·</span>';if(s==='done')return '<span class="tag t-done">Ù…ÙƒØªÙ…Ù„</span>';return '<span class="tag t-review">Ù…Ø±Ø§Ø¬Ø¹Ø©</span>';}
function roleTag(r){if(r==='provider')return '<span class="tag t-provider">Ù…Ø²ÙˆØ¯</span>';if(r==='admin')return '<span class="tag t-admin">Ù…Ø¯ÙŠØ±</span>';return '<span class="tag t-client">Ø¹Ù…ÙŠÙ„</span>';}
function starsHtml(n){var s='';for(var i=1;i<=5;i++)s+=i<=n?'â­':'â˜†';return s;}
function loadHome(){
  fetch(API+'/api/admin/stats').then(function(r){return r.json();}).then(function(s){
    document.getElementById('st-users').textContent=s.users||0;
    document.getElementById('st-reqs').textContent=s.requests||0;
    document.getElementById('st-providers').textContent=s.providers||0;
    document.getElementById('st-bids').textContent=s.bids||0;
  }).catch(function(){});
  fetch(API+'/api/requests').then(function(r){return r.json();}).then(function(reqs){
    allReqs=reqs;
    var done=reqs.filter(function(r){return r.status==='done';});
    var total=done.reduce(function(s,r){return s+(r.budget_max||0);},0);
    var due=Math.round(total*0.01);
    var paid=paidComms.reduce(function(s,id){var r=done.find(function(x){return x.id==id;});return s+(r?Math.round((r.budget_max||0)*0.01):0);},0);
    document.getElementById('comm-total').innerHTML=total.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('comm-due').innerHTML=due.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('comm-paid').innerHTML=paid.toLocaleString()+' <span>Ø±.Ø³</span>';
    if(!reqs.length){document.getElementById('home-reqs').innerHTML='<div class="empty"><div class="empty-ic">ğŸ“­</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p></div>';return;}
    var html='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„ØªØµÙ†ÙŠÙ</th><th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
    reqs.slice(0,8).forEach(function(r){html+='<tr><td>#'+r.id+'</td><td>'+r.title+'</td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.category||'â€“')+'</td><td>'+(r.budget_max?r.budget_max+' Ø±.Ø³':'â€“')+'</td><td>'+statusTag(r.status)+'</td></tr>';});
    html+='</tbody></table>';
    document.getElementById('home-reqs').innerHTML=html;
  }).catch(function(){});
}
function loadCommissions(){
  fetch(API+'/api/requests').then(function(r){return r.json();}).then(function(reqs){
    var done=reqs.filter(function(r){return r.status==='done';});
    var total=done.reduce(function(s,r){return s+(r.budget_max||0);},0);
    var due=Math.round(total*0.01);
    var pending=done.filter(function(r){return paidComms.indexOf(r.id)===-1;}).length;
    document.getElementById('c-total').innerHTML=total.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('c-due').innerHTML=due.toLocaleString()+' <span>Ø±.Ø³</span>';
    document.getElementById('c-pending-count').textContent=pending;
    if(!done.length){document.getElementById('comm-table').innerHTML='<div class="empty"><div class="empty-ic">ğŸ’°</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯</p></div>';return;}
    var html='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙÙ‚Ø©</th><th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© 1%</th><th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¯ÙØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
    done.forEach(function(r){
      var comm=Math.round((r.budget_max||0)*0.01);
      var isPaid=paidComms.indexOf(r.id)!==-1;
      var deadline=new Date(r.created_at);deadline.setDate(deadline.getDate()+10);
      var isLate=!isPaid&&new Date()>deadline;
      html+='<tr class="comm-row-done"><td>#'+r.id+'</td><td>'+r.title+'</td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.budget_max||0).toLocaleString()+' Ø±.Ø³</td><td class="comm-amount">'+comm.toLocaleString()+' Ø±.Ø³</td><td style="color:'+(isLate?'#dc2626':'var(--muted)')+'">'+deadline.toLocaleDateString('ar')+'</td><td>'+(isPaid?'<span class="tag t-paid">âœ… Ù…Ø­ØµÙ‘Ù„Ø©</span>':'<button class="btn-paid" onclick="markPaid('+r.id+')">ğŸ’° ØªØ­ØµÙŠÙ„</button>')+'</td></tr>';
    });
    html+='</tbody></table>';
    document.getElementById('comm-table').innerHTML=html;
  }).catch(function(){document.getElementById('comm-table').innerHTML='<div class="empty"><div class="empty-ic">âš ï¸</div><p>ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';});
}
function markPaid(id){if(paidComms.indexOf(id)===-1){paidComms.push(id);localStorage.setItem('paidComms',JSON.stringify(paidComms));}loadCommissions();loadHome();}
function loadRequests(){
  document.getElementById('reqs-table').innerHTML='<div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/requests').then(function(r){return r.json();}).then(function(reqs){allReqs=reqs;renderReqs(reqs);}).catch(function(){document.getElementById('reqs-table').innerHTML='<div class="empty"><div class="empty-ic">âš ï¸</div><p>ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';});
}
function renderReqs(reqs){
  if(!reqs.length){document.getElementById('reqs-table').innerHTML='<div class="empty"><div class="empty-ic">ğŸ“­</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p></div>';return;}
  var html='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„ØªØµÙ†ÙŠÙ</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead><tbody>';
  reqs.forEach(function(r){html+='<tr><td>#'+r.id+'</td><td>'+r.title+'</td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.category||'â€“')+'</td><td>'+(r.city||'â€“')+'</td><td>'+(r.budget_max?r.budget_max+' Ø±.Ø³':'â€“')+'</td><td>'+statusTag(r.status)+'</td><td>'+new Date(r.created_at).toLocaleDateString('ar')+'</td></tr>';});
  html+='</tbody></table>';
  document.getElementById('reqs-table').innerHTML=html;
}
function filterReqs(){var q=document.getElementById('req-search').value.toLowerCase();renderReqs(allReqs.filter(function(r){return r.title.toLowerCase().includes(q)||(r.client_name||'').toLowerCase().includes(q)||(r.category||'').toLowerCase().includes(q);}));}
function loadUsers(){
  document.getElementById('users-table').innerHTML='<div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/admin/users').then(function(r){return r.json();}).then(function(users){allUsers=users;renderUsers(users);}).catch(function(){document.getElementById('users-table').innerHTML='<div class="empty"><div class="empty-ic">âš ï¸</div><p>ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';});
}
function renderUsers(users){
  if(!users.length){document.getElementById('users-table').innerHTML='<div class="empty"><div class="empty-ic">ğŸ‘¥</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p></div>';return;}
  var html='<table class="tbl"><thead><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr></thead><tbody>';
  users.forEach(function(u){html+='<tr><td>#'+u.id+'</td><td>'+u.name+'</td><td>'+u.email+'</td><td>'+(u.phone||'â€“')+'</td><td>'+roleTag(u.role)+'</td><td>'+new Date(u.created_at).toLocaleDateString('ar')+'</td></tr>';});
  html+='</tbody></table>';
  document.getElementById('users-table').innerHTML=html;
}
function filterUsers(){var q=document.getElementById('user-search').value.toLowerCase();renderUsers(allUsers.filter(function(u){return u.name.toLowerCase().includes(q)||u.email.toLowerCase().includes(q);}));}
function loadReviews(){
  document.getElementById('reviews-table').innerHTML='<div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/admin/users').then(function(r){return r.json();}).then(function(users){
    var providers=users.filter(function(u){return u.role==='provider';});
    if(!providers.length){document.getElementById('reviews-table').innerHTML='<div class="empty"><div class="empty-ic">â­</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙŠÙ† Ø¨Ø¹Ø¯</p></div>';return;}
    Promise.all(providers.map(function(p){return fetch(API+'/api/reviews/provider/'+p.id).then(function(r){return r.json();}).then(function(d){return{provider:p,data:d};});})).then(function(results){
      var html='<table class="tbl"><thead><tr><th>Ø§Ù„Ù…Ø²ÙˆØ¯</th><th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</th><th>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„Ù†Ø¬ÙˆÙ…</th></tr></thead><tbody>';
      results.forEach(function(res){html+='<tr><td>'+res.provider.name+'</td><td>'+res.data.count+'</td><td><strong>'+(res.data.average||0)+'</strong></td><td>'+starsHtml(Math.round(res.data.average||0))+'</td></tr>';});
      html+='</tbody></table>';
      document.getElementById('reviews-table').innerHTML=html;
    });
  }).catch(function(){document.getElementById('reviews-table').innerHTML='<div class="empty"><div class="empty-ic">âš ï¸</div><p>ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';});
}
loadHome();
</script>
</body>
</html>
