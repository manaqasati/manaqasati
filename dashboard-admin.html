<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>ŸÖŸÜÿßŸÇÿµÿ© ‚Äî ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ≤ŸàÿØ</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<style>
:root {
  --c-bg: #080c14;
  --c-surface: #0d1422;
  --c-surface-2: #111926;
  --c-surface-3: #161f2e;
  --c-border: rgba(255,255,255,.07);
  --c-border-2: rgba(255,255,255,.04);
  --c-gold: #e8b84b;
  --c-gold-2: #f5d07a;
  --c-gold-dim: rgba(232,184,75,.12);
  --c-gold-glow: rgba(232,184,75,.25);
  --c-emerald: #00c97a;
  --c-emerald-dim: rgba(0,201,122,.1);
  --c-blue: #3b8df5;
  --c-blue-dim: rgba(59,141,245,.1);
  --c-red: #ff4d67;
  --c-red-dim: rgba(255,77,103,.1);
  --c-amber: #f59e0b;
  --c-amber-dim: rgba(245,158,11,.1);
  --c-violet: #8b5cf6;
  --c-violet-dim: rgba(139,92,246,.1);
  --c-text: #e8eaf2;
  --c-text-2: #8a93a8;
  --c-text-3: #4a5568;
  --sidebar-w: 256px;
  --topbar-h: 58px;
  --r: 10px;
  --r-lg: 16px;
  --r-xl: 20px;
  --r-full: 9999px;
  --shadow: 0 8px 32px rgba(0,0,0,.4);
  --shadow-sm: 0 2px 8px rgba(0,0,0,.3);
  --t: 180ms cubic-bezier(.4,0,.2,1);
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'IBM Plex Sans Arabic', sans-serif; font-size:14px; background:var(--c-bg); color:var(--c-text); display:flex; min-height:100vh; overflow-x:hidden; -webkit-font-smoothing:antialiased; }
a { text-decoration:none; color:inherit; }
button { font-family:inherit; cursor:pointer; border:none; background:none; color:inherit; }
input, select, textarea { font-family:inherit; font-size:inherit; }
::-webkit-scrollbar { width:4px; height:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,.1); border-radius:99px; }
::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,.2); }

body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  opacity:.4;
}

.sidebar {
  width:var(--sidebar-w); background:var(--c-surface);
  border-left:1px solid var(--c-border);
  position:fixed; top:0; right:0; bottom:0; z-index:300;
  display:flex; flex-direction:column;
  transition:transform var(--t);
}
.sidebar::after {
  content:''; position:absolute; top:0; left:0; width:1px; height:100%;
  background:linear-gradient(180deg, transparent, var(--c-gold) 40%, transparent);
  opacity:.3;
}

.sb-logo {
  height:var(--topbar-h); display:flex; align-items:center; gap:12px;
  padding:0 20px; border-bottom:1px solid var(--c-border); flex-shrink:0;
}
.sb-logo-mark {
  width:32px; height:32px; border-radius:8px;
  background:linear-gradient(135deg, var(--c-gold), #c8952c);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 0 16px var(--c-gold-glow);
}
.sb-logo-mark svg { width:17px; height:17px; stroke:#0d1422; fill:none; stroke-width:2.2; stroke-linecap:round; stroke-linejoin:round; }
.sb-logo-text { font-family:'Syne', sans-serif; font-size:18px; font-weight:800; color:#fff; letter-spacing:-0.5px; }
.sb-logo-text em { color:var(--c-gold); font-style:normal; }

.sb-user {
  padding:16px 20px; border-bottom:1px solid var(--c-border); flex-shrink:0;
}
.sb-user-row { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
.sb-avatar {
  width:40px; height:40px; border-radius:var(--r);
  background:linear-gradient(135deg,#2a1f5c,#4c35a0);
  display:flex; align-items:center; justify-content:center;
  font-size:16px; font-weight:700; color:#fff; flex-shrink:0;
  border:1.5px solid rgba(139,92,246,.4);
  box-shadow:0 0 20px rgba(139,92,246,.2);
}
.sb-name { font-size:13px; font-weight:600; color:#fff; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-bottom:2px; }
.sb-role { font-size:10px; color:var(--c-text-3); font-weight:500; }

.avail-toggle-row {
  display:flex; align-items:center; justify-content:space-between;
  background:var(--c-surface-3); border-radius:var(--r); padding:8px 12px;
  border:1px solid var(--c-border);
}
.avail-label { display:flex; align-items:center; gap:6px; font-size:11px; font-weight:600; color:var(--c-text-2); }
.avail-pulse { width:7px; height:7px; border-radius:50%; flex-shrink:0; }
.avail-pulse.on { background:var(--c-emerald); box-shadow:0 0 8px var(--c-emerald); animation:pulse 2s ease-in-out infinite; }
.avail-pulse.off { background:var(--c-text-3); }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:.4} }

.switch { position:relative; width:38px; height:20px; flex-shrink:0; cursor:pointer; }
.switch input { opacity:0; width:0; height:0; }
.switch-track {
  position:absolute; inset:0; border-radius:99px;
  background:var(--c-surface-3); border:1px solid var(--c-border);
  transition:background var(--t);
}
.switch input:checked ~ .switch-track { background:linear-gradient(90deg,#009e5f,var(--c-emerald)); border-color:var(--c-emerald); }
.switch-thumb {
  position:absolute; top:2px; width:16px; height:16px; border-radius:50%;
  background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.4);
  transition:right var(--t); right:2px; z-index:1;
}
.switch input:checked ~ .switch-track + .switch-thumb { right:20px; }

.sb-mini-stats { display:grid; grid-template-columns:repeat(3,1fr); border-bottom:1px solid var(--c-border); flex-shrink:0; }
.sb-mini-stat { padding:12px 8px; text-align:center; position:relative; }
.sb-mini-stat:not(:last-child)::after { content:''; position:absolute; left:0; top:20%; bottom:20%; width:1px; background:var(--c-border); }
.sb-mini-val { font-size:15px; font-weight:700; color:#fff; letter-spacing:-0.5px; }
.sb-mini-val.gold { color:var(--c-gold); }
.sb-mini-lbl { font-size:9px; color:var(--c-text-3); margin-top:2px; font-weight:500; }

.sb-nav { flex:1; overflow-y:auto; padding:10px 12px; scrollbar-width:none; }
.sb-nav::-webkit-scrollbar { display:none; }
.nav-section-label {
  font-size:9px; font-weight:700; color:var(--c-text-3);
  letter-spacing:1.2px; text-transform:uppercase;
  padding:12px 8px 5px; display:block;
}
.nav-btn {
  display:flex; align-items:center; gap:10px;
  padding:8px 10px; border-radius:var(--r); width:100%;
  font-size:12px; font-weight:500; color:var(--c-text-2);
  margin-bottom:2px; transition:all var(--t); text-align:right;
  position:relative; cursor:pointer;
}
.nav-btn:hover { background:var(--c-surface-3); color:var(--c-text); }
.nav-btn.active { background:var(--c-gold-dim); color:var(--c-gold); font-weight:600; }
.nav-btn.active::before {
  content:''; position:absolute; right:0; top:25%; bottom:25%;
  width:2px; border-radius:99px; background:var(--c-gold);
}
.nav-icon {
  width:30px; height:30px; border-radius:8px;
  display:flex; align-items:center; justify-content:center; flex-shrink:0;
  background:var(--c-surface-3); transition:background var(--t);
}
.nav-btn.active .nav-icon { background:var(--c-gold-dim); }
.nav-icon svg { width:14px; height:14px; stroke:currentColor; fill:none; stroke-width:1.7; stroke-linecap:round; stroke-linejoin:round; }
.nav-lbl { flex:1; }
.nav-chip { font-size:9px; font-weight:700; padding:2px 7px; border-radius:99px; flex-shrink:0; }
.chip-gold { background:var(--c-gold); color:#1a1000; }
.chip-red { background:var(--c-red); color:#fff; }
.chip-green { background:var(--c-emerald); color:#00220f; }
.chip-blue { background:var(--c-blue); color:#fff; }

.sb-bottom { padding:12px; border-top:1px solid var(--c-border); flex-shrink:0; }
.sb-ver { text-align:center; font-size:9px; color:var(--c-text-3); padding-top:8px; }

.main { margin-right:var(--sidebar-w); flex:1; display:flex; flex-direction:column; min-height:100vh; position:relative; z-index:1; }

.topbar {
  height:var(--topbar-h); background:rgba(13,20,34,.85);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--c-border);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 24px; position:sticky; top:0; z-index:100; flex-shrink:0;
}
.breadcrumb { display:flex; align-items:center; gap:8px; font-size:12px; }
.bc-sep { color:var(--c-text-3); }
.bc-root { color:var(--c-text-3); font-weight:500; }
.bc-cur { color:var(--c-text); font-weight:700; }

.topbar-right { display:flex; align-items:center; gap:8px; }
.tb-clock {
  font-size:11px; font-weight:600; color:var(--c-text-2);
  background:var(--c-surface-3); border:1px solid var(--c-border);
  padding:5px 12px; border-radius:var(--r);
  font-variant-numeric:tabular-nums; letter-spacing:.5px;
}
.tb-btn {
  width:34px; height:34px; border-radius:var(--r);
  background:var(--c-surface-3); border:1px solid var(--c-border);
  display:flex; align-items:center; justify-content:center;
  color:var(--c-text-2); cursor:pointer; transition:all var(--t); position:relative;
}
.tb-btn:hover { background:var(--c-surface-2); color:var(--c-text); border-color:rgba(255,255,255,.12); }
.tb-btn svg { width:14px; height:14px; stroke:currentColor; fill:none; stroke-width:1.7; stroke-linecap:round; stroke-linejoin:round; }
.notif-dot {
  position:absolute; top:5px; left:5px; width:6px; height:6px;
  border-radius:50%; background:var(--c-red);
  border:1.5px solid var(--c-surface-3);
  animation:pulse 2s ease-in-out infinite;
  display:none;
}

.page-content { padding:24px; flex:1; }
.page-header { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:24px; gap:12px; flex-wrap:wrap; }
.ph-title { font-size:20px; font-weight:700; color:#fff; letter-spacing:-0.4px; margin-bottom:3px; }
.ph-sub { font-size:12px; color:var(--c-text-2); font-weight:400; }
.ph-actions { display:flex; gap:8px; align-items:center; }

.btn {
  display:inline-flex; align-items:center; justify-content:center; gap:6px;
  padding:8px 16px; border-radius:var(--r); font-size:12px; font-weight:600;
  cursor:pointer; border:none; transition:all var(--t);
  white-space:nowrap; line-height:1;
}
.btn:active { transform:scale(.97); }
.btn svg { width:13px; height:13px; stroke:currentColor; fill:none; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; flex-shrink:0; }
.btn-gold { background:linear-gradient(135deg, var(--c-gold), #c8952c); color:#0d1422; font-weight:700; box-shadow:0 4px 16px rgba(232,184,75,.25); }
.btn-gold:hover { box-shadow:0 6px 24px rgba(232,184,75,.4); filter:brightness(1.05); }
.btn-ghost { background:var(--c-surface-3); color:var(--c-text-2); border:1px solid var(--c-border); }
.btn-ghost:hover { background:var(--c-surface-2); color:var(--c-text); border-color:rgba(255,255,255,.12); }
.btn-success { background:var(--c-emerald-dim); color:var(--c-emerald); border:1px solid rgba(0,201,122,.25); }
.btn-success:hover { background:rgba(0,201,122,.2); }
.btn-danger { background:var(--c-red-dim); color:var(--c-red); border:1px solid rgba(255,77,103,.2); }
.btn-danger:hover { background:rgba(255,77,103,.2); }
.btn-blue { background:var(--c-blue-dim); color:var(--c-blue); border:1px solid rgba(59,141,245,.2); }
.btn-blue:hover { background:rgba(59,141,245,.2); }
.btn-save { background:var(--c-amber-dim); color:var(--c-amber); border:1px solid rgba(245,158,11,.2); }
.btn-save:hover { background:rgba(245,158,11,.2); }
.btn-save.saved { background:var(--c-amber); color:#1a0f00; border-color:var(--c-amber); }
.btn-sm { padding:6px 12px; font-size:11px; }
.btn-xs { padding:4px 10px; font-size:10px; }

.badge {
  display:inline-flex; align-items:center; gap:4px;
  padding:3px 9px; border-radius:99px; font-size:10px; font-weight:600;
  white-space:nowrap; border:1px solid transparent;
}
.badge::before { content:''; width:4px; height:4px; border-radius:50%; flex-shrink:0; }
.badge-open { background:rgba(0,201,122,.1); color:var(--c-emerald); border-color:rgba(0,201,122,.2); }
.badge-open::before { background:var(--c-emerald); }
.badge-progress { background:var(--c-blue-dim); color:var(--c-blue); border-color:rgba(59,141,245,.2); }
.badge-progress::before { background:var(--c-blue); }
.badge-done { background:var(--c-violet-dim); color:var(--c-violet); border-color:rgba(139,92,246,.2); }
.badge-done::before { background:var(--c-violet); }
.badge-pending { background:var(--c-amber-dim); color:var(--c-amber); border-color:rgba(245,158,11,.2); }
.badge-pending::before { background:var(--c-amber); }
.badge-rejected { background:var(--c-red-dim); color:var(--c-red); border-color:rgba(255,77,103,.2); }
.badge-rejected::before { background:var(--c-red); }
.badge-accepted { background:rgba(0,201,122,.1); color:var(--c-emerald); border-color:rgba(0,201,122,.2); }
.badge-accepted::before { background:var(--c-emerald); }

.card {
  background:var(--c-surface); border:1px solid var(--c-border);
  border-radius:var(--r-lg); overflow:hidden; margin-bottom:16px;
  box-shadow:var(--shadow-sm);
}
.card:hover { border-color:rgba(255,255,255,.1); }
.card-header { padding:14px 18px; border-bottom:1px solid var(--c-border); display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.card-header-left { display:flex; align-items:center; gap:10px; }
.card-icon { width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.card-icon svg { width:15px; height:15px; stroke-width:1.7; stroke-linecap:round; stroke-linejoin:round; fill:none; }
.card-title { font-size:13px; font-weight:700; color:#fff; }
.card-sub { font-size:10px; color:var(--c-text-3); margin-top:2px; }
.card-body { padding:18px; }

.stats-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px; margin-bottom:20px; }
.stat-card {
  background:var(--c-surface); border:1px solid var(--c-border);
  border-radius:var(--r-lg); padding:18px;
  transition:all var(--t); cursor:default; position:relative; overflow:hidden;
}
.stat-card::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg, rgba(255,255,255,.02), transparent); pointer-events:none; }
.stat-card:hover { border-color:rgba(255,255,255,.12); transform:translateY(-2px); box-shadow:0 8px 32px rgba(0,0,0,.3); }
.stat-card-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
.stat-icon { width:38px; height:38px; border-radius:var(--r); display:flex; align-items:center; justify-content:center; }
.stat-icon svg { width:17px; height:17px; stroke-width:1.6; stroke-linecap:round; stroke-linejoin:round; fill:none; }
.stat-val { font-size:26px; font-weight:700; letter-spacing:-0.8px; line-height:1; margin-bottom:4px; color:#fff; }
.stat-lbl { font-size:11px; color:var(--c-text-2); font-weight:500; }
.stat-bar { height:2px; background:rgba(255,255,255,.05); border-radius:99px; margin-top:14px; overflow:hidden; }
.stat-bar-fill { height:100%; border-radius:99px; transition:width 1.4s cubic-bezier(.4,0,.2,1); }

.wallet-hero {
  background:var(--c-surface); border:1px solid var(--c-border);
  border-radius:var(--r-xl); padding:24px; margin-bottom:20px;
  position:relative; overflow:hidden;
}
.wallet-hero::before {
  content:''; position:absolute; inset:0;
  background: radial-gradient(ellipse 60% 70% at 10% 50%, rgba(232,184,75,.07), transparent), radial-gradient(ellipse 40% 60% at 90% 20%, rgba(139,92,246,.05), transparent);
}
.wallet-hero-grid { display:grid; grid-template-columns:1fr auto; gap:20px; align-items:start; position:relative; }
.wallet-label { font-size:10px; font-weight:600; color:var(--c-text-3); letter-spacing:1px; text-transform:uppercase; margin-bottom:6px; }
.wallet-amount { font-size:38px; font-weight:700; color:#fff; letter-spacing:-1.5px; line-height:1; margin-bottom:4px; }
.wallet-amount span { font-size:16px; font-weight:400; color:var(--c-text-3); }
.wallet-sub { font-size:11px; color:var(--c-text-2); }
.wallet-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:18px; position:relative; }
.wallet-stat { background:rgba(255,255,255,.04); border-radius:var(--r); padding:12px 14px; border:1px solid var(--c-border); }
.wallet-stat-val { font-size:16px; font-weight:700; color:#fff; letter-spacing:-0.4px; }
.wallet-stat-lbl { font-size:9px; color:var(--c-text-3); margin-top:3px; }
.wallet-badge { width:64px; height:64px; border-radius:var(--r-xl); background:linear-gradient(135deg, rgba(232,184,75,.15), rgba(232,184,75,.05)); border:1px solid rgba(232,184,75,.2); display:flex; align-items:center; justify-content:center; font-size:28px; flex-shrink:0; }

.proj-card {
  background:var(--c-surface-2); border:1px solid var(--c-border);
  border-radius:var(--r-lg); padding:18px; margin-bottom:10px;
  transition:all var(--t); position:relative; overflow:hidden;
}
.proj-card::before { content:''; position:absolute; top:0; right:0; width:3px; height:100%; border-radius:0 var(--r-lg) var(--r-lg) 0; background:var(--c-emerald); }
.proj-card.saved-card::before { background:var(--c-amber); }
.proj-card.prog-card::before { background:var(--c-blue); }
.proj-card.done-card::before { background:var(--c-violet); }
.proj-card:hover { border-color:rgba(255,255,255,.1); background:var(--c-surface-3); }
.proj-num { font-size:9px; font-weight:600; color:var(--c-text-3); letter-spacing:.5px; margin-bottom:4px; font-variant-numeric:tabular-nums; }
.proj-title { font-size:14px; font-weight:700; color:#fff; margin-bottom:10px; line-height:1.4; }
.proj-meta { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px; }
.meta-chip { display:inline-flex; align-items:center; gap:4px; padding:3px 9px; border-radius:99px; background:var(--c-surface-3); border:1px solid var(--c-border); font-size:10px; color:var(--c-text-2); font-weight:500; }
.meta-chip svg { width:10px; height:10px; stroke:currentColor; fill:none; stroke-width:2; flex-shrink:0; stroke-linecap:round; stroke-linejoin:round; }
.proj-desc { font-size:12px; color:var(--c-text-2); line-height:1.7; padding:10px 12px; background:rgba(255,255,255,.02); border-radius:var(--r); border-right:2px solid rgba(232,184,75,.3); margin-bottom:12px; }
.proj-actions { display:flex; gap:6px; flex-wrap:wrap; align-items:center; }
.new-badge { position:absolute; top:14px; left:14px; background:linear-gradient(135deg,var(--c-gold),#c8952c); color:#1a0f00; font-size:9px; font-weight:700; padding:2px 8px; border-radius:99px; }

.bid-card { border:1px solid var(--c-border); border-radius:var(--r-lg); padding:16px; margin-bottom:8px; background:var(--c-surface-2); transition:border-color var(--t); }
.bid-card:hover { border-color:rgba(255,255,255,.1); }
.bid-card.acc { border-color:rgba(0,201,122,.2); background:rgba(0,201,122,.04); }
.bid-card.rej { opacity:.55; }
.bid-card.pend { border-color:rgba(232,184,75,.2); }
.bid-header { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:12px; }
.bid-num { font-size:9px; color:var(--c-text-3); font-variant-numeric:tabular-nums; margin-bottom:4px; }
.bid-title { font-size:13px; font-weight:700; color:#fff; line-height:1.3; }
.bid-chips { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px; }
.bid-chip { background:var(--c-surface-3); border:1px solid var(--c-border); border-radius:var(--r); padding:5px 11px; font-size:11px; color:var(--c-text-2); }
.bid-chip strong { color:var(--c-text); font-weight:700; }
.bid-note { font-size:11px; color:var(--c-text-2); background:rgba(255,255,255,.02); padding:10px 12px; border-radius:var(--r); line-height:1.7; border-right:2px solid rgba(232,184,75,.3); }
.bid-footer { display:flex; gap:6px; margin-top:12px; flex-wrap:wrap; }

.rev-card { border:1px solid var(--c-border); border-radius:var(--r-lg); padding:16px; margin-bottom:8px; background:var(--c-surface-2); transition:border-color var(--t); }
.rev-card:hover { border-color:rgba(255,255,255,.1); }
.rev-header { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:12px; }
.rev-avatar { width:32px; height:32px; border-radius:8px; color:#fff; font-size:13px; font-weight:700; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.rev-name { font-size:12px; font-weight:700; color:#fff; }
.rev-sub { font-size:10px; color:var(--c-text-3); margin-top:2px; }
.stars { letter-spacing:1px; }
.star-on { color:var(--c-gold); }
.star-off { color:rgba(255,255,255,.1); }
.rev-text { font-size:12px; color:var(--c-text-2); line-height:1.8; padding:10px 12px; background:rgba(255,255,255,.02); border-radius:var(--r); border-right:2px solid rgba(232,184,75,.3); }
.rev-reply { background:rgba(139,92,246,.07); border:1px solid rgba(139,92,246,.15); border-radius:var(--r); padding:10px 12px; margin-top:8px; }
.reply-lbl { font-size:9px; font-weight:700; color:var(--c-violet); letter-spacing:.6px; text-transform:uppercase; margin-bottom:4px; }
.reply-txt { font-size:11px; color:rgba(200,190,255,.7); line-height:1.6; }

.notif-item { display:flex; gap:12px; padding:13px 0; border-bottom:1px solid var(--c-border-2); cursor:default; transition:all var(--t); }
.notif-item:last-child { border-bottom:none; }
.notif-item:hover { background:rgba(255,255,255,.02); margin:0 -18px; padding:13px 18px; border-radius:var(--r); }
.notif-ic { width:38px; height:38px; border-radius:var(--r); display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0; }
.notif-title { font-size:12px; font-weight:600; color:#fff; margin-bottom:3px; }
.notif-body { font-size:11px; color:var(--c-text-2); line-height:1.5; }
.notif-time { font-size:9px; color:var(--c-text-3); margin-top:4px; }
.unread-dot { width:7px; height:7px; border-radius:50%; background:var(--c-gold); flex-shrink:0; margin-top:6px; }

.profile-hero { background:var(--c-surface); border:1px solid var(--c-border); border-radius:var(--r-xl); padding:24px; margin-bottom:16px; position:relative; overflow:hidden; display:flex; align-items:center; gap:16px; flex-wrap:wrap; }
.profile-hero::before { content:''; position:absolute; inset:0; background:radial-gradient(ellipse 50% 100% at 100% 50%, rgba(232,184,75,.06), transparent); }
.profile-avatar { width:60px; height:60px; border-radius:var(--r-lg); background:linear-gradient(135deg,#2a1f5c,#4c35a0); color:#fff; font-size:24px; font-weight:700; display:flex; align-items:center; justify-content:center; flex-shrink:0; border:2px solid rgba(139,92,246,.4); box-shadow:0 0 30px rgba(139,92,246,.2); position:relative; }
.profile-name { font-size:17px; font-weight:700; color:#fff; letter-spacing:-0.3px; margin-bottom:3px; }
.profile-email { font-size:11px; color:var(--c-text-3); margin-bottom:8px; }
.profile-tags { display:flex; gap:5px; flex-wrap:wrap; }
.ptag { display:inline-flex; align-items:center; gap:4px; padding:3px 9px; border-radius:99px; font-size:10px; font-weight:600; border:1px solid; }
.ptag-none { background:rgba(255,255,255,.04); color:var(--c-text-3); border-color:var(--c-border); }
.ptag-verified { background:rgba(59,141,245,.1); color:var(--c-blue); border-color:rgba(59,141,245,.2); }
.ptag-gold { background:var(--c-gold-dim); color:var(--c-gold); border-color:rgba(232,184,75,.25); }
.ptag-top { background:rgba(0,201,122,.1); color:var(--c-emerald); border-color:rgba(0,201,122,.2); }

.info-block { background:var(--c-surface-3); border-radius:var(--r); padding:14px; margin-bottom:10px; border:1px solid var(--c-border); }
.info-block-title { font-size:9px; font-weight:700; color:var(--c-text-3); text-transform:uppercase; letter-spacing:1px; margin-bottom:10px; }
.info-row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid var(--c-border-2); }
.info-row:last-child { border-bottom:none; }
.info-key { font-size:11px; color:var(--c-text-2); }
.info-val { font-size:11px; font-weight:600; color:var(--c-text); }

.fg { display:flex; flex-direction:column; gap:6px; margin-bottom:14px; }
.fl { font-size:11px; font-weight:600; color:var(--c-text-2); }
.fl-hint { color:var(--c-text-3); font-weight:400; margin-right:3px; }
.fi { padding:9px 12px; border:1px solid var(--c-border); border-radius:var(--r); font-size:13px; background:var(--c-surface-3); color:var(--c-text); outline:none; transition:border-color var(--t), box-shadow var(--t); width:100%; }
.fi:focus { border-color:rgba(232,184,75,.5); box-shadow:0 0 0 3px rgba(232,184,75,.08); }
.fi::placeholder { color:var(--c-text-3); }
.fsel { padding:9px 12px; border:1px solid var(--c-border); border-radius:var(--r); font-size:13px; background:var(--c-surface-3); color:var(--c-text); outline:none; cursor:pointer; width:100%; }
.fsel:focus { border-color:rgba(232,184,75,.5); }
.fta { padding:9px 12px; border:1px solid var(--c-border); border-radius:var(--r); font-size:13px; background:var(--c-surface-3); color:var(--c-text); outline:none; resize:vertical; min-height:90px; transition:border-color var(--t); width:100%; line-height:1.6; }
.fta:focus { border-color:rgba(232,184,75,.5); box-shadow:0 0 0 3px rgba(232,184,75,.08); }
.f2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.fsec { font-size:10px; font-weight:700; color:var(--c-gold); padding:10px 0 6px; border-bottom:1px solid rgba(232,184,75,.15); margin:4px 0 14px; letter-spacing:.6px; text-transform:uppercase; }

.specs-wrap { border:1px solid var(--c-border); border-radius:var(--r); overflow:hidden; }
.specs-head { padding:9px 12px; background:var(--c-surface-3); border-bottom:1px solid var(--c-border); display:flex; align-items:center; justify-content:space-between; }
.specs-head-lbl { font-size:11px; font-weight:600; color:var(--c-text-2); }
.specs-cnt-badge { font-size:10px; font-weight:700; color:var(--c-gold); background:var(--c-gold-dim); padding:2px 8px; border-radius:99px; border:1px solid rgba(232,184,75,.2); }
.specs-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:4px; padding:8px; max-height:200px; overflow-y:auto; }
.spec-item { display:flex; align-items:center; gap:6px; padding:7px 9px; border:1px solid var(--c-border); border-radius:var(--r); cursor:pointer; transition:all var(--t); background:var(--c-surface-3); }
.spec-item:hover { border-color:rgba(255,255,255,.1); }
.spec-item.on { border-color:rgba(232,184,75,.4); background:var(--c-gold-dim); }
.spec-item input { width:12px; height:12px; accent-color:var(--c-gold); cursor:pointer; flex-shrink:0; }
.spec-item label { font-size:11px; font-weight:500; cursor:pointer; color:var(--c-text-2); line-height:1.3; }
.spec-item.on label { color:var(--c-gold); font-weight:600; }

.img-up { border:1.5px dashed rgba(255,255,255,.1); border-radius:var(--r-lg); padding:22px; text-align:center; cursor:pointer; transition:all var(--t); background:var(--c-surface-3); position:relative; }
.img-up:hover { border-color:rgba(232,184,75,.4); background:var(--c-gold-dim); }
.img-up input[type=file] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
.img-up-ico { width:42px; height:42px; border-radius:var(--r); background:var(--c-gold-dim); display:flex; align-items:center; justify-content:center; margin:0 auto 10px; }
.img-up-ico svg { width:18px; height:18px; stroke:var(--c-gold); fill:none; stroke-width:1.6; stroke-linecap:round; stroke-linejoin:round; }
.img-up-t { font-size:12px; font-weight:600; color:var(--c-text); margin-bottom:3px; }
.img-up-s { font-size:10px; color:var(--c-text-3); }
.img-previews { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
.img-prev { position:relative; width:72px; height:72px; border-radius:var(--r); overflow:hidden; border:1px solid var(--c-border); }
.img-prev img { width:100%; height:100%; object-fit:cover; }
.img-prev-del { position:absolute; top:3px; left:3px; width:18px; height:18px; border-radius:50%; background:var(--c-red); color:#fff; border:none; cursor:pointer; font-size:11px; display:flex; align-items:center; justify-content:center; font-weight:700; }

.tracker { display:flex; align-items:flex-start; gap:0; margin:18px 0; }
.tracker-step { flex:1; display:flex; flex-direction:column; align-items:center; position:relative; }
.tracker-step:not(:last-child)::after { content:''; position:absolute; top:13px; left:-50%; right:50%; height:2px; background:var(--c-border); z-index:0; }
.tracker-step.done:not(:last-child)::after { background:linear-gradient(90deg,var(--c-gold),rgba(232,184,75,.4)); }
.tracker-dot { width:26px; height:26px; border-radius:50%; border:2px solid var(--c-border); background:var(--c-surface-3); display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:700; z-index:1; transition:all var(--t); color:var(--c-text-3); }
.tracker-step.done .tracker-dot { background:var(--c-gold); border-color:var(--c-gold); color:#1a0f00; }
.tracker-step.cur .tracker-dot { background:var(--c-surface-3); border-color:var(--c-gold); color:var(--c-gold); box-shadow:0 0 12px rgba(232,184,75,.3); }
.tracker-lbl { font-size:9px; font-weight:500; color:var(--c-text-3); margin-top:7px; text-align:center; white-space:nowrap; }
.tracker-step.done .tracker-lbl { color:var(--c-gold); font-weight:600; }
.tracker-step.cur .tracker-lbl { color:var(--c-gold); font-weight:700; }

.rating-stars { display:flex; gap:6px; margin:8px 0; }
.rating-star { font-size:28px; cursor:pointer; color:rgba(255,255,255,.1); transition:color var(--t); user-select:none; line-height:1; }
.rating-star.active { color:var(--c-gold); text-shadow:0 0 10px rgba(232,184,75,.5); }
.rating-star:hover { color:var(--c-gold-2); }

.alert { display:flex; align-items:flex-start; gap:10px; padding:11px 14px; border-radius:var(--r); margin-bottom:12px; font-size:12px; line-height:1.5; }
.alert svg { width:14px; height:14px; flex-shrink:0; margin-top:1px; fill:none; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; }
.alert-info { background:var(--c-blue-dim); border:1px solid rgba(59,141,245,.2); color:rgba(150,200,255,.85); }
.alert-info svg { stroke:var(--c-blue); }
.alert-success { background:rgba(0,201,122,.07); border:1px solid rgba(0,201,122,.2); color:rgba(120,255,180,.85); }
.alert-success svg { stroke:var(--c-emerald); }
.alert-warning { background:var(--c-amber-dim); border:1px solid rgba(245,158,11,.2); color:rgba(255,220,100,.85); }
.alert-warning svg { stroke:var(--c-amber); }

.filter-bar { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:14px; align-items:center; }
.search-box { flex:1; min-width:200px; display:flex; align-items:center; gap:8px; background:var(--c-surface-3); border:1px solid var(--c-border); border-radius:var(--r); padding:0 12px; transition:border-color var(--t), box-shadow var(--t); }
.search-box:focus-within { border-color:rgba(232,184,75,.4); box-shadow:0 0 0 3px rgba(232,184,75,.07); }
.search-box svg { width:14px; height:14px; stroke:var(--c-text-3); fill:none; stroke-width:1.6; flex-shrink:0; stroke-linecap:round; stroke-linejoin:round; }
.search-box input { border:none; outline:none; background:transparent; font-size:12px; padding:9px 0; flex:1; color:var(--c-text); }
.search-box input::placeholder { color:var(--c-text-3); }
.filter-select { padding:8px 10px; border:1px solid var(--c-border); border-radius:var(--r); font-size:12px; font-weight:500; background:var(--c-surface-3); color:var(--c-text); outline:none; cursor:pointer; transition:border-color var(--t); }
.filter-select:focus { border-color:rgba(232,184,75,.4); }
option { background:var(--c-surface-3); }

.table-wrap { overflow-x:auto; }
.tbl { width:100%; border-collapse:collapse; min-width:560px; }
.tbl th { text-align:right; padding:10px 14px; font-size:10px; font-weight:700; color:var(--c-text-3); background:var(--c-surface-3); border-bottom:1px solid var(--c-border); white-space:nowrap; text-transform:uppercase; letter-spacing:.5px; }
.tbl td { padding:12px 14px; border-bottom:1px solid var(--c-border-2); vertical-align:middle; }
.tbl tr:last-child td { border-bottom:none; }
.tbl tbody tr { transition:background var(--t); }
.tbl tbody tr:hover td { background:rgba(255,255,255,.02); }

.two-col { display:grid; grid-template-columns:1.3fr 1fr; gap:16px; }
.divider { height:1px; background:var(--c-border-2); margin:12px 0; }

.overlay { display:none; position:fixed; inset:0; z-index:500; background:rgba(0,0,0,.7); backdrop-filter:blur(8px); align-items:center; justify-content:center; padding:16px; }
.overlay.visible { display:flex; }
.modal { background:var(--c-surface); border:1px solid var(--c-border); border-radius:var(--r-xl); width:100%; max-width:600px; max-height:92vh; overflow-y:auto; box-shadow:0 24px 80px rgba(0,0,0,.6); animation:modalIn .2s cubic-bezier(.34,1.56,.64,1); }
@keyframes modalIn { from{opacity:0;transform:scale(.96) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)} }
.modal::-webkit-scrollbar { width:4px; }
.modal-header { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; border-bottom:1px solid var(--c-border); position:sticky; top:0; background:var(--c-surface); z-index:2; border-radius:var(--r-xl) var(--r-xl) 0 0; }
.modal-header-left { display:flex; align-items:center; gap:10px; }
.modal-ico { width:32px; height:32px; border-radius:var(--r); display:flex; align-items:center; justify-content:center; }
.modal-ico svg { width:14px; height:14px; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; fill:none; }
.modal-title { font-size:14px; font-weight:700; color:#fff; }
.modal-close { width:28px; height:28px; border-radius:var(--r); background:var(--c-surface-3); display:flex; align-items:center; justify-content:center; color:var(--c-text-2); font-size:16px; line-height:1; cursor:pointer; transition:all var(--t); border:1px solid var(--c-border); }
.modal-close:hover { background:var(--c-red-dim); color:var(--c-red); border-color:rgba(255,77,103,.3); }
.modal-body { padding:20px; }
.modal-footer { display:flex; gap:8px; justify-content:flex-end; padding:14px 20px; border-top:1px solid var(--c-border); background:var(--c-surface-2); border-radius:0 0 var(--r-xl) var(--r-xl); }

.toast { position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(12px); background:var(--c-surface); border:1px solid var(--c-border); color:var(--c-text); padding:11px 18px; border-radius:var(--r-lg); font-size:12px; font-weight:600; z-index:9999; opacity:0; transition:all .22s cubic-bezier(.34,1.56,.64,1); pointer-events:none; display:flex; align-items:center; gap:9px; box-shadow:var(--shadow); white-space:nowrap; }
.toast.visible { opacity:1; transform:translateX(-50%) translateY(0); }
.toast-icon { width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:900; flex-shrink:0; }
.toast-success .toast-icon { background:var(--c-emerald); color:#003015; }
.toast-error .toast-icon { background:var(--c-red); color:#fff; }
.toast-info .toast-icon { background:var(--c-gold-dim); color:var(--c-gold); }

.loading-state { display:flex; flex-direction:column; align-items:center; padding:52px 20px; color:var(--c-text-3); }
.spinner { width:28px; height:28px; border:2px solid var(--c-border); border-top-color:var(--c-gold); border-radius:50%; animation:spin .7s linear infinite; margin-bottom:12px; }
@keyframes spin { to{transform:rotate(360deg)} }
.loading-text { font-size:12px; font-weight:500; }
.empty-state { display:flex; flex-direction:column; align-items:center; padding:52px 20px; text-align:center; }
.empty-icon { width:50px; height:50px; border-radius:var(--r-lg); background:var(--c-surface-3); border:1.5px dashed var(--c-border); display:flex; align-items:center; justify-content:center; margin-bottom:12px; }
.empty-icon svg { width:20px; height:20px; stroke:var(--c-text-3); fill:none; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; }
.empty-title { font-size:13px; font-weight:600; color:var(--c-text-2); margin-bottom:4px; }
.empty-desc { font-size:11px; color:var(--c-text-3); }

.mob-trigger { display:none; position:fixed; top:12px; left:12px; z-index:400; width:38px; height:38px; border-radius:var(--r); background:var(--c-gold); border:none; cursor:pointer; align-items:center; justify-content:center; box-shadow:var(--shadow); }
.mob-trigger svg { width:16px; height:16px; stroke:#1a0f00; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }
.mob-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); backdrop-filter:blur(4px); z-index:200; }

@keyframes fadeUp { from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)} }
.anim { animation:fadeUp .35s cubic-bezier(.4,0,.2,1) both; }
.anim-1 { animation-delay:.05s; }
.anim-2 { animation-delay:.1s; }
.anim-3 { animation-delay:.15s; }
.anim-4 { animation-delay:.2s; }
.anim-5 { animation-delay:.25s; }
.anim-6 { animation-delay:.3s; }

@media(max-width:960px) {
  .sidebar { transform:translateX(110%); }
  .sidebar.open { transform:translateX(0); }
  .main { margin-right:0; }
  .mob-trigger { display:flex; }
  .mob-overlay.active { display:block; }
  .stats-grid { grid-template-columns:repeat(2,1fr); }
  .two-col { grid-template-columns:1fr; }
  .page-content { padding:16px; }
  .topbar { padding:0 16px; }
  .f2 { grid-template-columns:1fr; }
  .specs-grid { grid-template-columns:repeat(2,1fr); }
}
</style>
</head>
<body>

<button class="mob-trigger" onclick="openSb()">
  <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<div class="mob-overlay" id="mobOv" onclick="closeSb()"></div>

<aside class="sidebar" id="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-mark">
      <svg viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
    </div>
    <span class="sb-logo-text">ŸÖŸÜÿßŸÇÿµÿ©<em>.</em></span>
  </div>

  <div class="sb-user">
    <div class="sb-user-row">
      <div class="sb-avatar" id="sbAvatar">ŸÖ</div>
      <div style="flex:1;min-width:0">
        <div class="sb-name" id="sbName">ÿßŸÑŸÖÿ≤ŸàÿØ</div>
        <div class="sb-role" id="sbCity">ŸÖÿ≤ŸàÿØ ÿÆÿØŸÖÿ©</div>
      </div>
    </div>
    <div class="avail-toggle-row">
      <div class="avail-label">
        <span class="avail-pulse on" id="availDot"></span>
        <span id="availLabel">ŸÖÿ™ÿßÿ≠ ÿßŸÑÿ¢ŸÜ</span>
      </div>
      <label class="switch" onclick="toggleAvailability()">
        <input type="checkbox" id="availChk" checked>
        <span class="switch-track"></span>
        <span class="switch-thumb"></span>
      </label>
    </div>
  </div>

  <div class="sb-mini-stats">
    <div class="sb-mini-stat">
      <div class="sb-mini-val gold" id="sbRating">‚Äî</div>
      <div class="sb-mini-lbl">ÿ™ŸÇŸäŸäŸÖŸä</div>
    </div>
    <div class="sb-mini-stat">
      <div class="sb-mini-val" id="sbDone">0</div>
      <div class="sb-mini-lbl">ŸÖŸÉÿ™ŸÖŸÑ</div>
    </div>
    <div class="sb-mini-stat">
      <div class="sb-mini-val" id="sbWin">‚Äî</div>
      <div class="sb-mini-lbl">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅŸàÿ≤</div>
    </div>
  </div>

  <nav class="sb-nav">
    <span class="nav-section-label">ÿπÿßŸÖ</span>
    <button class="nav-btn active" onclick="go('home',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg></div>
      <span class="nav-lbl">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
    </button>
    <span class="nav-section-label">ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</span>
    <button class="nav-btn" onclick="go('browse',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
      <span class="nav-lbl">ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</span>
    </button>
    <button class="nav-btn" onclick="go('saved',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg></div>
      <span class="nav-lbl">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸáÿ™ŸÖ</span>
      <span class="nav-chip chip-gold" id="nbSaved" style="display:none">0</span>
    </button>
    <button class="nav-btn" onclick="go('mybids',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
      <span class="nav-lbl">ÿπÿ±Ÿàÿ∂Ÿä</span>
      <span class="nav-chip chip-blue" id="nbBids">0</span>
    </button>
    <button class="nav-btn" onclick="go('active',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
      <span class="nav-lbl">ŸÖÿ¥ÿßÿ±ŸäÿπŸä ÿßŸÑŸÜÿ¥ÿ∑ÿ©</span>
      <span class="nav-chip chip-green" id="nbActive" style="display:none">0</span>
    </button>
    <button class="nav-btn" onclick="go('history',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
      <span class="nav-lbl">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿπŸÖŸÑ</span>
    </button>
    <span class="nav-section-label">ÿßŸÑÿ™ŸÅÿßÿπŸÑ</span>
    <button class="nav-btn" onclick="go('reviews',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>
      <span class="nav-lbl">ÿ™ŸÇŸäŸäŸÖÿßÿ™Ÿä</span>
    </button>
    <button class="nav-btn" onclick="go('notifs',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>
      <span class="nav-lbl">ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</span>
      <span class="nav-chip chip-red" id="nbNotifs" style="display:none">0</span>
    </button>
    <span class="nav-section-label">ÿßŸÑÿ≠ÿ≥ÿßÿ®</span>
    <button class="nav-btn" onclick="go('wallet',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg></div>
      <span class="nav-lbl">ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©</span>
    </button>
    <button class="nav-btn" onclick="go('profile',this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
      <span class="nav-lbl">ŸÖŸÑŸÅŸä ÿßŸÑÿ¥ÿÆÿµŸä</span>
    </button>
  </nav>

  <div class="sb-bottom">
    <button class="nav-btn" onclick="logout()" style="width:100%;color:var(--c-red)">
      <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
      <span class="nav-lbl">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</span>
    </button>
    <div class="sb-ver">ŸÖŸÜÿßŸÇÿµÿ© Provider v3.0</div>
  </div>
</aside>

<div class="main">
  <header class="topbar">
    <div class="breadcrumb">
      <span class="bc-root">ŸÖŸÜÿßŸÇÿµÿ©</span>
      <span class="bc-sep">/</span>
      <span class="bc-cur" id="pageTitle">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
    </div>
    <div class="topbar-right">
      <div class="tb-clock" id="clock">--:--:--</div>
      <button class="tb-btn" onclick="go('notifs',null)" title="ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™">
        <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <div class="notif-dot" id="topNotifDot"></div>
      </button>
    </div>
  </header>
  <main class="page-content" id="pageContent">
    <div class="loading-state"><div class="spinner"></div><div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ‚Ä¶</div></div>
  </main>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-ico" id="mIco"></div>
        <span class="modal-title" id="mTitle">‚Äî</span>
      </div>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
    <div class="modal-body" id="mBody"></div>
    <div class="modal-footer" id="mFoot"></div>
  </div>
</div>

<div class="toast" id="toast">
  <div class="toast-icon" id="toastIco"></div>
  <span id="toastMsg"></span>
</div>

<script>
const API = 'https://manaqasati-production.up.railway.app';
const token = localStorage.getItem('token');
const me = JSON.parse(localStorage.getItem('user') || '{}');

if (!token || me.role !== 'provider') location.href = 'auth.html';

let savedIds = JSON.parse(localStorage.getItem('prov_saved') || '[]');
let allOpenReqs = [], myBidsData = [], myNotifsData = [], myRevsData = [];
let isAvail = true;
let uploadedImgs = {};
let ratingSelected = 0;

const CATS = ['ÿ™ÿ®ÿ±ŸäÿØ Ÿàÿ™ŸÉŸäŸäŸÅ','ŸÉŸáÿ±ÿ®ÿßÿ°','ÿ≥ÿ®ÿßŸÉÿ©','ŸÜÿ¨ÿßÿ±ÿ©','ÿ™ŸÜÿ∏ŸäŸÅ','ŸÜŸÇŸÑ ÿπŸÅÿ¥','ÿ≠ÿØÿßÿØÿ©','ÿ£ŸÑŸÖŸÜŸäŸàŸÖ','ŸÖÿ≥ÿßÿ®ÿ≠','ŸÉÿßŸÖŸäÿ±ÿßÿ™ ŸÖÿ±ÿßŸÇÿ®ÿ©','ÿ¥ÿ®ŸÉÿßÿ™ Ÿàÿ•ŸÜÿ™ÿ±ŸÜÿ™','ŸÖÿ∏ŸÑÿßÿ™ Ÿàÿ≥Ÿàÿßÿ™ÿ±','ÿπÿ≤ŸÑ ÿ≠ÿ±ÿßÿ±Ÿä','ÿ£ÿ®Ÿàÿßÿ®','ÿ¨ÿ®ÿ≥ Ÿàÿ∑ÿ®ÿßÿ¥Ÿäÿ±','ŸÖŸÉÿßŸÅÿ≠ÿ© ÿ≠ÿ¥ÿ±ÿßÿ™','ÿ£ÿÆÿ±Ÿâ'];
const CITIES = ['ÿßŸÑÿ±Ÿäÿßÿ∂','ÿ¨ÿØÿ©','ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©','ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ©','ÿßŸÑÿØŸÖÿßŸÖ','ÿßŸÑÿÆÿ®ÿ±','ÿßŸÑÿ∏Ÿáÿ±ÿßŸÜ','ÿßŸÑÿ£ÿ≠ÿ≥ÿßÿ°','ÿßŸÑÿ∑ÿßÿ¶ŸÅ','ÿ™ÿ®ŸàŸÉ','ÿ®ÿ±ŸäÿØÿ©','ÿÆŸÖŸäÿ≥ ŸÖÿ¥Ÿäÿ∑','ÿ£ÿ®Ÿáÿß','ŸÜÿ¨ÿ±ÿßŸÜ','ÿ¨Ÿäÿ≤ÿßŸÜ','ÿ≠ÿßÿ¶ŸÑ','ŸäŸÜÿ®ÿπ','ÿßŸÑÿ¨ÿ®ŸäŸÑ','ÿßŸÑŸÇÿ∑ŸäŸÅ','ÿ≥ŸÉÿßŸÉÿß','ÿπÿ±ÿπÿ±','ÿßŸÑÿ®ÿßÿ≠ÿ©','ÿßŸÑÿ±ÿ≥','ÿ±ÿßÿ®ÿ∫','ÿ®Ÿäÿ¥ÿ©','ŸàÿßÿØŸä ÿßŸÑÿØŸàÿßÿ≥ÿ±','ÿßŸÑÿ≤ŸÑŸÅŸä','ÿßŸÑŸÇÿ±Ÿäÿßÿ™'];
const AV_COLORS = ['#7c3aed','#2563eb','#059669','#d97706','#dc2626','#0891b2','#7e22ce','#b45309','#be185d','#0f766e'];
const BADGE_MAP = {
  none:{cls:'ptag-none',label:'ÿ®ÿØŸàŸÜ Ÿàÿ≥ÿßŸÖ',icon:'‚Äî'},
  verified:{cls:'ptag-verified',label:'ŸÖŸàÿ´ŸÇ',icon:'‚úì'},
  star:{cls:'ptag-gold',label:'ŸÖÿ™ŸÖŸäÿ≤',icon:'‚≠ê'},
  partner:{cls:'ptag-gold',label:'ÿ¥ÿ±ŸäŸÉ',icon:'üíé'},
  top:{cls:'ptag-top',label:'ÿßŸÑÿ£ŸÅÿ∂ŸÑ',icon:'üèÜ'}
};

document.getElementById('sbName').textContent = me.name || 'ÿßŸÑŸÖÿ≤ŸàÿØ';
document.getElementById('sbAvatar').textContent = (me.name || 'ŸÖ')[0];
if (me.city) document.getElementById('sbCity').textContent = 'üìç ' + me.city;
setInterval(() => {
  document.getElementById('clock').textContent = new Date().toLocaleTimeString('ar-SA',{hour12:false});
}, 1000);

async function api(path, opts = {}) {
  try {
    const r = await fetch(API + path, {
      headers: {'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json'},
      ...opts
    });
    return await r.json();
  } catch { return {}; }
}

let toastTimer;
function toast(msg, type = 'info') {
  const el = document.getElementById('toast');
  el.className = `toast toast-${type}`;
  document.getElementById('toastIco').textContent = type==='success'?'‚úì':type==='error'?'‚úï':'i';
  document.getElementById('toastMsg').textContent = msg;
  el.classList.add('visible');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('visible'), 3200);
}

function openModal(title, body, footer, icoSvg, icoBg = 'var(--c-gold-dim)') {
  document.getElementById('mTitle').textContent = title;
  document.getElementById('mBody').innerHTML = body;
  document.getElementById('mFoot').innerHTML = footer || '';
  const ic = document.getElementById('mIco');
  ic.innerHTML = icoSvg || '';
  ic.style.background = icoBg;
  if (icoSvg) {
    const s = ic.querySelector('svg');
    if (s) s.setAttribute('style','width:14px;height:14px;stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round');
  }
  document.getElementById('overlay').classList.add('visible');
}
function closeModal() { document.getElementById('overlay').classList.remove('visible'); }
function setContent(html) { document.getElementById('pageContent').innerHTML = html; }
function loading() { setContent(`<div class="loading-state"><div class="spinner"></div><div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ‚Ä¶</div></div>`); }
function openSb() { document.getElementById('sidebar').classList.add('open'); document.getElementById('mobOv').classList.add('active'); }
function closeSb() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('mobOv').classList.remove('active'); }
function logout() { localStorage.clear(); location.href = 'auth.html'; }

function go(page, btn) {
  document.querySelectorAll('.nav-btn').forEach(i => i.classList.remove('active'));
  if (btn) btn.classList.add('active');
  const titles = {home:'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',browse:'ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ',saved:'ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸáÿ™ŸÖ',mybids:'ÿπÿ±Ÿàÿ∂Ÿä',active:'ŸÖÿ¥ÿßÿ±ŸäÿπŸä ÿßŸÑŸÜÿ¥ÿ∑ÿ©',history:'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿπŸÖŸÑ',reviews:'ÿ™ŸÇŸäŸäŸÖÿßÿ™Ÿä',notifs:'ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™',wallet:'ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©',profile:'ŸÖŸÑŸÅŸä ÿßŸÑÿ¥ÿÆÿµŸä'};
  document.getElementById('pageTitle').textContent = titles[page] || page;
  const pages = {home:pgHome,browse:pgBrowse,saved:pgSaved,mybids:pgMyBids,active:pgActive,history:pgHistory,reviews:pgReviews,notifs:pgNotifs,wallet:pgWallet,profile:pgProfile};
  if (pages[page]) pages[page]();
  closeSb();
}

const I = {
  send:`<line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>`,
  star:`<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>`,
  check:`<polyline points="20 6 9 17 4 12"/>`,
  eye:`<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>`,
  edit:`<path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>`,
  trash:`<polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/>`,
  bookmark:`<path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/>`,
  map:`<path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>`,
  folder:`<path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>`,
  dollar:`<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>`,
  zap:`<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>`,
  bell:`<path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/>`,
  user:`<path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/>`,
  img:`<rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>`,
  calendar:`<rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>`,
  phone:`<path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.8a19.79 19.79 0 01-3.07-8.63A2 2 0 012 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 14.92z"/>`,
};

function svg(paths, color) {
  return `<svg viewBox="0 0 24 24" fill="none" stroke="${color||'currentColor'}" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">${paths}</svg>`;
}

function avColor(id) { return AV_COLORS[(id||0) % AV_COLORS.length]; }
function avLetter(name) { return (name||'ÿü')[0]; }
function starsHtml(n) { return [1,2,3,4,5].map(i=>`<span class="${i<=Math.round(n)?'star-on':'star-off'}">‚òÖ</span>`).join(''); }
function fdate(d) { return d ? new Date(d).toLocaleDateString('ar-SA') : '‚Äî'; }
function fprice(p) { return p ? Number(p).toLocaleString('ar-SA') + ' ÿ±.ÿ≥' : '‚Äî'; }
function isNew(d) { return d && (Date.now() - new Date(d).getTime()) < 86400000; }

function cityOpts(sel = '') {
  return `<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿØŸäŸÜÿ©</option>` + CITIES.map(c=>`<option value="${c}" ${c===sel?'selected':''}>${c}</option>`).join('');
}

function specsHtml(sel = []) {
  return `<div class="specs-wrap">
    <div class="specs-head"><span class="specs-head-lbl">ÿßŸÑÿ™ÿÆÿµÿµÿßÿ™</span><span class="specs-cnt-badge" id="specCnt">${sel.length} ŸÖÿ≠ÿØÿØ</span></div>
    <div class="specs-grid">${CATS.map((c,i)=>{const on=sel.includes(c);return `<div class="spec-item${on?' on':''}" onclick="togSpec(this)"><input type="checkbox" id="sp${i}" value="${c}" ${on?'checked':''} onchange="updSpec()"><label for="sp${i}">${c}</label></div>`;}).join('')}</div>
  </div>`;
}
function togSpec(el) { el.classList.toggle('on'); el.querySelector('input').checked = el.classList.contains('on'); updSpec(); }
function updSpec() { const c=document.querySelectorAll('.spec-item.on').length; const el=document.getElementById('specCnt'); if(el) el.textContent=`${c} ŸÖÿ≠ÿØÿØ`; }
function getSpecs() { return [...document.querySelectorAll('.spec-item.on input')].map(i=>i.value); }

function imgUpHtml(id) {
  return `<div class="img-up"><input type="file" accept="image/*" multiple onchange="handleImgs(this,'${id}')"><div class="img-up-ico">${svg(I.img,'var(--c-gold)')}</div><div class="img-up-t">ÿßÿ≥ÿ≠ÿ® ÿßŸÑÿµŸàÿ± ÿ£Ÿà ÿßŸÜŸÇÿ± ŸÑŸÑÿ±ŸÅÿπ</div><div class="img-up-s">PNG, JPG ‚Äî ÿ≠ÿ™Ÿâ 5 ÿµŸàÿ±</div></div><div class="img-previews" id="imgPv_${id}"></div>`;
}
function handleImgs(input, id) {
  const files = [...input.files];
  if (!uploadedImgs[id]) uploadedImgs[id] = [];
  files.forEach(f => {
    if (uploadedImgs[id].length >= 5) return;
    const r = new FileReader();
    r.onload = e => { uploadedImgs[id].push(e.target.result); renderImgPv(id); };
    r.readAsDataURL(f);
  });
}
function renderImgPv(id) {
  const el = document.getElementById(`imgPv_${id}`);
  if (!el) return;
  el.innerHTML = (uploadedImgs[id]||[]).map((src,i)=>`<div class="img-prev"><img src="${src}"><button class="img-prev-del" onclick="delImg('${id}',${i})">√ó</button></div>`).join('');
}
function delImg(id, i) { uploadedImgs[id].splice(i,1); renderImgPv(id); }

function savedIncl(id) { return savedIds.includes(id); }
function savePersist() { localStorage.setItem('prov_saved', JSON.stringify(savedIds)); }
function toggleSave(id, btn) {
  const idx = savedIds.indexOf(id);
  if (idx > -1) {
    savedIds.splice(idx, 1);
    api(`/api/saved/${id}`, {method:'DELETE'});
    if (btn) { btn.className='btn btn-save btn-sm'; btn.textContent='üîñ ÿßŸáÿ™ŸÖ'; }
    toast('ÿ£Ÿèÿ≤ŸäŸÑ ŸÖŸÜ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸáÿ™ŸÖ', 'info');
  } else {
    savedIds.push(id);
    api(`/api/saved/${id}`, {method:'POST'});
    if (btn) { btn.className='btn btn-save saved btn-sm'; btn.textContent='‚úì ŸÖŸáÿ™ŸÖ'; }
    toast('ÿ£Ÿèÿ∂ŸäŸÅ ŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸáÿ™ŸÖ ‚úÖ', 'success');
  }
  savePersist();
  const nb = document.getElementById('nbSaved');
  if (nb) { nb.style.display=savedIds.length?'':'none'; nb.textContent=savedIds.length; }
}

function toggleAvailability() {
  isAvail = !isAvail;
  const dot = document.getElementById('availDot');
  const lbl = document.getElementById('availLabel');
  dot.className = 'avail-pulse ' + (isAvail ? 'on' : 'off');
  lbl.textContent = isAvail ? 'ŸÖÿ™ÿßÿ≠ ÿßŸÑÿ¢ŸÜ' : 'ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠';
  api('/api/provider/availability', {method:'PUT', body:JSON.stringify({available:isAvail})});
  toast(isAvail ? 'ÿ£ŸÜÿ™ ŸÖÿ™ÿßÿ≠ ÿßŸÑÿ¢ŸÜ üü¢' : 'ÿ≠ÿßŸÑÿ™ŸÉ: ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ ‚ö´', 'info');
}

async function pgHome() {
  loading();
  const [stats, open] = await Promise.all([api('/api/provider/stats'), api('/api/requests?status=open')]);
  const s = stats || {};
  allOpenReqs = open || [];
  const winRate = s.total_bids ? Math.round((s.won_bids||0)/s.total_bids*100) : 0;

  document.getElementById('sbRating').textContent = s.avg_rating ? Number(s.avg_rating).toFixed(1)+'‚òÖ' : '‚Äî';
  document.getElementById('sbDone').textContent = s.completed || 0;
  document.getElementById('sbWin').textContent = winRate + '%';

  setContent(`
    <div class="page-header anim">
      <div>
        <div class="ph-title">ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå ${me.name||'ŸÖÿ≤ŸàÿØŸÜÿß'} üëã</div>
        <div class="ph-sub">ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿ£ÿØÿßÿ¶ŸÉ ŸÅŸä ÿßŸÑŸÖŸÜÿµÿ© ‚Äî ${new Date().toLocaleDateString('ar-SA',{weekday:'long',day:'numeric',month:'long'})}</div>
      </div>
      <div class="ph-actions">
        <button class="btn btn-gold" onclick="go('browse',null)">${svg('<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>')} ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</button>
      </div>
    </div>
    <div class="stats-grid">
      ${sc('ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿπÿ±Ÿàÿ∂', s.total_bids||0, 'var(--c-violet)','rgba(139,92,246,.12)', I.send, 100, 'var(--c-violet)', 'anim anim-1')}
      ${sc('ÿπÿ±Ÿàÿ∂ ŸÖŸÇÿ®ŸàŸÑÿ©', s.won_bids||0, 'var(--c-emerald)','rgba(0,201,122,.1)', I.check, winRate, 'var(--c-emerald)', 'anim anim-2')}
      ${sc('ŸÖÿ¥ÿßÿ±Ÿäÿπ ŸÖŸÉÿ™ŸÖŸÑÿ©', s.completed||0, 'var(--c-blue)','rgba(59,141,245,.1)', I.zap, s.total_bids?Math.round((s.completed||0)/s.total_bids*100):0, 'var(--c-blue)', 'anim anim-3')}
      ${sc('ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ', s.avg_rating?Number(s.avg_rating).toFixed(1):0, 'var(--c-gold)','var(--c-gold-dim)', I.star, (s.avg_rating||0)*20, 'var(--c-gold)', 'anim anim-4')}
      ${sc('ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞', s.active||0, 'var(--c-amber)','rgba(245,158,11,.1)', I.zap, 100, 'var(--c-amber)', 'anim anim-5')}
      ${sc('ŸÖÿ≠ŸÅŸàÿ∏', savedIds.length, 'var(--c-gold)','var(--c-gold-dim)', I.bookmark, 100, 'var(--c-gold)', 'anim anim-6')}
    </div>
    <div class="two-col anim">
      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:rgba(0,201,122,.1)">${svg(I.eye,'var(--c-emerald)')}</div>
            <div><div class="card-title">ÿ£ÿ≠ÿØÿ´ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©</div><div class="card-sub">ŸÖŸÅÿ™Ÿàÿ≠ÿ© ŸÑŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑÿ¢ŸÜ</div></div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="go('browse',null)">ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ</button>
        </div>
        <div class="card-body">
          ${allOpenReqs.slice(0,5).map(r => {
            const sv = savedIncl(r.id);
            return `<div style="display:flex;align-items:flex-start;gap:10px;padding:11px 0;border-bottom:1px solid var(--c-border-2)">
              <div style="flex:1;min-width:0">
                <div style="font-size:12px;font-weight:700;margin-bottom:5px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${r.title}</div>
                <div style="display:flex;gap:4px;flex-wrap:wrap">
                  <span class="meta-chip">${svg(I.map)} ${r.city||'‚Äî'}</span>
                  <span class="meta-chip">${svg(I.folder)} ${r.category||'ÿπÿßŸÖ'}</span>
                  ${r.budget_max?`<span class="meta-chip" style="color:var(--c-emerald)">${svg(I.dollar,'var(--c-emerald)')} ${Number(r.budget_max).toLocaleString()}</span>`:''}
                </div>
              </div>
              <div style="display:flex;gap:4px;flex-shrink:0">
                <button class="btn btn-save ${sv?'saved':''} btn-xs" onclick="toggleSave(${r.id},this)">${sv?'‚úì':'üîñ'}</button>
                <button class="btn btn-gold btn-xs" onclick="bidModal(${r.id},'${r.title.replace(/'/g,'')}')">ÿπÿ±ÿ∂</button>
              </div>
            </div>`;
          }).join('') || `<div class="empty-state" style="padding:30px"><div class="empty-desc">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ¥ÿßÿ±Ÿäÿπ ŸÖÿ™ÿßÿ≠ÿ©</div></div>`}
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-header-left">
            <div class="card-icon" style="background:var(--c-blue-dim)">${svg(I.send,'var(--c-blue)')}</div>
            <div class="card-title">ÿ¢ÿÆÿ± ÿπÿ±Ÿàÿ∂Ÿä</div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="go('mybids',null)">ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ</button>
        </div>
        <div class="card-body" id="homeBids">
          <div class="loading-state" style="padding:24px"><div class="spinner"></div></div>
        </div>
      </div>
    </div>
  `);

  const bids = await api('/api/my-bids');
  myBidsData = bids || [];
  const hb = document.getElementById('homeBids');
  if (hb) {
    const bClr = {pending:'badge-pending',accepted:'badge-accepted',rejected:'badge-rejected'};
    const bLbl = {pending:'ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ±',accepted:'ŸÖŸÇÿ®ŸàŸÑ',rejected:'ŸÖÿ±ŸÅŸàÿ∂'};
    hb.innerHTML = myBidsData.slice(0,6).map(b =>
      `<div style="display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--c-border-2)">
        <div style="font-size:11px;font-weight:600;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#fff">${b.request_title||'ŸÖÿ¥ÿ±Ÿàÿπ #'+b.request_id}</div>
        <span class="badge ${bClr[b.status]||'badge-pending'}">${bLbl[b.status]||'ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ±'}</span>
      </div>`
    ).join('') || `<div class="empty-state" style="padding:24px"><div class="empty-desc">ŸÑŸÖ ÿ™ŸÇÿØŸÖ ÿ£Ÿä ÿπÿ±ÿ∂ ÿ®ÿπÿØ</div></div>`;
  }
  document.getElementById('nbBids').textContent = myBidsData.length;
}

function sc(lbl, val, ic, ibg, ipath, pct, bclr, cls='') {
  return `<div class="stat-card ${cls}">
    <div class="stat-card-top"><div class="stat-icon" style="background:${ibg}">${svg(ipath,ic)}</div></div>
    <div class="stat-val">${val}</div>
    <div class="stat-lbl">${lbl}</div>
    <div class="stat-bar"><div class="stat-bar-fill" style="width:${Math.min(pct,100)}%;background:${bclr}"></div></div>
  </div>`;
}

async function pgBrowse() {
  loading();
  const data = await api('/api/requests?status=open');
  allOpenReqs = data || [];
  setContent(`
    <div class="page-header anim">
      <div><div class="ph-title">ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</div><div class="ph-sub">${allOpenReqs.length} ŸÖÿ¥ÿ±Ÿàÿπ ŸÖÿ™ÿßÿ≠ ŸÑŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑÿ¢ŸÜ</div></div>
    </div>
    <div class="card anim">
      <div class="card-body">
        <div class="filter-bar">
          <div class="search-box"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="bQ" placeholder="ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ£Ÿà ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ‚Ä¶" oninput="filterBrowse()"></div>
          <select class="filter-select" id="bCat" onchange="filterBrowse()"><option value="">ŸÉŸÑ ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™</option>${CATS.map(c=>`<option value="${c}">${c}</option>`).join('')}</select>
          <select class="filter-select" id="bCity" onchange="filterBrowse()"><option value="">ŸÉŸÑ ÿßŸÑŸÖÿØŸÜ</option>${CITIES.map(c=>`<option value="${c}">${c}</option>`).join('')}</select>
          <select class="filter-select" id="bSort" onchange="filterBrowse()"><option value="new">ÿßŸÑÿ£ÿ≠ÿØÿ´</option><option value="budget">ÿ£ÿπŸÑŸâ ŸÖŸäÿ≤ÿßŸÜŸäÿ©</option><option value="bids">ÿ£ŸÇŸÑ ÿπÿ±Ÿàÿ∂</option></select>
        </div>
        <div id="browseList">${renderBrowse(allOpenReqs)}</div>
      </div>
    </div>
  `);
}

function filterBrowse() {
  const q = (document.getElementById('bQ')?.value||'').toLowerCase();
  const cat = document.getElementById('bCat')?.value||'';
  const city = document.getElementById('bCity')?.value||'';
  const sort = document.getElementById('bSort')?.value||'new';
  let f = allOpenReqs.filter(r => (!q||r.title.toLowerCase().includes(q)||(r.description||'').toLowerCase().includes(q)) && (!cat||r.category===cat) && (!city||r.city===city));
  if (sort==='budget') f.sort((a,b)=>(b.budget_max||0)-(a.budget_max||0));
  else if (sort==='bids') f.sort((a,b)=>(a.bid_count||0)-(b.bid_count||0));
  const el = document.getElementById('browseList');
  if (el) el.innerHTML = renderBrowse(f);
}

function renderBrowse(list) {
  if (!list.length) return `<div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div><div class="empty-title">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨</div><div class="empty-desc">ÿ¨ÿ±ÿ® ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ®ÿ≠ÿ´ ÿ£Ÿà ÿßŸÑŸÅŸÑÿßÿ™ÿ±</div></div>`;
  return list.map(r => {
    const sv = savedIncl(r.id);
    const newTag = isNew(r.created_at) ? `<span class="new-badge">‚ú® ÿ¨ÿØŸäÿØ</span>` : '';
    return `<div class="proj-card">
      ${newTag}
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px">
        <div><div class="proj-num">${r.project_number||'#'+r.id}</div><div class="proj-title">${r.title}</div></div>
        <span class="badge badge-open" style="flex-shrink:0">ŸÖŸÅÿ™Ÿàÿ≠</span>
      </div>
      <div class="proj-meta">
        <span class="meta-chip">${svg(I.map)} ${r.city||'‚Äî'}</span>
        <span class="meta-chip">${svg(I.folder)} ${r.category||'ÿπÿßŸÖ'}</span>
        ${r.budget_max?`<span class="meta-chip" style="color:var(--c-emerald)">${svg(I.dollar,'var(--c-emerald)')} ÿ≠ÿ™Ÿâ ${Number(r.budget_max).toLocaleString()} ÿ±.ÿ≥</span>`:''}
        ${r.deadline?`<span class="meta-chip">${svg(I.calendar)} ${r.deadline}</span>`:''}
        <span class="meta-chip">${svg(I.user)} ${r.bid_count||0} ÿπÿ±ÿ∂</span>
      </div>
      ${r.description?`<div class="proj-desc">${r.description.slice(0,200)}${r.description.length>200?'‚Ä¶':''}</div>`:''}
      <div class="proj-actions">
        <button class="btn btn-gold btn-sm" onclick="bidModal(${r.id},'${r.title.replace(/'/g,'')}')">ÿ™ŸÇÿØŸäŸÖ ÿπÿ±ÿ∂</button>
        <button class="btn btn-save ${sv?'saved':''} btn-sm" onclick="toggleSave(${r.id},this)">${sv?'‚úì ŸÖŸáÿ™ŸÖ':'üîñ ÿßŸáÿ™ŸÖ'}</button>
        <button class="btn btn-ghost btn-sm" onclick="viewReqModal(${r.id})">${svg(I.eye)} ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</button>
      </div>
    </div>`;
  }).join('');
}

function bidModal(reqId, title) {
  openModal(`ÿ™ŸÇÿØŸäŸÖ ÿπÿ±ÿ∂ ‚Äî ${title}`,
    `<div class="alert alert-info">${svg('<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16">')}ÿ≥ŸäÿµŸÑŸÉ ÿ•ÿ¥ÿπÿßÿ± ŸÅŸàÿ± ÿ±ÿØ ÿßŸÑÿπŸÖŸäŸÑ ÿπŸÑŸâ ÿπÿ±ÿ∂ŸÉ</div>
     <div class="f2">
       <div class="fg"><label class="fl">ÿ≥ÿπÿ±ŸÉ ÿßŸÑŸÖŸÇÿ™ÿ±ÿ≠ (ÿ±.ÿ≥) <span class="fl-hint">*</span></label><input type="number" class="fi" id="bPrice" placeholder="ÿßÿØÿÆŸÑ ÿ≥ÿπÿ±ŸÉ ÿßŸÑÿ™ŸÜÿßŸÅÿ≥Ÿä" min="1"></div>
       <div class="fg"><label class="fl">ŸÖÿØÿ© ÿßŸÑÿ™ŸÜŸÅŸäÿ∞ (ÿ£ŸäÿßŸÖ) <span class="fl-hint">*</span></label><input type="number" class="fi" id="bDays" placeholder="ÿπÿØÿØ ÿßŸÑÿ£ŸäÿßŸÖ" min="1"></div>
     </div>
     <div class="fg"><label class="fl">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ŸÉ ŸàŸÖÿ§ŸáŸÑÿßÿ™ŸÉ</label><textarea class="fta" id="bNote" style="min-height:110px" placeholder="ÿßÿ¥ÿ±ÿ≠ ŸÑŸÖÿßÿ∞ÿß ÿ£ŸÜÿ™ ÿßŸÑÿÆŸäÿßÿ± ÿßŸÑÿ£ŸÅÿ∂ŸÑ‚Ä¶"></textarea></div>`,
    `<button class="btn btn-ghost" onclick="closeModal()">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-gold" onclick="submitBid(${reqId})">${svg(I.send)} ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿπÿ±ÿ∂</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--c-gold)">${I.send}</svg>`, 'var(--c-gold-dim)'
  );
}

async function submitBid(reqId) {
  const price = document.getElementById('bPrice')?.value;
  const days = document.getElementById('bDays')?.value;
  const note = document.getElementById('bNote')?.value;
  if (!price || !days) { toast('ÿ£ÿØÿÆŸÑ ÿßŸÑÿ≥ÿπÿ± ŸàÿßŸÑŸÖÿØÿ©', 'error'); return; }
  const res = await api('/api/bids', {method:'POST', body:JSON.stringify({request_id:reqId, price:parseFloat(price), days:parseInt(days), note})});
  if (res.message && !res.id) { toast(res.message, 'error'); return; }
  closeModal();
  toast('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿπÿ±ÿ∂ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠ ‚úÖ', 'success');
  const nb = document.getElementById('nbBids');
  if (nb) nb.textContent = parseInt(nb.textContent||0) + 1;
}

async function viewReqModal(id) {
  const r = await api(`/api/requests/${id}`);
  const sv = savedIncl(r.id);
  openModal('ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ',
    `<div style="background:linear-gradient(135deg,var(--c-surface-3),var(--c-surface-2));border:1px solid var(--c-border);border-radius:var(--r-lg);padding:18px;margin-bottom:16px">
       <div style="font-size:9px;font-weight:700;color:var(--c-text-3);letter-spacing:1px;margin-bottom:5px">${r.project_number||'#'+r.id}</div>
       <div style="font-size:15px;font-weight:700;color:#fff;margin-bottom:12px;line-height:1.3">${r.title}</div>
       <div style="display:flex;gap:6px;flex-wrap:wrap">
         <span class="badge badge-open">ŸÖŸÅÿ™Ÿàÿ≠</span>
         <span style="font-size:10px;color:var(--c-text-2);background:rgba(255,255,255,.05);padding:3px 9px;border-radius:99px;border:1px solid var(--c-border)">${r.category||'‚Äî'}</span>
         ${r.city?`<span style="font-size:10px;color:var(--c-text-2);background:rgba(255,255,255,.05);padding:3px 9px;border-radius:99px;border:1px solid var(--c-border)">üìç ${r.city}</span>`:''}
       </div>
     </div>
     <div class="info-block">
       <div class="info-block-title">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</div>
       <div class="info-row"><span class="info-key">ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑŸÇÿµŸàŸâ</span><span class="info-val" style="color:var(--c-emerald)">${fprice(r.budget_max)}</span></div>
       <div class="info-row"><span class="info-key">ÿßŸÑŸÖŸàÿπÿØ ÿßŸÑŸÜŸáÿßÿ¶Ÿä</span><span class="info-val">${r.deadline||'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span></div>
       <div class="info-row"><span class="info-key">ÿßŸÑŸÖÿØŸäŸÜÿ©</span><span class="info-val">${r.city||'‚Äî'}</span></div>
       ${r.address?`<div class="info-row"><span class="info-key">ÿßŸÑÿπŸÜŸàÿßŸÜ</span><span class="info-val">${r.address}</span></div>`:''}
       <div class="info-row"><span class="info-key">ÿπÿØÿØ ÿßŸÑÿπÿ±Ÿàÿ∂</span><span class="info-val">${r.bid_count||0} ÿπÿ±ÿ∂</span></div>
     </div>
     ${r.description?`<div class="info-block"><div class="info-block-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</div><div style="font-size:12px;line-height:1.8;color:var(--c-text-2)">${r.description}</div></div>`:''}`,
    `${r.status==='open'?`<button class="btn btn-save ${sv?'saved':''} btn-sm" onclick="toggleSave(${r.id},this)">${sv?'‚úì ŸÖŸáÿ™ŸÖ':'üîñ ÿßŸáÿ™ŸÖ'}</button><button class="btn btn-gold" onclick="closeModal();bidModal(${r.id},'${(r.title||'').replace(/'/g,'')}')">ÿ™ŸÇÿØŸäŸÖ ÿπÿ±ÿ∂</button>`:''}
     <button class="btn btn-ghost" onclick="closeModal()">ÿ•ÿ∫ŸÑÿßŸÇ</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--c-gold)">${I.eye}</svg>`, 'var(--c-gold-dim)'
  );
}

async function pgSaved() {
  loading();
  const data = await api('/api/saved');
  const saved = data || [];
  savedIds = saved.map(x=>x.id);
  savePersist();
  const nb = document.getElementById('nbSaved');
  if (nb) { nb.style.display=savedIds.length?'':'none'; nb.textContent=savedIds.length; }
  setContent(`
    <div class="page-header anim">
      <div><div class="ph-title">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸáÿ™ŸÖ</div><div class="ph-sub">${saved.length} ŸÖÿ¥ÿ±Ÿàÿπ ŸÖÿ≠ŸÅŸàÿ∏</div></div>
      ${saved.length?`<div class="ph-actions"><button class="btn btn-ghost btn-sm" onclick="clearSaved()">ŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸÑ</button></div>`:''}
    </div>
    <div class="card anim"><div class="card-body">
      ${saved.length ? saved.map(r => `<div class="proj-card saved-card">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px">
          <div><div class="proj-num">${r.project_number||'#'+r.id}</div><div class="proj-title">${r.title}</div></div>
          <span class="badge ${r.status==='open'?'badge-open':'badge-pending'}">${r.status==='open'?'ŸÖŸÅÿ™Ÿàÿ≠':'ŸÖÿπŸÑŸÇ'}</span>
        </div>
        <div class="proj-meta">
          <span class="meta-chip">${svg(I.map)} ${r.city||'‚Äî'}</span>
          <span class="meta-chip">${svg(I.folder)} ${r.category||'ÿπÿßŸÖ'}</span>
          ${r.budget_max?`<span class="meta-chip" style="color:var(--c-emerald)">${svg(I.dollar,'var(--c-emerald)')} ÿ≠ÿ™Ÿâ ${Number(r.budget_max).toLocaleString()} ÿ±.ÿ≥</span>`:''}
        </div>
        ${r.description?`<div class="proj-desc">${r.description.slice(0,150)}${r.description.length>150?'‚Ä¶':''}</div>`:''}
        <div class="proj-actions">
          ${r.status==='open'?`<button class="btn btn-gold btn-sm" onclick="bidModal(${r.id},'${r.title.replace(/'/g,'')}')">ÿ™ŸÇÿØŸäŸÖ ÿπÿ±ÿ∂</button>`:''}
          <button class="btn btn-ghost btn-sm" onclick="viewReqModal(${r.id})">ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</button>
          <button class="btn btn-save saved btn-sm" onclick="toggleSave(${r.id},this);setTimeout(pgSaved,400)">‚úì ÿ•ÿ≤ÿßŸÑÿ©</button>
        </div>
      </div>`).join('') : `<div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24">${I.bookmark}</svg></div><div class="empty-title">ŸÇÿßÿ¶ŸÖÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ©</div><div class="empty-desc">ÿßÿ∂ÿ∫ÿ∑ "üîñ ÿßŸáÿ™ŸÖ" ÿπŸÑŸâ ÿ£Ÿä ŸÖÿ¥ÿ±Ÿàÿπ ŸÑÿ•ÿ∂ÿßŸÅÿ™Ÿá ŸáŸÜÿß</div></div>`}
    </div></div>
  `);
}

async function clearSaved() {
  if (!confirm('ŸÖÿ≥ÿ≠ ŸÉŸÑ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿßÿ™ÿü')) return;
  await Promise.all(savedIds.map(id=>api(`/api/saved/${id}`,{method:'DELETE'})));
  savedIds=[]; savePersist();
  toast('ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©','info'); pgSaved();
  const nb=document.getElementById('nbSaved'); if(nb) nb.style.display='none';
}

async function pgMyBids() {
  loading();
  const data = await api('/api/my-bids');
  myBidsData = data || [];
  const pend = myBidsData.filter(b=>b.status==='pending').length;
  const acc = myBidsData.filter(b=>b.status==='accepted').length;
  const rej = myBidsData.filter(b=>b.status==='rejected').length;
  document.getElementById('nbBids').textContent = myBidsData.length;
  setContent(`
    <div class="page-header anim"><div><div class="ph-title">ÿπÿ±Ÿàÿ∂Ÿä</div><div class="ph-sub">ŸÉŸÑ ÿßŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑÿ™Ÿä ŸÇÿØŸÖÿ™Ÿáÿß</div></div></div>
    <div class="stats-grid" style="grid-template-columns:repeat(4,1fr)">
      ${ms('ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿπÿ±Ÿàÿ∂', myBidsData.length, 'var(--c-violet)', 'rgba(139,92,246,.1)', 'anim anim-1')}
      ${ms('ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ±ÿØ', pend, 'var(--c-amber)', 'rgba(245,158,11,.1)', 'anim anim-2')}
      ${ms('ŸÖŸÇÿ®ŸàŸÑÿ© ‚úÖ', acc, 'var(--c-emerald)', 'rgba(0,201,122,.1)', 'anim anim-3')}
      ${ms('ŸÖÿ±ŸÅŸàÿ∂ÿ©', rej, 'var(--c-red)', 'rgba(255,77,103,.1)', 'anim anim-4')}
    </div>
    <div class="card anim">
      <div class="card-header">
        <div class="card-header-left"><div class="card-icon" style="background:var(--c-blue-dim)">${svg(I.send,'var(--c-blue)')}</div><div><div class="card-title">ŸÉŸÑ ÿπÿ±Ÿàÿ∂Ÿä</div></div></div>
        <select class="filter-select" id="bfSt" onchange="filterMyBids()"><option value="">ÿßŸÑŸÉŸÑ</option><option value="pending">ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ±</option><option value="accepted">ŸÖŸÇÿ®ŸàŸÑ</option><option value="rejected">ŸÖÿ±ŸÅŸàÿ∂</option></select>
      </div>
      <div class="card-body" id="bidsList">${renderBidsList(myBidsData)}</div>
    </div>
  `);
}

function ms(lbl, val, clr, bg, cls='') {
  return `<div class="stat-card ${cls}"><div class="stat-val" style="color:${clr}">${val}</div><div class="stat-lbl">${lbl}</div><div class="stat-bar" style="margin-top:8px"><div class="stat-bar-fill" style="width:100%;background:${clr};opacity:.4"></div></div></div>`;
}

function filterMyBids() {
  const st = document.getElementById('bfSt')?.value||'';
  const f = st ? myBidsData.filter(b=>b.status===st) : myBidsData;
  const el = document.getElementById('bidsList');
  if (el) el.innerHTML = renderBidsList(f);
}

function renderBidsList(list) {
  if (!list.length) return `<div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24">${I.send}</svg></div><div class="empty-title">ŸÑÿß ŸäŸàÿ¨ÿØ ÿπÿ±Ÿàÿ∂</div><div class="empty-desc">ÿßÿ®ÿØÿ£ ÿ®ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ Ÿàÿ™ŸÇÿØŸäŸÖ ÿπÿ±Ÿàÿ∂ŸÉ</div></div>`;
  const clsMap = {accepted:'acc',rejected:'rej',pending:'pend'};
  const lblMap = {accepted:'ŸÖŸÇÿ®ŸàŸÑ ‚úÖ',rejected:'ŸÖÿ±ŸÅŸàÿ∂',pending:'ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ±ÿØ'};
  const badgeMap = {accepted:'badge-accepted',rejected:'badge-rejected',pending:'badge-pending'};
  return list.map(b=>`<div class="bid-card ${clsMap[b.status]||'pend'}">
    <div class="bid-header">
      <div><div class="bid-num">${b.project_number||'#'+b.request_id}</div><div class="bid-title">${b.request_title||'ŸÖÿ¥ÿ±Ÿàÿπ'}</div></div>
      <span class="badge ${badgeMap[b.status]||'badge-pending'}">${lblMap[b.status]||'‚Äî'}</span>
    </div>
    <div class="bid-chips">
      <div class="bid-chip"><span>ÿßŸÑÿ≥ÿπÿ±: </span><strong>${Number(b.price).toLocaleString()} ÿ±.ÿ≥</strong></div>
      <div class="bid-chip"><span>ÿßŸÑŸÖÿØÿ©: </span><strong>${b.days} ŸäŸàŸÖ</strong></div>
      ${b.created_at?`<div class="bid-chip"><span>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: </span><strong>${fdate(b.created_at)}</strong></div>`:''}
    </div>
    ${b.note?`<div class="bid-note">${b.note}</div>`:''}
    ${b.status==='accepted'?`<div class="alert alert-success" style="margin-top:10px">${svg(I.check,'var(--c-emerald)')} ÿ™ŸÖ ŸÇÿ®ŸàŸÑ ÿπÿ±ÿ∂ŸÉ! ÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿßŸÑÿπŸÖŸäŸÑ ŸÑŸÑÿ®ÿØÿ° ŸÅŸä ÿßŸÑÿπŸÖŸÑ</div>`:''}
    ${b.status==='pending'?`<div class="bid-footer"><button class="btn btn-danger btn-xs" onclick="withdrawBid(${b.id})">${svg(I.trash)} ÿ≥ÿ≠ÿ® ÿßŸÑÿπÿ±ÿ∂</button></div>`:''}
  </div>`).join('');
}

async function withdrawBid(id) {
  if (!confirm('ÿ≥ÿ≠ÿ® Ÿáÿ∞ÿß ÿßŸÑÿπÿ±ÿ∂ ŸÜŸáÿßÿ¶ŸäÿßŸãÿü')) return;
  await api(`/api/bids/${id}`, {method:'DELETE'});
  toast('ÿ™ŸÖ ÿ≥ÿ≠ÿ® ÿßŸÑÿπÿ±ÿ∂','info'); pgMyBids();
}

async function pgActive() {
  loading();
  const data = await api('/api/my-projects?status=in_progress');
  const projects = data || [];
  const nb = document.getElementById('nbActive');
  if (nb) { nb.style.display=projects.length?'':'none'; nb.textContent=projects.length; }
  setContent(`
    <div class="page-header anim"><div><div class="ph-title">ŸÖÿ¥ÿßÿ±ŸäÿπŸä ÿßŸÑŸÜÿ¥ÿ∑ÿ©</div><div class="ph-sub">${projects.length} ŸÖÿ¥ÿ±Ÿàÿπ ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞</div></div></div>
    ${projects.length ? projects.map(p=>`
      <div class="card anim">
        <div class="card-header">
          <div class="card-header-left"><div class="card-icon" style="background:var(--c-blue-dim)">${svg(I.zap,'var(--c-blue)')}</div><div><div class="card-title">${p.title}</div><div class="card-sub">${p.project_number||'#'+p.id} ‚Ä¢ ${p.client_name||'ÿßŸÑÿπŸÖŸäŸÑ'}</div></div></div>
          <span class="badge badge-progress">ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞</span>
        </div>
        <div class="card-body">
          <div class="tracker">
            ${['ŸÜŸèÿ¥ÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ','ÿ®ÿØÿ£ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞','ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿπŸÖŸÑ','ÿ™ŸÖ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ'].map((lbl,i)=>{
              const cls=i<1?'done':i===1?'cur':'';
              return `<div class="tracker-step ${cls}"><div class="tracker-dot">${i<1?'‚úì':i+1}</div><div class="tracker-lbl">${lbl}</div></div>`;
            }).join('')}
          </div>
          <div class="info-block">
            <div class="info-block-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</div>
            <div class="info-row"><span class="info-key">ÿßŸÑÿπŸÖŸäŸÑ</span><span class="info-val">${p.client_name||'‚Äî'}</span></div>
            <div class="info-row"><span class="info-key">ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿ™ŸÅŸÇ</span><span class="info-val" style="color:var(--c-emerald)">${fprice(p.agreed_price)}</span></div>
            <div class="info-row"><span class="info-key">ÿßŸÑŸÖŸàÿπÿØ ÿßŸÑŸÜŸáÿßÿ¶Ÿä</span><span class="info-val" style="color:var(--c-amber)">${p.deadline||'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span></div>
            <div class="info-row"><span class="info-key">ÿßŸÑŸÖÿØŸäŸÜÿ©</span><span class="info-val">${p.city||'‚Äî'}</span></div>
            ${p.address?`<div class="info-row"><span class="info-key">ÿßŸÑÿπŸÜŸàÿßŸÜ</span><span class="info-val">${p.address}</span></div>`:''}
          </div>
          ${p.description?`<div class="proj-desc" style="margin-bottom:12px">${p.description}</div>`:''}
          ${p.client_phone?`<div style="display:flex;gap:8px;flex-wrap:wrap"><a href="tel:${p.client_phone}" class="btn btn-success btn-sm">${svg(I.phone)} ÿßÿ™ÿµŸÑ ÿ®ÿßŸÑÿπŸÖŸäŸÑ</a><a href="https://wa.me/966${p.client_phone.replace(/^0/,'')}" target="_blank" class="btn btn-ghost btn-sm">üí¨ Ÿàÿßÿ™ÿ≥ÿßÿ®</a></div>`:''}
        </div>
      </div>`).join('') : `<div class="card anim"><div class="card-body"><div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24">${I.zap}</svg></div><div class="empty-title">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ¥ÿßÿ±Ÿäÿπ ŸÜÿ¥ÿ∑ÿ©</div><div class="empty-desc">ÿπŸÜÿØŸÖÿß ŸäŸÇÿ®ŸÑ ÿπŸÖŸäŸÑ ÿπÿ±ÿ∂ŸÉ ÿ≥Ÿäÿ∏Ÿáÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸáŸÜÿß</div></div></div></div>`}
  `);
}

async function pgHistory() {
  loading();
  const data = await api('/api/my-projects?status=completed');
  const projects = data || [];
  setContent(`
    <div class="page-header anim"><div><div class="ph-title">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿπŸÖŸÑ</div><div class="ph-sub">${projects.length} ŸÖÿ¥ÿ±Ÿàÿπ ŸÖŸÉÿ™ŸÖŸÑ</div></div></div>
    <div class="card anim"><div class="card-body">
      ${projects.length ? `<div class="table-wrap"><table class="tbl">
        <thead><tr><th>ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</th><th>ÿßŸÑÿπŸÖŸäŸÑ</th><th>ÿßŸÑŸÖÿØŸäŸÜÿ©</th><th>ÿßŸÑÿ≥ÿπÿ±</th><th>ÿßŸÑÿ™ŸÇŸäŸäŸÖ</th><th>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÉŸÖÿßŸÑ</th><th></th></tr></thead>
        <tbody>${projects.map(p=>`<tr>
          <td><div style="font-size:12px;font-weight:700;color:#fff">${p.title}</div><div style="font-size:9px;color:var(--c-text-3)">${p.project_number||'#'+p.id}</div></td>
          <td style="font-size:12px">${p.client_name||'‚Äî'}</td>
          <td style="font-size:11px;color:var(--c-text-2)">${p.city||'‚Äî'}</td>
          <td style="font-size:12px;font-weight:700;color:var(--c-emerald)">${fprice(p.agreed_price)}</td>
          <td>${p.my_rating?`<span>${starsHtml(p.my_rating)}</span>`:`<span style="color:var(--c-text-3);font-size:11px">‚Äî</span>`}</td>
          <td style="font-size:11px;color:var(--c-text-3)">${fdate(p.completed_at)}</td>
          <td>${!p.my_rating?`<button class="btn btn-save btn-xs" onclick="rateClientModal(${p.id},'${(p.client_name||'').replace(/'/g,'')}',${p.client_id||0})">${svg(I.star,'var(--c-gold)')} ÿ™ŸÇŸäŸäŸÖ</button>`:''}</td>
        </tr>`).join('')}</tbody>
      </table></div>` :
      `<div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div><div class="empty-title">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ¥ÿßÿ±Ÿäÿπ ŸÖŸÉÿ™ŸÖŸÑÿ© ÿ®ÿπÿØ</div><div class="empty-desc">ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ© ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß ŸÖÿπ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™</div></div>`}
    </div></div>
  `);
}

function rateClientModal(reqId, clientName, clientId) {
  ratingSelected = 0;
  openModal(`ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿπŸÖŸäŸÑ ‚Äî ${clientName}`,
    `<div style="text-align:center;padding:8px 0 20px">
       <div style="font-size:12px;color:var(--c-text-2);margin-bottom:14px">ŸÉŸäŸÅ ŸÉÿßŸÜÿ™ ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉ ŸÖÿπ Ÿáÿ∞ÿß ÿßŸÑÿπŸÖŸäŸÑÿü</div>
       <div class="rating-stars" style="justify-content:center">${[1,2,3,4,5].map(n=>`<span class="rating-star" onclick="selectRating(${n})">‚òÖ</span>`).join('')}</div>
       <div style="font-size:11px;color:var(--c-text-3);margin-top:10px;min-height:16px" id="ratingHint">ÿßÿÆÿ™ÿ± ÿπÿØÿØ ÿßŸÑŸÜÿ¨ŸàŸÖ</div>
     </div>
     <div class="fg"><label class="fl">ÿ™ÿπŸÑŸäŸÇŸÉ <span class="fl-hint">ÿßÿÆÿ™Ÿäÿßÿ±Ÿä</span></label><textarea class="fta" id="ratingComment" placeholder="ÿ¥ÿßÿ±ŸÉ ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉ ŸÖÿπ Ÿáÿ∞ÿß ÿßŸÑÿπŸÖŸäŸÑ‚Ä¶"></textarea></div>`,
    `<button class="btn btn-ghost" onclick="closeModal()">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-gold" onclick="submitRating(${reqId},${clientId})">${svg(I.star)} ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--c-gold)">${I.star}</svg>`, 'var(--c-gold-dim)'
  );
}

function selectRating(n) {
  ratingSelected = n;
  document.querySelectorAll('.rating-star').forEach((s,i)=>s.classList.toggle('active',i<n));
  const hints=['','ÿ∂ÿπŸäŸÅ ÿ¨ÿØÿßŸã','ÿ∂ÿπŸäŸÅ','ŸÖŸÇÿ®ŸàŸÑ','ÿ¨ŸäÿØ','ŸÖŸÖÿ™ÿßÿ≤! üéâ'];
  const el=document.getElementById('ratingHint');
  if(el) el.textContent=hints[n]||'';
}

async function submitRating(reqId, clientId) {
  if (!ratingSelected) { toast('ÿßÿÆÿ™ÿ± ÿπÿØÿØ ÿßŸÑŸÜÿ¨ŸàŸÖ ÿ£ŸàŸÑÿßŸã','error'); return; }
  const comment = document.getElementById('ratingComment')?.value||'';
  await api('/api/reviews',{method:'POST',body:JSON.stringify({request_id:reqId,reviewed_id:clientId,rating:ratingSelected,comment})});
  closeModal(); toast('ÿ¥ŸÉÿ±ÿßŸã ÿπŸÑŸâ ÿ™ŸÇŸäŸäŸÖŸÉ ‚úÖ','success'); pgHistory();
}

async function pgReviews() {
  loading();
  const data = await api('/api/my-reviews');
  myRevsData = data || [];
  const avg = myRevsData.length ? myRevsData.reduce((s,r)=>s+r.rating,0)/myRevsData.length : 0;
  const dist = {5:0,4:0,3:0,2:0,1:0};
  myRevsData.forEach(r=>{dist[r.rating]=(dist[r.rating]||0)+1;});
  setContent(`
    <div class="page-header anim"><div><div class="ph-title">ÿ™ŸÇŸäŸäŸÖÿßÿ™Ÿä</div><div class="ph-sub">${myRevsData.length} ÿ™ŸÇŸäŸäŸÖ ÿ•ÿ¨ŸÖÿßŸÑÿßŸã</div></div></div>
    <div style="display:grid;grid-template-columns:180px 1fr;gap:14px;margin-bottom:16px" class="anim">
      <div class="card"><div class="card-body" style="text-align:center;padding:24px 16px">
        <div style="font-size:42px;font-weight:700;letter-spacing:-2px;color:#fff;margin-bottom:4px">${avg.toFixed(1)}</div>
        <div style="font-size:20px;letter-spacing:3px;margin-bottom:6px">${starsHtml(avg)}</div>
        <div style="font-size:11px;color:var(--c-text-3)">ŸÖŸÜ ${myRevsData.length} ÿ™ŸÇŸäŸäŸÖ</div>
      </div></div>
      <div class="card"><div class="card-body">
        ${[5,4,3,2,1].map(n=>{const c=dist[n]||0;const pct=myRevsData.length?Math.round(c/myRevsData.length*100):0;return `<div style="display:flex;align-items:center;gap:10px;margin-bottom:10px"><div style="font-size:11px;font-weight:700;width:35px;flex-shrink:0;color:var(--c-text-2)">${n} ‚òÖ</div><div style="flex:1;height:6px;border-radius:99px;background:rgba(255,255,255,.05);overflow:hidden"><div style="height:100%;width:${pct}%;background:var(--c-gold);border-radius:99px;transition:width 1.2s cubic-bezier(.4,0,.2,1)"></div></div><div style="font-size:10px;color:var(--c-text-3);width:20px;text-align:left;flex-shrink:0">${c}</div></div>`;}).join('')}
      </div></div>
    </div>
    <div class="card anim">
      <div class="card-header">
        <div class="card-header-left"><div class="card-icon" style="background:var(--c-gold-dim)">${svg(I.star,'var(--c-gold)')}</div><div class="card-title">ŸÉŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™</div></div>
        <select class="filter-select" id="rvF" onchange="filterRevs()"><option value="">ŸÉŸÑ ÿßŸÑŸÜÿ¨ŸàŸÖ</option>${[5,4,3,2,1].map(n=>`<option value="${n}">${n} ‚òÖ</option>`).join('')}</select>
      </div>
      <div class="card-body" id="revsList">${renderRevsList(myRevsData)}</div>
    </div>
  `);
}

function filterRevs() {
  const n=document.getElementById('rvF')?.value||'';
  const f=n?myRevsData.filter(r=>r.rating==n):myRevsData;
  const el=document.getElementById('revsList');
  if(el) el.innerHTML=renderRevsList(f);
}

function renderRevsList(list) {
  if (!list.length) return `<div class="empty-state"><div class="empty-title">ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ŸÇŸäŸäŸÖÿßÿ™</div></div>`;
  return list.map(r=>{
    const bg=avColor(r.reviewer_id||1);
    return `<div class="rev-card">
      <div class="rev-header">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="rev-avatar" style="background:${bg}">${avLetter(r.reviewer_name)}</div>
          <div><div class="rev-name">${r.reviewer_name||'‚Äî'}</div><div class="rev-sub">${r.project_number||'#'+r.request_id}</div></div>
        </div>
        <div style="text-align:left"><div class="stars" style="font-size:13px">${starsHtml(r.rating)}</div><div style="font-size:9px;color:var(--c-text-3);margin-top:3px">${fdate(r.created_at)}</div></div>
      </div>
      ${r.comment?`<div class="rev-text">${r.comment}</div>`:''}
      ${r.admin_reply?`<div class="rev-reply"><div class="reply-lbl">ÿ±ÿØ ÿßŸÑÿ•ÿØÿßÿ±ÿ©</div><div class="reply-txt">${r.admin_reply}</div></div>`:''}
    </div>`;
  }).join('');
}

async function pgNotifs() {
  loading();
  const data = await api('/api/notifications');
  myNotifsData = data || [];
  const unread = myNotifsData.filter(n=>!n.read).length;
  const dot = document.getElementById('topNotifDot');
  const nb = document.getElementById('nbNotifs');
  if (dot) dot.style.display=unread?'':'none';
  if (nb) { nb.style.display=unread?'':'none'; nb.textContent=unread; }
  setContent(`
    <div class="page-header anim">
      <div><div class="ph-title">ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</div><div class="ph-sub">${unread} ÿ∫Ÿäÿ± ŸÖŸÇÿ±Ÿàÿ°</div></div>
      ${unread?`<div class="ph-actions"><button class="btn btn-ghost btn-sm" onclick="markAllRead()">‚úì ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÉŸÑ</button></div>`:''}
    </div>
    <div class="card anim"><div class="card-body">
      ${myNotifsData.length ? myNotifsData.map(n=>{
        const icoBg={bid_accepted:'rgba(0,201,122,.1)',bid_rejected:'rgba(255,77,103,.1)',warning:'rgba(245,158,11,.1)',admin:'var(--c-gold-dim)'};
        const ico={bid_accepted:'üéâ',bid_rejected:'‚ùå',project_complete:'‚úÖ',warning:'‚ö†Ô∏è',admin:'üì¢'};
        return `<div class="notif-item ${n.read?'':'unread'}" onclick="readN(${n.id})">
          <div class="notif-ic" style="background:${icoBg[n.type]||'rgba(255,255,255,.04)'}">${ico[n.type]||'üîî'}</div>
          <div style="flex:1"><div class="notif-title">${n.title||'ÿ•ÿ¥ÿπÿßÿ±'}</div><div class="notif-body">${n.body||''}</div><div class="notif-time">${fdate(n.created_at)}</div></div>
          ${!n.read?'<div class="unread-dot"></div>':''}
        </div>`;
      }).join('') : `<div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24">${I.bell}</svg></div><div class="empty-title">ŸÑÿß ŸäŸàÿ¨ÿØ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</div></div>`}
    </div></div>
  `);
}

function readN(id) { api(`/api/notifications/${id}/read`,{method:'PUT'}); }
async function markAllRead() { await api('/api/notifications/read-all',{method:'PUT'}); pgNotifs(); }

async function pgWallet() {
  loading();
  const s = await api('/api/provider/stats') || {};
  const total = (s.completed||0) * (s.avg_price||0);
  const winRate = s.total_bids ? Math.round((s.won_bids||0)/s.total_bids*100) : 0;
  setContent(`
    <div class="page-header anim"><div><div class="ph-title">ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©</div><div class="ph-sub">ŸÖŸÑÿÆÿµ ÿ£ÿØÿßÿ¶ŸÉ ÿßŸÑŸÖÿßŸÑŸä</div></div></div>
    <div class="wallet-hero anim">
      <div class="wallet-hero-grid">
        <div>
          <div class="wallet-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸÖŸÇÿØÿ±ÿ©</div>
          <div class="wallet-amount">${total.toLocaleString('ar-SA')} <span>ÿ±.ÿ≥</span></div>
          <div class="wallet-sub">ŸÖŸÜ ${s.completed||0} ŸÖÿ¥ÿ±Ÿàÿπ ŸÖŸÉÿ™ŸÖŸÑ</div>
        </div>
        <div class="wallet-badge">üí∞</div>
      </div>
      <div class="wallet-stats">
        <div class="wallet-stat"><div class="wallet-stat-val">${s.completed||0}</div><div class="wallet-stat-lbl">ŸÖÿ¥ÿ±Ÿàÿπ ŸÖŸÉÿ™ŸÖŸÑ</div></div>
        <div class="wallet-stat"><div class="wallet-stat-val">${s.avg_price?Math.round(s.avg_price).toLocaleString():0}</div><div class="wallet-stat-lbl">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</div></div>
        <div class="wallet-stat"><div class="wallet-stat-val" style="color:var(--c-emerald)">${winRate}%</div><div class="wallet-stat-lbl">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅŸàÿ≤</div></div>
      </div>
    </div>
    <div class="card anim">
      <div class="card-header"><div class="card-header-left"><div class="card-icon" style="background:rgba(0,201,122,.1)">${svg(I.dollar,'var(--c-emerald)')}</div><div class="card-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑŸÖÿßŸÑŸä</div></div></div>
      <div class="card-body">
        <div class="info-block">
          <div class="info-row"><span class="info-key">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸÖŸÇÿØÿ±ÿ©</span><span class="info-val" style="color:var(--c-emerald);font-size:14px">${total.toLocaleString('ar-SA')} ÿ±.ÿ≥</span></div>
          <div class="info-row"><span class="info-key">ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</span><span class="info-val">${fprice(s.avg_price)}</span></div>
          <div class="info-row"><span class="info-key">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑŸÖŸÇÿØŸÖÿ©</span><span class="info-val">${s.total_bids||0} ÿπÿ±ÿ∂</span></div>
          <div class="info-row"><span class="info-key">ÿßŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑŸÖŸÇÿ®ŸàŸÑÿ©</span><span class="info-val">${s.won_bids||0} ÿπÿ±ÿ∂</span></div>
          <div class="info-row"><span class="info-key">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅŸàÿ≤</span><span class="info-val" style="color:var(--c-emerald)">${winRate}%</span></div>
          <div class="info-row"><span class="info-key">ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ ÿßŸÑŸÜÿ¥ÿ∑ÿ© ÿ≠ÿßŸÑŸäÿßŸã</span><span class="info-val" style="color:var(--c-blue)">${s.active||0}</span></div>
        </div>
        <div class="alert alert-success">${svg(I.star,'var(--c-emerald)')} ÿ±ŸÅÿπ ŸÖŸÑŸÅŸÉ ÿßŸÑÿ¥ÿÆÿµŸä Ÿàÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿπŸÖÿßŸÑ ÿ≥ÿßÿ®ŸÇÿ© Ÿäÿ≤ŸäÿØ ŸÜÿ≥ÿ®ÿ© ŸÇÿ®ŸàŸÑ ÿπÿ±Ÿàÿ∂ŸÉ</div>
      </div>
    </div>
  `);
}

async function pgProfile() {
  loading();
  const u = await api('/api/me') || me;
  const b = BADGE_MAP[u.badge||'none'] || BADGE_MAP.none;
  uploadedImgs['prof'] = [];
  setContent(`
    <div class="profile-hero anim">
      <div class="profile-avatar">${avLetter(u.name)}</div>
      <div style="flex:1;position:relative">
        <div class="profile-name">${u.name||'‚Äî'}</div>
        <div class="profile-email">${u.email||'‚Äî'}</div>
        <div class="profile-tags">
          <span style="font-size:10px;background:rgba(255,255,255,.05);color:var(--c-text-3);padding:3px 9px;border-radius:99px;border:1px solid var(--c-border)">üìç ${u.city||'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span>
          <span class="ptag ${b.cls}">${b.icon} ${b.label}</span>
        </div>
      </div>
      <button class="btn btn-ghost btn-sm" style="flex-shrink:0;position:relative" onclick="editProfileModal(${JSON.stringify(u).replace(/"/g,"'")})">
        ${svg(I.edit)} ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÑŸÅ
      </button>
    </div>
    <div class="two-col anim">
      <div class="card">
        <div class="card-header"><div class="card-header-left"><div class="card-icon" style="background:rgba(139,92,246,.1)">${svg(I.user,'var(--c-violet)')}</div><div class="card-title">ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©</div></div></div>
        <div class="card-body">
          <div class="info-block">
            <div class="info-row"><span class="info-key">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ</span><span class="info-val">${u.name||'‚Äî'}</span></div>
            <div class="info-row"><span class="info-key">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</span><span class="info-val">${u.email||'‚Äî'}</span></div>
            <div class="info-row"><span class="info-key">ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ</span><span class="info-val">${u.phone||'‚Äî'}</span></div>
            <div class="info-row"><span class="info-key">ÿßŸÑŸÖÿØŸäŸÜÿ©</span><span class="info-val">${u.city||'‚Äî'}</span></div>
            <div class="info-row"><span class="info-key">ÿßŸÑŸàÿ≥ÿßŸÖ</span><span class="info-val"><span class="ptag ${b.cls}">${b.icon} ${b.label}</span></span></div>
          </div>
          ${u.bio?`<div style="background:rgba(255,255,255,.02);border-radius:var(--r);padding:14px;border:1px solid var(--c-border)"><div style="font-size:9px;font-weight:700;color:var(--c-text-3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">ŸÜÿ®ÿ∞ÿ© ÿπŸÜŸä</div><div style="font-size:12px;line-height:1.8;color:var(--c-text-2)">${u.bio}</div></div>`:''}
        </div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-header-left"><div class="card-icon" style="background:var(--c-gold-dim)">${svg(I.star,'var(--c-gold)')}</div><div class="card-title">ÿßŸÑÿ™ÿÆÿµÿµÿßÿ™</div></div></div>
        <div class="card-body">
          ${(u.specialties||[]).length ?
            `<div style="display:flex;gap:6px;flex-wrap:wrap">${(u.specialties||[]).map(s=>`<span style="background:rgba(139,92,246,.1);color:var(--c-violet);padding:5px 12px;border-radius:99px;font-size:11px;font-weight:600;border:1px solid rgba(139,92,246,.2)">${s}</span>`).join('')}</div>` :
            `<div class="empty-state" style="padding:28px"><div class="empty-title">ŸÑŸÖ ÿ™ÿ≠ÿØÿØ ÿ™ÿÆÿµÿµÿßÿ™ŸÉ ÿ®ÿπÿØ</div><div class="empty-desc" style="margin-bottom:12px">ÿ£ÿ∂ŸÅ ÿ™ÿÆÿµÿµÿßÿ™ŸÉ ŸÑÿ™ÿ∏Ÿáÿ± ŸÅŸä ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´</div><button class="btn btn-gold btn-sm" onclick="editProfileModal(${JSON.stringify(u).replace(/"/g,"'")})">ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿÆÿµÿµÿßÿ™</button></div>`}
        </div>
      </div>
    </div>
  `);
}

function editProfileModal(u) {
  if (typeof u === 'string') { try { u = JSON.parse(u.replace(/'/g,'"')); } catch { u = me; } }
  uploadedImgs['editProf'] = [];
  openModal('ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä',
    `<div class="fsec">ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©</div>
     <div class="f2">
       <div class="fg"><label class="fl">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ</label><input type="text" class="fi" id="epName" value="${u.name||''}"></div>
       <div class="fg"><label class="fl">ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ</label><input type="text" class="fi" id="epPhone" value="${u.phone||''}" placeholder="05xxxxxxxx"></div>
     </div>
     <div class="fg"><label class="fl">ÿßŸÑŸÖÿØŸäŸÜÿ©</label><select class="fsel" id="epCity">${cityOpts(u.city)}</select></div>
     <div class="fsec">ÿßŸÑÿ™ÿÆÿµÿµÿßÿ™</div>${specsHtml(u.specialties||[])}
     <div class="fsec">ŸÜÿ®ÿ∞ÿ© ÿπŸÜŸä</div>
     <div class="fg"><textarea class="fta" id="epBio" style="min-height:90px" placeholder="ÿßŸÉÿ™ÿ® ŸÜÿ®ÿ∞ÿ© ŸÖÿÆÿ™ÿµÿ±ÿ© ÿπŸÜ ÿÆÿ®ÿ±ÿßÿ™ŸÉ‚Ä¶">${u.bio||''}</textarea></div>
     <div class="fsec">ÿµŸàÿ± ÿßŸÑÿ£ÿπŸÖÿßŸÑ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©</div>${imgUpHtml('editProf')}`,
    `<button class="btn btn-ghost" onclick="closeModal()">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-gold" onclick="saveProfile()">${svg(I.check)} ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--c-gold)">${I.edit}</svg>`, 'var(--c-gold-dim)'
  );
}

async function saveProfile() {
  const body = {
    name: document.getElementById('epName')?.value?.trim() || me.name,
    phone: document.getElementById('epPhone')?.value || '',
    city: document.getElementById('epCity')?.value || '',
    specialties: getSpecs(),
    bio: document.getElementById('epBio')?.value || ''
  };
  if (!body.name) { toast('ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ∑ŸÑŸàÿ®','error'); return; }
  const res = await api('/api/me',{method:'PUT',body:JSON.stringify(body)});
  if (res.message && !res.id) { toast(res.message,'error'); return; }
  Object.assign(me,body);
  localStorage.setItem('user',JSON.stringify(me));
  document.getElementById('sbName').textContent = me.name;
  document.getElementById('sbAvatar').textContent = me.name[0];
  if (me.city) document.getElementById('sbCity').textContent = 'üìç ' + me.city;
  closeModal();
  toast('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä ‚úÖ','success');
  pgProfile();
}

document.getElementById('overlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

api('/api/saved').then(r => {
  if (r && r.length) {
    savedIds = r.map(x=>x.id);
    savePersist();
    const nb = document.getElementById('nbSaved');
    if (nb && savedIds.length) { nb.style.display=''; nb.textContent=savedIds.length; }
  }
});

api('/api/notifications').then(r => {
  const unread = (r||[]).filter(n=>!n.read).length;
  if (unread) {
    const dot = document.getElementById('topNotifDot');
    const nb = document.getElementById('nbNotifs');
    if (dot) dot.style.display='';
    if (nb) { nb.style.display=''; nb.textContent=unread; }
  }
});

go('home', document.querySelector('.nav-btn.active'));
</script>
</body>
</html>
