<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€” Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;
  --gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;
  --gray-800:#1f2937;--gray-900:#111827;
  --violet-50:#f5f3ff;--violet-100:#ede9fe;--violet-200:#ddd6fe;--violet-300:#c4b5fd;
  --violet-500:#8b5cf6;--violet-600:#7c3aed;--violet-700:#6d28d9;
  --amber-50:#fffbeb;--amber-100:#fef3c7;--amber-200:#fde68a;
  --amber-400:#fbbf24;--amber-500:#f59e0b;--amber-600:#d97706;
  --emerald-50:#ecfdf5;--emerald-100:#d1fae5;--emerald-200:#a7f3d0;
  --emerald-500:#10b981;--emerald-600:#059669;--emerald-700:#047857;
  --red-50:#fef2f2;--red-100:#fee2e2;--red-500:#ef4444;--red-600:#dc2626;
  --blue-50:#eff6ff;--blue-100:#dbeafe;--blue-500:#3b82f6;--blue-600:#2563eb;
  --orange-50:#fff7ed;--orange-100:#ffedd5;--orange-500:#f97316;--orange-600:#ea580c;

  /* LIGHT THEME */
  --bg:#f1f5f9;
  --surface:#ffffff;
  --surface-2:#f8fafc;
  --border:#e2e8f0;
  --border-sub:#f1f5f9;
  --text-1:#0f172a;
  --text-2:#475569;
  --text-3:#94a3b8;

  --sb-bg:#ffffff;
  --sb-border:#e2e8f0;
  --sb-text:#475569;
  --sb-text-active:#7c3aed;
  --sb-active-bg:#f5f3ff;

  --sidebar:248px;--topbar:54px;
  --r-sm:6px;--r-md:8px;--r-lg:12px;--r-xl:16px;--r-2xl:20px;--r-full:9999px;
  --sh-sm:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --sh-md:0 4px 6px -1px rgba(0,0,0,.07),0 2px 4px -1px rgba(0,0,0,.04);
  --sh-lg:0 10px 15px -3px rgba(0,0,0,.07),0 4px 6px -2px rgba(0,0,0,.04);
  --sh-xl:0 20px 25px -5px rgba(0,0,0,.08),0 10px 10px -5px rgba(0,0,0,.03);
  --t-fast:100ms ease;--t-base:150ms ease;--t-slow:250ms ease;
}

*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;font-size:14px;line-height:1.5;color:var(--text-1);background:var(--bg);display:flex;min-height:100vh;-webkit-font-smoothing:antialiased}
button{font-family:inherit;cursor:pointer;border:none;background:none}
input,select,textarea{font-family:inherit;font-size:inherit}
a{text-decoration:none;color:inherit}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--gray-200);border-radius:var(--r-full)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR â€” LIGHT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar{
  width:var(--sidebar);
  background:var(--sb-bg);
  border-left:1px solid var(--sb-border);
  position:fixed;top:0;right:0;bottom:0;
  z-index:300;
  display:flex;flex-direction:column;
  transition:transform var(--t-slow);
  box-shadow:var(--sh-md);
}

.sb-logo{
  height:var(--topbar);
  display:flex;align-items:center;gap:10px;
  padding:0 18px;
  border-bottom:1px solid var(--sb-border);
  flex-shrink:0;
}
.logo-mark{
  width:32px;height:32px;border-radius:var(--r-md);
  background:linear-gradient(135deg,var(--violet-600),var(--violet-500));
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  box-shadow:0 2px 8px rgba(124,58,237,.3);
}
.logo-mark svg{width:16px;height:16px;stroke:#fff;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.logo-text{font-size:16px;font-weight:900;color:var(--text-1);letter-spacing:-.4px}
.logo-text em{color:var(--violet-600);font-style:normal}

.sb-user{
  padding:14px 18px;
  border-bottom:1px solid var(--sb-border);
  flex-shrink:0;
}
.user-row{display:flex;align-items:center;gap:10px}
.user-av{
  width:36px;height:36px;border-radius:var(--r-md);
  background:linear-gradient(135deg,var(--violet-600),var(--violet-500));
  display:flex;align-items:center;justify-content:center;
  font-size:14px;font-weight:800;color:#fff;flex-shrink:0;
}
.user-nm{font-size:13px;font-weight:700;color:var(--text-1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.user-role{font-size:10px;color:var(--text-3);margin-top:1px;font-weight:600}
.avail-pill{
  display:inline-flex;align-items:center;gap:5px;
  margin-top:8px;
  background:var(--emerald-50);border:1px solid var(--emerald-200);
  border-radius:var(--r-full);padding:3px 10px;
}
.avail-dot{width:6px;height:6px;border-radius:50%;background:var(--emerald-500);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.avail-text{font-size:10px;font-weight:700;color:var(--emerald-700)}

.sb-stats{
  display:grid;grid-template-columns:repeat(3,1fr);
  gap:1px;background:var(--sb-border);
  border-top:1px solid var(--sb-border);
  border-bottom:1px solid var(--sb-border);
  flex-shrink:0;
}
.sb-stat{padding:10px 6px;text-align:center;background:var(--surface)}
.sb-sv{font-size:15px;font-weight:900;color:var(--text-1);letter-spacing:-.3px}
.sb-sl{font-size:9px;color:var(--text-3);margin-top:1px;font-weight:600}

.sb-nav{flex:1;overflow-y:auto;padding:10px 10px;scrollbar-width:none}
.sb-nav::-webkit-scrollbar{display:none}
.sb-grp{font-size:9px;font-weight:700;color:var(--text-3);letter-spacing:.8px;text-transform:uppercase;padding:10px 8px 4px}
.ni{
  display:flex;align-items:center;gap:9px;
  padding:8px 10px;border-radius:var(--r-md);
  color:var(--sb-text);font-size:12px;font-weight:600;
  cursor:pointer;transition:all var(--t-fast);
  margin-bottom:1px;position:relative;
  width:100%;text-align:right;
}
.ni:hover{background:var(--gray-50);color:var(--text-1)}
.ni.on{background:var(--sb-active-bg);color:var(--sb-text-active);font-weight:700}
.ni.on::after{
  content:'';position:absolute;right:0;top:20%;bottom:20%;
  width:3px;border-radius:var(--r-full);
  background:var(--violet-600);
}
.ni-ic{width:28px;height:28px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ni-ic svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:1.7;stroke-linecap:round;stroke-linejoin:round}
.ni-lbl{flex:1}
.nbadge{font-size:9px;font-weight:800;padding:1px 6px;border-radius:var(--r-full);min-width:18px;text-align:center;flex-shrink:0}
.nb-v{background:var(--violet-100);color:var(--violet-700)}
.nb-r{background:var(--red-100);color:var(--red-600)}
.nb-a{background:var(--amber-100);color:var(--amber-700)}
.nb-e{background:var(--emerald-100);color:var(--emerald-700)}

.sb-bot{padding:10px;border-top:1px solid var(--sb-border);flex-shrink:0}
.sb-ver{text-align:center;font-size:9px;color:var(--text-3);padding:6px 0 0;font-weight:600}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{margin-right:var(--sidebar);flex:1;display:flex;flex-direction:column;min-height:100vh;max-width:calc(100vw - var(--sidebar))}

.topbar{
  height:var(--topbar);
  background:var(--surface);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 22px;
  position:sticky;top:0;z-index:100;flex-shrink:0;
  box-shadow:0 1px 3px rgba(0,0,0,.04);
}
.bc{display:flex;align-items:center;gap:7px;font-size:12px}
.bc-r{color:var(--text-3);font-weight:600}
.bc-sep{color:var(--gray-300)}
.bc-c{color:var(--text-1);font-weight:800}
.tb-r{display:flex;align-items:center;gap:7px}
.tb-clk{
  font-size:11px;font-weight:700;color:var(--text-2);
  background:var(--gray-50);border:1px solid var(--border);
  padding:5px 12px;border-radius:var(--r-md);
  font-variant-numeric:tabular-nums;letter-spacing:.3px;
}
.ib{
  width:32px;height:32px;border-radius:var(--r-md);
  border:1px solid var(--border);background:var(--surface);
  display:flex;align-items:center;justify-content:center;
  color:var(--text-2);cursor:pointer;transition:all var(--t-fast);position:relative;
}
.ib:hover{background:var(--gray-50);color:var(--text-1);border-color:var(--gray-300)}
.ib svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:1.7;stroke-linecap:round;stroke-linejoin:round}
.ndot{position:absolute;top:4px;left:4px;width:6px;height:6px;border-radius:50%;background:var(--red-500);border:1.5px solid var(--surface)}

.pg{padding:22px;flex:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pghd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:22px;gap:12px;flex-wrap:wrap}
.pgt{font-size:20px;font-weight:900;letter-spacing:-.4px;line-height:1.2;color:var(--text-1)}
.pgs{font-size:12px;color:var(--text-3);margin-top:3px;font-weight:600}
.pga{display:flex;gap:8px;align-items:center;flex-shrink:0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sg{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;margin-bottom:22px}
.sc{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--r-xl);padding:18px;
  transition:box-shadow var(--t-base),transform var(--t-base);
  position:relative;overflow:hidden;
}
.sc:hover{box-shadow:var(--sh-md);transform:translateY(-1px)}
.sc::before{content:'';position:absolute;top:0;right:0;width:3px;height:100%;border-radius:0 var(--r-xl) var(--r-xl) 0}
.sc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.sc-ic{width:38px;height:38px;border-radius:var(--r-lg);display:flex;align-items:center;justify-content:center}
.sc-ic svg{width:17px;height:17px;stroke-width:1.7;stroke-linecap:round;stroke-linejoin:round}
.sc-badge{font-size:9px;font-weight:800;padding:2px 8px;border-radius:var(--r-full)}
.sc-val{font-size:26px;font-weight:900;letter-spacing:-.5px;line-height:1;margin-bottom:4px}
.sc-lbl{font-size:11px;color:var(--text-3);font-weight:600}
.sc-bar{height:3px;background:var(--gray-100);border-radius:var(--r-full);margin-top:14px;overflow:hidden}
.sc-fill{height:100%;border-radius:var(--r-full);transition:width 1.4s cubic-bezier(.4,0,.2,1)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);overflow:hidden;margin-bottom:16px;box-shadow:var(--sh-sm)}
.ch{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;background:var(--surface)}
.ch-l{display:flex;align-items:center;gap:10px}
.ch-ic{width:32px;height:32px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ch-ic svg{width:14px;height:14px;stroke-width:1.7;stroke-linecap:round;stroke-linejoin:round}
.ch-t{font-size:13px;font-weight:800;color:var(--text-1)}
.ch-s{font-size:10px;color:var(--text-3);margin-top:1px;font-weight:600}
.ch-r{display:flex;gap:7px;align-items:center}
.cb{padding:18px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:8px 16px;border-radius:var(--r-md);font-size:12px;font-weight:700;line-height:1;cursor:pointer;border:none;transition:all var(--t-fast);white-space:nowrap;user-select:none}
.btn:active{transform:scale(.97)}
.btn svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round;flex-shrink:0}
.btn-p{background:var(--violet-600);color:#fff;box-shadow:0 2px 6px rgba(124,58,237,.25)}.btn-p:hover{background:var(--violet-700)}
.btn-g{background:var(--emerald-600);color:#fff;box-shadow:0 2px 6px rgba(5,150,105,.2)}.btn-g:hover{background:var(--emerald-700)}
.btn-r{background:var(--red-500);color:#fff;box-shadow:0 2px 6px rgba(239,68,68,.2)}.btn-r:hover{background:var(--red-600)}
.btn-a{background:var(--amber-500);color:#fff;box-shadow:0 2px 6px rgba(245,158,11,.2)}.btn-a:hover{background:var(--amber-600)}
.btn-b{background:var(--blue-500);color:#fff;box-shadow:0 2px 6px rgba(59,130,246,.2)}.btn-b:hover{background:var(--blue-600)}
.btn-o{background:var(--orange-500);color:#fff}.btn-o:hover{background:var(--orange-600)}
.btn-gh{background:var(--surface);color:var(--text-1);border:1px solid var(--border)}.btn-gh:hover{background:var(--gray-50);border-color:var(--gray-300)}
.btn-sub{background:var(--gray-100);color:var(--text-2)}.btn-sub:hover{background:var(--gray-200);color:var(--text-1)}
.btn-vio{background:var(--violet-50);color:var(--violet-700);border:1px solid var(--violet-200)}.btn-vio:hover{background:var(--violet-100)}
.btn-sm{padding:5px 11px;font-size:11px;border-radius:var(--r-sm);gap:4px}
.btn-sm svg{width:11px;height:11px}
.btn-xs{padding:3px 8px;font-size:10px;border-radius:5px;gap:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bdg{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:var(--r-full);font-size:10px;font-weight:700;white-space:nowrap;border:1px solid transparent}
.bdg::before{content:'';width:5px;height:5px;border-radius:50%;flex-shrink:0}
.bdg-pend{background:var(--amber-50);color:#92400e;border-color:var(--amber-200)}.bdg-pend::before{background:var(--amber-500)}
.bdg-open{background:var(--emerald-50);color:var(--emerald-700);border-color:var(--emerald-200)}.bdg-open::before{background:var(--emerald-500)}
.bdg-prog{background:var(--blue-50);color:var(--blue-700);border-color:var(--blue-100)}.bdg-prog::before{background:var(--blue-500)}
.bdg-done{background:var(--violet-50);color:var(--violet-700);border-color:var(--violet-200)}.bdg-done::before{background:var(--violet-600)}
.bdg-rej{background:var(--red-50);color:var(--red-700);border-color:var(--red-100)}.bdg-rej::before{background:var(--red-500)}
.bdg-active{background:var(--emerald-50);color:var(--emerald-700);border-color:var(--emerald-200)}.bdg-active::before{background:var(--emerald-500)}
.bdg-inactive{background:var(--gray-100);color:var(--gray-600);border-color:var(--gray-200)}.bdg-inactive::before{background:var(--gray-400)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:center}
.sbox{flex:1;min-width:200px;display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-md);padding:0 12px;transition:all var(--t-fast)}
.sbox:focus-within{border-color:var(--violet-400);box-shadow:0 0 0 3px rgba(124,58,237,.08)}
.sbox svg{width:14px;height:14px;stroke:var(--text-3);fill:none;stroke-width:1.7;flex-shrink:0;stroke-linecap:round;stroke-linejoin:round}
.sbox input{border:none;outline:none;background:transparent;font-size:12px;padding:8px 0;flex:1;color:var(--text-1)}
.sbox input::placeholder{color:var(--text-3)}
.fsel{padding:8px 11px;border:1px solid var(--border);border-radius:var(--r-md);font-size:12px;font-weight:600;background:var(--surface);color:var(--text-1);outline:none;cursor:pointer;transition:border-color var(--t-fast)}
.fsel:focus{border-color:var(--violet-400)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROJECT CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pc{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:18px;margin-bottom:12px;transition:box-shadow var(--t-base);border-right:3px solid transparent}
.pc:hover{box-shadow:var(--sh-md)}
.pc-pend{border-right-color:var(--amber-400)}
.pc-open{border-right-color:var(--emerald-500)}
.pc-prog{border-right-color:var(--blue-500)}
.pc-done{border-right-color:var(--violet-600)}
.pc-rej{border-right-color:var(--red-500)}
.pc-num{font-size:9px;font-weight:800;color:var(--text-3);letter-spacing:.5px;font-variant-numeric:tabular-nums;margin-bottom:4px}
.pc-title{font-size:14px;font-weight:800;line-height:1.35;letter-spacing:-.2px;color:var(--text-1)}
.pc-meta{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0}
.chip{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:var(--r-full);background:var(--gray-50);border:1px solid var(--border);font-size:10px;font-weight:600;color:var(--text-2)}
.chip svg{width:10px;height:10px;stroke:currentColor;fill:none;stroke-width:2;flex-shrink:0;stroke-linecap:round;stroke-linejoin:round}
.pc-desc{font-size:12px;color:var(--text-2);line-height:1.7;padding:10px 14px;background:var(--surface-2);border-radius:var(--r-md);border-right:2px solid var(--violet-200);margin-bottom:12px}
.pc-acts{display:flex;gap:6px;flex-wrap:wrap}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tbl-wrap{overflow-x:auto}
.tbl{width:100%;border-collapse:collapse;min-width:600px}
.tbl th{text-align:right;padding:10px 16px;font-size:10px;font-weight:700;color:var(--text-3);background:var(--surface-2);border-bottom:1px solid var(--border);white-space:nowrap;text-transform:uppercase;letter-spacing:.4px}
.tbl td{padding:12px 16px;border-bottom:1px solid var(--border-sub);vertical-align:middle}
.tbl tr:last-child td{border-bottom:none}
.tbl tbody tr{transition:background var(--t-fast)}
.tbl tbody tr:hover td{background:var(--gray-50)}
.tbl-av{width:30px;height:30px;border-radius:var(--r-md);color:#fff;font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{display:none;position:fixed;inset:0;z-index:500;background:rgba(15,23,42,.35);backdrop-filter:blur(8px);align-items:center;justify-content:center;padding:16px}
.overlay.vis{display:flex}
.modal{background:var(--surface);border-radius:var(--r-2xl);width:100%;max-width:680px;max-height:90vh;overflow-y:auto;box-shadow:var(--sh-xl);animation:mIn .22s cubic-bezier(.34,1.56,.64,1)}
@keyframes mIn{from{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal::-webkit-scrollbar{width:4px}
.mh{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--surface);z-index:2;border-radius:var(--r-2xl) var(--r-2xl) 0 0}
.mh-l{display:flex;align-items:center;gap:11px}
.m-ico{width:32px;height:32px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center}
.m-ico svg{width:15px;height:15px;stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round}
.m-title{font-size:14px;font-weight:800;letter-spacing:-.2px}
.m-close{width:28px;height:28px;border-radius:var(--r-md);background:var(--gray-100);display:flex;align-items:center;justify-content:center;color:var(--text-2);font-size:18px;line-height:1;cursor:pointer;transition:all var(--t-fast)}
.m-close:hover{background:var(--red-100);color:var(--red-600)}
.mb{padding:20px}
.mf{display:flex;gap:8px;justify-content:flex-end;padding:14px 20px;border-top:1px solid var(--border);background:var(--surface-2);border-radius:0 0 var(--r-2xl) var(--r-2xl)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fg{display:flex;flex-direction:column;gap:5px;margin-bottom:14px}
.fl{font-size:11px;font-weight:700;color:var(--text-1)}
.fh{color:var(--text-3);font-weight:500;margin-right:4px}
.fi{padding:9px 12px;border:1px solid var(--border);border-radius:var(--r-md);font-size:13px;outline:none;background:var(--surface);color:var(--text-1);transition:all var(--t-fast);width:100%}
.fi:focus{border-color:var(--violet-500);box-shadow:0 0 0 3px rgba(124,58,237,.08)}
.fi::placeholder{color:var(--text-3)}
.fsel-f{padding:9px 12px;border:1px solid var(--border);border-radius:var(--r-md);font-size:13px;outline:none;background:var(--surface);cursor:pointer;width:100%;color:var(--text-1)}
.fsel-f:focus{border-color:var(--violet-500)}
.fta{padding:9px 12px;border:1px solid var(--border);border-radius:var(--r-md);font-size:13px;outline:none;resize:vertical;min-height:86px;width:100%;color:var(--text-1);line-height:1.6;transition:all var(--t-fast)}
.fta:focus{border-color:var(--violet-500);box-shadow:0 0 0 3px rgba(124,58,237,.08)}
.f2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.f3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.fsec{font-size:10px;font-weight:800;color:var(--violet-600);padding:12px 0 7px;border-bottom:1px solid var(--violet-100);margin:4px 0 14px;letter-spacing:.6px;text-transform:uppercase}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPECS CHECKBOXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.specs-wrap{border:1px solid var(--border);border-radius:var(--r-md);overflow:hidden}
.specs-hd{padding:9px 13px;background:var(--surface-2);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.specs-hd-lbl{font-size:11px;font-weight:700}
.specs-cnt{font-size:10px;font-weight:700;color:var(--violet-600);background:var(--violet-50);padding:2px 8px;border-radius:var(--r-full);border:1px solid var(--violet-100)}
.specs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;padding:8px;max-height:190px;overflow-y:auto}
.spec-item{display:flex;align-items:center;gap:7px;padding:7px 9px;border:1px solid var(--border);border-radius:var(--r-sm);cursor:pointer;transition:all var(--t-fast);background:var(--surface)}
.spec-item:hover{border-color:var(--gray-300);background:var(--gray-50)}
.spec-item.on{border-color:var(--violet-400);background:var(--violet-50)}
.spec-item input{width:13px;height:13px;accent-color:var(--violet-600);cursor:pointer;flex-shrink:0}
.spec-item label{font-size:11px;font-weight:600;cursor:pointer;color:var(--text-2)}
.spec-item.on label{color:var(--violet-700);font-weight:700}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMG UPLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.img-up{border:1.5px dashed var(--gray-300);border-radius:var(--r-lg);padding:22px;text-align:center;cursor:pointer;transition:all var(--t-base);background:var(--surface-2);position:relative}
.img-up:hover{border-color:var(--violet-400);background:var(--violet-50)}
.img-up input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-up-ico{width:42px;height:42px;border-radius:var(--r-md);background:var(--violet-100);display:flex;align-items:center;justify-content:center;margin:0 auto 10px}
.img-up-ico svg{width:18px;height:18px;stroke:var(--violet-600);fill:none;stroke-width:1.7;stroke-linecap:round;stroke-linejoin:round}
.img-up-t{font-size:12px;font-weight:700;margin-bottom:3px}
.img-up-s{font-size:10px;color:var(--text-3)}
.imgs-pv{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.img-pv{position:relative;width:74px;height:74px;border-radius:var(--r-md);overflow:hidden;border:1px solid var(--border)}
.img-pv img{width:100%;height:100%;object-fit:cover}
.img-pv-del{position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:var(--red-500);color:#fff;border:none;cursor:pointer;font-size:11px;display:flex;align-items:center;justify-content:center;font-weight:800}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALERTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.alert{display:flex;align-items:flex-start;gap:10px;padding:11px 14px;border-radius:var(--r-md);margin-bottom:14px;font-size:12px;line-height:1.5;font-weight:600}
.alert svg{width:14px;height:14px;flex-shrink:0;margin-top:1px;fill:none;stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round}
.al-info{background:var(--blue-50);border:1px solid var(--blue-100);color:#1e40af}.al-info svg{stroke:var(--blue-500)}
.al-warn{background:var(--amber-50);border:1px solid var(--amber-200);color:#92400e}.al-warn svg{stroke:var(--amber-500)}
.al-ok{background:var(--emerald-50);border:1px solid var(--emerald-200);color:var(--emerald-700)}.al-ok svg{stroke:var(--emerald-500)}
.al-err{background:var(--red-50);border:1px solid var(--red-100);color:var(--red-700)}.al-err svg{stroke:var(--red-500)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO BLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ib-block{background:var(--surface-2);border-radius:var(--r-md);padding:13px;margin-bottom:12px;border:1px solid var(--border-sub)}
.ib-t{font-size:9px;font-weight:800;color:var(--text-3);text-transform:uppercase;letter-spacing:.8px;margin-bottom:9px}
.ir{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--border-sub)}
.ir:last-child{border-bottom:none}
.ik{font-size:11px;color:var(--text-3);font-weight:600}
.iv{font-size:11px;font-weight:700;color:var(--text-1)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVIEW CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rev-card{border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;margin-bottom:10px;background:var(--surface);transition:all var(--t-fast)}
.rev-card:hover{box-shadow:var(--sh-sm)}
.rev-card.reported{border-color:var(--red-300);background:var(--red-50)}
.rev-header{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:12px}
.rev-av{width:32px;height:32px;border-radius:var(--r-md);color:#fff;font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.rev-nm{font-size:12px;font-weight:700}
.rev-sub{font-size:10px;color:var(--text-3);margin-top:1px;font-weight:600}
.stars-html{font-size:14px;letter-spacing:1px}
.rev-text{font-size:12px;color:var(--text-2);background:var(--surface-2);padding:10px 13px;border-radius:var(--r-md);line-height:1.7;border-right:2px solid var(--violet-200);margin-bottom:10px}
.admin-reply{background:var(--violet-50);border:1px solid var(--violet-100);border-radius:var(--r-md);padding:10px 13px;margin-bottom:10px}
.reply-lbl{font-size:9px;font-weight:800;color:var(--violet-600);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.reply-text{font-size:11px;color:var(--violet-800);line-height:1.6}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISPUTE CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.disp-card{border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;margin-bottom:10px;background:var(--surface);border-right:3px solid var(--red-400)}
.disp-card.resolved{border-right-color:var(--emerald-500)}
.disp-title{font-size:13px;font-weight:800;margin-bottom:5px}
.disp-meta{font-size:10px;color:var(--text-3);font-weight:600;margin-bottom:10px}
.disp-desc{font-size:12px;color:var(--text-2);line-height:1.7;background:var(--surface-2);padding:10px 13px;border-radius:var(--r-md);margin-bottom:12px}
.disp-parties{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;background:var(--surface-2);border-radius:var(--r-md);padding:12px;margin-bottom:12px}
.party-nm{font-size:11px;font-weight:700}
.party-role{font-size:9px;color:var(--text-3);font-weight:600;margin-top:2px}
.disp-res{background:var(--emerald-50);border:1px solid var(--emerald-200);border-radius:var(--r-md);padding:10px 13px;margin-bottom:10px;font-size:12px;color:var(--emerald-700)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.setting-row{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border-sub)}
.setting-row:last-child{border-bottom:none}
.setting-info{flex:1}
.setting-title{font-size:12px;font-weight:700;color:var(--text-1);margin-bottom:2px}
.setting-desc{font-size:10px;color:var(--text-3);font-weight:600}
.toggle-sw{position:relative;flex-shrink:0;cursor:pointer}
.toggle-sw input{opacity:0;width:0;height:0;position:absolute}
.toggle-track{width:38px;height:20px;border-radius:var(--r-full);background:var(--gray-200);transition:background var(--t-base);position:relative}
.toggle-sw input:checked + .toggle-track{background:var(--emerald-500)}
.toggle-thumb{position:absolute;top:2px;right:2px;width:16px;height:16px;border-radius:50%;background:#fff;transition:right var(--t-base);box-shadow:0 1px 3px rgba(0,0,0,.2)}
.toggle-sw input:checked + .toggle-track .toggle-thumb{right:20px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.prog-lbl{font-size:11px;font-weight:600;color:var(--text-2);min-width:100px;text-align:right}
.prog-bar{flex:1;height:6px;background:var(--gray-100);border-radius:var(--r-full);overflow:hidden}
.prog-fill{height:100%;border-radius:var(--r-full);transition:width 1.4s cubic-bezier(.4,0,.2,1)}
.prog-val{font-size:11px;font-weight:700;color:var(--text-2);min-width:30px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.log-item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border-sub)}
.log-item:last-child{border-bottom:none}
.log-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.log-body{flex:1}
.log-action{font-size:12px;font-weight:700;color:var(--text-1)}
.log-detail{font-size:10px;color:var(--text-3);font-weight:600;margin-top:1px}
.log-time{font-size:10px;color:var(--text-3);font-weight:600;flex-shrink:0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(16px);background:var(--gray-900);color:#fff;padding:11px 20px;border-radius:var(--r-lg);font-size:12px;font-weight:700;z-index:9999;opacity:0;transition:all .22s cubic-bezier(.34,1.56,.64,1);pointer-events:none;display:flex;align-items:center;gap:9px;box-shadow:var(--sh-xl);white-space:nowrap}
.toast.vis{opacity:1;transform:translateX(-50%) translateY(0)}
.t-ico{width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:900;flex-shrink:0}
.t-ok{background:var(--emerald-600)}.t-err{background:var(--red-600)}.t-inf{background:var(--gray-700)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING / EMPTY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ls{display:flex;flex-direction:column;align-items:center;padding:52px 20px;color:var(--text-3)}
.spin{width:28px;height:28px;border:2px solid var(--violet-100);border-top-color:var(--violet-600);border-radius:50%;animation:sp .7s linear infinite;margin-bottom:12px}
@keyframes sp{to{transform:rotate(360deg)}}
.ls-t{font-size:12px;font-weight:600}
.es{display:flex;flex-direction:column;align-items:center;padding:52px 20px;text-align:center}
.es-ic{width:52px;height:52px;border-radius:var(--r-xl);background:var(--gray-50);border:2px dashed var(--gray-200);display:flex;align-items:center;justify-content:center;margin-bottom:14px}
.es-ic svg{width:22px;height:22px;stroke:var(--gray-300);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round}
.es-t{font-size:14px;font-weight:800;margin-bottom:5px}
.es-s{font-size:12px;color:var(--text-3);font-weight:600}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.two-col{display:grid;grid-template-columns:1.4fr 1fr;gap:16px}
.three-col{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.divider{height:1px;background:var(--border-sub);margin:14px 0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFY TARGET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notif-targets{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.notif-tgt{padding:7px 16px;border-radius:var(--r-full);border:1.5px solid var(--border);font-size:12px;font-weight:700;color:var(--text-2);cursor:pointer;transition:all var(--t-fast);background:var(--surface)}
.notif-tgt:hover{border-color:var(--gray-300);color:var(--text-1)}
.notif-tgt.on{border-color:var(--violet-500);background:var(--violet-50);color:var(--violet-700)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mob-btn{display:none;position:fixed;top:10px;left:10px;z-index:400;width:36px;height:36px;border-radius:var(--r-md);background:var(--violet-600);border:none;cursor:pointer;align-items:center;justify-content:center;box-shadow:var(--sh-md)}
.mob-btn svg{width:16px;height:16px;stroke:#fff;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.mob-ov{display:none;position:fixed;inset:0;background:rgba(15,23,42,.4);z-index:200}
@media(max-width:960px){
  .sidebar{transform:translateX(110%)}.sidebar.open{transform:translateX(0)}
  .main{margin-right:0}.mob-btn{display:flex}.mob-ov.show{display:block}
  .sg{grid-template-columns:repeat(2,1fr)}.two-col{grid-template-columns:1fr}.three-col{grid-template-columns:1fr}
  .pg{padding:14px}.topbar{padding:0 14px}
  .f2{grid-template-columns:1fr}.f3{grid-template-columns:1fr}
  .specs-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<button class="mob-btn" onclick="openSb()">
  <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<div class="mob-ov" id="mobOv" onclick="closeSb()"></div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sb-logo">
    <div class="logo-mark"><svg viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
    <span class="logo-text">Ù…Ù†Ø§Ù‚ØµØ©<em>.</em></span>
  </div>

  <div class="sb-user">
    <div class="user-row">
      <div class="user-av" id="sbAv">Ù…</div>
      <div style="flex:1;min-width:0">
        <div class="user-nm" id="sbNm">Ø§Ù„Ù…Ø¯ÙŠØ±</div>
        <div class="user-role">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      </div>
    </div>
    <div class="avail-pill">
      <div class="avail-dot"></div>
      <span class="avail-text">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span>
    </div>
  </div>

  <div class="sb-stats">
    <div class="sb-stat"><div class="sb-sv" id="sbUsers">â€”</div><div class="sb-sl">Ù…Ø³ØªØ®Ø¯Ù…</div></div>
    <div class="sb-stat"><div class="sb-sv" id="sbProjects">â€”</div><div class="sb-sl">Ù…Ø´Ø±ÙˆØ¹</div></div>
    <div class="sb-stat"><div class="sb-sv" id="sbPending">â€”</div><div class="sb-sl">Ø§Ù†ØªØ¸Ø§Ø±</div></div>
  </div>

  <nav class="sb-nav">
    <div class="sb-grp">Ø¹Ø§Ù…</div>
    <button class="ni on" onclick="go('home',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </button>

    <div class="sb-grp">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
    <button class="ni" onclick="go('pending',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
      <span class="ni-lbl">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
      <span class="nbadge nb-a" id="nbPend">0</span>
    </button>
    <button class="ni" onclick="go('projects',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
      <span class="ni-lbl">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
    </button>

    <div class="sb-grp">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
    <button class="ni" onclick="go('providers',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg></div>
      <span class="ni-lbl">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
    </button>
    <button class="ni" onclick="go('clients',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
    </button>

    <div class="sb-grp">Ø§Ù„ØªÙØ§Ø¹Ù„</div>
    <button class="ni" onclick="go('reviews',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>
      <span class="ni-lbl">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
      <span class="nbadge nb-r" id="nbRev" style="display:none">0</span>
    </button>
    <button class="ni" onclick="go('disputes',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</span>
      <span class="nbadge nb-r" id="nbDisp" style="display:none">0</span>
    </button>
    <button class="ni" onclick="go('notifs',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>
      <span class="ni-lbl">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
    </button>

    <div class="sb-grp">Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
    <button class="ni" onclick="go('reports',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div>
      <span class="ni-lbl">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
    </button>
    <button class="ni" onclick="go('log',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
      <span class="ni-lbl">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</span>
    </button>

    <div class="sb-grp">Ø§Ù„Ù†Ø¸Ø§Ù…</div>
    <button class="ni" onclick="go('settings',this)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg></div>
      <span class="ni-lbl">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
    </button>
  </nav>

  <div class="sb-bot">
    <button class="ni" onclick="logout()" style="width:100%;color:var(--red-600)">
      <div class="ni-ic"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
      <span class="ni-lbl">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
    </button>
    <div class="sb-ver">Manaqasa Admin v3.0</div>
  </div>
</aside>

<!-- MAIN -->
<div class="main">
  <header class="topbar">
    <div class="bc">
      <span class="bc-r">Ù…Ù†Ø§Ù‚ØµØ©</span>
      <span class="bc-sep">/</span>
      <span class="bc-c" id="pgTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="tb-r">
      <div class="tb-clk" id="clk">--:--:--</div>
      <div class="ib" onclick="go('notifs',null)" title="Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
        <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <div class="ndot" id="topDot" style="display:none"></div>
      </div>
    </div>
  </header>

  <main class="pg" id="pg">
    <div class="ls"><div class="spin"></div><div class="ls-t">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div></div>
  </main>
</div>

<!-- MODAL -->
<div class="overlay" id="ov">
  <div class="modal">
    <div class="mh">
      <div class="mh-l">
        <div class="m-ico" id="mIco"></div>
        <span class="m-title" id="mTitle">â€”</span>
      </div>
      <button class="m-close" onclick="closeM()">Ã—</button>
    </div>
    <div class="mb" id="mBody"></div>
    <div class="mf" id="mFoot"></div>
  </div>
</div>

<div class="toast" id="toast">
  <div class="t-ico" id="tIco"></div>
  <span id="tMsg"></span>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const API = 'https://manaqasati-production.up.railway.app';
const token = localStorage.getItem('token');
const me = JSON.parse(localStorage.getItem('user') || '{}');
if (!token || me.role !== 'admin') location.href = 'auth.html';

let allRequests=[], allUsers=[], allReviews=[], allDisputes=[];
let uploadedImgs={};
let activityLog=[];

const CATS=['ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ','ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ø³Ø¨Ø§ÙƒØ©','Ù†Ø¬Ø§Ø±Ø©','ØªÙ†Ø¸ÙŠÙ','Ù†Ù‚Ù„ Ø¹ÙØ´','Ø­Ø¯Ø§Ø¯Ø©','Ø£Ù„Ù…Ù†ÙŠÙˆÙ…','Ù…Ø³Ø§Ø¨Ø­','ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø©','Ø´Ø¨ÙƒØ§Øª ÙˆØ¥Ù†ØªØ±Ù†Øª','Ù…Ø¸Ù„Ø§Øª ÙˆØ³ÙˆØ§ØªØ±','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ','Ø£Ø¨ÙˆØ§Ø¨','Ø¬Ø¨Ø³ ÙˆØ·Ø¨Ø§Ø´ÙŠØ±','Ù…ÙƒØ§ÙØ­Ø© Ø­Ø´Ø±Ø§Øª','Ø£Ø®Ø±Ù‰'];
const CITIES=['Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©','Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©','Ø§Ù„Ø¯Ù…Ø§Ù…','Ø§Ù„Ø®Ø¨Ø±','Ø§Ù„Ø¸Ù‡Ø±Ø§Ù†','Ø§Ù„Ø£Ø­Ø³Ø§Ø¡','Ø§Ù„Ø·Ø§Ø¦Ù','ØªØ¨ÙˆÙƒ','Ø¨Ø±ÙŠØ¯Ø©','Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·','Ø£Ø¨Ù‡Ø§','Ù†Ø¬Ø±Ø§Ù†','Ø¬ÙŠØ²Ø§Ù†','Ø­Ø§Ø¦Ù„','ÙŠÙ†Ø¨Ø¹','Ø§Ù„Ø¬Ø¨ÙŠÙ„','Ø§Ù„Ù‚Ø·ÙŠÙ','Ø³ÙƒØ§ÙƒØ§','Ø¹Ø±Ø¹Ø±','Ø§Ù„Ø¨Ø§Ø­Ø©','Ø§Ù„Ø±Ø³','Ø±Ø§Ø¨Øº','Ø¨ÙŠØ´Ø©','ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±','Ø§Ù„Ø²Ù„ÙÙŠ','Ø§Ù„Ù‚Ø±ÙŠØ§Øª'];
const AVC=['#7c3aed','#2563eb','#059669','#d97706','#dc2626','#0891b2','#7e22ce','#b45309'];
const SL={pending_review:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',open:'Ù…ÙØªÙˆØ­',in_progress:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',completed:'Ù…ÙƒØªÙ…Ù„',rejected:'Ù…Ø±ÙÙˆØ¶'};
const SB={pending_review:'bdg-pend',open:'bdg-open',in_progress:'bdg-prog',completed:'bdg-done',rejected:'bdg-rej'};
const BDGMAP={none:{cls:'',label:'Ø¨Ø¯ÙˆÙ†',icon:'â€”'},verified:{cls:'color:#2563eb',label:'Ù…ÙˆØ«Ù‚',icon:'âœ“'},star:{cls:'color:#d97706',label:'Ù…ØªÙ…ÙŠØ²',icon:'â­'},partner:{cls:'color:#7c3aed',label:'Ø´Ø±ÙŠÙƒ',icon:'ğŸ’'},top:{cls:'color:#059669',label:'Ø§Ù„Ø£ÙØ¶Ù„',icon:'ğŸ†'}};

/* â”€â”€ INIT â”€â”€ */
document.getElementById('sbNm').textContent = me.name||'Ø§Ù„Ù…Ø¯ÙŠØ±';
document.getElementById('sbAv').textContent = (me.name||'Ù…')[0];
setInterval(()=>{ document.getElementById('clk').textContent = new Date().toLocaleTimeString('ar-SA',{hour12:false}); },1000);

/* â•â• UTILS â•â• */
async function api(path,opts={}){
  try{
    const r=await fetch(API+path,{headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'},...opts});
    return await r.json();
  }catch{return{};}
}

let toastT;
function toast(msg,type='info'){
  const el=document.getElementById('toast');
  el.className=`toast vis`;
  el.style.background=type==='success'?'#059669':type==='error'?'#dc2626':'#1f2937';
  document.getElementById('tIco').textContent=type==='success'?'âœ“':type==='error'?'âœ•':'i';
  document.getElementById('tMsg').textContent=msg;
  clearTimeout(toastT);
  toastT=setTimeout(()=>el.classList.remove('vis'),3400);
}

function openM(title,body,foot,iSvg,iBg='var(--violet-100)'){
  document.getElementById('mTitle').textContent=title;
  document.getElementById('mBody').innerHTML=body;
  document.getElementById('mFoot').innerHTML=foot||'';
  const ic=document.getElementById('mIco');
  ic.innerHTML=iSvg||''; ic.style.background=iBg;
  if(iSvg){const s=ic.querySelector('svg');if(s)s.style.cssText='width:15px;height:15px;stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round';}
  document.getElementById('ov').classList.add('vis');
}
function closeM(){document.getElementById('ov').classList.remove('vis');}
function setContent(html){document.getElementById('pg').innerHTML=html;}
function loading(){setContent(`<div class="ls"><div class="spin"></div><div class="ls-t">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div></div>`);}
function openSb(){document.getElementById('sidebar').classList.add('open');document.getElementById('mobOv').classList.add('show');}
function closeSb(){document.getElementById('sidebar').classList.remove('open');document.getElementById('mobOv').classList.remove('show');}
function logout(){localStorage.clear();location.href='auth.html';}
function addLog(action,detail,color='var(--violet-600)'){activityLog.unshift({action,detail,color,time:new Date().toLocaleTimeString('ar-SA',{hour12:false})});if(activityLog.length>200)activityLog.pop();}

function go(page,btn){
  document.querySelectorAll('.ni').forEach(i=>i.classList.remove('on'));
  if(btn)btn.classList.add('on');
  const T={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',pending:'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',projects:'ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',providers:'Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',clients:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',reviews:'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',disputes:'Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª',notifs:'Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',reports:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',log:'Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'};
  document.getElementById('pgTitle').textContent=T[page]||page;
  const P={home:pgHome,pending:pgPending,projects:pgProjects,providers:pgProviders,clients:pgClients,reviews:pgReviews,disputes:pgDisputes,notifs:pgNotifs,reports:pgReports,log:pgLog,settings:pgSettings};
  if(P[page])P[page]();
  closeSb();
}

function S(paths,color='currentColor'){
  return `<svg viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">${paths}</svg>`;
}
const I={
  proj:`<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/>`,
  send:`<line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>`,
  star:`<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>`,
  check:`<polyline points="20 6 9 17 4 12"/>`,
  x:`<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>`,
  eye:`<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>`,
  edit:`<path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>`,
  trash:`<polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/>`,
  map:`<path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>`,
  folder:`<path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>`,
  dollar:`<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>`,
  zap:`<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>`,
  bell:`<path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/>`,
  user:`<path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/>`,
  img:`<rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>`,
  cal:`<rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>`,
  alert:`<path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>`,
  info:`<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>`,
  plus:`<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>`,
  shield:`<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>`,
  phone:`<path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.8a19.79 19.79 0 01-3.07-8.63A2 2 0 012 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 14.92z"/>`,
  save:`<path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>`,
  bars:`<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>`,
};

function avColor(id){return AVC[(id||0)%AVC.length];}
function avLetter(name){return (name||'ØŸ')[0];}
function starsHtml(n){return[1,2,3,4,5].map(i=>`<span style="color:${i<=Math.round(n)?'#f59e0b':'#e5e7eb'}">â˜…</span>`).join('');}
function fdate(d){return d?new Date(d).toLocaleDateString('ar-SA'):'â€”';}
function fprice(p){return p?Number(p).toLocaleString('ar-SA')+' Ø±.Ø³':'â€”';}
function cityOpts(sel=''){return`<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>`+CITIES.map(c=>`<option value="${c}"${c===sel?' selected':''}>${c}</option>`).join('');}
function catOpts(sel=''){return`<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>`+CATS.map(c=>`<option value="${c}"${c===sel?' selected':''}>${c}</option>`).join('');}
function imgUpHtml(id){return`<div class="img-up"><input type="file" accept="image/*" multiple onchange="handleImgs(this,'${id}')"><div class="img-up-ico">${S(I.img,'var(--violet-600)')}</div><div class="img-up-t">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø±ÙØ¹</div><div class="img-up-s">PNG, JPG â€” Ø­ØªÙ‰ 5 ØµÙˆØ±</div></div><div class="imgs-pv" id="imgPv_${id}"></div>`;}
function handleImgs(input,id){if(!uploadedImgs[id])uploadedImgs[id]=[];[...input.files].forEach(f=>{if(uploadedImgs[id].length>=5)return;const r=new FileReader();r.onload=e=>{uploadedImgs[id].push(e.target.result);renderImgPv(id);};r.readAsDataURL(f);});}
function renderImgPv(id){const el=document.getElementById(`imgPv_${id}`);if(!el)return;el.innerHTML=(uploadedImgs[id]||[]).map((src,i)=>`<div class="img-pv"><img src="${src}"><button class="img-pv-del" onclick="delImg('${id}',${i})">Ã—</button></div>`).join('');}
function delImg(id,i){uploadedImgs[id].splice(i,1);renderImgPv(id);}
function specsHtml(sel=[]){return`<div class="specs-wrap"><div class="specs-hd"><span class="specs-hd-lbl">Ø§Ù„ØªØ®ØµØµØ§Øª</span><span class="specs-cnt" id="specCnt">${sel.length} Ù…Ø­Ø¯Ø¯</span></div><div class="specs-grid">${CATS.map((c,i)=>{const on=sel.includes(c);return`<div class="spec-item${on?' on':''}" onclick="togSpec(this)"><input type="checkbox" id="sp${i}" value="${c}"${on?' checked':''}  onchange="updSpec()"><label for="sp${i}">${c}</label></div>`;}).join('')}</div></div>`;}
function togSpec(el){el.classList.toggle('on');el.querySelector('input').checked=el.classList.contains('on');updSpec();}
function updSpec(){const c=document.querySelectorAll('.spec-item.on').length;const el=document.getElementById('specCnt');if(el)el.textContent=`${c} Ù…Ø­Ø¯Ø¯`;}
function getSpecs(){return[...document.querySelectorAll('.spec-item.on input')].map(i=>i.value);}

function sCard(lbl,val,ic,ibg,iclr,pct,bclr,accentClr){
  return`<div class="sc" style="--accent:${accentClr||bclr}">
    <style>.sc{--accent:#7c3aed}.sc::before{background:var(--accent)}</style>
    <div class="sc-top">
      <div class="sc-ic" style="background:${ibg}">${S(ic,iclr)}</div>
    </div>
    <div class="sc-val">${val}</div>
    <div class="sc-lbl">${lbl}</div>
    <div class="sc-bar"><div class="sc-fill" style="width:${Math.min(pct,100)}%;background:${bclr}"></div></div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgHome(){
  loading();
  const [stats,reqs]=await Promise.all([api('/api/admin/stats'),api('/api/admin/requests')]);
  const s=stats||{}; allRequests=reqs||[];
  const pending=allRequests.filter(r=>r.status==='pending_review');

  document.getElementById('sbUsers').textContent=(s.total_users||0);
  document.getElementById('sbProjects').textContent=(s.total_requests||0);
  document.getElementById('sbPending').textContent=pending.length;
  document.getElementById('nbPend').textContent=pending.length;

  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div><div class="pgs">Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ù…Ù†ØµØ© Ù…Ù†Ø§Ù‚ØµØ©</div></div>
      <div class="pga">
        <button class="btn btn-sub btn-sm" onclick="go('log',null)">${S('<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>')} Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</button>
        <button class="btn btn-p btn-sm" onclick="go('pending',null)">${S('<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>')} Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      </div>
    </div>

    <div class="sg">
      ${sCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',s.total_users||0,I.user,'var(--violet-50)','var(--violet-600)',100,'var(--violet-600)')}
      ${sCard('Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©',s.providers||0,`<path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/>`,'var(--blue-50)','var(--blue-600)',s.providers&&s.total_users?Math.round(s.providers/s.total_users*100):0,'var(--blue-600)')}
      ${sCard('Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',(s.total_users||0)-(s.providers||0),`<path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/>`,'var(--emerald-50)','var(--emerald-600)',100,'var(--emerald-600)')}
      ${sCard('Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø©',pending.length,I.alert,'var(--amber-50)','var(--amber-600)',100,'var(--amber-500)')}
      ${sCard('Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙƒØªÙ…Ù„Ø©',s.completed||0,I.check,'var(--emerald-50)','var(--emerald-600)',allRequests.length?Math.round((s.completed||0)/allRequests.length*100):0,'var(--emerald-600)')}
      ${sCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶',s.total_bids||0,I.send,'var(--blue-50)','var(--blue-600)',100,'var(--blue-500)')}
    </div>

    <div class="two-col">
      <div class="card">
        <div class="ch">
          <div class="ch-l">
            <div class="ch-ic" style="background:var(--amber-50)">${S(I.alert,'var(--amber-600)')}</div>
            <div><div class="ch-t">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div class="ch-s">${pending.length} Ù…Ø´Ø±ÙˆØ¹ ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©</div></div>
          </div>
          ${pending.length?`<button class="btn btn-a btn-sm" onclick="go('pending',null)">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>`:''}
        </div>
        <div class="cb">
          ${pending.length?pending.slice(0,4).map(r=>`
            <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border-sub)">
              <div style="flex:1;min-width:0">
                <div style="font-size:12px;font-weight:800;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${r.title}</div>
                <div style="display:flex;gap:5px;flex-wrap:wrap">
                  <span class="chip" style="font-size:9px">${S(I.map)} ${r.city||'â€”'}</span>
                  <span class="chip" style="font-size:9px">${S(I.folder)} ${r.category||'Ø¹Ø§Ù…'}</span>
                </div>
              </div>
              <div style="display:flex;gap:5px;flex-shrink:0;margin-right:10px">
                <button class="btn btn-g btn-xs" onclick="approveProject(${r.id})">${S(I.check)} Ù‚Ø¨ÙˆÙ„</button>
                <button class="btn btn-r btn-xs" onclick="rejectModal(${r.id})">Ø±ÙØ¶</button>
              </div>
            </div>`).join(''):`<div class="es" style="padding:24px"><div class="es-ic">${S(I.check)}</div><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© âœ…</div></div>`}
        </div>
      </div>

      <div>
        <div class="card">
          <div class="ch">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--blue-50)">${S(I.bars,'var(--blue-600)')}</div>
              <div class="ch-t">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            </div>
          </div>
          <div class="cb">
            ${[{l:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',k:'pending_review',c:'var(--amber-500)'},{l:'Ù…ÙØªÙˆØ­',k:'open',c:'var(--emerald-500)'},{l:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',k:'in_progress',c:'var(--blue-500)'},{l:'Ù…ÙƒØªÙ…Ù„',k:'completed',c:'var(--violet-600)'},{l:'Ù…Ø±ÙÙˆØ¶',k:'rejected',c:'var(--red-500)'}].map(it=>{
              const cnt=s[it.k]||0;
              const pct=allRequests.length?Math.round(cnt/allRequests.length*100):0;
              return`<div class="prog-row">
                <div class="prog-lbl" style="font-size:10px">${it.l}</div>
                <div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:${it.c}"></div></div>
                <div class="prog-val">${cnt}</div>
              </div>`;
            }).join('')}
          </div>
        </div>

        <div class="card">
          <div class="ch">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--violet-50)">${S('<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>','var(--violet-600)')}</div>
              <div class="ch-t">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</div>
            </div>
          </div>
          <div class="cb" style="max-height:220px;overflow-y:auto">
            ${activityLog.length?activityLog.slice(0,8).map(l=>`<div class="log-item"><div class="log-dot" style="background:${l.color}"></div><div class="log-body"><div class="log-action">${l.action}</div><div class="log-detail">${l.detail}</div></div><div class="log-time">${l.time}</div></div>`).join(''):`<div class="es" style="padding:24px"><div class="es-s">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø¨Ø¹Ø¯</div></div>`}
          </div>
        </div>
      </div>
    </div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PENDING REVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgPending(){
  loading();
  const data=await api('/api/admin/requests?status=pending_review');
  const pending=data||[];
  document.getElementById('nbPend').textContent=pending.length;

  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div><div class="pgs">${pending.length} Ù…Ø´Ø±ÙˆØ¹ ÙŠÙ†ØªØ¸Ø± Ù‚Ø±Ø§Ø±Ùƒ</div></div>
    </div>
    <div class="card">
      <div class="cb">
        ${pending.length?pending.map(r=>projCardHtml(r,true)).join(''):`<div class="es"><div class="es-ic">${S(I.check)}</div><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø¹Ù„Ù‚Ø© âœ…</div><div class="es-s">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§</div></div>`}
      </div>
    </div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALL PROJECTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgProjects(){
  loading();
  const data=await api('/api/admin/requests');
  allRequests=data||[];
  setContent(`
    <div class="pghd">
      <div><div class="pgt">ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="pgs">${allRequests.length} Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹</div></div>
    </div>
    <div class="card">
      <div class="cb">
        <div class="fbar">
          <div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="pQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…â€¦" oninput="filterProjects()"></div>
          <select class="fsel" id="pSt" onchange="filterProjects()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="pending_review">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option><option value="open">Ù…ÙØªÙˆØ­</option><option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option><option value="completed">Ù…ÙƒØªÙ…Ù„</option><option value="rejected">Ù…Ø±ÙÙˆØ¶</option></select>
          <select class="fsel" id="pCat" onchange="filterProjects()"><option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>${CATS.map(c=>`<option>${c}</option>`).join('')}</select>
          <select class="fsel" id="pCi" onchange="filterProjects()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(c=>`<option>${c}</option>`).join('')}</select>
        </div>
        <div id="projList">${renderProjList(allRequests)}</div>
      </div>
    </div>
  `);
}

function filterProjects(){
  const q=(document.getElementById('pQ')?.value||'').toLowerCase();
  const st=document.getElementById('pSt')?.value||'';
  const cat=document.getElementById('pCat')?.value||'';
  const ci=document.getElementById('pCi')?.value||'';
  const f=allRequests.filter(r=>(!q||r.title.toLowerCase().includes(q)||(r.project_number||'').toLowerCase().includes(q))&&(!st||r.status===st)&&(!cat||r.category===cat)&&(!ci||r.city===ci));
  const el=document.getElementById('projList');
  if(el)el.innerHTML=renderProjList(f);
}

function renderProjList(list){
  if(!list.length)return`<div class="es"><div class="es-ic">${S(I.proj)}</div><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>`;
  return list.map(r=>projCardHtml(r,r.status==='pending_review')).join('');
}

function projCardHtml(r,showApprove=false){
  const SC={pending_review:'pc-pend',open:'pc-open',in_progress:'pc-prog',completed:'pc-done',rejected:'pc-rej'};
  return`<div class="pc ${SC[r.status]||''}">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px">
      <div>
        <div class="pc-num">${r.project_number||'#'+r.id}</div>
        <div class="pc-title">${r.title}</div>
      </div>
      <span class="bdg ${SB[r.status]||''}">${SL[r.status]||r.status}</span>
    </div>
    <div class="pc-meta">
      <span class="chip">${S(I.map)} ${r.city||'â€”'}</span>
      <span class="chip">${S(I.folder)} ${r.category||'Ø¹Ø§Ù…'}</span>
      ${r.budget_max?`<span class="chip">${S(I.dollar)} ${Number(r.budget_max).toLocaleString()} Ø±.Ø³</span>`:''}
      ${r.deadline?`<span class="chip">${S(I.cal)} ${r.deadline}</span>`:''}
      <span class="chip">${S(I.send)} ${r.bid_count||0} Ø¹Ø±Ø¶</span>
      ${r.client_name?`<span class="chip">${S(I.user)} ${r.client_name}</span>`:''}
    </div>
    ${r.description?`<div class="pc-desc">${r.description.slice(0,200)}${r.description.length>200?'â€¦':''}</div>`:''}
    <div class="pc-acts">
      ${showApprove?`<button class="btn btn-g btn-sm" onclick="approveProject(${r.id})">${S(I.check)} Ù‚Ø¨ÙˆÙ„ ÙˆÙ†Ø´Ø±</button><button class="btn btn-r btn-sm" onclick="rejectModal(${r.id})">${S(I.x)} Ø±ÙØ¶</button>`:''}
      <button class="btn btn-sub btn-sm" onclick="viewProjModal(${r.id})">${S(I.eye)} Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
      <button class="btn btn-vio btn-sm" onclick="editProjModal(${r.id})">${S(I.edit)} ØªØ¹Ø¯ÙŠÙ„</button>
      ${r.status==='open'?`<button class="btn btn-b btn-sm" onclick="assignModal(${r.id})">Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ</button>`:''}
      ${r.status==='in_progress'?`<button class="btn btn-g btn-sm" onclick="completeProject(${r.id})">ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØªÙ…Ù„</button>`:''}
      ${['open','in_progress'].includes(r.status)?`<button class="btn btn-o btn-sm" onclick="openDisputeModal(${r.id},'${r.title.replace(/'/g,'')}')">ÙØªØ­ Ù†Ø²Ø§Ø¹</button>`:''}
      <button class="btn btn-r btn-sm" onclick="deleteProject(${r.id})">${S(I.trash)} Ø­Ø°Ù</button>
    </div>
  </div>`;
}

/* PROJECT ACTIONS */
async function approveProject(id){
  await api(`/api/admin/requests/${id}/review`,{method:'PUT',body:JSON.stringify({action:'approve'})});
  toast('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ âœ…','success');
  addLog('Ù‚Ø¨ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--emerald-600)');
  go(document.getElementById('pgTitle').textContent==='Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'?'pending':'projects',null);
}

function rejectModal(id){
  openM('Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div class="al-err alert">${S(I.alert,'var(--red-500)')} Ø³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ù„Ø±ÙØ¶ ÙˆÙ„Ù† ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†</div>
     <div class="fg"><label class="fl">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ <span class="fh">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span></label><textarea class="fta" id="rejReason" placeholder="Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„â€¦"></textarea></div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-r" onclick="confirmReject(${id})">${S(I.x)} ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--red-600)">${I.x}</svg>`,'var(--red-50)'
  );
}
async function confirmReject(id){
  const reason=document.getElementById('rejReason')?.value||'';
  await api(`/api/admin/requests/${id}/review`,{method:'PUT',body:JSON.stringify({action:'reject',reason})});
  closeM(); toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹','error');
  addLog('Ø±ÙØ¶ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--red-600)');
  go('pending',null);
}

async function completeProject(id){
  if(!confirm('ØªØ¹ÙŠÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒÙ…ÙƒØªÙ…Ù„ØŸ'))return;
  await api(`/api/admin/requests/${id}/complete`,{method:'PUT'});
  toast('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒÙ…ÙƒØªÙ…Ù„ âœ…','success');
  addLog('Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--violet-600)');
  pgProjects();
}

async function deleteProject(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  await api(`/api/admin/requests/${id}`,{method:'DELETE'});
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');
  addLog('Ø­Ø°Ù Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--red-600)');
  pgProjects();
}

async function viewProjModal(id){
  const [r,bids]=await Promise.all([api(`/api/requests/${id}`),api(`/api/requests/${id}/bids`)]);
  const bidsList=bids||[];
  openM('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div style="background:var(--gray-900);border-radius:var(--r-lg);padding:16px;margin-bottom:16px">
       <div style="font-size:9px;font-weight:800;color:rgba(255,255,255,.3);letter-spacing:1px;margin-bottom:4px">${r.project_number||'#'+r.id}</div>
       <div style="font-size:15px;font-weight:900;color:#fff;margin-bottom:10px;line-height:1.3">${r.title}</div>
       <div style="display:flex;gap:5px;flex-wrap:wrap">
         <span class="bdg ${SB[r.status]||''}">${SL[r.status]||r.status}</span>
         ${r.category?`<span style="font-size:10px;color:rgba(255,255,255,.35);background:rgba(255,255,255,.07);padding:2px 9px;border-radius:var(--r-full)">ğŸ“‚ ${r.category}</span>`:''}
         ${r.city?`<span style="font-size:10px;color:rgba(255,255,255,.35);background:rgba(255,255,255,.07);padding:2px 9px;border-radius:var(--r-full)">ğŸ“ ${r.city}</span>`:''}
       </div>
     </div>
     <div class="ib-block">
       <div class="ib-t">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>
       <div class="ir"><span class="ik">Ø§Ù„Ø¹Ù…ÙŠÙ„</span><span class="iv">${r.client_name||'â€”'}</span></div>
       <div class="ir"><span class="ik">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span><span class="iv" style="color:var(--emerald-600)">${fprice(r.budget_max)}</span></div>
       <div class="ir"><span class="ik">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><span class="iv">${r.deadline||'â€”'}</span></div>
       <div class="ir"><span class="ik">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span><span class="iv">${r.address||'â€”'}</span></div>
       <div class="ir"><span class="ik">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</span><span class="iv">${bidsList.length}</span></div>
       <div class="ir"><span class="ik">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</span><span class="iv">${fdate(r.created_at)}</span></div>
     </div>
     ${r.description?`<div class="ib-block"><div class="ib-t">Ø§Ù„ÙˆØµÙ</div><div style="font-size:12px;line-height:1.8;color:var(--text-2)">${r.description}</div></div>`:''}
     ${bidsList.length?`<div class="ib-block"><div class="ib-t">Ø§Ù„Ø¹Ø±ÙˆØ¶ (${bidsList.length})</div>
       ${bidsList.map(b=>{const bg=avColor(b.provider_id||1);return`<div style="display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--border-sub)">
         <div style="display:flex;align-items:center;gap:8px">
           <div class="tbl-av" style="background:${bg};width:28px;height:28px">${avLetter(b.provider_name)}</div>
           <div><div style="font-size:11px;font-weight:700">${b.provider_name||'â€”'}</div><div style="font-size:9px;color:var(--text-3)">${starsHtml(b.avg_rating||0)}</div></div>
         </div>
         <div style="text-align:left">
           <div style="font-size:12px;font-weight:800;color:var(--emerald-600)">${Number(b.price).toLocaleString()} Ø±.Ø³</div>
           <div style="font-size:9px;color:var(--text-3)">${b.days} ÙŠÙˆÙ…</div>
         </div>
       </div>`;}).join('')}
     </div>`:''}`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.eye}</svg>`,'var(--violet-100)'
  );
}

function editProjModal(id){
  const r=allRequests.find(x=>x.id===id)||{};
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
    `<div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" class="fi" id="eTi" value="${r.title||''}"></div>
     <div class="f2">
       <div class="fg"><label class="fl">Ø§Ù„ØªØµÙ†ÙŠÙ</label><select class="fsel-f" id="eCat">${catOpts(r.category)}</select></div>
       <div class="fg"><label class="fl">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" class="fi" id="eBudget" value="${r.budget_max||''}"></div>
     </div>
     <div class="fg"><label class="fl">Ø§Ù„ÙˆØµÙ</label><textarea class="fta" id="eDesc">${r.description||''}</textarea></div>
     <div class="f2">
       <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="fsel-f" id="eCi">${cityOpts(r.city)}</select></div>
       <div class="fg"><label class="fl">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label><input type="date" class="fi" id="eDl" value="${r.deadline||''}"></div>
     </div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="saveEditProj(${id})">${S(I.save)} Ø­ÙØ¸</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.edit}</svg>`,'var(--violet-100)'
  );
}
async function saveEditProj(id){
  const body={title:document.getElementById('eTi')?.value?.trim(),category:document.getElementById('eCat')?.value,description:document.getElementById('eDesc')?.value?.trim(),budget_max:document.getElementById('eBudget')?.value?parseFloat(document.getElementById('eBudget').value):null,city:document.getElementById('eCi')?.value,deadline:document.getElementById('eDl')?.value||null};
  if(!body.title){toast('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨','error');return;}
  await api(`/api/admin/requests/${id}`,{method:'PUT',body:JSON.stringify(body)});
  closeM();toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success');addLog('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹',`#${id}`,'var(--blue-600)');pgProjects();
}

function assignModal(reqId){
  openM('Ø¥Ø³Ù†Ø§Ø¯ ÙŠØ¯ÙˆÙŠ Ù„Ù…Ø²ÙˆØ¯',
    `<div class="al-info alert">${S(I.info,'var(--blue-500)')} Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø²ÙˆØ¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ø³Ù†Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù„ÙŠÙ‡ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
     <div class="fg"><label class="fl">Ø±Ù‚Ù… Ø§Ù„Ù…Ø²ÙˆØ¯ (ID)</label><input type="number" class="fi" id="assProv" placeholder="Ø§Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ø²ÙˆØ¯"></div>
     <div class="fg"><label class="fl">Ø³Ø¹Ø± Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ (Ø±.Ø³)</label><input type="number" class="fi" id="assPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡"></div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="confirmAssign(${reqId})">${S(I.check)} Ø¥Ø³Ù†Ø§Ø¯</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.user}</svg>`,'var(--violet-100)'
  );
}
async function confirmAssign(reqId){
  const provId=document.getElementById('assProv')?.value;
  const price=document.getElementById('assPrice')?.value;
  if(!provId){toast('Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ø²ÙˆØ¯','error');return;}
  await api(`/api/admin/requests/${reqId}/assign`,{method:'PUT',body:JSON.stringify({provider_id:parseInt(provId),price:price?parseFloat(price):undefined})});
  closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ âœ…','success');addLog('Ø¥Ø³Ù†Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹',`#${reqId} â†’ Ù…Ø²ÙˆØ¯ #${provId}`,'var(--blue-600)');pgProjects();
}

function openDisputeModal(reqId,title){
  openM(`ÙØªØ­ Ù†Ø²Ø§Ø¹ â€” ${title}`,
    `<div class="fg"><label class="fl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø²Ø§Ø¹ <span class="fh">*</span></label><input type="text" class="fi" id="dTitle" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù†Ø²Ø§Ø¹"></div>
     <div class="fg"><label class="fl">Ø§Ù„ØªÙØ§ØµÙŠÙ„</label><textarea class="fta" id="dDesc" placeholder="Ø§Ø´Ø±Ø­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ø²Ø§Ø¹â€¦"></textarea></div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-o" onclick="confirmDispute(${reqId})">${S(I.alert)} ÙØªØ­ Ø§Ù„Ù†Ø²Ø§Ø¹</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--orange-500)">${I.alert}</svg>`,'var(--orange-50)'
  );
}
async function confirmDispute(reqId){
  const title=document.getElementById('dTitle')?.value?.trim();
  const desc=document.getElementById('dDesc')?.value||'';
  if(!title){toast('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø²Ø§Ø¹ Ù…Ø·Ù„ÙˆØ¨','error');return;}
  await api('/api/admin/disputes',{method:'POST',body:JSON.stringify({request_id:reqId,title,description:desc})});
  closeM();toast('ØªÙ… ÙØªØ­ Ø§Ù„Ù†Ø²Ø§Ø¹','info');addLog('ÙØªØ­ Ù†Ø²Ø§Ø¹',`Ù…Ø´Ø±ÙˆØ¹ #${reqId}`,'var(--orange-500)');pgProjects();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROVIDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgProviders(){
  loading();
  const data=await api('/api/admin/providers');
  allUsers=data||[];
  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div><div class="pgs">${allUsers.length} Ù…Ø²ÙˆØ¯ Ù…Ø³Ø¬Ù„</div></div>
      <div class="pga"><button class="btn btn-p btn-sm" onclick="addUserModal('provider')">${S(I.plus)} Ø¥Ø¶Ø§ÙØ© Ù…Ø²ÙˆØ¯</button></div>
    </div>
    <div class="card">
      <div class="cb">
        <div class="fbar">
          <div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="prQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯â€¦" oninput="filterProviders()"></div>
          <select class="fsel" id="prSp" onchange="filterProviders()"><option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>${CATS.map(c=>`<option>${c}</option>`).join('')}</select>
          <select class="fsel" id="prCi" onchange="filterProviders()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(c=>`<option>${c}</option>`).join('')}</select>
          <select class="fsel" id="prSt" onchange="filterProviders()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="active">Ù†Ø´Ø·</option><option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option></select>
        </div>
        <div class="tbl-wrap">
          <table class="tbl" id="provTbl">
            <thead><tr><th>Ø§Ù„Ù…Ø²ÙˆØ¯</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„ØªØ®ØµØµ</th><th>Ø§Ù„ÙˆØ³Ø§Ù…</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
            <tbody id="provBody">${renderProvidersTable(allUsers)}</tbody>
          </table>
        </div>
      </div>
    </div>
  `);
}

function filterProviders(){
  const q=(document.getElementById('prQ')?.value||'').toLowerCase();
  const sp=document.getElementById('prSp')?.value||'';
  const ci=document.getElementById('prCi')?.value||'';
  const st=document.getElementById('prSt')?.value||'';
  const f=allUsers.filter(u=>(!q||(u.name||'').toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q))&&(!sp||(u.specialties||[]).includes(sp))&&(!ci||u.city===ci)&&(!st||(st==='active'?u.is_active!==false:u.is_active===false)));
  const el=document.getElementById('provBody');
  if(el)el.innerHTML=renderProvidersTable(f);
}

function renderProvidersTable(list){
  if(!list.length)return`<tr><td colspan="8"><div class="es" style="padding:24px"><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²ÙˆØ¯ÙŠÙ†</div></div></td></tr>`;
  return list.map(u=>{
    const bg=avColor(u.id||1);
    const bdg=BDGMAP[u.badge||'none']||BDGMAP.none;
    const active=u.is_active!==false;
    return`<tr>
      <td><div style="display:flex;align-items:center;gap:9px">
        <div class="tbl-av" style="background:${bg}">${avLetter(u.name)}</div>
        <div><div style="font-size:12px;font-weight:700">${u.name||'â€”'}</div><div style="font-size:10px;color:var(--text-3)">${u.email||'â€”'}</div></div>
      </div></td>
      <td style="font-size:11px;color:var(--text-2)">${u.city||'â€”'}</td>
      <td style="font-size:10px;color:var(--text-2)">${(u.specialties||[]).slice(0,2).join('ØŒ ')||'â€”'}</td>
      <td><span style="font-size:11px;font-weight:700">${bdg.icon} ${bdg.label}</span></td>
      <td><span style="font-size:12px;color:#f59e0b">${u.avg_rating?Number(u.avg_rating).toFixed(1)+'â˜…':'â€”'}</span></td>
      <td style="font-size:11px;font-weight:700">${u.completed_projects||0}</td>
      <td><span class="bdg ${active?'bdg-active':'bdg-inactive'}">${active?'Ù†Ø´Ø·':'ØºÙŠØ± Ù†Ø´Ø·'}</span></td>
      <td><div style="display:flex;gap:4px;flex-wrap:wrap">
        <button class="btn btn-sub btn-xs" onclick="viewUser(${u.id})">${S(I.eye)}</button>
        <button class="btn btn-vio btn-xs" onclick="editUserModal(${u.id},'provider')">${S(I.edit)}</button>
        <button class="btn btn-a btn-xs" onclick="setBadgeModal(${u.id},'${u.badge||'none'}')">ğŸ†</button>
        <button class="btn ${active?'btn-sub':'btn-g'} btn-xs" onclick="toggleUser(${u.id},${active})">${active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„'}</button>
        <button class="btn btn-r btn-xs" onclick="deleteUser(${u.id})">${S(I.trash)}</button>
      </div></td>
    </tr>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLIENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgClients(){
  loading();
  const data=await api('/api/admin/users?role=client');
  allUsers=data||[];
  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div><div class="pgs">${allUsers.length} Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¬Ù„</div></div>
      <div class="pga"><button class="btn btn-p btn-sm" onclick="addUserModal('client')">${S(I.plus)} Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button></div>
    </div>
    <div class="card">
      <div class="cb">
        <div class="fbar">
          <div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="clQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯â€¦" oninput="filterClients()"></div>
          <select class="fsel" id="clCi" onchange="filterClients()"><option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>${CITIES.map(c=>`<option>${c}</option>`).join('')}</select>
          <select class="fsel" id="clSt" onchange="filterClients()"><option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="active">Ù†Ø´Ø·</option><option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option></select>
        </div>
        <div class="tbl-wrap">
          <table class="tbl">
            <thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
            <tbody id="cliBody">${renderClientsTable(allUsers)}</tbody>
          </table>
        </div>
      </div>
    </div>
  `);
}

function filterClients(){
  const q=(document.getElementById('clQ')?.value||'').toLowerCase();
  const ci=document.getElementById('clCi')?.value||'';
  const st=document.getElementById('clSt')?.value||'';
  const f=allUsers.filter(u=>(!q||(u.name||'').toLowerCase().includes(q)||(u.email||'').toLowerCase().includes(q))&&(!ci||u.city===ci)&&(!st||(st==='active'?u.is_active!==false:u.is_active===false)));
  const el=document.getElementById('cliBody');
  if(el)el.innerHTML=renderClientsTable(f);
}

function renderClientsTable(list){
  if(!list.length)return`<tr><td colspan="7"><div class="es" style="padding:24px"><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</div></div></td></tr>`;
  return list.map(u=>{
    const bg=avColor(u.id||1);
    const active=u.is_active!==false;
    return`<tr>
      <td><div style="display:flex;align-items:center;gap:9px">
        <div class="tbl-av" style="background:${bg}">${avLetter(u.name)}</div>
        <div><div style="font-size:12px;font-weight:700">${u.name||'â€”'}</div><div style="font-size:10px;color:var(--text-3)">${u.email||'â€”'}</div></div>
      </div></td>
      <td style="font-size:11px;color:var(--text-2)">${u.city||'â€”'}</td>
      <td style="font-size:11px;font-variant-numeric:tabular-nums">${u.phone||'â€”'}</td>
      <td style="font-size:12px;font-weight:700">${u.total_projects||0}</td>
      <td><span class="bdg ${active?'bdg-active':'bdg-inactive'}">${active?'Ù†Ø´Ø·':'ØºÙŠØ± Ù†Ø´Ø·'}</span></td>
      <td style="font-size:10px;color:var(--text-3)">${fdate(u.created_at)}</td>
      <td><div style="display:flex;gap:4px;flex-wrap:wrap">
        <button class="btn btn-sub btn-xs" onclick="viewUser(${u.id})">${S(I.eye)}</button>
        <button class="btn btn-vio btn-xs" onclick="editUserModal(${u.id},'client')">${S(I.edit)}</button>
        <button class="btn ${active?'btn-sub':'btn-g'} btn-xs" onclick="toggleUser(${u.id},${active})">${active?'Ø¥ÙŠÙ‚Ø§Ù':'ØªÙØ¹ÙŠÙ„'}</button>
        <button class="btn btn-r btn-xs" onclick="deleteUser(${u.id})">${S(I.trash)}</button>
      </div></td>
    </tr>`;
  }).join('');
}

/* USER ACTIONS */
async function viewUser(id){
  const u=await api(`/api/admin/users/${id}`);
  const bg=avColor(u.id||1);
  openM('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
    `<div style="display:flex;align-items:center;gap:13px;padding:16px;background:var(--surface-2);border-radius:var(--r-lg);margin-bottom:16px;border:1px solid var(--border)">
       <div style="width:48px;height:48px;border-radius:var(--r-lg);background:${bg};color:#fff;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center">${avLetter(u.name)}</div>
       <div><div style="font-size:15px;font-weight:800">${u.name||'â€”'}</div><div style="font-size:11px;color:var(--text-3);margin-top:2px">${u.email||'â€”'}</div></div>
     </div>
     <div class="ib-block">
       <div class="ib-t">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
       <div class="ir"><span class="ik">Ø§Ù„Ø¯ÙˆØ±</span><span class="iv">${u.role==='provider'?'Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':u.role==='client'?'Ø¹Ù…ÙŠÙ„':'Ù…Ø¯ÙŠØ±'}</span></div>
       <div class="ir"><span class="ik">Ø§Ù„Ø¬ÙˆØ§Ù„</span><span class="iv">${u.phone||'â€”'}</span></div>
       <div class="ir"><span class="ik">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span><span class="iv">${u.city||'â€”'}</span></div>
       <div class="ir"><span class="ik">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span><span class="iv">${fdate(u.created_at)}</span></div>
       <div class="ir"><span class="ik">Ø§Ù„Ø­Ø§Ù„Ø©</span><span class="iv"><span class="bdg ${u.is_active!==false?'bdg-active':'bdg-inactive'}">${u.is_active!==false?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ'}</span></span></div>
       ${u.role==='provider'?`<div class="ir"><span class="ik">Ø§Ù„ÙˆØ³Ø§Ù…</span><span class="iv">${(BDGMAP[u.badge||'none']||BDGMAP.none).icon} ${(BDGMAP[u.badge||'none']||BDGMAP.none).label}</span></div><div class="ir"><span class="ik">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span><span class="iv" style="color:#f59e0b">${u.avg_rating?Number(u.avg_rating).toFixed(1)+'â˜…':'â€”'}</span></div>`:''}
     </div>
     ${u.bio?`<div class="ib-block"><div class="ib-t">Ø§Ù„Ù†Ø¨Ø°Ø©</div><div style="font-size:12px;line-height:1.8;color:var(--text-2)">${u.bio}</div></div>`:''}
     ${(u.specialties||[]).length?`<div class="ib-block"><div class="ib-t">Ø§Ù„ØªØ®ØµØµØ§Øª</div><div style="display:flex;gap:5px;flex-wrap:wrap;padding-top:5px">${u.specialties.map(s=>`<span style="background:var(--violet-50);color:var(--violet-700);padding:3px 9px;border-radius:var(--r-full);font-size:11px;font-weight:700;border:1px solid var(--violet-200)">${s}</span>`).join('')}</div></div>`:''}`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥ØºÙ„Ø§Ù‚</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.user}</svg>`,'var(--violet-100)'
  );
}

function addUserModal(role){
  uploadedImgs['addU']=[]; 
  openM(role==='provider'?'Ø¥Ø¶Ø§ÙØ© Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø©':'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„',
    `<div class="fsec">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
     <div class="f2">
       <div class="fg"><label class="fl">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="fh">*</span></label><input type="text" class="fi" id="auNm" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div>
       <div class="fg"><label class="fl">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="fh">*</span></label><input type="email" class="fi" id="auEm" placeholder="example@email.com"></div>
     </div>
     <div class="f2">
       <div class="fg"><label class="fl">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="fi" id="auPh" placeholder="05xxxxxxxx"></div>
       <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="fsel-f" id="auCi">${cityOpts()}</select></div>
     </div>
     <div class="fg"><label class="fl">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± <span class="fh">*</span></label><input type="password" class="fi" id="auPw" placeholder="8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"></div>
     ${role==='provider'?`<div class="fsec">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯</div>
       <div class="fg"><label class="fl">Ø§Ù„ØªØ®ØµØµØ§Øª</label>${specsHtml([])}</div>
       <div class="fg"><label class="fl">Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø©</label><textarea class="fta" id="auBio" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø²ÙˆØ¯â€¦"></textarea></div>
       <div class="fsec">ØµÙˆØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>${imgUpHtml('addU')}`:``}`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="saveNewUser('${role}')">${S(I.plus)} Ø¥Ø¶Ø§ÙØ©</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.user}</svg>`,'var(--violet-100)'
  );
}

async function saveNewUser(role){
  const body={name:document.getElementById('auNm')?.value?.trim(),email:document.getElementById('auEm')?.value?.trim(),phone:document.getElementById('auPh')?.value||'',city:document.getElementById('auCi')?.value||'',password:document.getElementById('auPw')?.value||'',role};
  if(!body.name||!body.email||!body.password){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©','error');return;}
  if(role==='provider'){body.specialties=getSpecs();body.bio=document.getElementById('auBio')?.value||'';}
  const res=await api('/api/admin/users',{method:'POST',body:JSON.stringify(body)});
  if(res.message&&!res.id){toast(res.message,'error');return;}
  closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…','success');addLog(`Ø¥Ø¶Ø§ÙØ© ${role==='provider'?'Ù…Ø²ÙˆØ¯':'Ø¹Ù…ÙŠÙ„'}`,body.name,'var(--emerald-600)');
  role==='provider'?pgProviders():pgClients();
}

function editUserModal(id,role){
  const u=allUsers.find(x=>x.id===id)||{};
  uploadedImgs['editU']=[];
  openM('ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
    `<div class="f2">
       <div class="fg"><label class="fl">Ø§Ù„Ø§Ø³Ù…</label><input type="text" class="fi" id="euNm" value="${u.name||''}"></div>
       <div class="fg"><label class="fl">Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" class="fi" id="euPh" value="${u.phone||''}"></div>
     </div>
     <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select class="fsel-f" id="euCi">${cityOpts(u.city)}</select></div>
     ${role==='provider'?`<div class="fg"><label class="fl">Ø§Ù„ØªØ®ØµØµØ§Øª</label>${specsHtml(u.specialties||[])}</div>
       <div class="fg"><label class="fl">Ø§Ù„Ù†Ø¨Ø°Ø©</label><textarea class="fta" id="euBio">${u.bio||''}</textarea></div>`:''}`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-p" onclick="saveEditUser(${id},'${role}')">${S(I.save)} Ø­ÙØ¸</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.edit}</svg>`,'var(--violet-100)'
  );
}

async function saveEditUser(id,role){
  const body={name:document.getElementById('euNm')?.value?.trim()||'',phone:document.getElementById('euPh')?.value||'',city:document.getElementById('euCi')?.value||''};
  if(role==='provider'){body.specialties=getSpecs();body.bio=document.getElementById('euBio')?.value||'';}
  await api(`/api/admin/users/${id}`,{method:'PUT',body:JSON.stringify(body)});
  closeM();toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success');addLog('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…',`#${id}`,'var(--blue-600)');
  role==='provider'?pgProviders():pgClients();
}

function setBadgeModal(id,currentBadge){
  openM('Ù…Ù†Ø­ Ø§Ù„ÙˆØ³Ø§Ù…',
    `<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
       ${Object.entries(BDGMAP).map(([key,b])=>`<div onclick="document.querySelectorAll('.bdg-opt').forEach(x=>x.classList.remove('on'));this.classList.add('on');document.getElementById('selBdg').value='${key}'" class="bdg-opt${key===currentBadge?' on':''}" style="padding:12px;border-radius:var(--r-lg);border:2px solid ${key===currentBadge?'var(--violet-500)':'var(--border)'};text-align:center;cursor:pointer;transition:all var(--t-fast);background:${key===currentBadge?'var(--violet-50)':'var(--surface)'}">
         <div style="font-size:20px;margin-bottom:4px">${b.icon}</div>
         <div style="font-size:11px;font-weight:700">${b.label}</div>
       </div>`).join('')}
     </div>
     <input type="hidden" id="selBdg" value="${currentBadge}">`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-a" onclick="saveBadge(${id})">${S(I.star)} Ù…Ù†Ø­ Ø§Ù„ÙˆØ³Ø§Ù…</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--amber-600)">${I.star}</svg>`,'var(--amber-50)'
  );
}
async function saveBadge(id){
  const badge=document.getElementById('selBdg')?.value||'none';
  await api(`/api/admin/users/${id}/badge`,{method:'PUT',body:JSON.stringify({badge})});
  closeM();toast('ØªÙ… Ù…Ù†Ø­ Ø§Ù„ÙˆØ³Ø§Ù… âœ…','success');addLog('Ù…Ù†Ø­ ÙˆØ³Ø§Ù…',`#${id} â†’ ${badge}`,'var(--amber-600)');pgProviders();
}

async function toggleUser(id,isActive){
  await api(`/api/admin/users/${id}/toggle`,{method:'PUT',body:JSON.stringify({active:!isActive})});
  toast(isActive?'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨':'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨',isActive?'error':'success');
  addLog(isActive?'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø³ØªØ®Ø¯Ù…':'ØªÙØ¹ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…',`#${id}`,isActive?'var(--red-600)':'var(--emerald-600)');
  if(document.getElementById('pgTitle').textContent==='Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©')pgProviders();else pgClients();
}

async function deleteUser(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  await api(`/api/admin/users/${id}`,{method:'DELETE'});
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');addLog('Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…',`#${id}`,'var(--red-600)');
  if(document.getElementById('pgTitle').textContent==='Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©')pgProviders();else pgClients();
}

/* OVERLAY CLOSE */
document.getElementById('ov').addEventListener('click',function(e){if(e.target===this)closeM();});

/* BOOT */
go('home',document.querySelector('.ni.on'));
</script>
</body>
</html>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVIEWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgReviews(){
  loading();
  const data=await api('/api/admin/reviews');
  allReviews=data||[];
  const reported=allReviews.filter(r=>r.reported).length;
  const nb=document.getElementById('nbRev');
  if(nb){nb.style.display=reported?'':'none';nb.textContent=reported;}

  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div><div class="pgs">${allReviews.length} ØªÙ‚ÙŠÙŠÙ… Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹${reported?` â€¢ <span style="color:var(--red-600)">${reported} Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡</span>`:''}</div></div>
    </div>
    <div class="card">
      <div class="cb">
        <div class="fbar">
          <div class="sbox"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="rvQ" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹â€¦" oninput="filterRevs()"></div>
          <select class="fsel" id="rvVis" onchange="filterRevs()">
            <option value="">ÙƒÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
            <option value="reported">Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡Ø§</option>
            <option value="hidden">Ù…Ø®ÙÙŠØ©</option>
            <option value="pinned">Ù…Ø«Ø¨ØªØ©</option>
          </select>
          <select class="fsel" id="rvSt" onchange="filterRevs()">
            <option value="">ÙƒÙ„ Ø§Ù„Ù†Ø¬ÙˆÙ…</option>
            ${[5,4,3,2,1].map(n=>`<option value="${n}">${n} â˜…</option>`).join('')}
          </select>
        </div>
        <div id="revsList">${renderRevsList(allReviews)}</div>
      </div>
    </div>
  `);
}

function filterRevs(){
  const q=(document.getElementById('rvQ')?.value||'').toLowerCase();
  const vis=document.getElementById('rvVis')?.value||'';
  const st=document.getElementById('rvSt')?.value||'';
  let f=allReviews.filter(r=>{
    const matchQ=!q||(r.reviewer_name||'').toLowerCase().includes(q)||(r.reviewed_name||'').toLowerCase().includes(q)||(r.project_number||'').toLowerCase().includes(q);
    const matchVis=!vis||(vis==='reported'&&r.reported)||(vis==='hidden'&&r.hidden)||(vis==='pinned'&&r.pinned);
    const matchSt=!st||r.rating==st;
    return matchQ&&matchVis&&matchSt;
  });
  const el=document.getElementById('revsList');
  if(el)el.innerHTML=renderRevsList(f);
}

function renderRevsList(list){
  if(!list.length)return`<div class="es"><div class="es-ic">${S(I.star)}</div><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div></div>`;
  return list.map(r=>{
    const bg1=avColor(r.reviewer_id||1);
    const bg2=avColor(r.reviewed_id||2);
    return`<div class="rev-card${r.reported?' reported':''}">
      <div class="rev-header">
        <div style="display:flex;align-items:center;gap:9px">
          <div class="rev-av" style="background:${bg1}">${avLetter(r.reviewer_name)}</div>
          <div>
            <div class="rev-nm">${r.reviewer_name||'â€”'}</div>
            <div class="rev-sub">Ù‚ÙŠÙ‘Ù… â† ${r.reviewed_name||'â€”'}</div>
          </div>
          <div style="display:flex;align-items:center;gap:4px;margin-right:4px">
            <div class="rev-av" style="background:${bg2};width:24px;height:24px;font-size:10px">${avLetter(r.reviewed_name)}</div>
          </div>
        </div>
        <div style="text-align:left">
          <div class="stars-html">${starsHtml(r.rating)}</div>
          <div style="font-size:9px;color:var(--text-3);margin-top:2px">${fdate(r.created_at)}</div>
          <div style="display:flex;gap:4px;margin-top:4px;justify-content:flex-end">
            ${r.reported?`<span style="background:var(--red-100);color:var(--red-600);padding:1px 6px;border-radius:var(--r-full);font-size:9px;font-weight:700">ğŸš© Ù…ÙØ¨Ù„ÙÙ‘Øº</span>`:''}
            ${r.pinned?`<span style="background:var(--amber-100);color:var(--amber-700);padding:1px 6px;border-radius:var(--r-full);font-size:9px;font-weight:700">ğŸ“Œ Ù…Ø«Ø¨Øª</span>`:''}
            ${r.hidden?`<span style="background:var(--gray-100);color:var(--text-3);padding:1px 6px;border-radius:var(--r-full);font-size:9px;font-weight:700">ğŸ™ˆ Ù…Ø®ÙÙŠ</span>`:''}
          </div>
        </div>
      </div>
      <div style="font-size:10px;color:var(--text-3);font-weight:600;margin-bottom:8px">
        ${S('<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/>','var(--text-3)')} ${r.project_number||'#'+r.request_id}
      </div>
      ${r.comment?`<div class="rev-text">${r.comment}</div>`:''}
      ${r.admin_reply?`<div class="admin-reply"><div class="reply-lbl">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div><div class="reply-text">${r.admin_reply}</div></div>`:''}
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <button class="btn btn-a btn-xs" onclick="replyRevModal(${r.id},'${(r.comment||'').replace(/'/g,'')}','${r.admin_reply||''}')">
          ${S('<path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>')} Ø±Ø¯
        </button>
        <button class="btn btn-sub btn-xs" onclick="togglePinRev(${r.id},${!r.pinned})">${r.pinned?'ğŸ“Œ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª':'ğŸ“Œ ØªØ«Ø¨ÙŠØª'}</button>
        <button class="btn btn-sub btn-xs" onclick="toggleHideRev(${r.id},${!r.hidden})">${r.hidden?'ğŸ‘ Ø¥Ø¸Ù‡Ø§Ø±':'ğŸ™ˆ Ø¥Ø®ÙØ§Ø¡'}</button>
        ${r.reported?`<button class="btn btn-g btn-xs" onclick="resolveReport(${r.id})">âœ“ Ø­Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</button>`:''}
        <button class="btn btn-r btn-xs" onclick="deleteRev(${r.id})">${S(I.trash)}</button>
      </div>
    </div>`;
  }).join('');
}

function replyRevModal(id,comment,currentReply){
  openM('Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…',
    `${comment?`<div class="rev-text" style="margin-bottom:14px">"${comment}"</div>`:''}
     <div class="fg"><label class="fl">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© <span class="fh">*</span></label>
       <textarea class="fta" id="replyBody" style="min-height:100px" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙˆÙ…â€¦">${currentReply}</textarea>
     </div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button>
     <button class="btn btn-a" onclick="saveReplyRev(${id})">${S('<path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>')} Ù†Ø´Ø± Ø§Ù„Ø±Ø¯</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--amber-600)"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>`,'var(--amber-50)'
  );
}
async function saveReplyRev(id){
  const reply=document.getElementById('replyBody')?.value?.trim();
  if(!reply){toast('Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯','error');return;}
  await api(`/api/admin/reviews/${id}/reply`,{method:'PUT',body:JSON.stringify({reply})});
  closeM();toast('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø±Ø¯ âœ…','success');
  addLog('Ø±Ø¯ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…',`#${id}`,'var(--amber-600)');
  pgReviews();
}
async function togglePinRev(id,pin){
  await api(`/api/admin/reviews/${id}/pin`,{method:'PUT',body:JSON.stringify({pinned:pin})});
  toast(pin?'ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª ğŸ“Œ':'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª','success');
  addLog(pin?'ØªØ«Ø¨ÙŠØª ØªÙ‚ÙŠÙŠÙ…':'Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª',`#${id}`,'var(--amber-500)');
  pgReviews();
}
async function toggleHideRev(id,hide){
  await api(`/api/admin/reviews/${id}/hide`,{method:'PUT',body:JSON.stringify({hidden:hide})});
  toast(hide?'ØªÙ… Ø§Ù„Ø¥Ø®ÙØ§Ø¡ ğŸ™ˆ':'ØªÙ… Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø± ğŸ‘','info');
  addLog(hide?'Ø¥Ø®ÙØ§Ø¡ ØªÙ‚ÙŠÙŠÙ…':'Ø¥Ø¸Ù‡Ø§Ø± ØªÙ‚ÙŠÙŠÙ…',`#${id}`,'var(--gray-500)');
  pgReviews();
}
async function resolveReport(id){
  await api(`/api/admin/reviews/${id}/resolve`,{method:'PUT'});
  toast('ØªÙ… Ø­Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº âœ…','success');
  addLog('Ø­Ù„ Ø¥Ø¨Ù„Ø§Øº',`#${id}`,'var(--emerald-600)');
  pgReviews();
}
async function deleteRev(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  await api(`/api/admin/reviews/${id}`,{method:'DELETE'});
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','error');
  addLog('Ø­Ø°Ù ØªÙ‚ÙŠÙŠÙ…',`#${id}`,'var(--red-600)');
  pgReviews();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISPUTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgDisputes(){
  loading();
  const data=await api('/api/admin/disputes');
  allDisputes=data||[];
  const open=allDisputes.filter(d=>d.status==='open').length;
  const nb=document.getElementById('nbDisp');
  if(nb){nb.style.display=open?'':'none';nb.textContent=open;}

  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</div><div class="pgs">${open} Ù†Ø²Ø§Ø¹ Ù…ÙØªÙˆØ­</div></div>
      <div class="pga">
        <select class="fsel" id="dfSt" onchange="filterDisp()">
          <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="open">Ù…ÙØªÙˆØ­Ø©</option>
          <option value="resolved">Ù…Ø­Ù„ÙˆÙ„Ø©</option>
        </select>
      </div>
    </div>
    <div id="dispList">${renderDispList(allDisputes)}</div>
  `);
}

function filterDisp(){
  const st=document.getElementById('dfSt')?.value||'';
  const f=st?allDisputes.filter(d=>d.status===st):allDisputes;
  const el=document.getElementById('dispList');
  if(el)el.innerHTML=renderDispList(f);
}

function renderDispList(list){
  if(!list.length)return`<div class="card"><div class="cb"><div class="es"><div class="es-ic">${S(I.check)}</div><div class="es-t">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø²Ø§Ø¹Ø§Øª Ù…ÙØªÙˆØ­Ø© âœ…</div></div></div></div>`;
  return list.map(d=>{
    const bg1=avColor(d.client_id||1);
    const bg2=avColor(d.provider_id||2);
    return`<div class="disp-card${d.status==='resolved'?' resolved':''}">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:6px">
        <div>
          <div class="disp-title">${d.title}</div>
          <div class="disp-meta">${d.project_number||'#'+d.request_id} â€¢ ${fdate(d.created_at)}</div>
        </div>
        <span class="bdg ${d.status==='open'?'bdg-rej':'bdg-open'}">${d.status==='open'?'Ù…ÙØªÙˆØ­':'Ù…Ø­Ù„ÙˆÙ„'}</span>
      </div>
      ${d.description?`<div class="disp-desc">${d.description}</div>`:''}
      <div class="disp-parties">
        <div style="display:flex;align-items:center;gap:8px">
          <div style="width:32px;height:32px;border-radius:var(--r-md);background:${bg1};color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">${avLetter(d.client_name)}</div>
          <div><div class="party-nm">${d.client_name||'â€”'}</div><div class="party-role">Ø§Ù„Ø¹Ù…ÙŠÙ„</div></div>
        </div>
        <div style="text-align:center;color:var(--text-3);font-size:18px">â‡†</div>
        <div style="display:flex;align-items:center;gap:8px">
          <div style="width:32px;height:32px;border-radius:var(--r-md);background:${bg2};color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">${avLetter(d.provider_name)}</div>
          <div><div class="party-nm">${d.provider_name||'â€”'}</div><div class="party-role">Ø§Ù„Ù…Ø²ÙˆØ¯</div></div>
        </div>
      </div>
      ${d.resolution?`<div class="disp-res">âœ“ Ø§Ù„Ù‚Ø±Ø§Ø±: ${d.resolution}</div>`:''}
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        ${d.status==='open'?`
          <button class="btn btn-g btn-sm" onclick="resolveDispModal(${d.id})">${S(I.check)} Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹</button>
          <button class="btn btn-b btn-sm" onclick="notifyBothModal(${d.client_id},${d.provider_id})">${S(I.bell)} Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†</button>
        `:''}
        <button class="btn btn-sub btn-sm" onclick="viewProjModal(${d.request_id})">${S(I.proj)} Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
      </div>
    </div>`;
  }).join('');
}

function resolveDispModal(id){
  openM('Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹',
    `<div class="fg"><label class="fl">Ø§Ù„Ù‚Ø±Ø§Ø± <span class="fh">*</span></label>
       <select class="fsel-f" id="rdSide">
         <option value="client">Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
         <option value="provider">Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø²ÙˆØ¯</option>
         <option value="mutual">ØªØ³ÙˆÙŠØ© Ù…Ø´ØªØ±ÙƒØ©</option>
       </select>
     </div>
     <div class="fg"><label class="fl">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø±</label>
       <textarea class="fta" id="rdRes" placeholder="Ø§Ø´Ø±Ø­ Ù‚Ø±Ø§Ø± Ø§Ù„Ø­Ù„ Ø¨ÙˆØ¶ÙˆØ­â€¦"></textarea>
     </div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button>
     <button class="btn btn-g" onclick="confirmResolveDisp(${id})">${S(I.check)} ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ù„</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--emerald-600)">${I.check}</svg>`,'var(--emerald-50)'
  );
}
async function confirmResolveDisp(id){
  const side=document.getElementById('rdSide')?.value;
  const resolution=document.getElementById('rdRes')?.value?.trim()||side;
  await api(`/api/admin/disputes/${id}/resolve`,{method:'PUT',body:JSON.stringify({resolution,decision:side})});
  closeM();toast('ØªÙ… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹ âœ…','success');
  addLog('Ø­Ù„ Ù†Ø²Ø§Ø¹',`#${id}`,'var(--emerald-600)');
  pgDisputes();
}

function notifyBothModal(cId,pId){
  openM('Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ†',
    `<div class="al-info alert">${S(I.info,'var(--blue-500)')} Ø³ÙŠÙØ±Ø³ÙÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø²ÙˆØ¯ ÙÙŠ Ø¢Ù†Ù ÙˆØ§Ø­Ø¯</div>
     <div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span class="fh">*</span></label><input type="text" class="fi" id="nbTitle" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>
     <div class="fg"><label class="fl">Ø§Ù„Ù†Øµ <span class="fh">*</span></label><textarea class="fta" id="nbBody" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±â€¦"></textarea></div>`,
    `<button class="btn btn-gh" onclick="closeM()">Ø¥Ù„ØºØ§Ø¡</button>
     <button class="btn btn-p" onclick="confirmNotifyBoth(${cId},${pId})">${S(I.send)} Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±ÙÙŠÙ†</button>`,
    `<svg viewBox="0 0 24 24" stroke="var(--violet-600)">${I.bell}</svg>`,'var(--violet-100)'
  );
}
async function confirmNotifyBoth(cId,pId){
  const title=document.getElementById('nbTitle')?.value?.trim();
  const body=document.getElementById('nbBody')?.value?.trim();
  if(!title||!body){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  await Promise.all([
    api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:cId,title,body,type:'admin'})}),
    api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:pId,title,body,type:'admin'})})
  ]);
  closeM();toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±ÙÙŠÙ† âœ…','success');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgNotifs(){
  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div><div class="pgs">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù…Ù†ØµØ©</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
      <div class="card">
        <div class="ch">
          <div class="ch-l">
            <div class="ch-ic" style="background:var(--violet-50)">${S(I.bell,'var(--violet-600)')}</div>
            <div><div class="ch-t">Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ</div><div class="ch-s">ÙŠØµÙ„ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ† ÙÙˆØ±Ø§Ù‹</div></div>
          </div>
        </div>
        <div class="cb">
          <div class="fg">
            <label class="fl">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙˆÙ†</label>
            <div class="notif-targets">
              <button class="notif-tgt on" onclick="setNTarget(this,'')">ğŸ‘¥ Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
              <button class="notif-tgt" onclick="setNTarget(this,'provider')">ğŸ”§ Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†</button>
              <button class="notif-tgt" onclick="setNTarget(this,'client')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
            </div>
            <input type="hidden" id="notifRole" value="">
          </div>
          <div class="divider"></div>
          <div class="fg"><label class="fl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="fh">*</span></label><input type="text" class="fi" id="notifTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø¶Ø­ ÙˆØ¬Ø°Ø§Ø¨"></div>
          <div class="fg"><label class="fl">Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± <span class="fh">*</span></label><textarea class="fta" id="notifBody" style="min-height:110px" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§â€¦"></textarea></div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-p" onclick="sendBroadcast()">${S(I.send)} Ø¥Ø±Ø³Ø§Ù„</button>
            <button class="btn btn-sub" onclick="document.getElementById('notifTitle').value='';document.getElementById('notifBody').value=''">Ù…Ø³Ø­</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="ch">
          <div class="ch-l">
            <div class="ch-ic" style="background:var(--blue-50)">${S(I.user,'var(--blue-600)')}</div>
            <div><div class="ch-t">Ø¥Ø´Ø¹Ø§Ø± ÙØ±Ø¯ÙŠ</div><div class="ch-s">Ø£Ø±Ø³Ù„ Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹ÙŠÙ†Ù‡</div></div>
          </div>
        </div>
        <div class="cb">
          <div class="fg"><label class="fl">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ID)</label><input type="number" class="fi" id="indUserId" placeholder="Ù…Ø«Ø§Ù„: 42"></div>
          <div class="fg"><label class="fl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span class="fh">*</span></label><input type="text" class="fi" id="indTitle" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></div>
          <div class="fg"><label class="fl">Ø§Ù„Ù†Øµ <span class="fh">*</span></label><textarea class="fta" id="indBody" style="min-height:110px" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±â€¦"></textarea></div>
          <button class="btn btn-b" onclick="sendIndividual()">${S(I.send)} Ø¥Ø±Ø³Ø§Ù„ ÙØ±Ø¯ÙŠ</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="ch">
        <div class="ch-l">
          <div class="ch-ic" style="background:var(--emerald-50)">${S(I.info,'var(--emerald-600)')}</div>
          <div class="ch-t">Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø©</div>
        </div>
      </div>
      <div class="cb">
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
          ${[
            ['ğŸ¯','ÙƒÙ† Ù…Ø­Ø¯Ø¯Ø§Ù‹','Ø§Ø°ÙƒØ± Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„ÙˆØ§Ø¶Ø­ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±'],
            ['âš¡','ÙƒÙ† Ù…ÙˆØ¬Ø²Ø§Ù‹','Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‚ØµÙŠØ± ÙŠÙÙ‚Ø±Ø£ Ø£ÙƒØ«Ø±'],
            ['ğŸ•','Ø§Ø®ØªØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª','Ø£Ø±Ø³Ù„ ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· (9Øµ-9Ù…)'],
          ].map(([ic,t,d])=>`<div style="background:var(--surface-2);border-radius:var(--r-lg);padding:14px;border:1px solid var(--border)">
            <div style="font-size:22px;margin-bottom:8px">${ic}</div>
            <div style="font-size:12px;font-weight:800;margin-bottom:4px">${t}</div>
            <div style="font-size:11px;color:var(--text-3);font-weight:600">${d}</div>
          </div>`).join('')}
        </div>
      </div>
    </div>
  `);
}

function setNTarget(btn,role){
  document.querySelectorAll('.notif-tgt').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById('notifRole').value=role;
}
async function sendBroadcast(){
  const title=document.getElementById('notifTitle')?.value?.trim();
  const body=document.getElementById('notifBody')?.value?.trim();
  const role=document.getElementById('notifRole')?.value;
  if(!title||!body){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  await api('/api/admin/notify',{method:'POST',body:JSON.stringify({title,body,role:role||undefined,type:'admin'})});
  toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…','success');
  addLog('Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ',title+(role?` â† ${role==='provider'?'Ø§Ù„Ù…Ø²ÙˆØ¯ÙˆÙ†':'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'}':''),'var(--violet-600)');
  document.getElementById('notifTitle').value='';
  document.getElementById('notifBody').value='';
}
async function sendIndividual(){
  const userId=document.getElementById('indUserId')?.value;
  const title=document.getElementById('indTitle')?.value?.trim();
  const body=document.getElementById('indBody')?.value?.trim();
  if(!userId||!title||!body){toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª','error');return;}
  await api('/api/admin/notify',{method:'POST',body:JSON.stringify({user_id:parseInt(userId),title,body,type:'admin'})});
  toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…','success');
  addLog('Ø¥Ø´Ø¹Ø§Ø± ÙØ±Ø¯ÙŠ',`#${userId}: ${title}`,'var(--blue-600)');
  document.getElementById('indTitle').value='';
  document.getElementById('indBody').value='';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pgReports(){
  loading();
  const [stats,reqs]=await Promise.all([api('/api/admin/stats'),api('/api/admin/requests')]);
  const s=stats||{};
  const reqs2=reqs||[];
  const cityCount={},catCount={};
  reqs2.forEach(r=>{
    if(r.city)cityCount[r.city]=(cityCount[r.city]||0)+1;
    if(r.category)catCount[r.category]=(catCount[r.category]||0)+1;
  });
  const topCities=Object.entries(cityCount).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const topCats=Object.entries(catCount).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const maxCity=topCities[0]?.[1]||1;
  const maxCat=topCats[0]?.[1]||1;
  const completionRate=reqs2.length?Math.round((s.completed||0)/reqs2.length*100):0;
  const winRate=s.total_bids&&s.won_bids?Math.round(s.won_bids/s.total_bids*100):0;

  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div><div class="pgs">Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ©</div></div>
    </div>

    <div class="sg" style="grid-template-columns:repeat(4,1fr)">
      ${miniStat('Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„',completionRate+'%','var(--emerald-600)','var(--emerald-50)')}
      ${miniStat('Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø±ÙˆØ¶/Ù…Ø´Ø±ÙˆØ¹',reqs2.length?Math.round((s.total_bids||0)/reqs2.length):0,'var(--violet-600)','var(--violet-50)')}
      ${miniStat('Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©',(s.open||0)+(s.in_progress||0),'var(--blue-600)','var(--blue-50)')}
      ${miniStat('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',reqs2.length,'var(--amber-600)','var(--amber-50)')}
    </div>

    <div class="two-col">
      <div class="card">
        <div class="ch">
          <div class="ch-l">
            <div class="ch-ic" style="background:var(--blue-50)">${S(I.bars,'var(--blue-600)')}</div>
            <div class="ch-t">Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø¯Ù† Ø·Ù„Ø¨Ø§Ù‹</div>
          </div>
        </div>
        <div class="cb">
          ${topCities.map(([city,count])=>`<div class="prog-row">
            <div class="prog-lbl">${city}</div>
            <div class="prog-bar"><div class="prog-fill" style="width:${Math.round(count/maxCity*100)}%;background:var(--blue-500)"></div></div>
            <div class="prog-val">${count}</div>
          </div>`).join('')||`<div class="es" style="padding:20px"><div class="es-s">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div></div>`}
        </div>
      </div>

      <div class="card">
        <div class="ch">
          <div class="ch-l">
            <div class="ch-ic" style="background:var(--violet-50)">${S(I.bars,'var(--violet-600)')}</div>
            <div class="ch-t">Ø£ÙƒØ«Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø·Ù„Ø¨Ø§Ù‹</div>
          </div>
        </div>
        <div class="cb">
          ${topCats.map(([cat,count])=>`<div class="prog-row">
            <div class="prog-lbl" style="min-width:120px">${cat}</div>
            <div class="prog-bar"><div class="prog-fill" style="width:${Math.round(count/maxCat*100)}%;background:var(--violet-600)"></div></div>
            <div class="prog-val">${count}</div>
          </div>`).join('')||`<div class="es" style="padding:20px"><div class="es-s">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div></div>`}
        </div>
      </div>
    </div>

    <div class="card">
      <div class="ch">
        <div class="ch-l">
          <div class="ch-ic" style="background:var(--emerald-50)">${S(I.zap,'var(--emerald-600)')}</div>
          <div class="ch-t">ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
        </div>
      </div>
      <div class="cb">
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;text-align:center">
          ${[
            {label:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',key:'pending_review',color:'var(--amber-600)',bg:'var(--amber-50)',border:'var(--amber-200)'},
            {label:'Ù…ÙØªÙˆØ­',key:'open',color:'var(--emerald-600)',bg:'var(--emerald-50)',border:'var(--emerald-200)'},
            {label:'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',key:'in_progress',color:'var(--blue-600)',bg:'var(--blue-50)',border:'var(--blue-100)'},
            {label:'Ù…ÙƒØªÙ…Ù„',key:'completed',color:'var(--violet-600)',bg:'var(--violet-50)',border:'var(--violet-200)'},
            {label:'Ù…Ø±ÙÙˆØ¶',key:'rejected',color:'var(--red-600)',bg:'var(--red-50)',border:'var(--red-100)'},
          ].map(item=>`
            <div style="background:${item.bg};border-radius:var(--r-xl);padding:18px 12px;border:1px solid ${item.border};transition:transform var(--t-fast)" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
              <div style="font-size:28px;font-weight:900;color:${item.color};margin-bottom:5px;letter-spacing:-.5px">${s[item.key]||0}</div>
              <div style="font-size:10px;font-weight:700;color:var(--text-2)">${item.label}</div>
              <div style="font-size:9px;color:var(--text-3);margin-top:3px;font-weight:600">${reqs2.length?Math.round((s[item.key]||0)/reqs2.length*100):0}%</div>
            </div>`).join('')}
        </div>
      </div>
    </div>
  `);
}

function miniStat(label,value,color,bg){
  return`<div class="sc">
    <div class="sc-val" style="color:${color};font-size:28px">${value}</div>
    <div class="sc-lbl">${label}</div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVITY LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgLog(){
  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</div><div class="pgs">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ù‡Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©</div></div>
      <div class="pga">
        <button class="btn btn-sub btn-sm" onclick="activityLog=[];pgLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
    </div>
    <div class="card">
      <div class="cb">
        ${activityLog.length?activityLog.map(l=>`
          <div class="log-item">
            <div class="log-dot" style="background:${l.color}"></div>
            <div class="log-body">
              <div class="log-action">${l.action}</div>
              <div class="log-detail">${l.detail}</div>
            </div>
            <div class="log-time">${l.time}</div>
          </div>`).join(''):`
          <div class="es">
            <div class="es-ic"><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
            <div class="es-t">Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº</div>
            <div class="es-s">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙƒÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ®Ø°Ù‡Ø§</div>
          </div>`}
      </div>
    </div>
  `);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pgSettings(){
  setContent(`
    <div class="pghd">
      <div><div class="pgt">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØµØ©</div><div class="pgs">ØªØ­ÙƒÙ… ÙÙŠ Ø³Ù„ÙˆÙƒ Ù…Ù†ØµØ© Ù…Ù†Ø§Ù‚ØµØ©</div></div>
    </div>
    <div class="two-col">
      <div>
        <div class="card">
          <div class="ch">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--violet-50)">${S('<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>','var(--violet-600)')}</div>
              <div class="ch-t">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</div>
            </div>
          </div>
          <div class="cb">
            ${settingRow('Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±','ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹ ÙŠÙ…Ø± Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹',true)}
            ${settingRow('Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†','Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ³Ø¬ÙŠÙ„ Ù…Ø²ÙˆØ¯ÙŠÙ† Ø¬Ø¯Ø¯ Ø¨Ø¯ÙˆÙ† Ù…Ø±Ø§Ø¬Ø¹Ø©',false)}
            ${settingRow('Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯',true)}
            ${settingRow('ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©','Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„ØµÙŠØ§Ù†Ø©',false)}
          </div>
        </div>

        <div class="card">
          <div class="ch">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--amber-50)">${S(I.dollar,'var(--amber-600)')}</div>
              <div class="ch-t">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            </div>
          </div>
          <div class="cb">
            <div class="fg"><label class="fl">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±.Ø³)</label><input type="number" class="fi" value="100"></div>
            <div class="fg"><label class="fl">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</label><input type="number" class="fi" value="20"></div>
            <div class="fg"><label class="fl">Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…ÙØªÙˆØ­ (Ø£ÙŠØ§Ù…)</label><input type="number" class="fi" value="30"></div>
            <button class="btn btn-p btn-sm" onclick="toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…','success')">${S(I.save)} Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          </div>
        </div>
      </div>

      <div>
        <div class="card">
          <div class="ch">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--emerald-50)">${S(I.shield,'var(--emerald-600)')}</div>
              <div class="ch-t">Ø§Ù„Ø£Ù…Ø§Ù†</div>
            </div>
          </div>
          <div class="cb">
            ${settingRow('Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (OTP)','Ø¥Ù„Ø²Ø§Ù…ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯',true)}
            ${settingRow('Rate Limiting','Ø­Ù…Ø§ÙŠØ© API Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØ±Ø·Ø©',true)}
            ${settingRow('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯','ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„',false)}
            ${settingRow('ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø°Ùˆ Ø¹Ø§Ù…Ù„ÙŠÙ†','Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·',false)}
          </div>
        </div>

        <div class="card" style="border-color:var(--red-200)">
          <div class="ch" style="background:var(--red-50)">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--red-100)">${S(I.alert,'var(--red-500)')}</div>
              <div class="ch-t" style="color:var(--red-700)">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</div>
            </div>
          </div>
          <div class="cb">
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-title" style="color:var(--red-600)">Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
                <div class="setting-desc">Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</div>
              </div>
              <button class="btn btn-r btn-sm" onclick="toast('Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹','error')">Ø­Ø°Ù</button>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-title" style="color:var(--red-600)">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                <div class="setting-desc">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
              </div>
              <button class="btn btn-r btn-sm" onclick="toast('Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹','error')">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="ch">
            <div class="ch-l">
              <div class="ch-ic" style="background:var(--blue-50)">${S(I.info,'var(--blue-600)')}</div>
              <div class="ch-t">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
            </div>
          </div>
          <div class="cb">
            <div class="ib-block">
              <div class="ir"><span class="ik">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</span><span class="iv">v3.0.0</span></div>
              <div class="ir"><span class="ik">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±</span><span class="iv">${me.name||'â€”'}</span></div>
              <div class="ir"><span class="ik">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span><span class="iv">${me.email||'â€”'}</span></div>
              <div class="ir"><span class="ik">Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</span><span class="iv">${new Date().toLocaleDateString('ar-SA')}</span></div>
              <div class="ir"><span class="ik">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span><span class="iv" style="color:var(--emerald-600)">â— Ù…ØªØµÙ„Ø©</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `);
}

function settingRow(title,desc,defaultOn){
  const id='tog_'+Math.random().toString(36).slice(2);
  return`<div class="setting-row">
    <label class="toggle-sw" for="${id}">
      <input type="checkbox" id="${id}"${defaultOn?' checked':''} onchange="toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','success')">
      <div class="toggle-track"><div class="toggle-thumb"></div></div>
    </label>
    <div class="setting-info">
      <div class="setting-title">${title}</div>
      <div class="setting-desc">${desc}</div>
    </div>
  </div>`;
}
