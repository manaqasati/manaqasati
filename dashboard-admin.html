<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†Ø§Ù‚ØµØ© â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:#f1f5f9;min-height:100vh;display:flex}
.side{width:240px;background:#1e3a8a;min-height:100vh;padding:24px 0;position:fixed;right:0;top:0}
.side-logo{padding:0 20px 24px;border-bottom:1px solid rgba(255,255,255,0.1)}
.side-logo h1{font-size:22px;font-weight:900;color:#fff}
.side-logo h1 span{color:#60a5fa}
.side-logo p{font-size:11px;color:#93c5fd;margin-top:3px}
.menu{padding:16px 0}
.menu-item{display:flex;align-items:center;gap:10px;padding:12px 20px;color:#cbd5e1;cursor:pointer;transition:.2s;font-size:14px;font-weight:600;border:none;background:none;width:100%;text-align:right;font-family:'Tajawal',sans-serif}
.menu-item:hover{background:rgba(255,255,255,0.08);color:#fff}
.menu-item.on{background:rgba(255,255,255,0.12);color:#fff;border-right:3px solid #60a5fa}
.menu-item .ic{font-size:18px;width:24px}
.main{margin-right:240px;flex:1;padding:24px}
.topbar{background:#fff;border-radius:12px;padding:16px 20px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
.topbar h2{font-size:18px;font-weight:800;color:#1e3a8a}
.topbar-right{display:flex;gap:10px;align-items:center}
.badge{background:#eff6ff;color:#1d4ed8;padding:5px 12px;border-radius:20px;font-size:13px;font-weight:700}
.logout{background:#fee2e2;color:#dc2626;padding:7px 14px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;border:none;font-family:'Tajawal',sans-serif}
.page{display:none}
.page.on{display:block}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:20px}
.stat{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);text-align:center}
.stat-ic{font-size:32px;margin-bottom:8px}
.stat-n{font-size:28px;font-weight:900;color:#1e3a8a}
.stat-t{font-size:13px;color:#64748b;margin-top:4px;font-weight:600}
.card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:16px}
.card h3{font-size:16px;font-weight:800;color:#1e3a8a;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid #f1f5f9}
table{width:100%;border-collapse:collapse}
th{text-align:right;padding:10px 12px;background:#f8fafc;font-size:13px;color:#64748b;font-weight:700}
td{padding:10px 12px;font-size:14px;color:#1e293b;border-bottom:1px solid #f1f5f9}
tr:last-child td{border-bottom:none}
.tag{padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700}
.tag-client{background:#eff6ff;color:#1d4ed8}
.tag-provider{background:#f0fdf4;color:#16a34a}
.tag-admin{background:#fef3c7;color:#d97706}
.tag-review{background:#fef3c7;color:#d97706}
.empty{text-align:center;padding:40px;color:#94a3b8;font-size:15px}
.loading{text-align:center;padding:30px;color:#64748b}
</style>
</head>
<body>
<div class="side">
  <div class="side-logo">
    <h1>Ù…Ù†Ø§Ù‚ØµØ©<span>.</span></h1>
    <p>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</p>
  </div>
  <div class="menu">
    <button class="menu-item on" onclick="show('home',this)"><span class="ic">ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="menu-item" onclick="show('users',this)"><span class="ic">ğŸ‘¥</span> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</button>
    <button class="menu-item" onclick="show('requests',this)"><span class="ic">ğŸ“‹</span> Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
    <button class="menu-item" onclick="show('bids',this)"><span class="ic">ğŸ’°</span> Ø§Ù„Ø¹Ø±ÙˆØ¶</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <h2 id="pageTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
    <div class="topbar-right">
      <span class="badge">ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
      <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
  <div class="page on" id="page-home">
    <div class="stats">
      <div class="stat"><div class="stat-ic">ğŸ‘¥</div><div class="stat-n" id="s-users">...</div><div class="stat-t">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div></div>
      <div class="stat"><div class="stat-ic">ğŸ“‹</div><div class="stat-n" id="s-requests">...</div><div class="stat-t">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div></div>
      <div class="stat"><div class="stat-ic">ğŸ’°</div><div class="stat-n" id="s-bids">...</div><div class="stat-t">Ø§Ù„Ø¹Ø±ÙˆØ¶</div></div>
      <div class="stat"><div class="stat-ic">ğŸ”§</div><div class="stat-n" id="s-providers">...</div><div class="stat-t">Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</div></div>
    </div>
    <div class="card">
      <h3>Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
      <div id="recent-users"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
  </div>
  <div class="page" id="page-users">
    <div class="card">
      <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
      <div id="all-users"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
  </div>
  <div class="page" id="page-requests">
    <div class="card">
      <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
      <div id="all-requests"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
  </div>
  <div class="page" id="page-bids">
    <div class="card">
      <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶</h3>
      <div id="all-bids"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
  </div>
</div>
<script>
var API='https://manaqasati-production.up.railway.app';
var user=JSON.parse(localStorage.getItem('user')||'{}');
if(!user.id){location.href='auth.html';}
function show(page,el){
  document.querySelectorAll('.page').forEach(function(p){p.className='page';});
  document.querySelectorAll('.menu-item').forEach(function(m){m.className='menu-item';});
  document.getElementById('page-'+page).className='page on';
  el.className='menu-item on';
  var titles={home:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',users:'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†',requests:'Ø§Ù„Ø·Ù„Ø¨Ø§Øª',bids:'Ø§Ù„Ø¹Ø±ÙˆØ¶'};
  document.getElementById('pageTitle').textContent=titles[page];
  if(page==='users')loadUsers();
  if(page==='requests')loadRequests();
  if(page==='bids')loadBids();
}
function logout(){localStorage.clear();location.href='auth.html';}
function roleTag(r){
  if(r==='admin')return '<span class="tag tag-admin">Ù…Ø¯ÙŠØ±</span>';
  if(r==='provider')return '<span class="tag tag-provider">Ù…Ø²ÙˆØ¯</span>';
  return '<span class="tag tag-client">Ø¹Ù…ÙŠÙ„</span>';
}
function loadStats(){
  fetch(API+'/api/admin/stats')
  .then(function(r){return r.json();})
  .then(function(d){
    document.getElementById('s-users').textContent=d.users||0;
    document.getElementById('s-requests').textContent=d.requests||0;
    document.getElementById('s-bids').textContent=d.bids||0;
    document.getElementById('s-providers').textContent=d.providers||0;
  }).catch(function(){});
}
function loadRecentUsers(){
  fetch(API+'/api/admin/users')
  .then(function(r){return r.json();})
  .then(function(users){
    if(!users.length){document.getElementById('recent-users').innerHTML='<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¨Ø¹Ø¯</div>';return;}
    var html='<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr>';
    users.slice(0,5).forEach(function(u){
      html+='<tr><td><strong>'+u.name+'</strong></td><td>'+u.email+'</td><td>'+roleTag(u.role)+'</td><td>'+new Date(u.created_at).toLocaleDateString('ar')+'</td></tr>';
    });
    html+='</table>';
    document.getElementById('recent-users').innerHTML=html;
  }).catch(function(){document.getElementById('recent-users').innerHTML='<div class="empty">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';});
}
function loadUsers(){
  document.getElementById('all-users').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/admin/users')
  .then(function(r){return r.json();})
  .then(function(users){
    if(!users.length){document.getElementById('all-users').innerHTML='<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¨Ø¹Ø¯</div>';return;}
    var html='<table><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr>';
    users.forEach(function(u,i){
      html+='<tr><td>'+(i+1)+'</td><td><strong>'+u.name+'</strong></td><td>'+u.email+'</td><td>'+(u.phone||'â€“')+'</td><td>'+roleTag(u.role)+'</td><td>'+new Date(u.created_at).toLocaleDateString('ar')+'</td></tr>';
    });
    html+='</table>';
    document.getElementById('all-users').innerHTML=html;
  }).catch(function(){document.getElementById('all-users').innerHTML='<div class="empty">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';});
}
function loadRequests(){
  document.getElementById('all-requests').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/requests')
  .then(function(r){return r.json();})
  .then(function(reqs){
    if(!reqs.length){document.getElementById('all-requests').innerHTML='<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>';return;}
    var html='<table><tr><th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>';
    reqs.forEach(function(r,i){
      html+='<tr><td>'+(i+1)+'</td><td><strong>'+r.title+'</strong></td><td>'+(r.client_name||'â€“')+'</td><td>'+(r.city||'â€“')+'</td><td><span class="tag tag-review">'+(r.status||'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')+'</span></td><td>'+new Date(r.created_at).toLocaleDateString('ar')+'</td></tr>';
    });
    html+='</table>';
    document.getElementById('all-requests').innerHTML=html;
  }).catch(function(){document.getElementById('all-requests').innerHTML='<div class="empty">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';});
}
function loadBids(){
  document.getElementById('all-bids').innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
  fetch(API+'/api/bids')
  .then(function(r){return r.json();})
  .then(function(bids){
    if(!bids.length){document.getElementById('all-bids').innerHTML='<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø¨Ø¹Ø¯</div>';return;}
    var html='<table><tr><th>#</th><th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>';
    bids.forEach(function(b,i){
      html+='<tr><td>'+(i+1)+'</td><td>#'+b.request_id+'</td><td>'+b.price+' Ø±.Ø³</td><td>'+(b.days||1)+' ÙŠÙˆÙ…</td><td><span class="tag tag-review">'+(b.status||'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±')+'</span></td><td>'+new Date(b.created_at).toLocaleDateString('ar')+'</td></tr>';
    });
    html+='</table>';
    document.getElementById('all-bids').innerHTML=html;
  }).catch(function(){document.getElementById('all-bids').innerHTML='<div class="empty">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';});
}
loadStats();
loadRecentUsers();
</script>
</body>
</html>
